import{r as S,j as l,R as Ad}from"./index-Cmnu-BXX.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cd=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kc=(...n)=>n.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ");/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Sd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rd=S.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:a,...c},h)=>S.createElement("svg",{ref:h,...Sd,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:kc("lucide",r),...c},[...a.map(([f,m])=>S.createElement(f,m)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=(n,e)=>{const t=S.forwardRef(({className:s,...r},i)=>S.createElement(Rd,{ref:i,iconNode:e,className:kc(`lucide-${Cd(n)}`,s),...r}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=de("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=de("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=de("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=de("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=de("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=de("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=de("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=de("CornerRightUp",[["polyline",{points:"10 9 15 4 20 9",key:"1lr6px"}],["path",{d:"M4 20h7a4 4 0 0 0 4-4V4",key:"1plgdj"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=de("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pc=de("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kd=de("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=de("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nd=de("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=de("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=de("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=de("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=de("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=de("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=de("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=de("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=de("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=de("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var cl={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Pd=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],a=n[t++],c=n[t++],h=((r&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(h>>10)),e[s++]=String.fromCharCode(56320+(h&1023))}else{const i=n[t++],a=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|a&63)}}return e.join("")},jc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],a=r+1<n.length,c=a?n[r+1]:0,h=r+2<n.length,f=h?n[r+2]:0,m=i>>2,_=(i&3)<<4|c>>4;let v=(c&15)<<2|f>>6,I=f&63;h||(I=64,a||(v=64)),s.push(t[m],t[_],t[v],t[I])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Dc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Pd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],c=r<n.length?t[n.charAt(r)]:0;++r;const f=r<n.length?t[n.charAt(r)]:64;++r;const _=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||c==null||f==null||_==null)throw new Dd;const v=i<<2|c>>4;if(s.push(v),f!==64){const I=c<<4&240|f>>2;if(s.push(I),_!==64){const C=f<<6&192|_;s.push(C)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Dd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jd=function(n){const e=Dc(n);return jc.encodeByteArray(e,!0)},pr=function(n){return jd(n).replace(/\./g,"")},Vc=function(n){try{return jc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Od=()=>Vd().__FIREBASE_DEFAULTS__,Md=()=>{if(typeof process>"u"||typeof cl>"u")return;const n=cl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ld=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Vc(n[1]);return e&&JSON.parse(e)},Mr=()=>{try{return Od()||Md()||Ld()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Oc=n=>{var e,t;return(t=(e=Mr())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Fd=n=>{const e=Oc(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Mc=()=>{var n;return(n=Mr())===null||n===void 0?void 0:n.config},Lc=n=>{var e;return(e=Mr())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[pr(JSON.stringify(t)),pr(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qd(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Oe())}function $d(){var n;const e=(n=Mr())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Gd(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Kd(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Hd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zd(){const n=Oe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Wd(){return!$d()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qd(){try{return typeof indexedDB=="object"}catch{return!1}}function Yd(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd="FirebaseError";class vt extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Jd,Object.setPrototypeOf(this,vt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bs.prototype.create)}}class bs{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?Xd(i,s):"Error",c=`${this.serviceName}: ${a} (${r}).`;return new vt(r,c,s)}}function Xd(n,e){return n.replace(Zd,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Zd=/\{\$([^}]+)}/g;function ef(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function gr(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],a=e[r];if(ul(i)&&ul(a)){if(!gr(i,a))return!1}else if(i!==a)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function ul(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function ns(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function ss(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function tf(n,e){const t=new nf(n,e);return t.subscribe.bind(t)}class nf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");sf(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=ki),r.error===void 0&&(r.error=ki),r.complete===void 0&&(r.complete=ki);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sf(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ki(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(n){return n&&n._delegate?n._delegate:n}class nn{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Ud;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(af(e))try{this.getOrInitializeService({instanceIdentifier:Xt})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Xt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Xt){return this.instances.has(e)}getOptions(e=Xt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);s===c&&a.resolve(r)}return r}onInit(e,t){var s;const r=this.normalizeInstanceIdentifier(t),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:of(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Xt){return this.component?this.component.multipleInstances?e:Xt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function of(n){return n===Xt?void 0:n}function af(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new rf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Z||(Z={}));const cf={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},uf=Z.INFO,hf={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},df=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=hf[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _o{constructor(e){this.name=e,this._logLevel=uf,this._logHandler=df,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}const ff=(n,e)=>e.some(t=>n instanceof t);let hl,dl;function mf(){return hl||(hl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pf(){return dl||(dl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fc=new WeakMap,qi=new WeakMap,Uc=new WeakMap,Ni=new WeakMap,vo=new WeakMap;function gf(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Dt(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Fc.set(t,n)}).catch(()=>{}),vo.set(e,n),e}function yf(n){if(qi.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});qi.set(n,e)}let $i={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return qi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Uc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Dt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _f(n){$i=n($i)}function vf(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Pi(this),e,...t);return Uc.set(s,e.sort?e.sort():[e]),Dt(s)}:pf().includes(n)?function(...e){return n.apply(Pi(this),e),Dt(Fc.get(this))}:function(...e){return Dt(n.apply(Pi(this),e))}}function xf(n){return typeof n=="function"?vf(n):(n instanceof IDBTransaction&&yf(n),ff(n,mf())?new Proxy(n,$i):n)}function Dt(n){if(n instanceof IDBRequest)return gf(n);if(Ni.has(n))return Ni.get(n);const e=xf(n);return e!==n&&(Ni.set(n,e),vo.set(e,n)),e}const Pi=n=>vo.get(n);function wf(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const a=indexedDB.open(n,e),c=Dt(a);return s&&a.addEventListener("upgradeneeded",h=>{s(Dt(a.result),h.oldVersion,h.newVersion,Dt(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),c.then(h=>{i&&h.addEventListener("close",()=>i()),r&&h.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),c}const bf=["get","getKey","getAll","getAllKeys","count"],Ef=["put","add","delete","clear"],Di=new Map;function fl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Di.get(e))return Di.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Ef.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||bf.includes(t)))return;const i=async function(a,...c){const h=this.transaction(a,r?"readwrite":"readonly");let f=h.store;return s&&(f=f.index(c.shift())),(await Promise.all([f[t](...c),r&&h.done]))[0]};return Di.set(e,i),i}_f(n=>({...n,get:(e,t,s)=>fl(e,t)||n.get(e,t,s),has:(e,t)=>!!fl(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Tf(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Tf(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Gi="@firebase/app",ml="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pt=new _o("@firebase/app"),Af="@firebase/app-compat",Cf="@firebase/analytics-compat",Sf="@firebase/analytics",Rf="@firebase/app-check-compat",kf="@firebase/app-check",Nf="@firebase/auth",Pf="@firebase/auth-compat",Df="@firebase/database",jf="@firebase/data-connect",Vf="@firebase/database-compat",Of="@firebase/functions",Mf="@firebase/functions-compat",Lf="@firebase/installations",Ff="@firebase/installations-compat",Uf="@firebase/messaging",Bf="@firebase/messaging-compat",qf="@firebase/performance",$f="@firebase/performance-compat",Gf="@firebase/remote-config",Kf="@firebase/remote-config-compat",Hf="@firebase/storage",zf="@firebase/storage-compat",Wf="@firebase/firestore",Qf="@firebase/vertexai-preview",Yf="@firebase/firestore-compat",Jf="firebase",Xf="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki="[DEFAULT]",Zf={[Gi]:"fire-core",[Af]:"fire-core-compat",[Sf]:"fire-analytics",[Cf]:"fire-analytics-compat",[kf]:"fire-app-check",[Rf]:"fire-app-check-compat",[Nf]:"fire-auth",[Pf]:"fire-auth-compat",[Df]:"fire-rtdb",[jf]:"fire-data-connect",[Vf]:"fire-rtdb-compat",[Of]:"fire-fn",[Mf]:"fire-fn-compat",[Lf]:"fire-iid",[Ff]:"fire-iid-compat",[Uf]:"fire-fcm",[Bf]:"fire-fcm-compat",[qf]:"fire-perf",[$f]:"fire-perf-compat",[Gf]:"fire-rc",[Kf]:"fire-rc-compat",[Hf]:"fire-gcs",[zf]:"fire-gcs-compat",[Wf]:"fire-fst",[Yf]:"fire-fst-compat",[Qf]:"fire-vertex","fire-js":"fire-js",[Jf]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yr=new Map,em=new Map,Hi=new Map;function pl(n,e){try{n.container.addComponent(e)}catch(t){pt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function An(n){const e=n.name;if(Hi.has(e))return pt.debug(`There were multiple attempts to register component ${e}.`),!1;Hi.set(e,n);for(const t of yr.values())pl(t,n);for(const t of em.values())pl(t,n);return!0}function xo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ye(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},jt=new bs("app","Firebase",tm);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new nn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw jt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On=Xf;function Bc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Ki,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw jt.create("bad-app-name",{appName:String(r)});if(t||(t=Mc()),!t)throw jt.create("no-options");const i=yr.get(r);if(i){if(gr(t,i.options)&&gr(s,i.config))return i;throw jt.create("duplicate-app",{appName:r})}const a=new lf(r);for(const h of Hi.values())a.addComponent(h);const c=new nm(t,s,a);return yr.set(r,c),c}function qc(n=Ki){const e=yr.get(n);if(!e&&n===Ki&&Mc())return Bc();if(!e)throw jt.create("no-app",{appName:n});return e}function Vt(n,e,t){var s;let r=(s=Zf[n])!==null&&s!==void 0?s:n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),pt.warn(c.join(" "));return}An(new nn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm="firebase-heartbeat-database",rm=1,fs="firebase-heartbeat-store";let ji=null;function $c(){return ji||(ji=wf(sm,rm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fs)}catch(t){console.warn(t)}}}}).catch(n=>{throw jt.create("idb-open",{originalErrorMessage:n.message})})),ji}async function im(n){try{const t=(await $c()).transaction(fs),s=await t.objectStore(fs).get(Gc(n));return await t.done,s}catch(e){if(e instanceof vt)pt.warn(e.message);else{const t=jt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});pt.warn(t.message)}}}async function gl(n,e){try{const s=(await $c()).transaction(fs,"readwrite");await s.objectStore(fs).put(e,Gc(n)),await s.done}catch(t){if(t instanceof vt)pt.warn(t.message);else{const s=jt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});pt.warn(s.message)}}}function Gc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const om=1024,am=30*24*60*60*1e3;class lm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new um(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=yl();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const c=new Date(a.date).valueOf();return Date.now()-c<=am}),this._storage.overwrite(this._heartbeatsCache))}catch(s){pt.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=yl(),{heartbeatsToSend:s,unsentEntries:r}=cm(this._heartbeatsCache.heartbeats),i=pr(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return pt.warn(t),""}}}function yl(){return new Date().toISOString().substring(0,10)}function cm(n,e=om){const t=[];let s=n.slice();for(const r of n){const i=t.find(a=>a.agent===r.agent);if(i){if(i.dates.push(r.date),_l(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),_l(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class um{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qd()?Yd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await im(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return gl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return gl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function _l(n){return pr(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n){An(new nn("platform-logger",e=>new If(e),"PRIVATE")),An(new nn("heartbeat",e=>new lm(e),"PRIVATE")),Vt(Gi,ml,n),Vt(Gi,ml,"esm2017"),Vt("fire-js","")}hm("");var dm="firebase",fm="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vt(dm,fm,"app");function wo(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t}function Kc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const mm=Kc,Hc=new bs("auth","Firebase",Kc());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _r=new _o("@firebase/auth");function pm(n,...e){_r.logLevel<=Z.WARN&&_r.warn(`Auth (${On}): ${n}`,...e)}function ir(n,...e){_r.logLevel<=Z.ERROR&&_r.error(`Auth (${On}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Je(n,...e){throw bo(n,...e)}function et(n,...e){return bo(n,...e)}function zc(n,e,t){const s=Object.assign(Object.assign({},mm()),{[e]:t});return new bs("auth","Firebase",s).create(e,{appName:n.name})}function tt(n){return zc(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function bo(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return Hc.create(n,...e)}function z(n,e,...t){if(!n)throw bo(e,...t)}function dt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ir(e),new Error(e)}function gt(n,e){n||dt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function gm(){return vl()==="http:"||vl()==="https:"}function vl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ym(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gm()||Kd()||"connection"in navigator)?navigator.onLine:!0}function _m(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e,t){this.shortDelay=e,this.longDelay=t,gt(t>e,"Short delay should be less than long delay!"),this.isMobile=qd()||Hd()}get(){return ym()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eo(n,e){gt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;dt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;dt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;dt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm=new Is(3e4,6e4);function ct(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function xt(n,e,t,s,r={}){return Qc(n,r,async()=>{let i={},a={};s&&(e==="GET"?a=s:i={body:JSON.stringify(s)});const c=Es(Object.assign({key:n.config.apiKey},a)).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const f=Object.assign({method:e,headers:h},i);return Gd()||(f.referrerPolicy="no-referrer"),Wc.fetch()(Yc(n,n.config.apiHost,t,c),f)})}async function Qc(n,e,t){n._canInitEmulator=!1;const s=Object.assign(Object.assign({},vm),e);try{const r=new bm(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Zs(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[h,f]=c.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Zs(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Zs(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Zs(n,"user-disabled",a);const m=s[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw zc(n,m,f);Je(n,m)}}catch(r){if(r instanceof vt)throw r;Je(n,"network-request-failed",{message:String(r)})}}async function Mn(n,e,t,s,r={}){const i=await xt(n,e,t,s,r);return"mfaPendingCredential"in i&&Je(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Yc(n,e,t,s){const r=`${e}${t}?${s}`;return n.config.emulator?Eo(n.config,r):`${n.config.apiScheme}://${r}`}function wm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bm{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(et(this.auth,"network-request-failed")),xm.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Zs(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=et(n,e,s);return r.customData._tokenResponse=t,r}function xl(n){return n!==void 0&&n.enterprise!==void 0}class Em{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return wm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Im(n,e){return xt(n,"GET","/v2/recaptchaConfig",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tm(n,e){return xt(n,"POST","/v1/accounts:delete",e)}async function Jc(n,e){return xt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Am(n,e=!1){const t=ye(n),s=await t.getIdToken(e),r=Io(s);z(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:ls(Vi(r.auth_time)),issuedAtTime:ls(Vi(r.iat)),expirationTime:ls(Vi(r.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Vi(n){return Number(n)*1e3}function Io(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return ir("JWT malformed, contained fewer than 3 sections"),null;try{const r=Vc(t);return r?JSON.parse(r):(ir("Failed to decode base64 JWT payload"),null)}catch(r){return ir("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function wl(n){const e=Io(n);return z(e,"internal-error"),z(typeof e.exp<"u","internal-error"),z(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ms(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof vt&&Cm(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Cm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ls(this.lastLoginAt),this.creationTime=ls(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vr(n){var e;const t=n.auth,s=await n.getIdToken(),r=await ms(n,Jc(t,{idToken:s}));z(r==null?void 0:r.users.length,t,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Xc(i.providerUserInfo):[],c=km(n.providerData,a),h=n.isAnonymous,f=!(n.email&&i.passwordHash)&&!(c!=null&&c.length),m=h?f:!1,_={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Wi(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(n,_)}async function Rm(n){const e=ye(n);await vr(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function km(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function Xc(n){return n.map(e=>{var{providerId:t}=e,s=wo(e,["providerId"]);return{providerId:t,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nm(n,e){const t=await Qc(n,{},async()=>{const s=Es({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,a=Yc(n,r,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Wc.fetch()(a,{method:"POST",headers:c,body:s})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Pm(n,e){return xt(n,"POST","/v2/accounts:revokeToken",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){z(e.idToken,"internal-error"),z(typeof e.idToken<"u","internal-error"),z(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):wl(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){z(e.length!==0,"internal-error");const t=wl(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(z(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Nm(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,a=new wn;return s&&(z(typeof s=="string","internal-error",{appName:e}),a.refreshToken=s),r&&(z(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),i&&(z(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wn,this.toJSON())}_performRefresh(){return dt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(n,e){z(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ft{constructor(e){var{uid:t,auth:s,stsTokenManager:r}=e,i=wo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Sm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Wi(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ms(this,this.stsTokenManager.getToken(this.auth,e));return z(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Am(this,e)}reload(){return Rm(this)}_assign(e){this!==e&&(z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ft(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await vr(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ye(this.auth.app))return Promise.reject(tt(this.auth));const e=await this.getIdToken();return await ms(this,Tm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,r,i,a,c,h,f,m;const _=(s=t.displayName)!==null&&s!==void 0?s:void 0,v=(r=t.email)!==null&&r!==void 0?r:void 0,I=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(a=t.photoURL)!==null&&a!==void 0?a:void 0,N=(c=t.tenantId)!==null&&c!==void 0?c:void 0,k=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,D=(f=t.createdAt)!==null&&f!==void 0?f:void 0,M=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:P,emailVerified:V,isAnonymous:B,providerData:L,stsTokenManager:w}=t;z(P&&w,e,"internal-error");const g=wn.fromJSON(this.name,w);z(typeof P=="string",e,"internal-error"),Ct(_,e.name),Ct(v,e.name),z(typeof V=="boolean",e,"internal-error"),z(typeof B=="boolean",e,"internal-error"),Ct(I,e.name),Ct(C,e.name),Ct(N,e.name),Ct(k,e.name),Ct(D,e.name),Ct(M,e.name);const y=new ft({uid:P,auth:e,email:v,emailVerified:V,displayName:_,isAnonymous:B,photoURL:C,phoneNumber:I,tenantId:N,stsTokenManager:g,createdAt:D,lastLoginAt:M});return L&&Array.isArray(L)&&(y.providerData=L.map(b=>Object.assign({},b))),k&&(y._redirectEventId=k),y}static async _fromIdTokenResponse(e,t,s=!1){const r=new wn;r.updateFromServerResponse(t);const i=new ft({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await vr(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];z(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?Xc(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),c=new wn;c.updateFromIdToken(s);const h=new ft({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:a}),f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Wi(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(h,f),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new Map;function mt(n){gt(n instanceof Function,"Expected a class definition");let e=bl.get(n);return e?(gt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,bl.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Zc.type="NONE";const El=Zc;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function or(n,e,t){return`firebase:${n}:${e}:${t}`}class bn{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=or(this.userKey,r.apiKey,i),this.fullPersistenceKey=or("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ft._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new bn(mt(El),e,s);const r=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let i=r[0]||mt(El);const a=or(s,e.config.apiKey,e.name);let c=null;for(const f of t)try{const m=await f._get(a);if(m){const _=ft._fromJSON(e,m);f!==i&&(c=_),i=f;break}}catch{}const h=r.filter(f=>f._shouldAllowMigration);return!i._shouldAllowMigration||!h.length?new bn(i,e,s):(i=h[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async f=>{if(f!==i)try{await f._remove(a)}catch{}})),new bn(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(su(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eu(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(iu(e))return"Blackberry";if(ou(e))return"Webos";if(tu(e))return"Safari";if((e.includes("chrome/")||nu(e))&&!e.includes("edge/"))return"Chrome";if(ru(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function eu(n=Oe()){return/firefox\//i.test(n)}function tu(n=Oe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nu(n=Oe()){return/crios\//i.test(n)}function su(n=Oe()){return/iemobile/i.test(n)}function ru(n=Oe()){return/android/i.test(n)}function iu(n=Oe()){return/blackberry/i.test(n)}function ou(n=Oe()){return/webos/i.test(n)}function To(n=Oe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Dm(n=Oe()){var e;return To(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function jm(){return zd()&&document.documentMode===10}function au(n=Oe()){return To(n)||ru(n)||ou(n)||iu(n)||/windows phone/i.test(n)||su(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(n,e=[]){let t;switch(n){case"Browser":t=Il(Oe());break;case"Worker":t=`${Il(Oe())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${On}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((a,c)=>{try{const h=e(i);a(h)}catch(h){c(h)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Om(n,e={}){return xt(n,"GET","/v2/passwordPolicy",ct(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mm=6;class Lm{constructor(e){var t,s,r,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Mm,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,r,i,a,c;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(s=h.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),h.isValid&&(h.isValid=(r=h.containsLowercaseLetter)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsUppercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(c=h.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),h}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tl(this),this.idTokenSubscription=new Tl(this),this.beforeStateQueue=new Vm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Hc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mt(t)),this._initializationPromise=this.queue(async()=>{var s,r;if(!this._deleted&&(this.persistenceManager=await bn.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Jc(this,{idToken:e}),s=await ft._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ye(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=r==null?void 0:r._redirectEventId,h=await this.tryRedirectSignIn(e);(!a||a===c)&&(h!=null&&h.user)&&(r=h.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return z(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await vr(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_m()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ye(this.app))return Promise.reject(tt(this));const t=e?ye(e):null;return t&&z(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&z(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ye(this.app)?Promise.reject(tt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ye(this.app)?Promise.reject(tt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Om(this),t=new Lm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new bs("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Pm(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&mt(e)||this._popupRedirectResolver;z(t,this,"argument-error"),this.redirectPersistenceManager=await bn.create(this,[mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(z(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,s,r);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return z(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(t["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&pm(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function wt(n){return ye(n)}class Tl{constructor(e){this.auth=e,this.observer=null,this.addObserver=tf(t=>this.observer=t)}get next(){return z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Um(n){Lr=n}function cu(n){return Lr.loadJS(n)}function Bm(){return Lr.recaptchaEnterpriseScript}function qm(){return Lr.gapiScript}function $m(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Gm="recaptcha-enterprise",Km="NO_RECAPTCHA";class Hm{constructor(e){this.type=Gm,this.auth=wt(e)}async verify(e="verify",t=!1){async function s(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{Im(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const f=new Em(h);return i.tenantId==null?i._agentRecaptchaConfig=f:i._tenantRecaptchaConfigs[i.tenantId]=f,a(f.siteKey)}}).catch(h=>{c(h)})})}function r(i,a,c){const h=window.grecaptcha;xl(h)?h.enterprise.ready(()=>{h.enterprise.execute(i,{action:e}).then(f=>{a(f)}).catch(()=>{a(Km)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{s(this.auth).then(c=>{if(!t&&xl(window.grecaptcha))r(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=Bm();h.length!==0&&(h+=c),cu(h).then(()=>{r(c,i,a)}).catch(f=>{a(f)})}}).catch(c=>{a(c)})})}}async function Al(n,e,t,s=!1){const r=new Hm(n);let i;try{i=await r.verify(t)}catch{i=await r.verify(t,!0)}const a=Object.assign({},e);return s?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function xr(n,e,t,s){var r;if(!((r=n._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Al(n,e,t,t==="getOobCode");return s(n,i)}else return s(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Al(n,e,t,t==="getOobCode");return s(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(n,e){const t=xo(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(gr(i,e??{}))return r;Je(r,"already-initialized")}return t.initialize({options:e})}function Wm(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(mt);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Qm(n,e,t){const s=wt(n);z(s._canInitEmulator,s,"emulator-config-failed"),z(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=uu(e),{host:a,port:c}=Ym(e),h=c===null?"":`:${c}`;s.config.emulator={url:`${i}//${a}${h}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),Jm()}function uu(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ym(n){const e=uu(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:Cl(s.substr(i.length+1))}}else{const[i,a]=s.split(":");return{host:i,port:Cl(a)}}}function Cl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Jm(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return dt("not implemented")}_getIdTokenResponse(e){return dt("not implemented")}_linkToIdToken(e,t){return dt("not implemented")}_getReauthenticationResolver(e){return dt("not implemented")}}async function Xm(n,e){return xt(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zm(n,e){return Mn(n,"POST","/v1/accounts:signInWithPassword",ct(n,e))}async function ep(n,e){return xt(n,"POST","/v1/accounts:sendOobCode",ct(n,e))}async function tp(n,e){return ep(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function np(n,e){return Mn(n,"POST","/v1/accounts:signInWithEmailLink",ct(n,e))}async function sp(n,e){return Mn(n,"POST","/v1/accounts:signInWithEmailLink",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps extends Ao{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ps(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new ps(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xr(e,t,"signInWithPassword",Zm);case"emailLink":return np(e,{email:this._email,oobCode:this._password});default:Je(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xr(e,s,"signUpPassword",Xm);case"emailLink":return sp(e,{idToken:t,email:this._email,oobCode:this._password});default:Je(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function En(n,e){return Mn(n,"POST","/v1/accounts:signInWithIdp",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp="http://localhost";class sn extends Ao{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Je("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=t,i=wo(t,["providerId","signInMethod"]);if(!s||!r)return null;const a=new sn(s,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return En(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,En(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,En(e,t)}buildRequest(){const e={requestUri:rp,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Es(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ip(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function op(n){const e=ns(ss(n)).link,t=e?ns(ss(e)).deep_link_id:null,s=ns(ss(n)).deep_link_id;return(s?ns(ss(s)).link:null)||s||t||e||n}class Co{constructor(e){var t,s,r,i,a,c;const h=ns(ss(e)),f=(t=h.apiKey)!==null&&t!==void 0?t:null,m=(s=h.oobCode)!==null&&s!==void 0?s:null,_=ip((r=h.mode)!==null&&r!==void 0?r:null);z(f&&m&&_,"argument-error"),this.apiKey=f,this.operation=_,this.code=m,this.continueUrl=(i=h.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=h.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(c=h.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const t=op(e);try{return new Co(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(){this.providerId=Ln.PROVIDER_ID}static credential(e,t){return ps._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Co.parseLink(t);return z(s,"argument-error"),ps._fromEmailAndCode(e,s.code,s.tenantId)}}Ln.PROVIDER_ID="password";Ln.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ln.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends hu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St extends Ts{constructor(){super("facebook.com")}static credential(e){return sn._fromParams({providerId:St.PROVIDER_ID,signInMethod:St.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return St.credentialFromTaggedObject(e)}static credentialFromError(e){return St.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return St.credential(e.oauthAccessToken)}catch{return null}}}St.FACEBOOK_SIGN_IN_METHOD="facebook.com";St.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt extends Ts{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sn._fromParams({providerId:Rt.PROVIDER_ID,signInMethod:Rt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rt.credentialFromTaggedObject(e)}static credentialFromError(e){return Rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Rt.credential(t,s)}catch{return null}}}Rt.GOOGLE_SIGN_IN_METHOD="google.com";Rt.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt extends Ts{constructor(){super("github.com")}static credential(e){return sn._fromParams({providerId:kt.PROVIDER_ID,signInMethod:kt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return kt.credentialFromTaggedObject(e)}static credentialFromError(e){return kt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return kt.credential(e.oauthAccessToken)}catch{return null}}}kt.GITHUB_SIGN_IN_METHOD="github.com";kt.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt extends Ts{constructor(){super("twitter.com")}static credential(e,t){return sn._fromParams({providerId:Nt.PROVIDER_ID,signInMethod:Nt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Nt.credentialFromTaggedObject(e)}static credentialFromError(e){return Nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Nt.credential(t,s)}catch{return null}}}Nt.TWITTER_SIGN_IN_METHOD="twitter.com";Nt.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ap(n,e){return Mn(n,"POST","/v1/accounts:signUp",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await ft._fromIdTokenResponse(e,s,r),a=Sl(s);return new Ft({user:i,providerId:a,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=Sl(s);return new Ft({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function Sl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr extends vt{constructor(e,t,s,r){var i;super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,wr.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new wr(e,t,s,r)}}function du(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?wr._fromErrorAndOperation(n,i,e,s):i})}async function lp(n,e,t=!1){const s=await ms(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ft._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cp(n,e,t=!1){const{auth:s}=n;if(Ye(s.app))return Promise.reject(tt(s));const r="reauthenticate";try{const i=await ms(n,du(s,r,e,n),t);z(i.idToken,s,"internal-error");const a=Io(i.idToken);z(a,s,"internal-error");const{sub:c}=a;return z(n.uid===c,s,"user-mismatch"),Ft._forOperation(n,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Je(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fu(n,e,t=!1){if(Ye(n.app))return Promise.reject(tt(n));const s="signIn",r=await du(n,s,e),i=await Ft._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}async function up(n,e){return fu(wt(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hp(n,e){return Mn(n,"POST","/v1/accounts:signInWithCustomToken",ct(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dp(n,e){if(Ye(n.app))return Promise.reject(tt(n));const t=wt(n),s=await hp(t,{token:e,returnSecureToken:!0}),r=await Ft._fromIdTokenResponse(t,"signIn",s);return await t._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mu(n){const e=wt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function fp(n,e,t){const s=wt(n);await xr(s,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",tp)}async function mp(n,e,t){if(Ye(n.app))return Promise.reject(tt(n));const s=wt(n),a=await xr(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ap).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&mu(n),h}),c=await Ft._fromIdTokenResponse(s,"signIn",a);return await s._updateCurrentUser(c.user),c}function pp(n,e,t){return Ye(n.app)?Promise.reject(tt(n)):up(ye(n),Ln.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&mu(n),s})}function gp(n,e,t,s){return ye(n).onIdTokenChanged(e,t,s)}function yp(n,e,t){return ye(n).beforeAuthStateChanged(e,t)}function _p(n,e,t,s){return ye(n).onAuthStateChanged(e,t,s)}function vp(n){return ye(n).signOut()}const br="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(br,"1"),this.storage.removeItem(br),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp=1e3,wp=10;class gu extends pu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=au(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,h)=>{this.notifyListeners(a,h)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(s);!t&&this.localCache[s]===a||this.notifyListeners(s,a)},i=this.storage.getItem(s);jm()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,wp):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},xp)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}gu.type="LOCAL";const bp=gu;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu extends pu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}yu.type="SESSION";const _u=yu;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ep(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Fr(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const c=Array.from(a).map(async f=>f(t.origin,i)),h=await Ep(c);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Fr.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise((c,h)=>{const f=So("",20);r.port1.start();const m=setTimeout(()=>{h(new Error("unsupported_event"))},s);a={messageChannel:r,onMessage(_){const v=_;if(v.data.eventId===f)switch(v.data.status){case"ack":clearTimeout(m),i=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(v.data.response);break;default:clearTimeout(m),clearTimeout(i),h(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(){return window}function Tp(n){nt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vu(){return typeof nt().WorkerGlobalScope<"u"&&typeof nt().importScripts=="function"}async function Ap(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Cp(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Sp(){return vu()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xu="firebaseLocalStorageDb",Rp=1,Er="firebaseLocalStorage",wu="fbase_key";class As{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ur(n,e){return n.transaction([Er],e?"readwrite":"readonly").objectStore(Er)}function kp(){const n=indexedDB.deleteDatabase(xu);return new As(n).toPromise()}function Qi(){const n=indexedDB.open(xu,Rp);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Er,{keyPath:wu})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Er)?e(s):(s.close(),await kp(),e(await Qi()))})})}async function Rl(n,e,t){const s=Ur(n,!0).put({[wu]:e,value:t});return new As(s).toPromise()}async function Np(n,e){const t=Ur(n,!1).get(e),s=await new As(t).toPromise();return s===void 0?null:s.value}function kl(n,e){const t=Ur(n,!0).delete(e);return new As(t).toPromise()}const Pp=800,Dp=3;class bu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Qi(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>Dp)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fr._getInstance(Sp()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Ap(),!this.activeServiceWorker)return;this.sender=new Ip(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((t=s[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Cp()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Qi();return await Rl(e,br,"1"),await kl(e,br),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>Rl(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>Np(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>kl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Ur(r,!1).getAll();return new As(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Pp)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}bu.type="LOCAL";const jp=bu;new Is(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vp(n,e){return e?mt(e):(z(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro extends Ao{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return En(e,this._buildIdpRequest())}_linkToIdToken(e,t){return En(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return En(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Op(n){return fu(n.auth,new Ro(n),n.bypassAuthState)}function Mp(n){const{auth:e,user:t}=n;return z(t,e,"internal-error"),cp(t,new Ro(n),n.bypassAuthState)}async function Lp(n){const{auth:e,user:t}=n;return z(t,e,"internal-error"),lp(t,new Ro(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Op;case"linkViaPopup":case"linkViaRedirect":return Lp;case"reauthViaPopup":case"reauthViaRedirect":return Mp;default:Je(this.auth,"internal-error")}}resolve(e){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp=new Is(2e3,1e4);class vn extends Eu{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,vn.currentPopupAction&&vn.currentPopupAction.cancel(),vn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return z(e,this.auth,"internal-error"),e}async onExecution(){gt(this.filter.length===1,"Popup operations only handle one event");const e=So();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(et(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(et(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if(!((s=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(et(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Fp.get())};e()}}vn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up="pendingRedirect",ar=new Map;class Bp extends Eu{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=ar.get(this.auth._key());if(!e){try{const s=await qp(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}ar.set(this.auth._key(),e)}return this.bypassAuthState||ar.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function qp(n,e){const t=Kp(e),s=Gp(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function $p(n,e){ar.set(n._key(),e)}function Gp(n){return mt(n._redirectPersistence)}function Kp(n){return or(Up,n.config.apiKey,n.name)}async function Hp(n,e,t=!1){if(Ye(n.app))return Promise.reject(tt(n));const s=wt(n),r=Vp(s,e),a=await new Bp(s,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zp=10*60*1e3;class Wp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Qp(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!Iu(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";t.onError(et(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zp&&this.cachedEventUids.clear(),this.cachedEventUids.has(Nl(e))}saveEventToCache(e){this.cachedEventUids.add(Nl(e)),this.lastProcessedEventTime=Date.now()}}function Nl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Iu({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Qp(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Iu(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yp(n,e={}){return xt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xp=/^https?/;async function Zp(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Yp(n);for(const t of e)try{if(eg(t))return}catch{}Je(n,"unauthorized-domain")}function eg(n){const e=zi(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===s}if(!Xp.test(t))return!1;if(Jp.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg=new Is(3e4,6e4);function Pl(){const n=nt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function ng(n){return new Promise((e,t)=>{var s,r,i;function a(){Pl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Pl(),t(et(n,"network-request-failed"))},timeout:tg.get()})}if(!((r=(s=nt().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=nt().gapi)===null||i===void 0)&&i.load)a();else{const c=$m("iframefcb");return nt()[c]=()=>{gapi.load?a():t(et(n,"network-request-failed"))},cu(`${qm()}?onload=${c}`).catch(h=>t(h))}}).catch(e=>{throw lr=null,e})}let lr=null;function sg(n){return lr=lr||ng(n),lr}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rg=new Is(5e3,15e3),ig="__/auth/iframe",og="emulator/auth/iframe",ag={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lg=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cg(n){const e=n.config;z(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Eo(e,og):`https://${n.config.authDomain}/${ig}`,s={apiKey:e.apiKey,appName:n.name,v:On},r=lg.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${Es(s).slice(1)}`}async function ug(n){const e=await sg(n),t=nt().gapi;return z(t,n,"internal-error"),e.open({where:document.body,url:cg(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ag,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const a=et(n,"network-request-failed"),c=nt().setTimeout(()=>{i(a)},rg.get());function h(){nt().clearTimeout(c),r(s)}s.ping(h).then(h,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dg=500,fg=600,mg="_blank",pg="http://localhost";class Dl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function gg(n,e,t,s=dg,r=fg){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let c="";const h=Object.assign(Object.assign({},hg),{width:s.toString(),height:r.toString(),top:i,left:a}),f=Oe().toLowerCase();t&&(c=nu(f)?mg:t),eu(f)&&(e=e||pg,h.scrollbars="yes");const m=Object.entries(h).reduce((v,[I,C])=>`${v}${I}=${C},`,"");if(Dm(f)&&c!=="_self")return yg(e||"",c),new Dl(null);const _=window.open(e||"",c,m);z(_,n,"popup-blocked");try{_.focus()}catch{}return new Dl(_)}function yg(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _g="__/auth/handler",vg="emulator/auth/handler",xg=encodeURIComponent("fac");async function jl(n,e,t,s,r,i){z(n.config.authDomain,n,"auth-domain-config-required"),z(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:On,eventId:r};if(e instanceof hu){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ef(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,_]of Object.entries({}))a[m]=_}if(e instanceof Ts){const m=e.getScopes().filter(_=>_!=="");m.length>0&&(a.scopes=m.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const h=await n._getAppCheckToken(),f=h?`#${xg}=${encodeURIComponent(h)}`:"";return`${wg(n)}?${Es(c).slice(1)}${f}`}function wg({config:n}){return n.emulator?Eo(n,vg):`https://${n.authDomain}/${_g}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi="webStorageSupport";class bg{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_u,this._completeRedirectFn=Hp,this._overrideRedirectResult=$p}async _openPopup(e,t,s,r){var i;gt((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await jl(e,t,s,zi(),r);return gg(e,a,So())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await jl(e,t,s,zi(),r);return Tp(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(gt(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await ug(e),s=new Wp(e);return t.register("authEvent",r=>(z(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Oi,{type:Oi},r=>{var i;const a=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[Oi];a!==void 0&&t(!!a),Je(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Zp(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return au()||tu()||To()}}const Eg=bg;var Vl="@firebase/auth",Ol="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ag(n){An(new nn("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=s.options;z(a&&!a.includes(":"),"invalid-api-key",{appName:s.name});const h={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lu(n)},f=new Fm(s,r,i,h);return Wm(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),An(new nn("auth-internal",e=>{const t=wt(e.getProvider("auth").getImmediate());return(s=>new Ig(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Vt(Vl,Ol,Tg(n)),Vt(Vl,Ol,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cg=5*60,Sg=Lc("authIdTokenMaxAge")||Cg;let Ml=null;const Rg=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Sg)return;const r=t==null?void 0:t.token;Ml!==r&&(Ml=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Br(n=qc()){const e=xo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=zm(n,{popupRedirectResolver:Eg,persistence:[jp,bp,_u]}),s=Lc("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const a=Rg(i.toString());yp(t,a,()=>a(t.currentUser)),gp(t,c=>a(c))}}const r=Oc("auth");return r&&Qm(t,`http://${r}`),t}function kg(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Um({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=et("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",kg().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ag("Browser");var Ll=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var en,Tu;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,g){function y(){}y.prototype=g.prototype,w.D=g.prototype,w.prototype=new y,w.prototype.constructor=w,w.C=function(b,E,T){for(var x=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)x[fe-2]=arguments[fe];return g.prototype[E].apply(b,x)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(w,g,y){y||(y=0);var b=Array(16);if(typeof g=="string")for(var E=0;16>E;++E)b[E]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(E=0;16>E;++E)b[E]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=w.g[0],y=w.g[1],E=w.g[2];var T=w.g[3],x=g+(T^y&(E^T))+b[0]+3614090360&4294967295;g=y+(x<<7&4294967295|x>>>25),x=T+(E^g&(y^E))+b[1]+3905402710&4294967295,T=g+(x<<12&4294967295|x>>>20),x=E+(y^T&(g^y))+b[2]+606105819&4294967295,E=T+(x<<17&4294967295|x>>>15),x=y+(g^E&(T^g))+b[3]+3250441966&4294967295,y=E+(x<<22&4294967295|x>>>10),x=g+(T^y&(E^T))+b[4]+4118548399&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(E^g&(y^E))+b[5]+1200080426&4294967295,T=g+(x<<12&4294967295|x>>>20),x=E+(y^T&(g^y))+b[6]+2821735955&4294967295,E=T+(x<<17&4294967295|x>>>15),x=y+(g^E&(T^g))+b[7]+4249261313&4294967295,y=E+(x<<22&4294967295|x>>>10),x=g+(T^y&(E^T))+b[8]+1770035416&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(E^g&(y^E))+b[9]+2336552879&4294967295,T=g+(x<<12&4294967295|x>>>20),x=E+(y^T&(g^y))+b[10]+4294925233&4294967295,E=T+(x<<17&4294967295|x>>>15),x=y+(g^E&(T^g))+b[11]+2304563134&4294967295,y=E+(x<<22&4294967295|x>>>10),x=g+(T^y&(E^T))+b[12]+1804603682&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(E^g&(y^E))+b[13]+4254626195&4294967295,T=g+(x<<12&4294967295|x>>>20),x=E+(y^T&(g^y))+b[14]+2792965006&4294967295,E=T+(x<<17&4294967295|x>>>15),x=y+(g^E&(T^g))+b[15]+1236535329&4294967295,y=E+(x<<22&4294967295|x>>>10),x=g+(E^T&(y^E))+b[1]+4129170786&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^E&(g^y))+b[6]+3225465664&4294967295,T=g+(x<<9&4294967295|x>>>23),x=E+(g^y&(T^g))+b[11]+643717713&4294967295,E=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(E^T))+b[0]+3921069994&4294967295,y=E+(x<<20&4294967295|x>>>12),x=g+(E^T&(y^E))+b[5]+3593408605&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^E&(g^y))+b[10]+38016083&4294967295,T=g+(x<<9&4294967295|x>>>23),x=E+(g^y&(T^g))+b[15]+3634488961&4294967295,E=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(E^T))+b[4]+3889429448&4294967295,y=E+(x<<20&4294967295|x>>>12),x=g+(E^T&(y^E))+b[9]+568446438&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^E&(g^y))+b[14]+3275163606&4294967295,T=g+(x<<9&4294967295|x>>>23),x=E+(g^y&(T^g))+b[3]+4107603335&4294967295,E=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(E^T))+b[8]+1163531501&4294967295,y=E+(x<<20&4294967295|x>>>12),x=g+(E^T&(y^E))+b[13]+2850285829&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^E&(g^y))+b[2]+4243563512&4294967295,T=g+(x<<9&4294967295|x>>>23),x=E+(g^y&(T^g))+b[7]+1735328473&4294967295,E=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(E^T))+b[12]+2368359562&4294967295,y=E+(x<<20&4294967295|x>>>12),x=g+(y^E^T)+b[5]+4294588738&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^E)+b[8]+2272392833&4294967295,T=g+(x<<11&4294967295|x>>>21),x=E+(T^g^y)+b[11]+1839030562&4294967295,E=T+(x<<16&4294967295|x>>>16),x=y+(E^T^g)+b[14]+4259657740&4294967295,y=E+(x<<23&4294967295|x>>>9),x=g+(y^E^T)+b[1]+2763975236&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^E)+b[4]+1272893353&4294967295,T=g+(x<<11&4294967295|x>>>21),x=E+(T^g^y)+b[7]+4139469664&4294967295,E=T+(x<<16&4294967295|x>>>16),x=y+(E^T^g)+b[10]+3200236656&4294967295,y=E+(x<<23&4294967295|x>>>9),x=g+(y^E^T)+b[13]+681279174&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^E)+b[0]+3936430074&4294967295,T=g+(x<<11&4294967295|x>>>21),x=E+(T^g^y)+b[3]+3572445317&4294967295,E=T+(x<<16&4294967295|x>>>16),x=y+(E^T^g)+b[6]+76029189&4294967295,y=E+(x<<23&4294967295|x>>>9),x=g+(y^E^T)+b[9]+3654602809&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^E)+b[12]+3873151461&4294967295,T=g+(x<<11&4294967295|x>>>21),x=E+(T^g^y)+b[15]+530742520&4294967295,E=T+(x<<16&4294967295|x>>>16),x=y+(E^T^g)+b[2]+3299628645&4294967295,y=E+(x<<23&4294967295|x>>>9),x=g+(E^(y|~T))+b[0]+4096336452&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~E))+b[7]+1126891415&4294967295,T=g+(x<<10&4294967295|x>>>22),x=E+(g^(T|~y))+b[14]+2878612391&4294967295,E=T+(x<<15&4294967295|x>>>17),x=y+(T^(E|~g))+b[5]+4237533241&4294967295,y=E+(x<<21&4294967295|x>>>11),x=g+(E^(y|~T))+b[12]+1700485571&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~E))+b[3]+2399980690&4294967295,T=g+(x<<10&4294967295|x>>>22),x=E+(g^(T|~y))+b[10]+4293915773&4294967295,E=T+(x<<15&4294967295|x>>>17),x=y+(T^(E|~g))+b[1]+2240044497&4294967295,y=E+(x<<21&4294967295|x>>>11),x=g+(E^(y|~T))+b[8]+1873313359&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~E))+b[15]+4264355552&4294967295,T=g+(x<<10&4294967295|x>>>22),x=E+(g^(T|~y))+b[6]+2734768916&4294967295,E=T+(x<<15&4294967295|x>>>17),x=y+(T^(E|~g))+b[13]+1309151649&4294967295,y=E+(x<<21&4294967295|x>>>11),x=g+(E^(y|~T))+b[4]+4149444226&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~E))+b[11]+3174756917&4294967295,T=g+(x<<10&4294967295|x>>>22),x=E+(g^(T|~y))+b[2]+718787259&4294967295,E=T+(x<<15&4294967295|x>>>17),x=y+(T^(E|~g))+b[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(E+(x<<21&4294967295|x>>>11))&4294967295,w.g[2]=w.g[2]+E&4294967295,w.g[3]=w.g[3]+T&4294967295}s.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var y=g-this.blockSize,b=this.B,E=this.h,T=0;T<g;){if(E==0)for(;T<=y;)r(this,w,T),T+=this.blockSize;if(typeof w=="string"){for(;T<g;)if(b[E++]=w.charCodeAt(T++),E==this.blockSize){r(this,b),E=0;break}}else for(;T<g;)if(b[E++]=w[T++],E==this.blockSize){r(this,b),E=0;break}}this.h=E,this.o+=g},s.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var y=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=y&255,y/=256;for(this.u(w),w=Array(16),g=y=0;4>g;++g)for(var b=0;32>b;b+=8)w[y++]=this.g[g]>>>b&255;return w};function i(w,g){var y=c;return Object.prototype.hasOwnProperty.call(y,w)?y[w]:y[w]=g(w)}function a(w,g){this.h=g;for(var y=[],b=!0,E=w.length-1;0<=E;E--){var T=w[E]|0;b&&T==g||(y[E]=T,b=!1)}this.g=y}var c={};function h(w){return-128<=w&&128>w?i(w,function(g){return new a([g|0],0>g?-1:0)}):new a([w|0],0>w?-1:0)}function f(w){if(isNaN(w)||!isFinite(w))return _;if(0>w)return k(f(-w));for(var g=[],y=1,b=0;w>=y;b++)g[b]=w/y|0,y*=4294967296;return new a(g,0)}function m(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return k(m(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=f(Math.pow(g,8)),b=_,E=0;E<w.length;E+=8){var T=Math.min(8,w.length-E),x=parseInt(w.substring(E,E+T),g);8>T?(T=f(Math.pow(g,T)),b=b.j(T).add(f(x))):(b=b.j(y),b=b.add(f(x)))}return b}var _=h(0),v=h(1),I=h(16777216);n=a.prototype,n.m=function(){if(N(this))return-k(this).m();for(var w=0,g=1,y=0;y<this.g.length;y++){var b=this.i(y);w+=(0<=b?b:4294967296+b)*g,g*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(C(this))return"0";if(N(this))return"-"+k(this).toString(w);for(var g=f(Math.pow(w,6)),y=this,b="";;){var E=V(y,g).g;y=D(y,E.j(g));var T=((0<y.g.length?y.g[0]:y.h)>>>0).toString(w);if(y=E,C(y))return T+b;for(;6>T.length;)T="0"+T;b=T+b}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function C(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function N(w){return w.h==-1}n.l=function(w){return w=D(this,w),N(w)?-1:C(w)?0:1};function k(w){for(var g=w.g.length,y=[],b=0;b<g;b++)y[b]=~w.g[b];return new a(y,~w.h).add(v)}n.abs=function(){return N(this)?k(this):this},n.add=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],b=0,E=0;E<=g;E++){var T=b+(this.i(E)&65535)+(w.i(E)&65535),x=(T>>>16)+(this.i(E)>>>16)+(w.i(E)>>>16);b=x>>>16,T&=65535,x&=65535,y[E]=x<<16|T}return new a(y,y[y.length-1]&-2147483648?-1:0)};function D(w,g){return w.add(k(g))}n.j=function(w){if(C(this)||C(w))return _;if(N(this))return N(w)?k(this).j(k(w)):k(k(this).j(w));if(N(w))return k(this.j(k(w)));if(0>this.l(I)&&0>w.l(I))return f(this.m()*w.m());for(var g=this.g.length+w.g.length,y=[],b=0;b<2*g;b++)y[b]=0;for(b=0;b<this.g.length;b++)for(var E=0;E<w.g.length;E++){var T=this.i(b)>>>16,x=this.i(b)&65535,fe=w.i(E)>>>16,me=w.i(E)&65535;y[2*b+2*E]+=x*me,M(y,2*b+2*E),y[2*b+2*E+1]+=T*me,M(y,2*b+2*E+1),y[2*b+2*E+1]+=x*fe,M(y,2*b+2*E+1),y[2*b+2*E+2]+=T*fe,M(y,2*b+2*E+2)}for(b=0;b<g;b++)y[b]=y[2*b+1]<<16|y[2*b];for(b=g;b<2*g;b++)y[b]=0;return new a(y,0)};function M(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function P(w,g){this.g=w,this.h=g}function V(w,g){if(C(g))throw Error("division by zero");if(C(w))return new P(_,_);if(N(w))return g=V(k(w),g),new P(k(g.g),k(g.h));if(N(g))return g=V(w,k(g)),new P(k(g.g),g.h);if(30<w.g.length){if(N(w)||N(g))throw Error("slowDivide_ only works with positive integers.");for(var y=v,b=g;0>=b.l(w);)y=B(y),b=B(b);var E=L(y,1),T=L(b,1);for(b=L(b,2),y=L(y,2);!C(b);){var x=T.add(b);0>=x.l(w)&&(E=E.add(y),T=x),b=L(b,1),y=L(y,1)}return g=D(w,E.j(g)),new P(E,g)}for(E=_;0<=w.l(g);){for(y=Math.max(1,Math.floor(w.m()/g.m())),b=Math.ceil(Math.log(y)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),T=f(y),x=T.j(g);N(x)||0<x.l(w);)y-=b,T=f(y),x=T.j(g);C(T)&&(T=v),E=E.add(T),w=D(w,x)}return new P(E,w)}n.A=function(w){return V(this,w).h},n.and=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],b=0;b<g;b++)y[b]=this.i(b)&w.i(b);return new a(y,this.h&w.h)},n.or=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],b=0;b<g;b++)y[b]=this.i(b)|w.i(b);return new a(y,this.h|w.h)},n.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],b=0;b<g;b++)y[b]=this.i(b)^w.i(b);return new a(y,this.h^w.h)};function B(w){for(var g=w.g.length+1,y=[],b=0;b<g;b++)y[b]=w.i(b)<<1|w.i(b-1)>>>31;return new a(y,w.h)}function L(w,g){var y=g>>5;g%=32;for(var b=w.g.length-y,E=[],T=0;T<b;T++)E[T]=0<g?w.i(T+y)>>>g|w.i(T+y+1)<<32-g:w.i(T+y);return new a(E,w.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,Tu=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,en=a}).apply(typeof Ll<"u"?Ll:typeof self<"u"?self:typeof window<"u"?window:{});var er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Au,rs,Cu,cr,Yi,Su,Ru,ku;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,d){return o==Array.prototype||o==Object.prototype||(o[u]=d.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof er=="object"&&er];for(var u=0;u<o.length;++u){var d=o[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function r(o,u){if(u)e:{var d=s;o=o.split(".");for(var p=0;p<o.length-1;p++){var A=o[p];if(!(A in d))break e;d=d[A]}o=o[o.length-1],p=d[o],u=u(p),u!=p&&u!=null&&e(d,o,{configurable:!0,writable:!0,value:u})}}function i(o,u){o instanceof String&&(o+="");var d=0,p=!1,A={next:function(){if(!p&&d<o.length){var R=d++;return{value:u(R,o[R]),done:!1}}return p=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}r("Array.prototype.values",function(o){return o||function(){return i(this,function(u,d){return d})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function h(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function f(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function m(o,u,d){return o.call.apply(o.bind,arguments)}function _(o,u,d){if(!o)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,p),o.apply(u,A)}}return function(){return o.apply(u,arguments)}}function v(o,u,d){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:_,v.apply(null,arguments)}function I(o,u){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function C(o,u){function d(){}d.prototype=u.prototype,o.aa=u.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(p,A,R){for(var F=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)F[ie-2]=arguments[ie];return u.prototype[A].apply(p,F)}}function N(o){const u=o.length;if(0<u){const d=Array(u);for(let p=0;p<u;p++)d[p]=o[p];return d}return[]}function k(o,u){for(let d=1;d<arguments.length;d++){const p=arguments[d];if(h(p)){const A=o.length||0,R=p.length||0;o.length=A+R;for(let F=0;F<R;F++)o[A+F]=p[F]}else o.push(p)}}class D{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function M(o){return/^[\s\xa0]*$/.test(o)}function P(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function V(o){return V[" "](o),o}V[" "]=function(){};var B=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function L(o,u,d){for(const p in o)u.call(d,o[p],p,o)}function w(o,u){for(const d in o)u.call(void 0,o[d],d,o)}function g(o){const u={};for(const d in o)u[d]=o[d];return u}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(o,u){let d,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(d in p)o[d]=p[d];for(let R=0;R<y.length;R++)d=y[R],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function E(o){var u=1;o=o.split(":");const d=[];for(;0<u&&o.length;)d.push(o.shift()),u--;return o.length&&d.push(o.join(":")),d}function T(o){c.setTimeout(()=>{throw o},0)}function x(){var o=Xe;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class fe{constructor(){this.h=this.g=null}add(u,d){const p=me.get();p.set(u,d),this.h?this.h.next=p:this.g=p,this.h=p}}var me=new D(()=>new He,o=>o.reset());class He{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let qe,Ee=!1,Xe=new fe,bt=()=>{const o=c.Promise.resolve(void 0);qe=()=>{o.then(J)}};var J=()=>{for(var o;o=x();){try{o.h.call(o.g)}catch(d){T(d)}var u=me;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}Ee=!1};function U(){this.s=this.s,this.C=this.C}U.prototype.s=!1,U.prototype.ma=function(){this.s||(this.s=!0,this.N())},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function se(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var we=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};c.addEventListener("test",d,u),c.removeEventListener("test",d,u)}catch{}return o}();function oe(o,u){if(se.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(B){e:{try{V(u.nodeName);var A=!0;break e}catch{}A=!1}A||(u=null)}}else d=="mouseover"?u=o.fromElement:d=="mouseout"&&(u=o.toElement);this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:js[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&oe.aa.h.call(this)}}C(oe,se);var js={2:"touch",3:"pen",4:"mouse"};oe.prototype.h=function(){oe.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Et="closure_listenable_"+(1e6*Math.random()|0),Qh=0;function Yh(o,u,d,p,A){this.listener=o,this.proxy=null,this.src=u,this.type=d,this.capture=!!p,this.ha=A,this.key=++Qh,this.da=this.fa=!1}function Vs(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Os(o){this.src=o,this.g={},this.h=0}Os.prototype.add=function(o,u,d,p,A){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var F=li(o,u,p,A);return-1<F?(u=o[F],d||(u.fa=!1)):(u=new Yh(u,this.src,R,!!p,A),u.fa=d,o.push(u)),u};function ai(o,u){var d=u.type;if(d in o.g){var p=o.g[d],A=Array.prototype.indexOf.call(p,u,void 0),R;(R=0<=A)&&Array.prototype.splice.call(p,A,1),R&&(Vs(u),o.g[d].length==0&&(delete o.g[d],o.h--))}}function li(o,u,d,p){for(var A=0;A<o.length;++A){var R=o[A];if(!R.da&&R.listener==u&&R.capture==!!d&&R.ha==p)return A}return-1}var ci="closure_lm_"+(1e6*Math.random()|0),ui={};function ua(o,u,d,p,A){if(Array.isArray(u)){for(var R=0;R<u.length;R++)ua(o,u[R],d,p,A);return null}return d=fa(d),o&&o[Et]?o.K(u,d,f(p)?!!p.capture:!1,A):Jh(o,u,d,!1,p,A)}function Jh(o,u,d,p,A,R){if(!u)throw Error("Invalid event type");var F=f(A)?!!A.capture:!!A,ie=di(o);if(ie||(o[ci]=ie=new Os(o)),d=ie.add(u,d,p,F,R),d.proxy)return d;if(p=Xh(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)we||(A=F),A===void 0&&(A=!1),o.addEventListener(u.toString(),p,A);else if(o.attachEvent)o.attachEvent(da(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Xh(){function o(d){return u.call(o.src,o.listener,d)}const u=Zh;return o}function ha(o,u,d,p,A){if(Array.isArray(u))for(var R=0;R<u.length;R++)ha(o,u[R],d,p,A);else p=f(p)?!!p.capture:!!p,d=fa(d),o&&o[Et]?(o=o.i,u=String(u).toString(),u in o.g&&(R=o.g[u],d=li(R,d,p,A),-1<d&&(Vs(R[d]),Array.prototype.splice.call(R,d,1),R.length==0&&(delete o.g[u],o.h--)))):o&&(o=di(o))&&(u=o.g[u.toString()],o=-1,u&&(o=li(u,d,p,A)),(d=-1<o?u[o]:null)&&hi(d))}function hi(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Et])ai(u.i,o);else{var d=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(d,p,o.capture):u.detachEvent?u.detachEvent(da(d),p):u.addListener&&u.removeListener&&u.removeListener(p),(d=di(u))?(ai(d,o),d.h==0&&(d.src=null,u[ci]=null)):Vs(o)}}}function da(o){return o in ui?ui[o]:ui[o]="on"+o}function Zh(o,u){if(o.da)o=!0;else{u=new oe(u,this);var d=o.listener,p=o.ha||o.src;o.fa&&hi(o),o=d.call(p,u)}return o}function di(o){return o=o[ci],o instanceof Os?o:null}var fi="__closure_events_fn_"+(1e9*Math.random()>>>0);function fa(o){return typeof o=="function"?o:(o[fi]||(o[fi]=function(u){return o.handleEvent(u)}),o[fi])}function Re(){U.call(this),this.i=new Os(this),this.M=this,this.F=null}C(Re,U),Re.prototype[Et]=!0,Re.prototype.removeEventListener=function(o,u,d,p){ha(this,o,u,d,p)};function Me(o,u){var d,p=o.F;if(p)for(d=[];p;p=p.F)d.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new se(u,o);else if(u instanceof se)u.target=u.target||o;else{var A=u;u=new se(p,o),b(u,A)}if(A=!0,d)for(var R=d.length-1;0<=R;R--){var F=u.g=d[R];A=Ms(F,p,!0,u)&&A}if(F=u.g=o,A=Ms(F,p,!0,u)&&A,A=Ms(F,p,!1,u)&&A,d)for(R=0;R<d.length;R++)F=u.g=d[R],A=Ms(F,p,!1,u)&&A}Re.prototype.N=function(){if(Re.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var d=o.g[u],p=0;p<d.length;p++)Vs(d[p]);delete o.g[u],o.h--}}this.F=null},Re.prototype.K=function(o,u,d,p){return this.i.add(String(o),u,!1,d,p)},Re.prototype.L=function(o,u,d,p){return this.i.add(String(o),u,!0,d,p)};function Ms(o,u,d,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var A=!0,R=0;R<u.length;++R){var F=u[R];if(F&&!F.da&&F.capture==d){var ie=F.listener,Ie=F.ha||F.src;F.fa&&ai(o.i,F),A=ie.call(Ie,p)!==!1&&A}}return A&&!p.defaultPrevented}function ma(o,u,d){if(typeof o=="function")d&&(o=v(o,d));else if(o&&typeof o.handleEvent=="function")o=v(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function pa(o){o.g=ma(()=>{o.g=null,o.i&&(o.i=!1,pa(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class ed extends U{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:pa(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qn(o){U.call(this),this.h=o,this.g={}}C(qn,U);var ga=[];function ya(o){L(o.g,function(u,d){this.g.hasOwnProperty(d)&&hi(u)},o),o.g={}}qn.prototype.N=function(){qn.aa.N.call(this),ya(this)},qn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mi=c.JSON.stringify,td=c.JSON.parse,nd=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function pi(){}pi.prototype.h=null;function _a(o){return o.h||(o.h=o.i())}function va(){}var $n={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gi(){se.call(this,"d")}C(gi,se);function yi(){se.call(this,"c")}C(yi,se);var Wt={},xa=null;function Ls(){return xa=xa||new Re}Wt.La="serverreachability";function wa(o){se.call(this,Wt.La,o)}C(wa,se);function Gn(o){const u=Ls();Me(u,new wa(u))}Wt.STAT_EVENT="statevent";function ba(o,u){se.call(this,Wt.STAT_EVENT,o),this.stat=u}C(ba,se);function Le(o){const u=Ls();Me(u,new ba(u,o))}Wt.Ma="timingevent";function Ea(o,u){se.call(this,Wt.Ma,o),this.size=u}C(Ea,se);function Kn(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function Hn(){this.g=!0}Hn.prototype.xa=function(){this.g=!1};function sd(o,u,d,p,A,R){o.info(function(){if(o.g)if(R)for(var F="",ie=R.split("&"),Ie=0;Ie<ie.length;Ie++){var te=ie[Ie].split("=");if(1<te.length){var ke=te[0];te=te[1];var Ne=ke.split("_");F=2<=Ne.length&&Ne[1]=="type"?F+(ke+"="+te+"&"):F+(ke+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+u+`
`+d+`
`+F})}function rd(o,u,d,p,A,R,F){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+u+`
`+d+`
`+R+" "+F})}function dn(o,u,d,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+od(o,d)+(p?" "+p:"")})}function id(o,u){o.info(function(){return"TIMEOUT: "+u})}Hn.prototype.info=function(){};function od(o,u){if(!o.g)return u;if(!u)return null;try{var d=JSON.parse(u);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var p=d[o];if(!(2>p.length)){var A=p[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return mi(d)}catch{return u}}var Fs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ia={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},_i;function Us(){}C(Us,pi),Us.prototype.g=function(){return new XMLHttpRequest},Us.prototype.i=function(){return{}},_i=new Us;function It(o,u,d,p){this.j=o,this.i=u,this.l=d,this.R=p||1,this.U=new qn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ta}function Ta(){this.i=null,this.g="",this.h=!1}var Aa={},vi={};function xi(o,u,d){o.L=1,o.v=Gs(ut(u)),o.m=d,o.P=!0,Ca(o,null)}function Ca(o,u){o.F=Date.now(),Bs(o),o.A=ut(o.v);var d=o.A,p=o.R;Array.isArray(p)||(p=[String(p)]),Ba(d.i,"t",p),o.C=0,d=o.j.J,o.h=new Ta,o.g=il(o.j,d?u:null,!o.m),0<o.O&&(o.M=new ed(v(o.Y,o,o.g),o.O)),u=o.U,d=o.g,p=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(ga[0]=A.toString()),A=ga);for(var R=0;R<A.length;R++){var F=ua(d,A[R],p||u.handleEvent,!1,u.h||u);if(!F)break;u.g[F.key]=F}u=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Gn(),sd(o.i,o.u,o.A,o.l,o.R,o.m)}It.prototype.ca=function(o){o=o.target;const u=this.M;u&&ht(o)==3?u.j():this.Y(o)},It.prototype.Y=function(o){try{if(o==this.g)e:{const Ne=ht(this.g);var u=this.g.Ba();const pn=this.g.Z();if(!(3>Ne)&&(Ne!=3||this.g&&(this.h.h||this.g.oa()||Wa(this.g)))){this.J||Ne!=4||u==7||(u==8||0>=pn?Gn(3):Gn(2)),wi(this);var d=this.g.Z();this.X=d;t:if(Sa(this)){var p=Wa(this.g);o="";var A=p.length,R=ht(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Qt(this),zn(this);var F="";break t}this.h.i=new c.TextDecoder}for(u=0;u<A;u++)this.h.h=!0,o+=this.h.i.decode(p[u],{stream:!(R&&u==A-1)});p.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,rd(this.i,this.u,this.A,this.l,this.R,Ne,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Ie=this.g;if((ie=Ie.g?Ie.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(ie)){var te=ie;break t}}te=null}if(d=te)dn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bi(this,d);else{this.o=!1,this.s=3,Le(12),Qt(this),zn(this);break e}}if(this.P){d=!0;let Qe;for(;!this.J&&this.C<F.length;)if(Qe=ad(this,F),Qe==vi){Ne==4&&(this.s=4,Le(14),d=!1),dn(this.i,this.l,null,"[Incomplete Response]");break}else if(Qe==Aa){this.s=4,Le(15),dn(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else dn(this.i,this.l,Qe,null),bi(this,Qe);if(Sa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ne!=4||F.length!=0||this.h.h||(this.s=1,Le(16),d=!1),this.o=this.o&&d,!d)dn(this.i,this.l,F,"[Invalid Chunked Response]"),Qt(this),zn(this);else if(0<F.length&&!this.W){this.W=!0;var ke=this.j;ke.g==this&&ke.ba&&!ke.M&&(ke.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Si(ke),ke.M=!0,Le(11))}}else dn(this.i,this.l,F,null),bi(this,F);Ne==4&&Qt(this),this.o&&!this.J&&(Ne==4?tl(this.j,this):(this.o=!1,Bs(this)))}else Id(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,Le(12)):(this.s=0,Le(13)),Qt(this),zn(this)}}}catch{}finally{}};function Sa(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function ad(o,u){var d=o.C,p=u.indexOf(`
`,d);return p==-1?vi:(d=Number(u.substring(d,p)),isNaN(d)?Aa:(p+=1,p+d>u.length?vi:(u=u.slice(p,p+d),o.C=p+d,u)))}It.prototype.cancel=function(){this.J=!0,Qt(this)};function Bs(o){o.S=Date.now()+o.I,Ra(o,o.I)}function Ra(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Kn(v(o.ba,o),u)}function wi(o){o.B&&(c.clearTimeout(o.B),o.B=null)}It.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(id(this.i,this.A),this.L!=2&&(Gn(),Le(17)),Qt(this),this.s=2,zn(this)):Ra(this,this.S-o)};function zn(o){o.j.G==0||o.J||tl(o.j,o)}function Qt(o){wi(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,ya(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function bi(o,u){try{var d=o.j;if(d.G!=0&&(d.g==o||Ei(d.h,o))){if(!o.K&&Ei(d.h,o)&&d.G==3){try{var p=d.Da.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)Ys(d),Ws(d);else break e;Ci(d),Le(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&d.v==0&&!d.C&&(d.C=Kn(v(d.Za,d),6e3));if(1>=Pa(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Jt(d,11)}else if((o.K||d.g==o)&&Ys(d),!M(u))for(A=d.Da.g.parse(u),u=0;u<A.length;u++){let te=A[u];if(d.T=te[0],te=te[1],d.G==2)if(te[0]=="c"){d.K=te[1],d.ia=te[2];const ke=te[3];ke!=null&&(d.la=ke,d.j.info("VER="+d.la));const Ne=te[4];Ne!=null&&(d.Aa=Ne,d.j.info("SVER="+d.Aa));const pn=te[5];pn!=null&&typeof pn=="number"&&0<pn&&(p=1.5*pn,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const Qe=o.g;if(Qe){const Xs=Qe.g?Qe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xs){var R=p.h;R.g||Xs.indexOf("spdy")==-1&&Xs.indexOf("quic")==-1&&Xs.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Ii(R,R.h),R.h=null))}if(p.D){const Ri=Qe.g?Qe.g.getResponseHeader("X-HTTP-Session-Id"):null;Ri&&(p.ya=Ri,ae(p.I,p.D,Ri))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var F=o;if(p.qa=rl(p,p.J?p.ia:null,p.W),F.K){Da(p.h,F);var ie=F,Ie=p.L;Ie&&(ie.I=Ie),ie.B&&(wi(ie),Bs(ie)),p.g=F}else Za(p);0<d.i.length&&Qs(d)}else te[0]!="stop"&&te[0]!="close"||Jt(d,7);else d.G==3&&(te[0]=="stop"||te[0]=="close"?te[0]=="stop"?Jt(d,7):Ai(d):te[0]!="noop"&&d.l&&d.l.ta(te),d.v=0)}}Gn(4)}catch{}}var ld=class{constructor(o,u){this.g=o,this.map=u}};function ka(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Na(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Pa(o){return o.h?1:o.g?o.g.size:0}function Ei(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Ii(o,u){o.g?o.g.add(u):o.h=u}function Da(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}ka.prototype.cancel=function(){if(this.i=ja(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function ja(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const d of o.g.values())u=u.concat(d.D);return u}return N(o.i)}function cd(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(h(o)){for(var u=[],d=o.length,p=0;p<d;p++)u.push(o[p]);return u}u=[],d=0;for(p in o)u[d++]=o[p];return u}function ud(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(h(o)||typeof o=="string"){var u=[];o=o.length;for(var d=0;d<o;d++)u.push(d);return u}u=[],d=0;for(const p in o)u[d++]=p;return u}}}function Va(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(h(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var d=ud(o),p=cd(o),A=p.length,R=0;R<A;R++)u.call(void 0,p[R],d&&d[R],o)}var Oa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hd(o,u){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var p=o[d].indexOf("="),A=null;if(0<=p){var R=o[d].substring(0,p);A=o[d].substring(p+1)}else R=o[d];u(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Yt(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Yt){this.h=o.h,qs(this,o.j),this.o=o.o,this.g=o.g,$s(this,o.s),this.l=o.l;var u=o.i,d=new Yn;d.i=u.i,u.g&&(d.g=new Map(u.g),d.h=u.h),Ma(this,d),this.m=o.m}else o&&(u=String(o).match(Oa))?(this.h=!1,qs(this,u[1]||"",!0),this.o=Wn(u[2]||""),this.g=Wn(u[3]||"",!0),$s(this,u[4]),this.l=Wn(u[5]||"",!0),Ma(this,u[6]||"",!0),this.m=Wn(u[7]||"")):(this.h=!1,this.i=new Yn(null,this.h))}Yt.prototype.toString=function(){var o=[],u=this.j;u&&o.push(Qn(u,La,!0),":");var d=this.g;return(d||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Qn(u,La,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Qn(d,d.charAt(0)=="/"?md:fd,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Qn(d,gd)),o.join("")};function ut(o){return new Yt(o)}function qs(o,u,d){o.j=d?Wn(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function $s(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Ma(o,u,d){u instanceof Yn?(o.i=u,yd(o.i,o.h)):(d||(u=Qn(u,pd)),o.i=new Yn(u,o.h))}function ae(o,u,d){o.i.set(u,d)}function Gs(o){return ae(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Wn(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Qn(o,u,d){return typeof o=="string"?(o=encodeURI(o).replace(u,dd),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function dd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var La=/[#\/\?@]/g,fd=/[#\?:]/g,md=/[#\?]/g,pd=/[#\?@]/g,gd=/#/g;function Yn(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function Tt(o){o.g||(o.g=new Map,o.h=0,o.i&&hd(o.i,function(u,d){o.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=Yn.prototype,n.add=function(o,u){Tt(this),this.i=null,o=fn(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(u),this.h+=1,this};function Fa(o,u){Tt(o),u=fn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Ua(o,u){return Tt(o),u=fn(o,u),o.g.has(u)}n.forEach=function(o,u){Tt(this),this.g.forEach(function(d,p){d.forEach(function(A){o.call(u,A,p,this)},this)},this)},n.na=function(){Tt(this);const o=Array.from(this.g.values()),u=Array.from(this.g.keys()),d=[];for(let p=0;p<u.length;p++){const A=o[p];for(let R=0;R<A.length;R++)d.push(u[p])}return d},n.V=function(o){Tt(this);let u=[];if(typeof o=="string")Ua(this,o)&&(u=u.concat(this.g.get(fn(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)u=u.concat(o[d])}return u},n.set=function(o,u){return Tt(this),this.i=null,o=fn(this,o),Ua(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function Ba(o,u,d){Fa(o,u),0<d.length&&(o.i=null,o.g.set(fn(o,u),N(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(var d=0;d<u.length;d++){var p=u[d];const R=encodeURIComponent(String(p)),F=this.V(p);for(p=0;p<F.length;p++){var A=R;F[p]!==""&&(A+="="+encodeURIComponent(String(F[p]))),o.push(A)}}return this.i=o.join("&")};function fn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function yd(o,u){u&&!o.j&&(Tt(o),o.i=null,o.g.forEach(function(d,p){var A=p.toLowerCase();p!=A&&(Fa(this,p),Ba(this,A,d))},o)),o.j=u}function _d(o,u){const d=new Hn;if(c.Image){const p=new Image;p.onload=I(At,d,"TestLoadImage: loaded",!0,u,p),p.onerror=I(At,d,"TestLoadImage: error",!1,u,p),p.onabort=I(At,d,"TestLoadImage: abort",!1,u,p),p.ontimeout=I(At,d,"TestLoadImage: timeout",!1,u,p),c.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function vd(o,u){const d=new Hn,p=new AbortController,A=setTimeout(()=>{p.abort(),At(d,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(A),R.ok?At(d,"TestPingServer: ok",!0,u):At(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(A),At(d,"TestPingServer: error",!1,u)})}function At(o,u,d,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(d)}catch{}}function xd(){this.g=new nd}function wd(o,u,d){const p=d||"";try{Va(o,function(A,R){let F=A;f(A)&&(F=mi(A)),u.push(p+R+"="+encodeURIComponent(F))})}catch(A){throw u.push(p+"type="+encodeURIComponent("_badmap")),A}}function Ks(o){this.l=o.Ub||null,this.j=o.eb||!1}C(Ks,pi),Ks.prototype.g=function(){return new Hs(this.l,this.j)},Ks.prototype.i=function(o){return function(){return o}}({});function Hs(o,u){Re.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Hs,Re),n=Hs.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Xn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jn(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Xn(this)),this.g&&(this.readyState=3,Xn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qa(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function qa(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Jn(this):Xn(this),this.readyState==3&&qa(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Jn(this))},n.Qa=function(o){this.g&&(this.response=o,Jn(this))},n.ga=function(){this.g&&Jn(this)};function Jn(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Xn(o)}n.setRequestHeader=function(o,u){this.u.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=u.next();return o.join(`\r
`)};function Xn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Hs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function $a(o){let u="";return L(o,function(d,p){u+=p,u+=":",u+=d,u+=`\r
`}),u}function Ti(o,u,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=$a(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):ae(o,u,d))}function he(o){Re.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(he,Re);var bd=/^https?$/i,Ed=["POST","PUT"];n=he.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,u,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_i.g(),this.v=this.o?_a(this.o):_a(_i),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(R){Ga(this,R);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)d.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())d.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),A=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ed,u,void 0))||p||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,F]of d)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{za(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){Ga(this,R)}};function Ga(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,Ka(o),zs(o)}function Ka(o){o.A||(o.A=!0,Me(o,"complete"),Me(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Me(this,"complete"),Me(this,"abort"),zs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zs(this,!0)),he.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ha(this):this.bb())},n.bb=function(){Ha(this)};function Ha(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ht(o)!=4||o.Z()!=2)){if(o.u&&ht(o)==4)ma(o.Ea,0,o);else if(Me(o,"readystatechange"),ht(o)==4){o.h=!1;try{const F=o.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var p;if(p=F===0){var A=String(o.D).match(Oa)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),p=!bd.test(A?A.toLowerCase():"")}d=p}if(d)Me(o,"complete"),Me(o,"success");else{o.m=6;try{var R=2<ht(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",Ka(o)}}finally{zs(o)}}}}function zs(o,u){if(o.g){za(o);const d=o.g,p=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Me(o,"ready");try{d.onreadystatechange=p}catch{}}}function za(o){o.I&&(c.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function ht(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<ht(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),td(u)}};function Wa(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Id(o){const u={};o=(o.g&&2<=ht(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(M(o[p]))continue;var d=E(o[p]);const A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=u[A]||[];u[A]=R,R.push(d)}w(u,function(p){return p.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zn(o,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||u}function Qa(o){this.Aa=0,this.i=[],this.j=new Hn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Zn("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Zn("baseRetryDelayMs",5e3,o),this.cb=Zn("retryDelaySeedMs",1e4,o),this.Wa=Zn("forwardChannelMaxRetries",2,o),this.wa=Zn("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new ka(o&&o.concurrentRequestLimit),this.Da=new xd,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Qa.prototype,n.la=8,n.G=1,n.connect=function(o,u,d,p){Le(0),this.W=o,this.H=u||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=rl(this,null,this.W),Qs(this)};function Ai(o){if(Ya(o),o.G==3){var u=o.U++,d=ut(o.I);if(ae(d,"SID",o.K),ae(d,"RID",u),ae(d,"TYPE","terminate"),es(o,d),u=new It(o,o.j,u),u.L=2,u.v=Gs(ut(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=u.v,d=!0),d||(u.g=il(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Bs(u)}sl(o)}function Ws(o){o.g&&(Si(o),o.g.cancel(),o.g=null)}function Ya(o){Ws(o),o.u&&(c.clearTimeout(o.u),o.u=null),Ys(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function Qs(o){if(!Na(o.h)&&!o.s){o.s=!0;var u=o.Ga;qe||bt(),Ee||(qe(),Ee=!0),Xe.add(u,o),o.B=0}}function Td(o,u){return Pa(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Kn(v(o.Ga,o,u),nl(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const A=new It(this,this.j,o);let R=this.o;if(this.S&&(R?(R=g(R),b(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,4096<u){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Xa(this,A,u),d=ut(this.I),ae(d,"RID",o),ae(d,"CVER",22),this.D&&ae(d,"X-HTTP-Session-Id",this.D),es(this,d),R&&(this.O?u="headers="+encodeURIComponent(String($a(R)))+"&"+u:this.m&&Ti(d,this.m,R)),Ii(this.h,A),this.Ua&&ae(d,"TYPE","init"),this.P?(ae(d,"$req",u),ae(d,"SID","null"),A.T=!0,xi(A,d,null)):xi(A,d,u),this.G=2}}else this.G==3&&(o?Ja(this,o):this.i.length==0||Na(this.h)||Ja(this))};function Ja(o,u){var d;u?d=u.l:d=o.U++;const p=ut(o.I);ae(p,"SID",o.K),ae(p,"RID",d),ae(p,"AID",o.T),es(o,p),o.m&&o.o&&Ti(p,o.m,o.o),d=new It(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Xa(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ii(o.h,d),xi(d,p,u)}function es(o,u){o.H&&L(o.H,function(d,p){ae(u,p,d)}),o.l&&Va({},function(d,p){ae(u,p,d)})}function Xa(o,u,d){d=Math.min(o.i.length,d);var p=o.l?v(o.l.Na,o.l,o):null;e:{var A=o.i;let R=-1;for(;;){const F=["count="+d];R==-1?0<d?(R=A[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let ie=!0;for(let Ie=0;Ie<d;Ie++){let te=A[Ie].g;const ke=A[Ie].map;if(te-=R,0>te)R=Math.max(0,A[Ie].g-100),ie=!1;else try{wd(ke,F,"req"+te+"_")}catch{p&&p(ke)}}if(ie){p=F.join("&");break e}}}return o=o.i.splice(0,d),u.D=o,p}function Za(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;qe||bt(),Ee||(qe(),Ee=!0),Xe.add(u,o),o.v=0}}function Ci(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Kn(v(o.Fa,o),nl(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,el(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Kn(v(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Le(10),Ws(this),el(this))};function Si(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function el(o){o.g=new It(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=ut(o.qa);ae(u,"RID","rpc"),ae(u,"SID",o.K),ae(u,"AID",o.T),ae(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&ae(u,"TO",o.ja),ae(u,"TYPE","xmlhttp"),es(o,u),o.m&&o.o&&Ti(u,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Gs(ut(u)),d.m=null,d.P=!0,Ca(d,o)}n.Za=function(){this.C!=null&&(this.C=null,Ws(this),Ci(this),Le(19))};function Ys(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function tl(o,u){var d=null;if(o.g==u){Ys(o),Si(o),o.g=null;var p=2}else if(Ei(o.h,u))d=u.D,Da(o.h,u),p=1;else return;if(o.G!=0){if(u.o)if(p==1){d=u.m?u.m.length:0,u=Date.now()-u.F;var A=o.B;p=Ls(),Me(p,new Ea(p,d)),Qs(o)}else Za(o);else if(A=u.s,A==3||A==0&&0<u.X||!(p==1&&Td(o,u)||p==2&&Ci(o)))switch(d&&0<d.length&&(u=o.h,u.i=u.i.concat(d)),A){case 1:Jt(o,5);break;case 4:Jt(o,10);break;case 3:Jt(o,6);break;default:Jt(o,2)}}}function nl(o,u){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*u}function Jt(o,u){if(o.j.info("Error code "+u),u==2){var d=v(o.fb,o),p=o.Xa;const A=!p;p=new Yt(p||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||qs(p,"https"),Gs(p),A?_d(p.toString(),d):vd(p.toString(),d)}else Le(2);o.G=0,o.l&&o.l.sa(u),sl(o),Ya(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Le(2)):(this.j.info("Failed to ping google.com"),Le(1))};function sl(o){if(o.G=0,o.ka=[],o.l){const u=ja(o.h);(u.length!=0||o.i.length!=0)&&(k(o.ka,u),k(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function rl(o,u,d){var p=d instanceof Yt?ut(d):new Yt(d);if(p.g!="")u&&(p.g=u+"."+p.g),$s(p,p.s);else{var A=c.location;p=A.protocol,u=u?u+"."+A.hostname:A.hostname,A=+A.port;var R=new Yt(null);p&&qs(R,p),u&&(R.g=u),A&&$s(R,A),d&&(R.l=d),p=R}return d=o.D,u=o.ya,d&&u&&ae(p,d,u),ae(p,"VER",o.la),es(o,p),p}function il(o,u,d){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new he(new Ks({eb:d})):new he(o.pa),u.Ha(o.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ol(){}n=ol.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Js(){}Js.prototype.g=function(o,u){return new $e(o,u)};function $e(o,u){Re.call(this),this.g=new Qa(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!M(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!M(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new mn(this)}C($e,Re),$e.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$e.prototype.close=function(){Ai(this.g)},$e.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=mi(o),o=d);u.i.push(new ld(u.Ya++,o)),u.G==3&&Qs(u)},$e.prototype.N=function(){this.g.l=null,delete this.j,Ai(this.g),delete this.g,$e.aa.N.call(this)};function al(o){gi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const d in u){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}C(al,gi);function ll(){yi.call(this),this.status=1}C(ll,yi);function mn(o){this.g=o}C(mn,ol),mn.prototype.ua=function(){Me(this.g,"a")},mn.prototype.ta=function(o){Me(this.g,new al(o))},mn.prototype.sa=function(o){Me(this.g,new ll)},mn.prototype.ra=function(){Me(this.g,"b")},Js.prototype.createWebChannel=Js.prototype.g,$e.prototype.send=$e.prototype.o,$e.prototype.open=$e.prototype.m,$e.prototype.close=$e.prototype.close,ku=function(){return new Js},Ru=function(){return Ls()},Su=Wt,Yi={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fs.NO_ERROR=0,Fs.TIMEOUT=8,Fs.HTTP_ERROR=6,cr=Fs,Ia.COMPLETE="complete",Cu=Ia,va.EventType=$n,$n.OPEN="a",$n.CLOSE="b",$n.ERROR="c",$n.MESSAGE="d",Re.prototype.listen=Re.prototype.K,rs=va,he.prototype.listenOnce=he.prototype.L,he.prototype.getLastError=he.prototype.Ka,he.prototype.getLastErrorCode=he.prototype.Ba,he.prototype.getStatus=he.prototype.Z,he.prototype.getResponseJson=he.prototype.Oa,he.prototype.getResponseText=he.prototype.oa,he.prototype.send=he.prototype.ea,he.prototype.setWithCredentials=he.prototype.Ha,Au=he}).apply(typeof er<"u"?er:typeof self<"u"?self:typeof window<"u"?window:{});const Fl="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}De.UNAUTHENTICATED=new De(null),De.GOOGLE_CREDENTIALS=new De("google-credentials-uid"),De.FIRST_PARTY=new De("first-party-uid"),De.MOCK_USER=new De("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut=new _o("@firebase/firestore");function ts(){return Ut.logLevel}function Ng(n){Ut.setLogLevel(n)}function q(n,...e){if(Ut.logLevel<=Z.DEBUG){const t=e.map(ko);Ut.debug(`Firestore (${Fn}): ${n}`,...t)}}function yt(n,...e){if(Ut.logLevel<=Z.ERROR){const t=e.map(ko);Ut.error(`Firestore (${Fn}): ${n}`,...t)}}function Cn(n,...e){if(Ut.logLevel<=Z.WARN){const t=e.map(ko);Ut.warn(`Firestore (${Fn}): ${n}`,...t)}}function ko(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(n="Unexpected state"){const e=`FIRESTORE (${Fn}) INTERNAL ASSERTION FAILED: `+n;throw yt(e),new Error(e)}function re(n,e){n||W()}function Y(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $ extends vt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Pg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(De.UNAUTHENTICATED))}shutdown(){}}class Dg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jg{constructor(e){this.t=e,this.currentUser=De.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){re(this.o===void 0);let s=this.i;const r=h=>this.i!==s?(s=this.i,t(h)):Promise.resolve();let i=new Ot;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ot,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const h=i;e.enqueueRetryable(async()=>{await h.promise,await r(this.currentUser)})},c=h=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ot)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(re(typeof s.accessToken=="string"),new Nu(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return re(e===null||typeof e=="string"),new De(e)}}class Vg{constructor(e,t,s){this.l=e,this.h=t,this.P=s,this.type="FirstParty",this.user=De.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Og{constructor(e,t,s){this.l=e,this.h=t,this.P=s}getToken(){return Promise.resolve(new Vg(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(De.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Mg{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Lg{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){re(this.o===void 0);const s=i=>{i.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,q("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?r(i):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(re(typeof t.token=="string"),this.R=t.token,new Mg(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const r=Fg(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%e.length))}return s}}function ne(n,e){return n<e?-1:n>e?1:0}function Sn(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new $(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xe.fromMillis(Date.now())}static fromDate(e){return xe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*t));return new xe(t,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Q(e)}static min(){return new Q(new xe(0,0))}static max(){return new Q(new xe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t,s){t===void 0?t=0:t>e.length&&W(),s===void 0?s=e.length-t:s>e.length-t&&W(),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return gs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof gs?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class le extends gs{construct(e,t,s){return new le(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new $(j.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new le(t)}static emptyPath(){return new le([])}}const Ug=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ae extends gs{construct(e,t,s){return new Ae(e,t,s)}static isValidIdentifier(e){return Ug.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ae.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ae(["__name__"])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new $(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;r<e.length;){const c=e[r];if(c==="\\"){if(r+1===e.length)throw new $(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[r+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new $(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=h,r+=2}else c==="`"?(a=!a,r++):c!=="."||a?(s+=c,r++):(i(),r++)}if(i(),a)throw new $(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ae(t)}static emptyPath(){return new Ae([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.path=e}static fromPath(e){return new H(le.fromString(e))}static fromName(e){return new H(le.fromString(e).popFirst(5))}static empty(){return new H(le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&le.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return le.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new le(e.slice()))}}function Bg(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=Q.fromTimestamp(s===1e9?new xe(t+1,0):new xe(t,s));return new Bt(r,H.empty(),e)}function qg(n){return new Bt(n.readTime,n.key,-1)}class Bt{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Bt(Q.min(),H.empty(),-1)}static max(){return new Bt(Q.max(),H.empty(),-1)}}function $g(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=H.comparator(n.documentKey,e.documentKey),t!==0?t:ne(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Kg{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cs(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==Gg)throw n;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,s)=>{t(e)})}static reject(e){return new O((t,s)=>{s(e)})}static waitFor(e){return new O((t,s)=>{let r=0,i=0,a=!1;e.forEach(c=>{++r,c.next(()=>{++i,a&&i===r&&t()},h=>s(h))}),a=!0,i===r&&t()})}static or(e){let t=O.resolve(!1);for(const s of e)t=t.next(r=>r?O.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new O((s,r)=>{const i=e.length,a=new Array(i);let c=0;for(let h=0;h<i;h++){const f=h;t(e[f]).next(m=>{a[f]=m,++c,c===i&&s(a)},m=>r(m))}})}static doWhile(e,t){return new O((s,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):s()};i()})}}function Hg(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ss(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ie(s),this.se=s=>t.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}No.oe=-1;function qr(n){return n==null}function Ir(n){return n===0&&1/n==-1/0}function zg(n){return typeof n=="number"&&Number.isInteger(n)&&!Ir(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function un(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Du(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e,t){this.comparator=e,this.root=t||Te.EMPTY}insert(e,t){return new ue(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Te.BLACK,null,null))}remove(e){return new ue(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Te.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tr(this.root,e,this.comparator,!1)}getReverseIterator(){return new tr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tr(this.root,e,this.comparator,!0)}}class tr{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Te{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Te.RED,this.left=r??Te.EMPTY,this.right=i??Te.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Te(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Te.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Te.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Te.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Te.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw W();const e=this.left.check();if(e!==this.right.check())throw W();return e+(this.isRed()?0:1)}}Te.EMPTY=null,Te.RED=!0,Te.BLACK=!1;Te.EMPTY=new class{constructor(){this.size=0}get key(){throw W()}get value(){throw W()}get color(){throw W()}get left(){throw W()}get right(){throw W()}copy(e,t,s,r,i){return this}insert(e,t,s){return new Te(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.comparator=e,this.data=new ue(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bl(this.data.getIterator())}getIteratorFrom(e){return new Bl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof Ce)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ce(this.comparator);return t.data=e,t}}class Bl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e){this.fields=e,e.sort(Ae.comparator)}static empty(){return new Ge([])}unionWith(e){let t=new Ce(Ae.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Ge(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Sn(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ju("Invalid base64 string: "+i):i}}(e);return new Se(t)}static fromUint8Array(e){const t=function(r){let i="";for(let a=0;a<r.length;++a)i+=String.fromCharCode(r[a]);return i}(e);return new Se(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Se.EMPTY_BYTE_STRING=new Se("");const Wg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qt(n){if(re(!!n),typeof n=="string"){let e=0;const t=Wg.exec(n);if(re(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:pe(n.seconds),nanos:pe(n.nanos)}}function pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rn(n){return typeof n=="string"?Se.fromBase64String(n):Se.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Po(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Do(n){const e=n.mapValue.fields.__previous_value__;return Po(e)?Do(e):e}function ys(n){const e=qt(n.mapValue.fields.__local_write_time__.timestampValue);return new xe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(e,t,s,r,i,a,c,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=h,this.useFetchStreams=f}}class _s{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _s("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof _s&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr={mapValue:{}};function on(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Po(n)?4:Jg(n)?9007199254740991:Yg(n)?10:11:W()}function ot(n,e){if(n===e)return!0;const t=on(n);if(t!==on(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ys(n).isEqual(ys(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const a=qt(r.timestampValue),c=qt(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return rn(r.bytesValue).isEqual(rn(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return pe(r.geoPointValue.latitude)===pe(i.geoPointValue.latitude)&&pe(r.geoPointValue.longitude)===pe(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return pe(r.integerValue)===pe(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const a=pe(r.doubleValue),c=pe(i.doubleValue);return a===c?Ir(a)===Ir(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return Sn(n.arrayValue.values||[],e.arrayValue.values||[],ot);case 10:case 11:return function(r,i){const a=r.mapValue.fields||{},c=i.mapValue.fields||{};if(Ul(a)!==Ul(c))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(c[h]===void 0||!ot(a[h],c[h])))return!1;return!0}(n,e);default:return W()}}function vs(n,e){return(n.values||[]).find(t=>ot(t,e))!==void 0}function Rn(n,e){if(n===e)return 0;const t=on(n),s=on(e);if(t!==s)return ne(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return function(i,a){const c=pe(i.integerValue||i.doubleValue),h=pe(a.integerValue||a.doubleValue);return c<h?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1}(n,e);case 3:return ql(n.timestampValue,e.timestampValue);case 4:return ql(ys(n),ys(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return function(i,a){const c=rn(i),h=rn(a);return c.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const c=i.split("/"),h=a.split("/");for(let f=0;f<c.length&&f<h.length;f++){const m=ne(c[f],h[f]);if(m!==0)return m}return ne(c.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const c=ne(pe(i.latitude),pe(a.latitude));return c!==0?c:ne(pe(i.longitude),pe(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return $l(n.arrayValue,e.arrayValue);case 10:return function(i,a){var c,h,f,m;const _=i.fields||{},v=a.fields||{},I=(c=_.value)===null||c===void 0?void 0:c.arrayValue,C=(h=v.value)===null||h===void 0?void 0:h.arrayValue,N=ne(((f=I==null?void 0:I.values)===null||f===void 0?void 0:f.length)||0,((m=C==null?void 0:C.values)===null||m===void 0?void 0:m.length)||0);return N!==0?N:$l(I,C)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===nr.mapValue&&a===nr.mapValue)return 0;if(i===nr.mapValue)return 1;if(a===nr.mapValue)return-1;const c=i.fields||{},h=Object.keys(c),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let _=0;_<h.length&&_<m.length;++_){const v=ne(h[_],m[_]);if(v!==0)return v;const I=Rn(c[h[_]],f[m[_]]);if(I!==0)return I}return ne(h.length,m.length)}(n.mapValue,e.mapValue);default:throw W()}}function ql(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);const t=qt(n),s=qt(e),r=ne(t.seconds,s.seconds);return r!==0?r:ne(t.nanos,s.nanos)}function $l(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Rn(t[r],s[r]);if(i)return i}return ne(t.length,s.length)}function kn(n){return Ji(n)}function Ji(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=qt(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return rn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return H.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=Ji(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const a of s)i?i=!1:r+=",",r+=`${a}:${Ji(t.fields[a])}`;return r+"}"}(n.mapValue):W()}function Xi(n){return!!n&&"integerValue"in n}function jo(n){return!!n&&"arrayValue"in n}function Gl(n){return!!n&&"nullValue"in n}function Kl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ur(n){return!!n&&"mapValue"in n}function Yg(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function cs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return un(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=cs(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=cs(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Jg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.value=e}static empty(){return new Ue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!ur(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cs(t)}setAll(e){let t=Ae.emptyPath(),s={},r=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){const h=this.getFieldsMap(t);this.applyChanges(h,s,r),s={},r=[],t=c.popLast()}a?s[c.lastSegment()]=cs(a):r.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());ur(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];ur(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){un(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Ue(cs(this.value))}}function Vu(n){const e=[];return un(n.fields,(t,s)=>{const r=new Ae([t]);if(ur(s)){const i=Vu(s.mapValue).fields;if(i.length===0)e.push(r);else for(const a of i)e.push(r.child(a))}else e.push(r)}),new Ge(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e,t,s,r,i,a,c){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Ve(e,0,Q.min(),Q.min(),Q.min(),Ue.empty(),0)}static newFoundDocument(e,t,s,r){return new Ve(e,1,t,Q.min(),s,r,0)}static newNoDocument(e,t){return new Ve(e,2,t,Q.min(),Q.min(),Ue.empty(),0)}static newUnknownDocument(e,t){return new Ve(e,3,t,Q.min(),Q.min(),Ue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ve&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ve(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e,t){this.position=e,this.inclusive=t}}function Hl(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],a=n.position[r];if(i.field.isKeyField()?s=H.comparator(H.fromName(a.referenceValue),t.key):s=Rn(a,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function zl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ot(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,t="asc"){this.field=e,this.dir=t}}function Xg(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{}class _e extends Ou{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new ey(e,t,s):t==="array-contains"?new sy(e,s):t==="in"?new ry(e,s):t==="not-in"?new iy(e,s):t==="array-contains-any"?new oy(e,s):new _e(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new ty(e,s):new ny(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Rn(t,this.value)):t!==null&&on(this.value)===on(t)&&this.matchesComparison(Rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class at extends Ou{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new at(e,t)}matches(e){return Mu(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Mu(n){return n.op==="and"}function Lu(n){return Zg(n)&&Mu(n)}function Zg(n){for(const e of n.filters)if(e instanceof at)return!1;return!0}function Zi(n){if(n instanceof _e)return n.field.canonicalString()+n.op.toString()+kn(n.value);if(Lu(n))return n.filters.map(e=>Zi(e)).join(",");{const e=n.filters.map(t=>Zi(t)).join(",");return`${n.op}(${e})`}}function Fu(n,e){return n instanceof _e?function(s,r){return r instanceof _e&&s.op===r.op&&s.field.isEqual(r.field)&&ot(s.value,r.value)}(n,e):n instanceof at?function(s,r){return r instanceof at&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,a,c)=>i&&Fu(a,r.filters[c]),!0):!1}(n,e):void W()}function Uu(n){return n instanceof _e?function(t){return`${t.field.canonicalString()} ${t.op} ${kn(t.value)}`}(n):n instanceof at?function(t){return t.op.toString()+" {"+t.getFilters().map(Uu).join(" ,")+"}"}(n):"Filter"}class ey extends _e{constructor(e,t,s){super(e,t,s),this.key=H.fromName(s.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class ty extends _e{constructor(e,t){super(e,"in",t),this.keys=Bu("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ny extends _e{constructor(e,t){super(e,"not-in",t),this.keys=Bu("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Bu(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(s=>H.fromName(s.referenceValue))}class sy extends _e{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jo(t)&&vs(t.arrayValue,this.value)}}class ry extends _e{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&vs(this.value.arrayValue,t)}}class iy extends _e{constructor(e,t){super(e,"not-in",t)}matches(e){if(vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!vs(this.value.arrayValue,t)}}class oy extends _e{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>vs(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e,t=null,s=[],r=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=a,this.endAt=c,this.ue=null}}function Wl(n,e=null,t=[],s=[],r=null,i=null,a=null){return new ay(n,e,t,s,r,i,a)}function Vo(n){const e=Y(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>Zi(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),qr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>kn(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>kn(s)).join(",")),e.ue=t}return e.ue}function Oo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Xg(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Fu(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!zl(n.startAt,e.startAt)&&zl(n.endAt,e.endAt)}function eo(n){return H.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,t=null,s=[],r=[],i=null,a="F",c=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ly(n,e,t,s,r,i,a,c){return new $r(n,e,t,s,r,i,a,c)}function Gr(n){return new $r(n)}function Ql(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cy(n){return n.collectionGroup!==null}function us(n){const e=Y(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Ce(Ae.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(c=c.add(f.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Ar(i,s))}),t.has(Ae.keyField().canonicalString())||e.ce.push(new Ar(Ae.keyField(),s))}return e.ce}function st(n){const e=Y(n);return e.le||(e.le=uy(e,us(n))),e.le}function uy(n,e){if(n.limitType==="F")return Wl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new Ar(r.field,i)});const t=n.endAt?new Tr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Tr(n.startAt.position,n.startAt.inclusive):null;return Wl(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function to(n,e,t){return new $r(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Kr(n,e){return Oo(st(n),st(e))&&n.limitType===e.limitType}function qu(n){return`${Vo(st(n))}|lt:${n.limitType}`}function gn(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>Uu(r)).join(", ")}]`),qr(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>kn(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>kn(r)).join(",")),`Target(${s})`}(st(n))}; limitType=${n.limitType})`}function Hr(n,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):H.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,e)&&function(s,r){for(const i of us(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(a,c,h){const f=Hl(a,c,h);return a.inclusive?f<=0:f<0}(s.startAt,us(s),r)||s.endAt&&!function(a,c,h){const f=Hl(a,c,h);return a.inclusive?f>=0:f>0}(s.endAt,us(s),r))}(n,e)}function hy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $u(n){return(e,t)=>{let s=!1;for(const r of us(n)){const i=dy(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function dy(n,e,t){const s=n.field.isKeyField()?H.comparator(e.key,t.key):function(i,a,c){const h=a.data.field(i),f=c.data.field(i);return h!==null&&f!==null?Rn(h,f):W()}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return W()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){un(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return Du(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fy=new ue(H.comparator);function _t(){return fy}const Gu=new ue(H.comparator);function is(...n){let e=Gu;for(const t of n)e=e.insert(t.key,t);return e}function Ku(n){let e=Gu;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Zt(){return hs()}function Hu(){return hs()}function hs(){return new Un(n=>n.toString(),(n,e)=>n.isEqual(e))}const my=new ue(H.comparator),py=new Ce(H.comparator);function X(...n){let e=py;for(const t of n)e=e.add(t);return e}const gy=new Ce(ne);function yy(){return gy}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ir(e)?"-0":e}}function zu(n){return{integerValue:""+n}}function _y(n,e){return zg(e)?zu(e):Mo(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(){this._=void 0}}function vy(n,e,t){return n instanceof Cr?function(r,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&Po(i)&&(i=Do(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):n instanceof xs?Qu(n,e):n instanceof ws?Yu(n,e):function(r,i){const a=Wu(r,i),c=Yl(a)+Yl(r.Pe);return Xi(a)&&Xi(r.Pe)?zu(c):Mo(r.serializer,c)}(n,e)}function xy(n,e,t){return n instanceof xs?Qu(n,e):n instanceof ws?Yu(n,e):t}function Wu(n,e){return n instanceof Sr?function(s){return Xi(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class Cr extends zr{}class xs extends zr{constructor(e){super(),this.elements=e}}function Qu(n,e){const t=Ju(e);for(const s of n.elements)t.some(r=>ot(r,s))||t.push(s);return{arrayValue:{values:t}}}class ws extends zr{constructor(e){super(),this.elements=e}}function Yu(n,e){let t=Ju(e);for(const s of n.elements)t=t.filter(r=>!ot(r,s));return{arrayValue:{values:t}}}class Sr extends zr{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Yl(n){return pe(n.integerValue||n.doubleValue)}function Ju(n){return jo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function wy(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof xs&&r instanceof xs||s instanceof ws&&r instanceof ws?Sn(s.elements,r.elements,ot):s instanceof Sr&&r instanceof Sr?ot(s.Pe,r.Pe):s instanceof Cr&&r instanceof Cr}(n.transform,e.transform)}class by{constructor(e,t){this.version=e,this.transformResults=t}}class Be{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Be}static exists(e){return new Be(void 0,e)}static updateTime(e){return new Be(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hr(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Wr{}function Xu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Lo(n.key,Be.none()):new Rs(n.key,n.data,Be.none());{const t=n.data,s=Ue.empty();let r=new Ce(Ae.comparator);for(let i of e.fields)if(!r.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?s.delete(i):s.set(i,a),r=r.add(i)}return new Kt(n.key,s,new Ge(r.toArray()),Be.none())}}function Ey(n,e,t){n instanceof Rs?function(r,i,a){const c=r.value.clone(),h=Xl(r.fieldTransforms,i,a.transformResults);c.setAll(h),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof Kt?function(r,i,a){if(!hr(r.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Xl(r.fieldTransforms,i,a.transformResults),h=i.data;h.setAll(Zu(r)),h.setAll(c),i.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(r,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ds(n,e,t,s){return n instanceof Rs?function(i,a,c,h){if(!hr(i.precondition,a))return c;const f=i.value.clone(),m=Zl(i.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,s):n instanceof Kt?function(i,a,c,h){if(!hr(i.precondition,a))return c;const f=Zl(i.fieldTransforms,h,a),m=a.data;return m.setAll(Zu(i)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(_=>_.field))}(n,e,t,s):function(i,a,c){return hr(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function Iy(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=Wu(s.transform,r||null);i!=null&&(t===null&&(t=Ue.empty()),t.set(s.field,i))}return t||null}function Jl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Sn(s,r,(i,a)=>wy(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Rs extends Wr{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Kt extends Wr{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Zu(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function Xl(n,e,t){const s=new Map;re(n.length===t.length);for(let r=0;r<t.length;r++){const i=n[r],a=i.transform,c=e.data.field(i.field);s.set(i.field,xy(a,c,t[r]))}return s}function Zl(n,e,t){const s=new Map;for(const r of n){const i=r.transform,a=t.data.field(r.field);s.set(r.field,vy(i,a,e))}return s}class Lo extends Wr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ty extends Wr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&Ey(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=ds(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=ds(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Hu();return this.mutations.forEach(r=>{const i=e.get(r.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(r.key)?null:c;const h=Xu(a,c);h!==null&&s.set(r.key,h),a.isValidDocument()||a.convertToNoDocument(Q.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&Sn(this.mutations,e.mutations,(t,s)=>Jl(t,s))&&Sn(this.baseMutations,e.baseMutations,(t,s)=>Jl(t,s))}}class Fo{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){re(e.mutations.length===s.length);let r=function(){return my}();const i=e.mutations;for(let a=0;a<i.length;a++)r=r.insert(i[a].key,s[a].version);return new Fo(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge,ee;function Ry(n){switch(n){default:return W();case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0}}function eh(n){if(n===void 0)return yt("GRPC error has no .code"),j.UNKNOWN;switch(n){case ge.OK:return j.OK;case ge.CANCELLED:return j.CANCELLED;case ge.UNKNOWN:return j.UNKNOWN;case ge.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case ge.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case ge.INTERNAL:return j.INTERNAL;case ge.UNAVAILABLE:return j.UNAVAILABLE;case ge.UNAUTHENTICATED:return j.UNAUTHENTICATED;case ge.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case ge.NOT_FOUND:return j.NOT_FOUND;case ge.ALREADY_EXISTS:return j.ALREADY_EXISTS;case ge.PERMISSION_DENIED:return j.PERMISSION_DENIED;case ge.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case ge.ABORTED:return j.ABORTED;case ge.OUT_OF_RANGE:return j.OUT_OF_RANGE;case ge.UNIMPLEMENTED:return j.UNIMPLEMENTED;case ge.DATA_LOSS:return j.DATA_LOSS;default:return W()}}(ee=ge||(ge={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny=new en([4294967295,4294967295],0);function ec(n){const e=ky().encode(n),t=new Tu;return t.update(e),new Uint8Array(t.digest())}function tc(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new en([t,s],0),new en([r,i],0)]}class Uo{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new os(`Invalid padding: ${t}`);if(s<0)throw new os(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new os(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new os(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=en.fromNumber(this.Ie)}Ee(e,t,s){let r=e.add(t.multiply(en.fromNumber(s)));return r.compare(Ny)===1&&(r=new en([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=ec(e),[s,r]=tc(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(s,r,i);if(!this.de(a))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Uo(i,r,t);return s.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;const t=ec(e),[s,r]=tc(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(s,r,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class os extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,ks.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Qr(Q.min(),r,new ue(ne),_t(),X())}}class ks{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new ks(s,t,X(),X(),X())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e,t,s,r){this.Re=e,this.removedTargetIds=t,this.key=s,this.Ve=r}}class th{constructor(e,t){this.targetId=e,this.me=t}}class nh{constructor(e,t,s=Se.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class nc{constructor(){this.fe=0,this.ge=rc(),this.pe=Se.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),s=X();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:W()}}),new ks(this.pe,this.ye,e,t,s)}Ce(){this.we=!1,this.ge=rc()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,re(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Py{constructor(e){this.Le=e,this.Be=new Map,this.ke=_t(),this.qe=sc(),this.Qe=new ue(ne)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const s=this.Ge(t);switch(e.state){case 0:this.ze(t)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),s.De(e.resumeToken));break;default:W()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((s,r)=>{this.ze(r)&&t(r)})}He(e){const t=e.targetId,s=e.me.count,r=this.Je(t);if(r){const i=r.target;if(eo(i))if(s===0){const a=new H(i.path);this.Ue(t,a,Ve.newNoDocument(a,Q.min()))}else re(s===1);else{const a=this.Ye(t);if(a!==s){const c=this.Ze(e),h=c?this.Xe(c,e,a):1;if(h!==0){this.je(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,f)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let a,c;try{a=rn(s).toUint8Array()}catch(h){if(h instanceof ju)return Cn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{c=new Uo(a,r,i)}catch(h){return Cn(h instanceof os?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return c.Ie===0?null:c}Xe(e,t,s){return t.me.count===s-this.nt(e,t.targetId)?0:2}nt(e,t){const s=this.Le.getRemoteKeysForTarget(t);let r=0;return s.forEach(i=>{const a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const c=this.Je(a);if(c){if(i.current&&eo(c.target)){const h=new H(c.target.path);this.ke.get(h)!==null||this.it(a,h)||this.Ue(a,h,Ve.newNoDocument(h,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let s=X();this.qe.forEach((i,a)=>{let c=!0;a.forEachWhile(h=>{const f=this.Je(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(s=s.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const r=new Qr(e,t,this.Qe,this.ke,s);return this.ke=_t(),this.qe=sc(),this.Qe=new ue(ne),r}$e(e,t){if(!this.ze(e))return;const s=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,s),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,s){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),s&&(this.ke=this.ke.insert(t,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new nc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ce(ne),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||q("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new nc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function sc(){return new ue(H.comparator)}function rc(){return new ue(H.comparator)}const Dy={asc:"ASCENDING",desc:"DESCENDING"},jy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vy={and:"AND",or:"OR"};class Oy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function no(n,e){return n.useProto3Json||qr(e)?e:{value:e}}function Rr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function My(n,e){return Rr(n,e.toTimestamp())}function rt(n){return re(!!n),Q.fromTimestamp(function(t){const s=qt(t);return new xe(s.seconds,s.nanos)}(n))}function Bo(n,e){return so(n,e).canonicalString()}function so(n,e){const t=function(r){return new le(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function rh(n){const e=le.fromString(n);return re(ch(e)),e}function ro(n,e){return Bo(n.databaseId,e.path)}function Mi(n,e){const t=rh(e);if(t.get(1)!==n.databaseId.projectId)throw new $(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new $(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new H(oh(t))}function ih(n,e){return Bo(n.databaseId,e)}function Ly(n){const e=rh(n);return e.length===4?le.emptyPath():oh(e)}function io(n){return new le(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function oh(n){return re(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function ic(n,e,t){return{name:ro(n,e),fields:t.value.mapValue.fields}}function Fy(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:W()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(f,m){return f.useProto3Json?(re(m===void 0||typeof m=="string"),Se.fromBase64String(m||"")):(re(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Se.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(f){const m=f.code===void 0?j.UNKNOWN:eh(f.code);return new $(m,f.message||"")}(a);t=new nh(s,r,i,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Mi(n,s.document.name),i=rt(s.document.updateTime),a=s.document.createTime?rt(s.document.createTime):Q.min(),c=new Ue({mapValue:{fields:s.document.fields}}),h=Ve.newFoundDocument(r,i,a,c),f=s.targetIds||[],m=s.removedTargetIds||[];t=new dr(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Mi(n,s.document),i=s.readTime?rt(s.readTime):Q.min(),a=Ve.newNoDocument(r,i),c=s.removedTargetIds||[];t=new dr([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Mi(n,s.document),i=s.removedTargetIds||[];t=new dr([],i,r,null)}else{if(!("filter"in e))return W();{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,a=new Sy(r,i),c=s.targetId;t=new th(c,a)}}return t}function Uy(n,e){let t;if(e instanceof Rs)t={update:ic(n,e.key,e.value)};else if(e instanceof Lo)t={delete:ro(n,e.key)};else if(e instanceof Kt)t={update:ic(n,e.key,e.data),updateMask:Qy(e.fieldMask)};else{if(!(e instanceof Ty))return W();t={verify:ro(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(i,a){const c=a.transform;if(c instanceof Cr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof xs)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof ws)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Sr)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw W()}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:My(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:W()}(n,e.precondition)),t}function By(n,e){return n&&n.length>0?(re(e!==void 0),n.map(t=>function(r,i){let a=r.updateTime?rt(r.updateTime):rt(i);return a.isEqual(Q.min())&&(a=rt(i)),new by(a,r.transformResults||[])}(t,e))):[]}function qy(n,e){return{documents:[ih(n,e.path)]}}function $y(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=ih(n,r);const i=function(f){if(f.length!==0)return lh(at.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(f){if(f.length!==0)return f.map(m=>function(v){return{field:yn(v.field),direction:Hy(v.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=no(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:r}}function Gy(n){let e=Ly(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){re(s===1);const m=t.from[0];m.allDescendants?r=m.collectionId:e=e.child(m.collectionId)}let i=[];t.where&&(i=function(_){const v=ah(_);return v instanceof at&&Lu(v)?v.getFilters():[v]}(t.where));let a=[];t.orderBy&&(a=function(_){return _.map(v=>function(C){return new Ar(_n(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(v))}(t.orderBy));let c=null;t.limit&&(c=function(_){let v;return v=typeof _=="object"?_.value:_,qr(v)?null:v}(t.limit));let h=null;t.startAt&&(h=function(_){const v=!!_.before,I=_.values||[];return new Tr(I,v)}(t.startAt));let f=null;return t.endAt&&(f=function(_){const v=!_.before,I=_.values||[];return new Tr(I,v)}(t.endAt)),ly(e,r,a,i,c,"F",h,f)}function Ky(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ah(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=_n(t.unaryFilter.field);return _e.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=_n(t.unaryFilter.field);return _e.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=_n(t.unaryFilter.field);return _e.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=_n(t.unaryFilter.field);return _e.create(a,"!=",{nullValue:"NULL_VALUE"});default:return W()}}(n):n.fieldFilter!==void 0?function(t){return _e.create(_n(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return W()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return at.create(t.compositeFilter.filters.map(s=>ah(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return W()}}(t.compositeFilter.op))}(n):W()}function Hy(n){return Dy[n]}function zy(n){return jy[n]}function Wy(n){return Vy[n]}function yn(n){return{fieldPath:n.canonicalString()}}function _n(n){return Ae.fromServerFormat(n.fieldPath)}function lh(n){return n instanceof _e?function(t){if(t.op==="=="){if(Kl(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NAN"}};if(Gl(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Kl(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NAN"}};if(Gl(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yn(t.field),op:zy(t.op),value:t.value}}}(n):n instanceof at?function(t){const s=t.getFilters().map(r=>lh(r));return s.length===1?s[0]:{compositeFilter:{op:Wy(t.op),filters:s}}}(n):W()}function Qy(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ch(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t,s,r,i=Q.min(),a=Q.min(),c=Se.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=h}withSequenceNumber(e){return new Pt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e){this.ct=e}}function Jy(n){const e=Gy({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?to(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this.un=new Zy}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(Bt.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(Bt.min())}updateCollectionGroup(e,t,s){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Zy{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ce(le.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ce(le.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Nn(0)}static kn(){return new Nn(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(){this.changes=new Un(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ve.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?O.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&ds(s.mutation,r,Ge.empty(),xe.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,X()).next(()=>s))}getLocalViewOfDocuments(e,t,s=X()){const r=Zt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let a=is();return i.forEach((c,h)=>{a=a.insert(c,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const s=Zt();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,X()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,s,r){let i=_t();const a=hs(),c=function(){return hs()}();return t.forEach((h,f)=>{const m=s.get(f.key);r.has(f.key)&&(m===void 0||m.mutation instanceof Kt)?i=i.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),ds(m.mutation,f,m.mutation.getFieldMask(),xe.now())):a.set(f.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((f,m)=>a.set(f,m)),t.forEach((f,m)=>{var _;return c.set(f,new t_(m,(_=a.get(f))!==null&&_!==void 0?_:null))}),c))}recalculateAndSaveOverlays(e,t){const s=hs();let r=new ue((a,c)=>a-c),i=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const c of a)c.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let m=s.get(h)||Ge.empty();m=c.applyToLocalView(f,m),s.set(h,m);const _=(r.get(c.batchId)||X()).add(h);r=r.insert(c.batchId,_)})}).next(()=>{const a=[],c=r.getReverseIterator();for(;c.hasNext();){const h=c.getNext(),f=h.key,m=h.value,_=Hu();m.forEach(v=>{if(!i.has(v)){const I=Xu(t.get(v),s.get(v));I!==null&&_.set(v,I),i=i.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,_))}return O.waitFor(a)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(a){return H.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):O.resolve(Zt());let c=-1,h=i;return a.next(f=>O.forEach(f,(m,_)=>(c<_.largestBatchId&&(c=_.largestBatchId),i.get(m)?O.resolve():this.remoteDocumentCache.getEntry(e,m).next(v=>{h=h.insert(m,v)}))).next(()=>this.populateOverlays(e,f,i)).next(()=>this.computeViews(e,h,f,X())).next(m=>({batchId:c,changes:Ku(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(s=>{let r=is();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let a=is();return this.indexManager.getCollectionParents(e,i).next(c=>O.forEach(c,h=>{const f=function(_,v){return new $r(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)}(t,h.child(i));return this.getDocumentsMatchingCollectionQuery(e,f,s,r).next(m=>{m.forEach((_,v)=>{a=a.insert(_,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r))).next(a=>{i.forEach((h,f)=>{const m=f.getKey();a.get(m)===null&&(a=a.insert(m,Ve.newInvalidDocument(m)))});let c=is();return a.forEach((h,f)=>{const m=i.get(h);m!==void 0&&ds(m.mutation,f,Ge.empty(),xe.now()),Hr(t,f)&&(c=c.insert(h,f))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s_{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:rt(r.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:Jy(r.bundledQuery),readTime:rt(r.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_{constructor(){this.overlays=new ue(H.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Zt();return O.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.Ir.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(s)),O.resolve()}getOverlaysForCollection(e,t,s){const r=Zt(),i=t.length+1,a=new H(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const h=c.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===i&&h.largestBatchId>s&&r.set(h.getKey(),h)}return O.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new ue((f,m)=>f-m);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>s){let m=i.get(f.largestBatchId);m===null&&(m=Zt(),i=i.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const c=Zt(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>c.set(f,m)),!(c.size()>=r)););return O.resolve(c)}ht(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const a=this.Ir.get(r.largestBatchId).delete(s.key);this.Ir.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new Cy(t,s));let i=this.Ir.get(t);i===void 0&&(i=X(),this.Ir.set(t,i)),this.Ir.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(){this.sessionToken=Se.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(){this.Tr=new Ce(be.Er),this.dr=new Ce(be.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const s=new be(e,t);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Vr(new be(e,t))}mr(e,t){e.forEach(s=>this.removeReference(s,t))}gr(e){const t=new H(new le([])),s=new be(t,e),r=new be(t,e+1),i=[];return this.dr.forEachInRange([s,r],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new H(new le([])),s=new be(t,e),r=new be(t,e+1);let i=X();return this.dr.forEachInRange([s,r],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new be(e,0),s=this.Tr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class be{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return H.comparator(e.key,t.key)||ne(e.wr,t.wr)}static Ar(e,t){return ne(e.wr,t.wr)||H.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ce(be.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Ay(i,t,s,r);this.mutationQueue.push(a);for(const c of r)this.br=this.br.add(new be(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return O.resolve(a)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.vr(s),i=r<0?0:r;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new be(t,0),r=new be(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([s,r],a=>{const c=this.Dr(a.wr);i.push(c)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ce(ne);return t.forEach(r=>{const i=new be(r,0),a=new be(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],c=>{s=s.add(c.wr)})}),O.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;H.isDocumentKey(i)||(i=i.child(""));const a=new be(new H(i),0);let c=new Ce(ne);return this.br.forEachWhile(h=>{const f=h.key.path;return!!s.isPrefixOf(f)&&(f.length===r&&(c=c.add(h.wr)),!0)},a),O.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(s=>{const r=this.Dr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){re(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return O.forEach(t.mutations,r=>{const i=new be(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=s})}On(e){}containsKey(e,t){const s=new be(t,0),r=this.br.firstAfterOrEqual(s);return O.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e){this.Mr=e,this.docs=function(){return new ue(H.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,a=this.Mr(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return O.resolve(s?s.document.mutableCopy():Ve.newInvalidDocument(t))}getEntries(e,t){let s=_t();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():Ve.newInvalidDocument(r))}),O.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=_t();const a=t.path,c=new H(a.child("")),h=this.docs.getIteratorFrom(c);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||$g(qg(m),s)<=0||(r.has(m.key)||Hr(t,m))&&(i=i.insert(m.key,m.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,s,r){W()}Or(e,t){return O.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new l_(this)}getSize(e){return O.resolve(this.size)}}class l_ extends e_{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(s)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){this.persistence=e,this.Nr=new Un(t=>Vo(t),Oo),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.Lr=0,this.Br=new qo,this.targetCount=0,this.kr=Nn.Bn()}forEachTarget(e,t){return this.Nr.forEach((s,r)=>t(r)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Nn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=t&&s.get(c.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),r++)}),O.waitFor(i).next(()=>r)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const s=this.Nr.get(t)||null;return O.resolve(s)}addMatchingKeys(e,t,s){return this.Br.Rr(t,s),O.resolve()}removeMatchingKeys(e,t,s){this.Br.mr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(a=>{i.push(r.markPotentiallyOrphaned(e,a))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const s=this.Br.yr(t);return O.resolve(s)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(e,t){this.qr={},this.overlays={},this.Qr=new No(0),this.Kr=!1,this.Kr=!0,this.$r=new i_,this.referenceDelegate=e(this),this.Ur=new c_(this),this.indexManager=new Xy,this.remoteDocumentCache=function(r){return new a_(r)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new Yy(t),this.Gr=new s_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new r_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.qr[e.toKey()];return s||(s=new o_(t,this.referenceDelegate),this.qr[e.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,s){q("MemoryPersistence","Starting transaction:",e);const r=new h_(this.Qr.next());return this.referenceDelegate.zr(),s(r).next(i=>this.referenceDelegate.jr(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(s=>()=>s.containsKey(e,t)))}}class h_ extends Kg{constructor(e){super(),this.currentSequenceNumber=e}}class $o{constructor(e){this.persistence=e,this.Jr=new qo,this.Yr=null}static Zr(e){return new $o(e)}get Xr(){if(this.Yr)return this.Yr;throw W()}addReference(e,t,s){return this.Jr.addReference(s,t),this.Xr.delete(s.toString()),O.resolve()}removeReference(e,t,s){return this.Jr.removeReference(s,t),this.Xr.add(s.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.Xr.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,s=>{const r=H.fromPath(s);return this.ei(e,r).next(i=>{i||t.removeEntry(r,Q.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(s=>{s?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.$i=s,this.Ui=r}static Wi(e,t){let s=X(),r=X();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Go(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Wd()?8:Hg(Oe())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,r,s).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new d_;return this.Xi(e,t,a).next(c=>{if(i.result=c,this.zi)return this.es(e,t,a,c.size)})}).next(()=>i.result)}es(e,t,s,r){return s.documentReadCount<this.ji?(ts()<=Z.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",gn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(ts()<=Z.DEBUG&&q("QueryEngine","Query:",gn(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.Hi*r?(ts()<=Z.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",gn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,st(t))):O.resolve())}Yi(e,t){if(Ql(t))return O.resolve(null);let s=st(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=to(t,null,"F"),s=st(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const a=X(...i);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,s).next(h=>{const f=this.ts(t,c);return this.ns(t,f,a,h.readTime)?this.Yi(e,to(t,null,"F")):this.rs(e,f,t,h)}))})))}Zi(e,t,s,r){return Ql(t)||r.isEqual(Q.min())?O.resolve(null):this.Ji.getDocuments(e,s).next(i=>{const a=this.ts(t,i);return this.ns(t,a,s,r)?O.resolve(null):(ts()<=Z.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),gn(t)),this.rs(e,a,t,Bg(r,-1)).next(c=>c))})}ts(e,t){let s=new Ce($u(e));return t.forEach((r,i)=>{Hr(e,i)&&(s=s.add(i))}),s}ns(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,s){return ts()<=Z.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",gn(t)),this.Ji.getDocumentsMatchingQuery(e,t,Bt.min(),s)}rs(e,t,s,r){return this.Ji.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,t,s,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new ue(ne),this._s=new Un(i=>Vo(i),Oo),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(s)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new n_(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function p_(n,e,t,s){return new m_(n,e,t,s)}async function uh(n,e){const t=Y(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.ls(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const a=[],c=[];let h=X();for(const f of r){a.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of i){c.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(s,h).next(f=>({hs:f,removedBatchIds:a,addedBatchIds:c}))})})}function g_(n,e){const t=Y(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,h,f,m){const _=f.batch,v=_.keys();let I=O.resolve();return v.forEach(C=>{I=I.next(()=>m.getEntry(h,C)).next(N=>{const k=f.docVersions.get(C);re(k!==null),N.version.compareTo(k)<0&&(_.applyToRemoteDocument(N,f),N.isValidDocument()&&(N.setReadTime(f.commitVersion),m.addEntry(N)))})}),I.next(()=>c.mutationQueue.removeMutationBatch(h,_))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(c){let h=X();for(let f=0;f<c.mutationResults.length;++f)c.mutationResults[f].transformResults.length>0&&(h=h.add(c.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function hh(n){const e=Y(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function y_(n,e){const t=Y(n),s=e.snapshotVersion;let r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;const c=[];e.targetChanges.forEach((m,_)=>{const v=r.get(_);if(!v)return;c.push(t.Ur.removeMatchingKeys(i,m.removedDocuments,_).next(()=>t.Ur.addMatchingKeys(i,m.addedDocuments,_)));let I=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(_)!==null?I=I.withResumeToken(Se.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):m.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(m.resumeToken,s)),r=r.insert(_,I),function(N,k,D){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(v,I,m)&&c.push(t.Ur.updateTargetData(i,I))});let h=_t(),f=X();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(__(i,a,e.documentUpdates).next(m=>{h=m.Ps,f=m.Is})),!s.isEqual(Q.min())){const m=t.Ur.getLastRemoteSnapshotVersion(i).next(_=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,s));c.push(m)}return O.waitFor(c).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,f)).next(()=>h)}).then(i=>(t.os=r,i))}function __(n,e,t){let s=X(),r=X();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let a=_t();return t.forEach((c,h)=>{const f=i.get(c);h.isFoundDocument()!==f.isFoundDocument()&&(r=r.add(c)),h.isNoDocument()&&h.version.isEqual(Q.min())?(e.removeEntry(c,h.readTime),a=a.insert(c,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(c,h)):q("LocalStore","Ignoring outdated watch update for ",c,". Current version:",f.version," Watch version:",h.version)}),{Ps:a,Is:r}})}function v_(n,e){const t=Y(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function x_(n,e){const t=Y(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Ur.getTargetData(s,e).next(i=>i?(r=i,O.resolve(r)):t.Ur.allocateTargetId(s).next(a=>(r=new Pt(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.Ur.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.os.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(s.targetId,s),t._s.set(e,s.targetId)),s})}async function oo(n,e,t){const s=Y(n),r=s.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,a=>s.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!Ss(a))throw a;q("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}s.os=s.os.remove(e),s._s.delete(r.target)}function oc(n,e,t){const s=Y(n);let r=Q.min(),i=X();return s.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){const _=Y(h),v=_._s.get(m);return v!==void 0?O.resolve(_.os.get(v)):_.Ur.getTargetData(f,m)}(s,a,st(e)).next(c=>{if(c)return r=c.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(a,c.targetId).next(h=>{i=h})}).next(()=>s.ss.getDocumentsMatchingQuery(a,e,t?r:Q.min(),t?i:X())).next(c=>(w_(s,hy(e),c),{documents:c,Ts:i})))}function w_(n,e,t){let s=n.us.get(e)||Q.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.us.set(e,s)}class ac{constructor(){this.activeTargetIds=yy()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class b_{constructor(){this.so=new ac,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,s){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ac,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){q("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){q("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sr=null;function Li(){return sr===null?sr=function(){return 268435456+Math.round(2147483648*Math.random())}():sr++,"0x"+sr.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pe="WebChannelConnection";class A_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+t.host,this.vo=`projects/${r}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${i}`}get Fo(){return!1}Mo(t,s,r,i,a){const c=Li(),h=this.xo(t,s.toUriEncodedString());q("RestConnection",`Sending RPC '${t}' ${c}:`,h,r);const f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,i,a),this.No(t,h,f,r).then(m=>(q("RestConnection",`Received RPC '${t}' ${c}: `,m),m),m=>{throw Cn("RestConnection",`RPC '${t}' ${c} failed with error: `,m,"url: ",h,"request:",r),m})}Lo(t,s,r,i,a,c){return this.Mo(t,s,r,i,a)}Oo(t,s,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((i,a)=>t[a]=i),r&&r.headers.forEach((i,a)=>t[a]=i)}xo(t,s){const r=I_[t];return`${this.Do}/v1/${s}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,s,r){const i=Li();return new Promise((a,c)=>{const h=new Au;h.setWithCredentials(!0),h.listenOnce(Cu.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case cr.NO_ERROR:const m=h.getResponseJson();q(Pe,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(m)),a(m);break;case cr.TIMEOUT:q(Pe,`RPC '${e}' ${i} timed out`),c(new $(j.DEADLINE_EXCEEDED,"Request time out"));break;case cr.HTTP_ERROR:const _=h.getStatus();if(q(Pe,`RPC '${e}' ${i} failed with status:`,_,"response text:",h.getResponseText()),_>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const I=v==null?void 0:v.error;if(I&&I.status&&I.message){const C=function(k){const D=k.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(D)>=0?D:j.UNKNOWN}(I.status);c(new $(C,I.message))}else c(new $(j.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new $(j.UNAVAILABLE,"Connection failed."));break;default:W()}}finally{q(Pe,`RPC '${e}' ${i} completed.`)}});const f=JSON.stringify(r);q(Pe,`RPC '${e}' ${i} sending request:`,r),h.send(t,"POST",f,s,15)})}Bo(e,t,s){const r=Li(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=ku(),c=Ru(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Oo(h.initMessageHeaders,t,s),h.encodeInitMessageHeaders=!0;const m=i.join("");q(Pe,`Creating RPC '${e}' stream ${r}: ${m}`,h);const _=a.createWebChannel(m,h);let v=!1,I=!1;const C=new T_({Io:k=>{I?q(Pe,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(v||(q(Pe,`Opening RPC '${e}' stream ${r} transport.`),_.open(),v=!0),q(Pe,`RPC '${e}' stream ${r} sending:`,k),_.send(k))},To:()=>_.close()}),N=(k,D,M)=>{k.listen(D,P=>{try{M(P)}catch(V){setTimeout(()=>{throw V},0)}})};return N(_,rs.EventType.OPEN,()=>{I||(q(Pe,`RPC '${e}' stream ${r} transport opened.`),C.yo())}),N(_,rs.EventType.CLOSE,()=>{I||(I=!0,q(Pe,`RPC '${e}' stream ${r} transport closed`),C.So())}),N(_,rs.EventType.ERROR,k=>{I||(I=!0,Cn(Pe,`RPC '${e}' stream ${r} transport errored:`,k),C.So(new $(j.UNAVAILABLE,"The operation could not be completed")))}),N(_,rs.EventType.MESSAGE,k=>{var D;if(!I){const M=k.data[0];re(!!M);const P=M,V=P.error||((D=P[0])===null||D===void 0?void 0:D.error);if(V){q(Pe,`RPC '${e}' stream ${r} received error:`,V);const B=V.status;let L=function(y){const b=ge[y];if(b!==void 0)return eh(b)}(B),w=V.message;L===void 0&&(L=j.INTERNAL,w="Unknown error status: "+B+" with message "+V.message),I=!0,C.So(new $(L,w)),_.close()}else q(Pe,`RPC '${e}' stream ${r} received:`,M),C.bo(M)}}),N(c,Su.STAT_EVENT,k=>{k.stat===Yi.PROXY?q(Pe,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===Yi.NOPROXY&&q(Pe,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}function Fi(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(n){return new Oy(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e,t,s=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=s,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-s);r>0&&q("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e,t,s,r,i,a,c,h){this.ui=e,this.Ho=s,this.Jo=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new dh(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(yt(t.toString()),yt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Yo===t&&this.P_(s,r)},s=>{e(()=>{const r=new $(j.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(r)})})}P_(e,t){const s=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{s(()=>this.I_(r))}),this.stream.onMessage(r=>{s(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return q("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(q("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class C_ extends fh{constructor(e,t,s,r,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Fy(this.serializer,e),s=function(i){if(!("targetChange"in i))return Q.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Q.min():a.readTime?rt(a.readTime):Q.min()}(e);return this.listener.d_(t,s)}A_(e){const t={};t.database=io(this.serializer),t.addTarget=function(i,a){let c;const h=a.target;if(c=eo(h)?{documents:qy(i,h)}:{query:$y(i,h)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=sh(i,a.resumeToken);const f=no(i,a.expectedCount);f!==null&&(c.expectedCount=f)}else if(a.snapshotVersion.compareTo(Q.min())>0){c.readTime=Rr(i,a.snapshotVersion.toTimestamp());const f=no(i,a.expectedCount);f!==null&&(c.expectedCount=f)}return c}(this.serializer,e);const s=Ky(this.serializer,e);s&&(t.labels=s),this.a_(t)}R_(e){const t={};t.database=io(this.serializer),t.removeTarget=e,this.a_(t)}}class S_ extends fh{constructor(e,t,s,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return re(!!e.streamToken),this.lastStreamToken=e.streamToken,re(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){re(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=By(e.writeResults,e.commitTime),s=rt(e.commitTime);return this.listener.g_(s,t)}p_(){const e={};e.database=io(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>Uy(this.serializer,s))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_ extends class{}{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new $(j.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,so(t,s),r,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new $(j.UNKNOWN,i.toString())})}Lo(e,t,s,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,so(t,s),r,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new $(j.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class k_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(yt(t),this.D_=!1):q("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{s.enqueueAndForget(async()=>{hn(this)&&(q("RemoteStore","Restarting streams for network reachability change."),await async function(h){const f=Y(h);f.L_.add(4),await Ns(f),f.q_.set("Unknown"),f.L_.delete(4),await Jr(f)}(this))})}),this.q_=new k_(s,r)}}async function Jr(n){if(hn(n))for(const e of n.B_)await e(!0)}async function Ns(n){for(const e of n.B_)await e(!1)}function mh(n,e){const t=Y(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Wo(t)?zo(t):Bn(t).r_()&&Ho(t,e))}function Ko(n,e){const t=Y(n),s=Bn(t);t.N_.delete(e),s.r_()&&ph(t,e),t.N_.size===0&&(s.r_()?s.o_():hn(t)&&t.q_.set("Unknown"))}function Ho(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bn(n).A_(e)}function ph(n,e){n.Q_.xe(e),Bn(n).R_(e)}function zo(n){n.Q_=new Py({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Bn(n).start(),n.q_.v_()}function Wo(n){return hn(n)&&!Bn(n).n_()&&n.N_.size>0}function hn(n){return Y(n).L_.size===0}function gh(n){n.Q_=void 0}async function P_(n){n.q_.set("Online")}async function D_(n){n.N_.forEach((e,t)=>{Ho(n,e)})}async function j_(n,e){gh(n),Wo(n)?(n.q_.M_(e),zo(n)):n.q_.set("Unknown")}async function V_(n,e,t){if(n.q_.set("Online"),e instanceof nh&&e.state===2&&e.cause)try{await async function(r,i){const a=i.cause;for(const c of i.targetIds)r.N_.has(c)&&(await r.remoteSyncer.rejectListen(c,a),r.N_.delete(c),r.Q_.removeTarget(c))}(n,e)}catch(s){q("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await kr(n,s)}else if(e instanceof dr?n.Q_.Ke(e):e instanceof th?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Q.min()))try{const s=await hh(n.localStore);t.compareTo(s)>=0&&await function(i,a){const c=i.Q_.rt(a);return c.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=i.N_.get(f);m&&i.N_.set(f,m.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach((h,f)=>{const m=i.N_.get(h);if(!m)return;i.N_.set(h,m.withResumeToken(Se.EMPTY_BYTE_STRING,m.snapshotVersion)),ph(i,h);const _=new Pt(m.target,h,f,m.sequenceNumber);Ho(i,_)}),i.remoteSyncer.applyRemoteEvent(c)}(n,t)}catch(s){q("RemoteStore","Failed to raise snapshot:",s),await kr(n,s)}}async function kr(n,e,t){if(!Ss(e))throw e;n.L_.add(1),await Ns(n),n.q_.set("Offline"),t||(t=()=>hh(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{q("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Jr(n)})}function yh(n,e){return e().catch(t=>kr(n,t,e))}async function Xr(n){const e=Y(n),t=$t(e);let s=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;O_(e);)try{const r=await v_(e.localStore,s);if(r===null){e.O_.length===0&&t.o_();break}s=r.batchId,M_(e,r)}catch(r){await kr(e,r)}_h(e)&&vh(e)}function O_(n){return hn(n)&&n.O_.length<10}function M_(n,e){n.O_.push(e);const t=$t(n);t.r_()&&t.V_&&t.m_(e.mutations)}function _h(n){return hn(n)&&!$t(n).n_()&&n.O_.length>0}function vh(n){$t(n).start()}async function L_(n){$t(n).p_()}async function F_(n){const e=$t(n);for(const t of n.O_)e.m_(t.mutations)}async function U_(n,e,t){const s=n.O_.shift(),r=Fo.from(s,e,t);await yh(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await Xr(n)}async function B_(n,e){e&&$t(n).V_&&await async function(s,r){if(function(a){return Ry(a)&&a!==j.ABORTED}(r.code)){const i=s.O_.shift();$t(s).s_(),await yh(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await Xr(s)}}(n,e),_h(n)&&vh(n)}async function cc(n,e){const t=Y(n);t.asyncQueue.verifyOperationInProgress(),q("RemoteStore","RemoteStore received new credentials");const s=hn(t);t.L_.add(3),await Ns(t),s&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Jr(t)}async function q_(n,e){const t=Y(n);e?(t.L_.delete(2),await Jr(t)):e||(t.L_.add(2),await Ns(t),t.q_.set("Unknown"))}function Bn(n){return n.K_||(n.K_=function(t,s,r){const i=Y(t);return i.w_(),new C_(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Eo:P_.bind(null,n),Ro:D_.bind(null,n),mo:j_.bind(null,n),d_:V_.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Wo(n)?zo(n):n.q_.set("Unknown")):(await n.K_.stop(),gh(n))})),n.K_}function $t(n){return n.U_||(n.U_=function(t,s,r){const i=Y(t);return i.w_(),new S_(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:L_.bind(null,n),mo:B_.bind(null,n),f_:F_.bind(null,n),g_:U_.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Xr(n)):(await n.U_.stop(),n.O_.length>0&&(q("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Ot,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const a=Date.now()+s,c=new Qo(e,t,a,r,i);return c.start(s),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Yo(n,e){if(yt("AsyncQueue",`${e}: ${n}`),Ss(n))return new $(j.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.comparator=e?(t,s)=>e(t,s)||H.comparator(t.key,s.key):(t,s)=>H.comparator(t.key,s.key),this.keyedMap=is(),this.sortedSet=new ue(this.comparator)}static emptySet(e){return new In(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof In)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new In;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(){this.W_=new ue(H.comparator)}track(e){const t=e.doc.key,s=this.W_.get(t);s?e.type!==0&&s.type===3?this.W_=this.W_.insert(t,e):e.type===3&&s.type!==1?this.W_=this.W_.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.W_=this.W_.remove(t):e.type===1&&s.type===2?this.W_=this.W_.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):W():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,s)=>{e.push(s)}),e}}class Pn{constructor(e,t,s,r,i,a,c,h,f){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,s,r,i){const a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new Pn(e,t,In.emptySet(t),a,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class G_{constructor(){this.queries=hc(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,s){const r=Y(t),i=r.queries;r.queries=hc(),i.forEach((a,c)=>{for(const h of c.j_)h.onError(s)})})(this,new $(j.ABORTED,"Firestore shutting down"))}}function hc(){return new Un(n=>qu(n),Kr)}async function xh(n,e){const t=Y(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.H_()&&e.J_()&&(s=2):(i=new $_,s=e.J_()?0:1);try{switch(s){case 0:i.z_=await t.onListen(r,!0);break;case 1:i.z_=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const c=Yo(a,`Initialization of query '${gn(e.query)}' failed`);return void e.onError(c)}t.queries.set(r,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Jo(t)}async function wh(n,e){const t=Y(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?r=e.J_()?0:1:!i.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function K_(n,e){const t=Y(n);let s=!1;for(const r of e){const i=r.query,a=t.queries.get(i);if(a){for(const c of a.j_)c.X_(r)&&(s=!0);a.z_=r}}s&&Jo(t)}function H_(n,e,t){const s=Y(n),r=s.queries.get(e);if(r)for(const i of r.j_)i.onError(t);s.queries.delete(e)}function Jo(n){n.Y_.forEach(e=>{e.next()})}var ao,dc;(dc=ao||(ao={})).ea="default",dc.Cache="cache";class bh{constructor(e,t,s){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Pn(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const s=t!=="Offline";return(!this.options._a||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Pn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ao.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e){this.key=e}}class Ih{constructor(e){this.key=e}}class z_{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=$u(e),this.Ra=new In(this.Aa)}get Va(){return this.Ta}ma(e,t){const s=t?t.fa:new uc,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=r,c=!1;const h=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,f=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((m,_)=>{const v=r.get(m),I=Hr(this.query,_)?_:null,C=!!v&&this.mutatedKeys.has(v.key),N=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let k=!1;v&&I?v.data.isEqual(I.data)?C!==N&&(s.track({type:3,doc:I}),k=!0):this.ga(v,I)||(s.track({type:2,doc:I}),k=!0,(h&&this.Aa(I,h)>0||f&&this.Aa(I,f)<0)&&(c=!0)):!v&&I?(s.track({type:0,doc:I}),k=!0):v&&!I&&(s.track({type:1,doc:v}),k=!0,(h||f)&&(c=!0)),k&&(I?(a=a.add(I),i=N?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),s.track({type:1,doc:m})}return{Ra:a,fa:s,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((m,_)=>function(I,C){const N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W()}};return N(I)-N(C)}(m.type,_.type)||this.Aa(m.doc,_.doc)),this.pa(s),r=r!=null&&r;const c=t&&!r?this.ya():[],h=this.da.size===0&&this.current&&!r?1:0,f=h!==this.Ea;return this.Ea=h,a.length!==0||f?{snapshot:new Pn(this.query,e.Ra,i,a,e.mutatedKeys,h===0,f,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new uc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=X(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const t=[];return e.forEach(s=>{this.da.has(s)||t.push(new Ih(s))}),this.da.forEach(s=>{e.has(s)||t.push(new Eh(s))}),t}ba(e){this.Ta=e.Ts,this.da=X();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Pn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class W_{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Q_{constructor(e){this.key=e,this.va=!1}}class Y_{constructor(e,t,s,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Un(c=>qu(c),Kr),this.Ma=new Map,this.xa=new Set,this.Oa=new ue(H.comparator),this.Na=new Map,this.La=new qo,this.Ba={},this.ka=new Map,this.qa=Nn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function J_(n,e,t=!0){const s=kh(n);let r;const i=s.Fa.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Da()):r=await Th(s,e,t,!0),r}async function X_(n,e){const t=kh(n);await Th(t,e,!0,!1)}async function Th(n,e,t,s){const r=await x_(n.localStore,st(e)),i=r.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return s&&(c=await Z_(n,e,i,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&mh(n.remoteStore,r),c}async function Z_(n,e,t,s,r){n.Ka=(_,v,I)=>async function(N,k,D,M){let P=k.view.ma(D);P.ns&&(P=await oc(N.localStore,k.query,!1).then(({documents:w})=>k.view.ma(w,P)));const V=M&&M.targetChanges.get(k.targetId),B=M&&M.targetMismatches.get(k.targetId)!=null,L=k.view.applyChanges(P,N.isPrimaryClient,V,B);return mc(N,k.targetId,L.wa),L.snapshot}(n,_,v,I);const i=await oc(n.localStore,e,!0),a=new z_(e,i.Ts),c=a.ma(i.documents),h=ks.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),f=a.applyChanges(c,n.isPrimaryClient,h);mc(n,t,f.wa);const m=new W_(e,t,a);return n.Fa.set(e,m),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),f.snapshot}async function ev(n,e,t){const s=Y(n),r=s.Fa.get(e),i=s.Ma.get(r.targetId);if(i.length>1)return s.Ma.set(r.targetId,i.filter(a=>!Kr(a,e))),void s.Fa.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await oo(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Ko(s.remoteStore,r.targetId),lo(s,r.targetId)}).catch(Cs)):(lo(s,r.targetId),await oo(s.localStore,r.targetId,!0))}async function tv(n,e){const t=Y(n),s=t.Fa.get(e),r=t.Ma.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Ko(t.remoteStore,s.targetId))}async function nv(n,e,t){const s=cv(n);try{const r=await function(a,c){const h=Y(a),f=xe.now(),m=c.reduce((I,C)=>I.add(C.key),X());let _,v;return h.persistence.runTransaction("Locally write mutations","readwrite",I=>{let C=_t(),N=X();return h.cs.getEntries(I,m).next(k=>{C=k,C.forEach((D,M)=>{M.isValidDocument()||(N=N.add(D))})}).next(()=>h.localDocuments.getOverlayedDocuments(I,C)).next(k=>{_=k;const D=[];for(const M of c){const P=Iy(M,_.get(M.key).overlayedDocument);P!=null&&D.push(new Kt(M.key,P,Vu(P.value.mapValue),Be.exists(!0)))}return h.mutationQueue.addMutationBatch(I,f,D,c)}).next(k=>{v=k;const D=k.applyToLocalDocumentSet(_,N);return h.documentOverlayCache.saveOverlays(I,k.batchId,D)})}).then(()=>({batchId:v.batchId,changes:Ku(_)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(a,c,h){let f=a.Ba[a.currentUser.toKey()];f||(f=new ue(ne)),f=f.insert(c,h),a.Ba[a.currentUser.toKey()]=f}(s,r.batchId,t),await Ps(s,r.changes),await Xr(s.remoteStore)}catch(r){const i=Yo(r,"Failed to persist write");t.reject(i)}}async function Ah(n,e){const t=Y(n);try{const s=await y_(t.localStore,e);e.targetChanges.forEach((r,i)=>{const a=t.Na.get(i);a&&(re(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?a.va=!0:r.modifiedDocuments.size>0?re(a.va):r.removedDocuments.size>0&&(re(a.va),a.va=!1))}),await Ps(t,s,e)}catch(s){await Cs(s)}}function fc(n,e,t){const s=Y(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Fa.forEach((i,a)=>{const c=a.view.Z_(e);c.snapshot&&r.push(c.snapshot)}),function(a,c){const h=Y(a);h.onlineState=c;let f=!1;h.queries.forEach((m,_)=>{for(const v of _.j_)v.Z_(c)&&(f=!0)}),f&&Jo(h)}(s.eventManager,e),r.length&&s.Ca.d_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function sv(n,e,t){const s=Y(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Na.get(e),i=r&&r.key;if(i){let a=new ue(H.comparator);a=a.insert(i,Ve.newNoDocument(i,Q.min()));const c=X().add(i),h=new Qr(Q.min(),new Map,new ue(ne),a,c);await Ah(s,h),s.Oa=s.Oa.remove(i),s.Na.delete(e),Xo(s)}else await oo(s.localStore,e,!1).then(()=>lo(s,e,t)).catch(Cs)}async function rv(n,e){const t=Y(n),s=e.batch.batchId;try{const r=await g_(t.localStore,e);Sh(t,s,null),Ch(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await Ps(t,r)}catch(r){await Cs(r)}}async function iv(n,e,t){const s=Y(n);try{const r=await function(a,c){const h=Y(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,c).next(_=>(re(_!==null),m=_.keys(),h.mutationQueue.removeMutationBatch(f,_))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,c)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(s.localStore,e);Sh(s,e,t),Ch(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await Ps(s,r)}catch(r){await Cs(r)}}function Ch(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Sh(n,e,t){const s=Y(n);let r=s.Ba[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Ba[s.currentUser.toKey()]=r}}function lo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Ma.get(e))n.Fa.delete(s),t&&n.Ca.$a(s,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(s=>{n.La.containsKey(s)||Rh(n,s)})}function Rh(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Ko(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Xo(n))}function mc(n,e,t){for(const s of t)s instanceof Eh?(n.La.addReference(s.key,e),ov(n,s)):s instanceof Ih?(q("SyncEngine","Document no longer in limbo: "+s.key),n.La.removeReference(s.key,e),n.La.containsKey(s.key)||Rh(n,s.key)):W()}function ov(n,e){const t=e.key,s=t.path.canonicalString();n.Oa.get(t)||n.xa.has(s)||(q("SyncEngine","New document in limbo: "+t),n.xa.add(s),Xo(n))}function Xo(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new H(le.fromString(e)),s=n.qa.next();n.Na.set(s,new Q_(t)),n.Oa=n.Oa.insert(t,s),mh(n.remoteStore,new Pt(st(Gr(t.path)),s,"TargetPurposeLimboResolution",No.oe))}}async function Ps(n,e,t){const s=Y(n),r=[],i=[],a=[];s.Fa.isEmpty()||(s.Fa.forEach((c,h)=>{a.push(s.Ka(h,e,t).then(f=>{var m;if((f||t)&&s.isPrimaryClient){const _=f?!f.fromCache:(m=t==null?void 0:t.targetChanges.get(h.targetId))===null||m===void 0?void 0:m.current;s.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(f){r.push(f);const _=Go.Wi(h.targetId,f);i.push(_)}}))}),await Promise.all(a),s.Ca.d_(r),await async function(h,f){const m=Y(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>O.forEach(f,v=>O.forEach(v.$i,I=>m.persistence.referenceDelegate.addReference(_,v.targetId,I)).next(()=>O.forEach(v.Ui,I=>m.persistence.referenceDelegate.removeReference(_,v.targetId,I)))))}catch(_){if(!Ss(_))throw _;q("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const v=_.targetId;if(!_.fromCache){const I=m.os.get(v),C=I.snapshotVersion,N=I.withLastLimboFreeSnapshotVersion(C);m.os=m.os.insert(v,N)}}}(s.localStore,i))}async function av(n,e){const t=Y(n);if(!t.currentUser.isEqual(e)){q("SyncEngine","User change. New user:",e.toKey());const s=await uh(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(c=>{c.forEach(h=>{h.reject(new $(j.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Ps(t,s.hs)}}function lv(n,e){const t=Y(n),s=t.Na.get(e);if(s&&s.va)return X().add(s.key);{let r=X();const i=t.Ma.get(e);if(!i)return r;for(const a of i){const c=t.Fa.get(a);r=r.unionWith(c.view.Va)}return r}}function kh(n){const e=Y(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ah.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sv.bind(null,e),e.Ca.d_=K_.bind(null,e.eventManager),e.Ca.$a=H_.bind(null,e.eventManager),e}function cv(n){const e=Y(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iv.bind(null,e),e}class Nr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yr(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return p_(this.persistence,new f_,e.initialUser,this.serializer)}Ga(e){return new u_($o.Zr,this.serializer)}Wa(e){return new b_}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nr.provider={build:()=>new Nr};class co{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>fc(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=av.bind(null,this.syncEngine),await q_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new G_}()}createDatastore(e){const t=Yr(e.databaseInfo.databaseId),s=function(i){return new A_(i)}(e.databaseInfo);return function(i,a,c,h){return new R_(i,a,c,h)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,i,a,c){return new N_(s,r,i,a,c)}(this.localStore,this.datastore,e.asyncQueue,t=>fc(this.syncEngine,t,0),function(){return lc.D()?new lc:new E_}())}createSyncEngine(e,t){return function(r,i,a,c,h,f,m){const _=new Y_(r,i,a,c,h,f);return m&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=Y(r);q("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ns(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}co.provider={build:()=>new co};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):yt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=De.UNAUTHENTICATED,this.clientId=Pu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async a=>{q("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(s,a=>(q("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ot;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Yo(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function Ui(n,e){n.asyncQueue.verifyOperationInProgress(),q("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await uh(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function pc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await hv(n);q("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>cc(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>cc(e.remoteStore,r)),n._onlineComponents=e}async function hv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){q("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ui(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===j.FAILED_PRECONDITION||r.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Cn("Error using user provided cache. Falling back to memory cache: "+t),await Ui(n,new Nr)}}else q("FirestoreClient","Using default OfflineComponentProvider"),await Ui(n,new Nr);return n._offlineComponents}async function Ph(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(q("FirestoreClient","Using user provided OnlineComponentProvider"),await pc(n,n._uninitializedComponentsProvider._online)):(q("FirestoreClient","Using default OnlineComponentProvider"),await pc(n,new co))),n._onlineComponents}function dv(n){return Ph(n).then(e=>e.syncEngine)}async function uo(n){const e=await Ph(n),t=e.eventManager;return t.onListen=J_.bind(null,e.syncEngine),t.onUnlisten=ev.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=X_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tv.bind(null,e.syncEngine),t}function fv(n,e,t={}){const s=new Ot;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,c,h,f){const m=new Nh({next:v=>{m.Za(),a.enqueueAndForget(()=>wh(i,_));const I=v.docs.has(c);!I&&v.fromCache?f.reject(new $(j.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&v.fromCache&&h&&h.source==="server"?f.reject(new $(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(v)},error:v=>f.reject(v)}),_=new bh(Gr(c.path),m,{includeMetadataChanges:!0,_a:!0});return xh(i,_)}(await uo(n),n.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(n,e,t){if(!t)throw new $(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mv(n,e,t,s){if(e===!0&&s===!0)throw new $(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function yc(n){if(!H.isDocumentKey(n))throw new $(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _c(n){if(H.isDocumentKey(n))throw new $(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W()}function ze(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new $(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zo(n);throw new $(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e){var t,s;if(e.host===void 0){if(e.ssl!==void 0)throw new $(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new $(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dh((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new $(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new $(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new $(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Zr{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new $(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vc(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new Pg;switch(s.type){case"firstParty":return new Og(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new $(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=gc.get(t);s&&(q("ComponentProvider","Removing Datastore"),gc.delete(t),s.terminate())}(this),Promise.resolve()}}function pv(n,e,t,s={}){var r;const i=(n=ze(n,Zr))._getSettings(),a=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&Cn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),s.mockUserToken){let c,h;if(typeof s.mockUserToken=="string")c=s.mockUserToken,h=De.MOCK_USER;else{c=Bd(s.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const f=s.mockUserToken.sub||s.mockUserToken.user_id;if(!f)throw new $(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new De(f)}n._authCredentials=new Dg(new Nu(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ei(this.firestore,e,this._query)}}class Fe{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Fe(this.firestore,e,this._key)}}class Mt extends ei{constructor(e,t,s){super(e,t,Gr(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Fe(this.firestore,null,new H(e))}withConverter(e){return new Mt(this.firestore,e,this._path)}}function gv(n,e,...t){if(n=ye(n),jh("collection","path",e),n instanceof Zr){const s=le.fromString(e,...t);return _c(s),new Mt(n,null,s)}{if(!(n instanceof Fe||n instanceof Mt))throw new $(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(le.fromString(e,...t));return _c(s),new Mt(n.firestore,null,s)}}function it(n,e,...t){if(n=ye(n),arguments.length===1&&(e=Pu.newId()),jh("doc","path",e),n instanceof Zr){const s=le.fromString(e,...t);return yc(s),new Fe(n,null,new H(s))}{if(!(n instanceof Fe||n instanceof Mt))throw new $(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(le.fromString(e,...t));return yc(s),new Fe(n.firestore,n instanceof Mt?n.converter:null,new H(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new dh(this,"async_queue_retry"),this.Vu=()=>{const s=Fi();s&&q("AsyncQueue","Visibility state changed to "+s.visibilityState),this.t_.jo()},this.mu=e;const t=Fi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Fi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Ot;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ss(e))throw e;q("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(s=>{this.Eu=s,this.du=!1;const r=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(s);throw yt("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.du=!1,s))));return this.mu=t,t}enqueueAfterDelay(e,t,s){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=Qo.createAndSchedule(this,e,t,s,i=>this.yu(i));return this.Tu.push(r),r}fu(){this.Eu&&W()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function wc(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Gt extends Zr{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new xc,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new xc(e),this._firestoreClient=void 0,await e}}}function yv(n,e){const t=typeof n=="object"?n:qc(),s=typeof n=="string"?n:"(default)",r=xo(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=Fd("firestore");i&&pv(r,...i)}return r}function ti(n){if(n._terminated)throw new $(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||_v(n),n._firestoreClient}function _v(n){var e,t,s;const r=n._freezeSettings(),i=function(c,h,f,m){return new Qg(c,h,f,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Dh(m.experimentalLongPollingOptions),m.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new uv(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(c){const h=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(h),_online:h}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Dn(Se.fromBase64String(e))}catch(t){throw new $(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Dn(Se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new $(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ae(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv=/^__.*__$/;class xv{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Kt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rs(e,this.data,t,this.fieldTransforms)}}class Vh{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Kt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Oh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W()}}class sa{constructor(e,t,s,r,i,a){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new sa(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const s=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:s,xu:!1});return r.Ou(e),r}Nu(e){var t;const s=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:s,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Pr(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Oh(this.Cu)&&vv.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class wv{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Yr(e)}Qu(e,t,s,r=!1){return new sa({Cu:e,methodName:t,qu:s,path:Ae.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ni(n){const e=n._freezeSettings(),t=Yr(n._databaseId);return new wv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ra(n,e,t,s,r,i={}){const a=n.Qu(i.merge||i.mergeFields?2:0,e,t,r);ia("Data must be an object, but it was:",a,s);const c=Fh(s,a);let h,f;if(i.merge)h=new Ge(a.fieldMask),f=a.fieldTransforms;else if(i.mergeFields){const m=[];for(const _ of i.mergeFields){const v=ho(e,_,t);if(!a.contains(v))throw new $(j.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Bh(m,v)||m.push(v)}h=new Ge(m),f=a.fieldTransforms.filter(_=>h.covers(_.field))}else h=null,f=a.fieldTransforms;return new xv(new Ue(c),h,f)}class si extends ea{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof si}}function Mh(n,e,t,s){const r=n.Qu(1,e,t);ia("Data must be an object, but it was:",r,s);const i=[],a=Ue.empty();un(s,(h,f)=>{const m=oa(e,h,t);f=ye(f);const _=r.Nu(m);if(f instanceof si)i.push(m);else{const v=ri(f,_);v!=null&&(i.push(m),a.set(m,v))}});const c=new Ge(i);return new Vh(a,c,r.fieldTransforms)}function Lh(n,e,t,s,r,i){const a=n.Qu(1,e,t),c=[ho(e,s,t)],h=[r];if(i.length%2!=0)throw new $(j.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)c.push(ho(e,i[v])),h.push(i[v+1]);const f=[],m=Ue.empty();for(let v=c.length-1;v>=0;--v)if(!Bh(f,c[v])){const I=c[v];let C=h[v];C=ye(C);const N=a.Nu(I);if(C instanceof si)f.push(I);else{const k=ri(C,N);k!=null&&(f.push(I),m.set(I,k))}}const _=new Ge(f);return new Vh(m,_,a.fieldTransforms)}function ri(n,e){if(Uh(n=ye(n)))return ia("Unsupported field value:",e,n),Fh(n,e);if(n instanceof ea)return function(s,r){if(!Oh(r.Cu))throw r.Bu(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(s,r){const i=[];let a=0;for(const c of s){let h=ri(c,r.Lu(a));h==null&&(h={nullValue:"NULL_VALUE"}),i.push(h),a++}return{arrayValue:{values:i}}}(n,e)}return function(s,r){if((s=ye(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return _y(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=xe.fromDate(s);return{timestampValue:Rr(r.serializer,i)}}if(s instanceof xe){const i=new xe(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Rr(r.serializer,i)}}if(s instanceof ta)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Dn)return{bytesValue:sh(r.serializer,s._byteString)};if(s instanceof Fe){const i=r.databaseId,a=s.firestore._databaseId;if(!a.isEqual(i))throw r.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Bo(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof na)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw c.Bu("VectorValues must only contain numeric values.");return Mo(c.serializer,h)})}}}}}}(s,r);throw r.Bu(`Unsupported field value: ${Zo(s)}`)}(n,e)}function Fh(n,e){const t={};return Du(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):un(n,(s,r)=>{const i=ri(r,e.Mu(s));i!=null&&(t[s]=i)}),{mapValue:{fields:t}}}function Uh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xe||n instanceof ta||n instanceof Dn||n instanceof Fe||n instanceof ea||n instanceof na)}function ia(n,e,t){if(!Uh(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const s=Zo(t);throw s==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+s)}}function ho(n,e,t){if((e=ye(e))instanceof Ds)return e._internalPath;if(typeof e=="string")return oa(n,e);throw Pr("Field path arguments must be of type string or ",n,!1,void 0,t)}const bv=new RegExp("[~\\*/\\[\\]]");function oa(n,e,t){if(e.search(bv)>=0)throw Pr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ds(...e.split("."))._internalPath}catch{throw Pr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Pr(n,e,t,s,r){const i=s&&!s.isEmpty(),a=r!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let h="";return(i||a)&&(h+=" (found",i&&(h+=` in field ${s}`),a&&(h+=` in document ${r}`),h+=")"),new $(j.INVALID_ARGUMENT,c+n+h)}function Bh(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Fe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ev(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($h("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Ev extends qh{data(){return super.data()}}function $h(n,e){return typeof e=="string"?oa(n,e):e instanceof Ds?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new $(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tv{convertValue(e,t="none"){switch(on(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return un(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertVectorValue(e){var t,s,r;const i=(r=(s=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||s===void 0?void 0:s.values)===null||r===void 0?void 0:r.map(a=>pe(a.doubleValue));return new na(i)}convertGeoPoint(e){return new ta(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Do(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(ys(e));default:return null}}convertTimestamp(e){const t=qt(e);return new xe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=le.fromString(e);re(ch(s));const r=new _s(s.get(1),s.get(3)),i=new H(s.popFirst(5));return r.isEqual(t)||yt(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gh extends qh{constructor(e,t,s,r,i,a){super(e,t,s,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field($h("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}}class fr extends Gh{data(e={}){return super.data(e)}}class Av{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new as(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new fr(this._firestore,this._userDataWriter,s.key,s,new as(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(c=>{const h=new fr(r._firestore,r._userDataWriter,c.doc.key,c.doc,new as(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);return c.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const h=new fr(r._firestore,r._userDataWriter,c.doc.key,c.doc,new as(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,m=-1;return c.type!==0&&(f=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:Cv(c.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Cv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sv(n){n=ze(n,Fe);const e=ze(n.firestore,Gt);return fv(ti(e),n._key).then(t=>Hh(e,n,t))}class Kh extends Tv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fe(this.firestore,null,t)}}function ii(n,e,t){n=ze(n,Fe);const s=ze(n.firestore,Gt),r=aa(n.converter,e,t);return oi(s,[ra(ni(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Be.none())])}function la(n,e,t,...s){n=ze(n,Fe);const r=ze(n.firestore,Gt),i=ni(r);let a;return a=typeof(e=ye(e))=="string"||e instanceof Ds?Lh(i,"updateDoc",n._key,e,t,s):Mh(i,"updateDoc",n._key,e),oi(r,[a.toMutation(n._key,Be.exists(!0))])}function Rv(n,e){const t=ze(n.firestore,Gt),s=it(n),r=aa(n.converter,e);return oi(t,[ra(ni(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,Be.exists(!1))]).then(()=>s)}function ca(n,...e){var t,s,r;n=ye(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||wc(e[a])||(i=e[a],a++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(wc(e[a])){const _=e[a];e[a]=(t=_.next)===null||t===void 0?void 0:t.bind(_),e[a+1]=(s=_.error)===null||s===void 0?void 0:s.bind(_),e[a+2]=(r=_.complete)===null||r===void 0?void 0:r.bind(_)}let h,f,m;if(n instanceof Fe)f=ze(n.firestore,Gt),m=Gr(n._key.path),h={next:_=>{e[a]&&e[a](Hh(f,n,_))},error:e[a+1],complete:e[a+2]};else{const _=ze(n,ei);f=ze(_.firestore,Gt),m=_._query;const v=new Kh(f);h={next:I=>{e[a]&&e[a](new Av(f,v,_,I))},error:e[a+1],complete:e[a+2]},Iv(n._query)}return function(v,I,C,N){const k=new Nh(N),D=new bh(I,k,C);return v.asyncQueue.enqueueAndForget(async()=>xh(await uo(v),D)),()=>{k.Za(),v.asyncQueue.enqueueAndForget(async()=>wh(await uo(v),D))}}(ti(f),m,c,h)}function oi(n,e){return function(s,r){const i=new Ot;return s.asyncQueue.enqueueAndForget(async()=>nv(await dv(s),r,i)),i.promise}(ti(n),e)}function Hh(n,e,t){const s=t.docs.get(e._key),r=new Kh(n);return new Gh(n,r,e._key,s,new as(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ni(e)}set(e,t,s){this._verifyNotCommitted();const r=Bi(e,this._firestore),i=aa(r.converter,t,s),a=ra(this._dataReader,"WriteBatch.set",r._key,i,r.converter!==null,s);return this._mutations.push(a.toMutation(r._key,Be.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=Bi(e,this._firestore);let a;return a=typeof(t=ye(t))=="string"||t instanceof Ds?Lh(this._dataReader,"WriteBatch.update",i._key,t,s,r):Mh(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Bi(e,this._firestore);return this._mutations=this._mutations.concat(new Lo(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $(j.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Bi(n,e){if((n=ye(n)).firestore!==e)throw new $(j.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zh(n){return ti(n=ze(n,Gt)),new kv(n,e=>oi(n,e))}(function(e,t=!0){(function(r){Fn=r})(On),An(new nn("firestore",(s,{instanceIdentifier:r,options:i})=>{const a=s.getProvider("app").getImmediate(),c=new Gt(new jg(s.getProvider("auth-internal")),new Lg(s.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new $(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _s(f.options.projectId,m)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Vt(Fl,"4.7.3",e),Vt(Fl,"4.7.3","esm2017")})();const fo={Strategy:[{id:1,title:"Measure What Matters",author:"John Doerr"},{id:7,title:"Good to Great",author:"Jim Collins"},{id:8,title:"Playing to Win",author:"A.G. Lafley & Roger L. Martin"},{id:9,title:"Blue Ocean Strategy",author:"W. Chan Kim & Renée Mauborgne"},{id:10,title:"The Innovator's Dilemma",author:"Clayton M. Christensen"}],Culture:[{id:2,title:"Dare to Lead",author:"Brené Brown"},{id:11,title:"The Culture Code",author:"Daniel Coyle"},{id:12,title:"Radical Candor",author:"Kim Scott"},{id:13,title:"Turn the Ship Around!",author:"L. David Marquet"},{id:14,title:"Legacy",author:"James Kerr"}],Productivity:[{id:3,title:"Deep Work",author:"Cal Newport"},{id:15,title:"Getting Things Done (GTD)",author:"David Allen"},{id:16,title:"The 7 Habits of Highly Effective People",author:"Stephen Covey"},{id:17,title:"Eat That Frog!",author:"Brian Tracy"},{id:18,title:"The One Thing",author:"Gary Keller & Jay Papasan"}],Innovation:[{id:4,title:"The Lean Startup",author:"Eric Ries"},{id:19,title:"Creativity, Inc.",author:"Ed Catmull"},{id:20,title:"Rework",author:"Jason Fried & D.H. Hansson"},{id:21,title:"Zero to One",author:"Peter Thiel"},{id:22,title:"Loonshots",author:"Safi Bahcall"}],"Personal Willpower":[{id:5,title:"Atomic Habits",author:"James Clear"},{id:23,title:"Grit",author:"Angela Duckworth"},{id:24,title:"The Power of Habit",author:"Charles Duhigg"},{id:25,title:"Flow",author:"Mihaly Csikszentmihalyi"},{id:26,title:"Start With Why",author:"Simon Sinek"}],"Mental Fitness & Resilience":[{id:6,title:"Mindset",author:"Carol Dweck"},{id:27,title:"Meditations",author:"Marcus Aurelius"},{id:28,title:"The Subtle Art of Not Giving a F*ck",author:"Mark Manson"},{id:29,title:"Option B",author:"Sheryl Sandberg & Adam Grant"},{id:30,title:"Daring Greatly",author:"Brené Brown"}]},Nv="gemini-2.5-flash-preview-09-2025",Pv=typeof window<"u"&&(window.__GEMINI_API_KEY||window.GEMINI_API_KEY)||"";function ve(){try{return typeof window<"u"&&(!!window.__GEMINI_API_KEY||!!window.GEMINI_API_KEY)}catch{return!1}}const Dv="LeaderReps2024!",jv={Zap:We,HeartPulse:Pc,Users:cn,Mic:tn,Briefcase:Ze,Target:lt,CheckCircle:Lt,TrendingUp:ln,ShieldCheck:Vr,BarChart3:go,AlertTriangle:Vn,Clock:Tn,Lightbulb:jr,Settings:yo,Eye:mr},Wh=S.createContext(null),ce=()=>S.useContext(Wh);async function Ht(n,e="/generateContent"){if(!ve())throw new Error("API Key Missing: The Gemini API Key is not configured in the execution environment.");const t=`https://generativelanguage.googleapis.com/v1beta/models/${Nv}${e}?key=${Pv}`,s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){let r=await s.text();throw new Error(`API call failed with status ${s.status}. Details: ${r.substring(0,200)}...`)}return s.json()}const bc=n=>new Promise((e,t)=>{let s=document.querySelector(`script[src="${n}"]`);if(s){if(s.dataset.loaded)return e();s.addEventListener("load",()=>e(),{once:!0}),s.addEventListener("error",t,{once:!0});return}s=document.createElement("script"),s.src=n,s.async=!0,s.onload=()=>{s.dataset.loaded="1",e()},s.onerror=t,document.head.appendChild(s)});async function zt(n){if(typeof window>"u")return n;window.marked||await bc("https://cdn.jsdelivr.net/npm/marked/marked.min.js"),window.DOMPurify||await bc("https://cdn.jsdelivr.net/npm/dompurify@3.1.5/dist/purify.min.js"),(!window.marked||!window.DOMPurify)&&await new Promise(t=>setTimeout(t,50));const e=window.marked.parse(n);return window.DOMPurify.sanitize(e)}const je={T1:{id:"T1",name:"Self-Awareness & Trust",icon:"HeartPulse",color:"indigo-500"},T2:{id:"T2",name:"Communication & Feedback",icon:"Mic",color:"cyan-600"},T3:{id:"T3",name:"Execution & Delegation",icon:"Briefcase",color:"green-600"},T4:{id:"T4",name:"Talent & People Development",icon:"Users",color:"yellow-600"},T5:{id:"T5",name:"Vision & Strategic Clarity",icon:"TrendingUp",color:"red-600"}},Ec=[{id:101,tier:"T1",skill:"Trust",type:"Reading",title:"Article: Vulnerability-Based Trust",duration:30,difficulty:"Intro"},{id:102,tier:"T1",skill:"Identity",type:"Exercise",title:"Drafting Your LIS",duration:45,difficulty:"Core"},{id:103,tier:"T1",skill:"Reflection",type:"Journal",title:"Daily Check: Acted in Integrity?",duration:15,difficulty:"Intro"},{id:104,tier:"T1",skill:"Awareness",type:"Quiz",title:"Self-Assessment: Blind Spots",duration:20,difficulty:"Intro"},{id:105,tier:"T1",skill:"Reflection",type:"Reading",title:"Book Summary: The Power of Habit",duration:25,difficulty:"Core"},{id:106,tier:"T1",skill:"Trust",type:"Case Study",title:"Trust Collapse Scenario Analysis",duration:60,difficulty:"Mastery"},{id:107,tier:"T1",skill:"Identity",type:"Reading",title:"Article: The LIS Anchor Point",duration:20,difficulty:"Intro"},{id:108,tier:"T1",skill:"Awareness",type:"Exercise",title:"Values Conflict Role-Play Prep",duration:30,difficulty:"Core"},{id:201,tier:"T2",skill:"Feedback",type:"Exercise",title:"SBI Feedback Practice (Lab)",duration:30,difficulty:"Core"},{id:202,tier:"T2",skill:"Listening",type:"Reading",title:"Article: Paraphrasing for Empathy",duration:15,difficulty:"Intro"},{id:203,tier:"T2",skill:"Crucial",type:"Role-Play",title:"Practice: Deflecting the Blame-Shifter",duration:40,difficulty:"Core"},{id:204,tier:"T2",skill:"Crucial",type:"Reading",title:"Book Summary: Crucial Conversations",duration:25,difficulty:"Intro"},{id:205,tier:"T2",skill:"Feedback",type:"Exercise",title:"Mastering the 5:1 Magic Ratio",duration:35,difficulty:"Mastery"},{id:206,tier:"T2",skill:"Listening",type:"Quiz",title:"Listening Blocks Assessment",duration:15,difficulty:"Intro"},{id:207,tier:"T2",skill:"Crucial",type:"Case Study",title:"Firing for Cultural Fit Scenario",duration:60,difficulty:"Mastery"},{id:208,tier:"T2",skill:"Feedback",type:"Reading",title:"Article: The CLEAR Model",duration:20,difficulty:"Core"},{id:301,tier:"T3",skill:"Execution",type:"Reading",title:"Book Summary: Deep Work",duration:25,difficulty:"Intro"},{id:302,tier:"T3",skill:"Execution",type:"Exercise",title:"Time Blocking for High Leverage",duration:30,difficulty:"Core"},{id:303,tier:"T3",skill:"Delegation",type:"Exercise",title:"RACI Matrix Practice",duration:45,difficulty:"Core"},{id:304,tier:"T3",skill:"Delegation",type:"Reading",title:"Article: Delegation Levels",duration:15,difficulty:"Intro"},{id:305,tier:"T3",skill:"Process",type:"Case Study",title:"Process Bottleneck Audit",duration:50,difficulty:"Mastery"},{id:306,tier:"T3",skill:"Execution",type:"Quiz",title:"Distraction Hotspots Assessment",duration:15,difficulty:"Intro"},{id:307,tier:"T3",skill:"Delegation",type:"Exercise",title:"Delegation Risk Assessment",duration:30,difficulty:"Core"},{id:308,tier:"T3",skill:"Process",type:"Reading",title:"Article: PDCA Cycles",duration:20,difficulty:"Mastery"},{id:401,tier:"T4",skill:"Coaching",type:"Exercise",title:"Grow Model Practice",duration:35,difficulty:"Core"},{id:402,tier:"T4",skill:"Development",type:"Reading",title:"Book Summary: Dare to Lead",duration:25,difficulty:"Intro"},{id:403,tier:"T4",skill:"Talent",type:"Exercise",title:"Succession Planning Draft",duration:60,difficulty:"Mastery"},{id:404,tier:"T4",skill:"Coaching",type:"Role-Play",title:"Practice: Coaching a High Performer",duration:40,difficulty:"Core"},{id:405,tier:"T4",skill:"Development",type:"Reading",title:"Article: Career Laddering",duration:20,difficulty:"Intro"},{id:406,tier:"T4",skill:"Talent",type:"Quiz",title:"Hiring Bias Assessment",duration:15,difficulty:"Intro"},{id:407,tier:"T4",skill:"Coaching",type:"Case Study",title:"High Turnover Intervention",duration:50,difficulty:"Mastery"},{id:408,tier:"T4",skill:"Development",type:"Exercise",title:"Motivational Driver Mapping",duration:30,difficulty:"Core"},{id:501,tier:"T5",skill:"Vision",type:"Exercise",title:"Vision Statement Workshop",duration:45,difficulty:"Core"},{id:502,tier:"T5",skill:"OKR",type:"Reading",title:"Book Summary: Measure What Matters",duration:25,difficulty:"Intro"},{id:503,tier:"T5",skill:"Strategic",type:"Tool",title:"Pre-Mortem Risk Audit",duration:30,difficulty:"Mastery"},{id:504,tier:"T5",skill:"OKR",type:"Exercise",title:"OKR Refinement (AI Critique)",duration:40,difficulty:"Core"},{id:505,tier:"T5",skill:"Strategic",type:"Reading",title:"Article: Competitive Moats",duration:20,difficulty:"Intro"},{id:506,tier:"T5",skill:"Vision",type:"Quiz",title:"Vision Alignment Check",duration:15,difficulty:"Intro"},{id:507,tier:"T5",skill:"Strategic",type:"Case Study",title:"Market Disruption Response Plan",duration:60,difficulty:"Mastery"},{id:508,tier:"T5",skill:"OKR",type:"Exercise",title:'KR "From X to Y" Practice',duration:30,difficulty:"Core"}],Ic={Reading:(n,e)=>`### Core Concepts of ${n}

**Focus Skill:** ${e}

This article highlights the importance of asynchronous communication, creating clear documentation, and setting "done" criteria upfront to reduce execution drag. Your primary takeaway should be the principle: **Clear is Kind, Vague is Cruel.**

* **Action Item:** Schedule 30 minutes for process mapping.
* **Key Term:** Psychological Safety.`,Exercise:(n,e)=>`### Guided Practice: ${n}

**Focus Skill:** ${e}

This exercise requires you to journal or draft statements based on a self-reflective prompt. Use the questions below as a starting point. Your goal is to identify a core belief and define a corresponding measurable behavior.

* **Prompt 1:** When was the last time you felt truly in integrity with your stated values?
* **Prompt 2:** What is the most difficult piece of feedback you have successfully processed and implemented?`,Journal:(n,e)=>`### Journal Prompt: ${n}

**Focus Skill:** ${e}

Dedicate 15 minutes to freewriting based on this reflection prompt. Do not edit or self-censor. Just write.

* **Reflection Focus:** Describe a recent decision where the easiest path conflicted with the most ethical or strategically correct path. What was the impact on your long-term credibility?`,Quiz:(n,e)=>`### Self-Assessment: ${n}

**Focus Skill:** ${e}

This is a quick self-score. Rate yourself 1-5 (1=Never, 5=Always) on the following statements.

* I actively ask for negative feedback from my team.
* I publicly own mistakes before assigning blame.`,"Case Study":(n,e)=>`### Case Study Setup: ${n}

**Focus Skill:** ${e}

Review the following scenario description and prepare a 5-step action plan before running the simulation or discussing with your coach. The scenario involves a failure to delegate a crucial task to a capable subordinate, leading to team burnout and missed deadlines.`,Tool:(n,e)=>`### Tool Overview: ${n}

**Focus Skill:** ${e}

This module guides you through a new framework. The current focus is risk identification and mitigation planning. The objective of this tool is to formalize risk assessment across your strategic goals.`},Vv=n=>n<=4?"Intro":n<=7?"Core":"Mastery",Tc=(n,e)=>n>=8?Math.max(15,Math.round(e*.7)):n<=3?Math.min(90,Math.round(e*1.3)):e,Ov=(n,e)=>{const{managerStatus:t,goalPriorities:s,selfRatings:r}=n,i=Object.keys(je),a=[],c=new Set,h=[];t==="New"?h.push("T1","T2"):t==="Mid-Level"?h.push("T2","T3","T4"):h.push("T4","T5"),s.forEach(m=>h.push(m));let f=h.filter((m,_,v)=>v.indexOf(m)===_);i.forEach(m=>{f.includes(m)||f.push(m)});for(let m=1;m<=24;m++){let _=f[Math.floor((m-1)/4)%f.length];if(m>1&&s.length>0){const P=s.find(V=>r[V]<=3);P&&m%6===0&&(_=P)}const I=`Focus on ${je[_].name}`,C=r[_],N=Vv(C),k=[],D=Ec.filter(P=>P.tier===_&&P.difficulty===N&&!c.has(P.id));let M=0;for(const P of D)M<4&&(k.push({...P,duration:Tc(C,P.duration),status:"Pending"}),c.add(P.id),M++);if(k.length<4){const P=Ec.filter(V=>V.tier===_&&!c.has(V.id));for(const V of P)M<4&&(k.push({...V,duration:Tc(C,V.duration),status:"Pending"}),c.add(V.id),M++)}a.push({month:m,tier:_,theme:I,requiredContent:k,status:"Pending",reflectionText:"",monthCompletedDate:null,totalDuration:k.reduce((P,V)=>P+V.duration,0)})}return{ownerUid:e,assessment:n,plan:a,currentMonth:1,latestScenario:null,lastUpdate:new Date().toISOString()}},an=({content:n,children:e})=>{const[t,s]=S.useState(!1);return l.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[e,t&&l.jsxs("div",{className:"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2",children:[n,l.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-[-4px] w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#002E47]"})]})]})},K=({children:n,onClick:e,disabled:t=!1,variant:s="primary",className:r="",...i})=>{let a="px-6 py-3 rounded-xl font-semibold transition-all shadow-xl focus:outline-none focus:ring-4 text-white";return s==="primary"?a+=" bg-[#47A88D] hover:bg-[#349881] focus:ring-[#47A88D]/50":s==="secondary"?a+=" bg-[#E04E1B] hover:bg-red-700 focus:ring-[#E04E1B]/50":s==="outline"&&(a="px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[#47A88D] text-[#47A88D] hover:bg-[#47A88D]/10 focus:ring-4 focus:ring-[#47A88D]/50 bg-[#FCFCFA]"),t&&(a="px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none"),l.jsx("button",{...i,onClick:e,disabled:t,className:`${a} ${r}`,children:n})},G=({children:n,title:e,icon:t,className:s="",onClick:r})=>{const i=!!r,a=c=>{i&&(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r())};return l.jsxs("div",{role:i?"button":void 0,tabIndex:i?0:void 0,onKeyDown:a,className:`bg-[#FCFCFA] p-6 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 ${i?"cursor-pointer hover:border-[#002E47] border-2 border-transparent":""} ${s}`,onClick:r,children:[t&&l.jsx(t,{className:"w-8 h-8 text-[#47A88D] mb-4"}),e&&l.jsx("h2",{className:"text-xl font-bold text-[#002E47] mb-2",children:e}),n]})},rr=({name:n,icon:e,currentScreen:t,onClick:s})=>{const r=t===n,i="w-full text-left flex items-center space-x-3 p-3 rounded-xl transition-all duration-200",a="bg-[#47A88D]/20 text-[#47A88D] font-semibold shadow-inner",c="text-indigo-300 hover:bg-[#002E47]/70 hover:text-white",h=n.replace(/-/g," ").split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ");return l.jsxs("button",{type:"button",className:`${i} ${r?a:c}`,onClick:()=>s(n),"aria-current":r?"page":void 0,children:[l.jsx(e,{className:"w-5 h-5"}),l.jsx("span",{className:"text-sm",children:h})]})},Mv=({setAuthView:n,onLogin:e})=>{const[t,s]=S.useState(""),[r,i]=S.useState(""),[a,c]=S.useState(""),[h,f]=S.useState(!1),m=async _=>{_.preventDefault(),c(""),f(!0);try{const v=Br(),I=await pp(v,t,r);e({name:I.user.email,userId:I.user.uid})}catch(v){console.error("Login Error:",v),c("Login failed. Check your email/password or try resetting your password.")}finally{f(!1)}};return l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 font-sans p-4",children:l.jsxs("div",{className:"w-full max-w-md bg-[#FCFCFA] p-8 rounded-3xl shadow-2xl border border-gray-200",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(We,{className:"w-12 h-12 text-[#47A88D] mx-auto mb-3"}),l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47]",children:"Welcome to LeaderReps"}),l.jsx("p",{className:"text-indigo-500 mt-1",children:"Sign in to your Professional Development Platform"})]}),l.jsxs("form",{onSubmit:m,children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"email",children:"Email"}),l.jsx("input",{id:"email",type:"email",value:t,onChange:_=>s(_.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",required:!0})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"password",children:"Password"}),l.jsx("input",{id:"password",type:"password",value:r,onChange:_=>i(_.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",required:!0})]}),a&&l.jsx("p",{className:"text-sm text-[#E04E1B] bg-[#E04E1B]/10 p-2 rounded-lg mb-4",children:a}),l.jsx(K,{type:"submit",className:"w-full",disabled:!t||!r||h,children:h?"Signing In...":"Sign In"})]}),l.jsxs("div",{className:"mt-6 text-center space-y-2 text-sm",children:[l.jsx("button",{onClick:()=>n("signup"),className:"text-[#002E47] hover:text-[#47A88D] font-medium block w-full",children:"Need an account? Sign Up"}),l.jsx("button",{onClick:()=>n("reset"),className:"text-[#002E47] hover:text-[#47A88D] block w-full",children:"Forgot Password?"})]})]})})},Lv=({setAuthView:n})=>{const[e,t]=S.useState(""),[s,r]=S.useState(""),[i,a]=S.useState(""),[c,h]=S.useState(""),[f,m]=S.useState(!1),_=async v=>{if(v.preventDefault(),h(""),i!==Dv){h("Invalid Invitation Code. Please check your email for the correct code.");return}m(!0);try{const I=Br();await mp(I,e,s),alert("Account created successfully! You are now signed in.")}catch(I){console.error("Sign Up Error:",I),I.code==="auth/email-already-in-use"?h("This email is already registered. Try signing in."):I.code==="auth/weak-password"?h("Password should be at least 6 characters."):h("Sign up failed. Ensure email is valid and password is secure.")}finally{m(!1)}};return l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 font-sans p-4",children:l.jsxs("div",{className:"w-full max-w-md bg-[#FCFCFA] p-8 rounded-3xl shadow-2xl border border-gray-200",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(cn,{className:"w-12 h-12 text-[#47A88D] mx-auto mb-3"}),l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47]",children:"Invitation Sign Up"}),l.jsx("p",{className:"text-indigo-500 mt-1",children:"Create your secure LeaderReps account."})]}),l.jsxs("form",{onSubmit:_,children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"email",children:"Email"}),l.jsx("input",{id:"email",type:"email",value:e,onChange:v=>t(v.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",required:!0})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"password",children:"Password (min 6 characters)"}),l.jsx("input",{id:"password",type:"password",value:s,onChange:v=>r(v.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",required:!0})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"code",children:"Invitation Code"}),l.jsx("input",{id:"code",type:"text",value:i,onChange:v=>a(v.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",placeholder:"Check your invitation email",required:!0})]}),c&&l.jsx("p",{className:"text-sm text-[#E04E1B] bg-[#E04E1B]/10 p-2 rounded-lg mb-4",children:c}),l.jsx(K,{type:"submit",className:"w-full",disabled:!e||!s||!i||f,children:f?"Creating Account...":"Create Account"})]}),l.jsx("div",{className:"mt-6 text-center space-y-2 text-sm",children:l.jsx("button",{onClick:()=>n("login"),className:"text-[#002E47] hover:text-[#47A88D] font-medium block w-full",children:"Already have an account? Sign In"})})]})})},Fv=({setAuthView:n})=>{const[e,t]=S.useState(""),[s,r]=S.useState(""),[i,a]=S.useState(""),[c,h]=S.useState(!1),f=async m=>{m.preventDefault(),r(""),a(""),h(!0);try{const _=Br();await fp(_,e),r("Password reset email sent! Check your inbox."),t("")}catch(_){console.error("Password Reset Error:",_),_.code==="auth/user-not-found"?a("No user found with that email address."):a("Failed to send reset email. Please ensure the email address is correct.")}finally{h(!1)}};return l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 font-sans p-4",children:l.jsxs("div",{className:"w-full max-w-md bg-[#FCFCFA] p-8 rounded-3xl shadow-2xl border border-gray-200",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(Vr,{className:"w-12 h-12 text-[#47A88D] mx-auto mb-3"}),l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47]",children:"Reset Password"}),l.jsx("p",{className:"text-indigo-500 mt-1",children:"Enter your email to receive a password reset link."})]}),l.jsxs("form",{onSubmit:f,children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"email",children:"Email"}),l.jsx("input",{id:"email",type:"email",value:e,onChange:m=>t(m.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] transition-shadow",required:!0})]}),s&&l.jsx("p",{className:"text-sm text-green-600 bg-green-100 p-2 rounded-lg mb-4 font-medium",children:s}),i&&l.jsx("p",{className:"text-sm text-[#E04E1B] bg-[#E04E1B]/10 p-2 rounded-lg mb-4",children:i}),l.jsx(K,{type:"submit",className:"w-full",disabled:!e||c,children:c?"Sending Link...":"Send Reset Link"})]}),l.jsx("div",{className:"mt-6 text-center space-y-2 text-sm",children:l.jsx("button",{onClick:()=>n("login"),className:"text-[#002E47] hover:text-[#47A88D] font-medium block w-full",children:"Back to Sign In"})})]})})},Uv=({onLogin:n})=>{const[e,t]=S.useState("login");return(()=>{switch(e){case"signup":return l.jsx(Lv,{setAuthView:t});case"reset":return l.jsx(Fv,{setAuthView:t});case"login":default:return l.jsx(Mv,{setAuthView:t,onLogin:n})}})()},Bv=({onLogin:n})=>l.jsx(Uv,{onLogin:n}),mo="leadership_plan",po="roadmap",jn=typeof __app_id<"u"?__app_id:"default-app-id",qv=(n,e,t)=>{const[s,r]=S.useState(void 0),[i,a]=S.useState(!0),[c,h]=S.useState(null),f=e?`/artifacts/${jn}/users/${e}/${mo}/${po}`:null;S.useEffect(()=>{if(!n||!t||!e||!f){t&&a(!1);return}h(null);const v=it(n,f),I=ca(v,C=>{C.exists()?r(C.data()):r(null),a(!1)},C=>{console.error("Error subscribing to PDP data:",C),h("Real-time data synchronization failed. Check network or security rules."),a(!1),r(null)});return()=>I()},[n,e,t,f]);const m=S.useCallback(async v=>{const{db:I,userId:C}=ce();if(!I||!C||!f)return!1;try{const N=it(I,f);return await la(N,{...v,lastUpdate:new Date().toISOString()}),!0}catch(N){return console.error("Error updating PDP data:",N),!1}},[f]),_=S.useCallback(async v=>{const{db:I,userId:C}=ce();if(!I||!C||!f)return!1;try{const N=it(I,f);return await ii(N,{...v,ownerUid:C,lastUpdate:new Date().toISOString(),currentMonth:1}),!0}catch(N){return console.error("Error saving new PDP document:",N),!1}},[f]);return{pdpData:s,isLoading:i,error:c,updatePdpData:m,saveNewPlan:_}},Ac={lastCommitmentDate:new Date().toISOString().split("T")[0],history:[{date:"2025-10-10",score:"3/3"},{date:"2025-10-11",score:"1/3"},{date:"2025-10-12",score:"3/3"},{date:"2025-10-13",score:"2/3"},{date:"2025-10-14",score:"3/3"},{date:"2025-10-15",score:"0/3"},{date:"2025-10-16",score:"3/3"}],active_commitments:[{id:102,text:'Identify and block out 90 minutes for "Deep Work" on a high-leverage task.',status:"Committed",linkedGoal:"Improve Team Execution Quality",linkedTier:"T3",targetColleague:null},{id:302,text:"Conduct at least one scheduled 1:1 session with a direct report.",status:"Pending",linkedGoal:"Formalize Succession Planning",linkedTier:"T4",targetColleague:"Alex"},{id:401,text:"Log one instance where I consciously acted in alignment with my Leadership Identity Statement (LIS).",status:"Missed",linkedGoal:"Develop Cross-Functional Skills",linkedTier:"T1",targetColleague:null}],reflection_journal:""},$v="daily_practice",Gv="scorecard_data",Kv=(n,e,t)=>{const[s,r]=S.useState(null),[i,a]=S.useState(!0),[c,h]=S.useState(null),f=e?`/artifacts/${jn}/users/${e}/${$v}/${Gv}`:null,m=v=>{if(!v)return!1;const I=new Date().toISOString().split("T")[0];return v.lastCommitmentDate!==I};S.useEffect(()=>{if(!n||!t||!e||!f){t&&a(!1);return}h(null);const v=it(n,f),I=ca(v,async C=>{let N;if(C.exists())N=C.data();else try{await ii(v,Ac),N=Ac}catch(k){console.error("Error creating default Commitment document:",k),h("Could not initialize Commitment data."),a(!1);return}if(m(N)){const k=new Date().toISOString().split("T")[0],D=N.active_commitments.length>0?`${N.active_commitments.filter(L=>L.status==="Committed").length}/${N.active_commitments.length}`:"0/0",M=[...N.history],P=N.lastCommitmentDate;(M.length===0||M[M.length-1].date!==P)&&M.push({date:P,score:D}),M.length>7&&M.splice(0,M.length-7);const V=N.active_commitments.map(L=>({...L,status:"Pending"})),B=zh(n);B.update(v,{lastCommitmentDate:k,history:M,active_commitments:V,reflection_journal:""});try{await B.commit()}catch(L){console.error("Error resetting daily commitments via batch:",L),h("Failed to reset daily scorecard.")}}else r(N);a(!1)},C=>{console.error("Error subscribing to Commitment data:",C),h("Commitment data synchronization failed."),a(!1)});return()=>I()},[n,e,t,f]);const _=S.useCallback(async v=>{const{db:I,userId:C}=ce();if(!I||!C||!f)return!1;try{const N=it(I,f);let k=v;if(typeof v=="function"){const D=await Sv(N),M=D.exists()?D.data():null;if(!M)throw new Error("Commitment data not found for functional update.");k=v(M)}return await la(N,k),!0}catch(N){return console.error("Error updating Commitment data:",N),!1}},[f]);return{commitmentData:s,isLoading:i,error:c,updateCommitmentData:_}},Cc={vision:"To lead a team recognized globally for its innovative speed and psychological safety by 2028.",mission:"To empower every team member to take calculated risks and own the outcomes, driving a culture of continuous learning and customer-centric excellence.",okrs:[{id:1,objective:"Dramatically improve team execution quality and velocity",keyResults:[{id:101,kr:"Reduce customer-reported bugs from 45 to 15 per quarter."},{id:102,kr:"Increase team code coverage on critical features from 70% to 95%."}]}],last_premortem_decision:"N/A"},Hv="planning_hub",zv="planning_data",Wv=(n,e,t)=>{const[s,r]=S.useState(null),[i,a]=S.useState(!0),[c,h]=S.useState(null),f=e?`/artifacts/${jn}/users/${e}/${Hv}/${zv}`:null;S.useEffect(()=>{if(!n||!t||!e||!f){t&&a(!1);return}h(null);const _=it(n,f),v=ca(_,async I=>{if(I.exists())r(I.data()),a(!1);else try{await ii(_,Cc),r(Cc),a(!1)}catch(C){console.error("Error creating default Planning document:",C),h("Could not initialize Planning data."),a(!1)}},I=>{console.error("Error subscribing to Planning data:",I),h("Planning data synchronization failed."),a(!1)});return()=>v()},[n,e,t,f]);const m=S.useCallback(async _=>{const{db:v,userId:I}=ce();if(!v||!I||!f)return!1;try{const C=it(v,f);return await la(C,_),!0}catch(C){return console.error("Error updating Planning data:",C),!1}},[f]);return{planningData:s,isLoading:i,error:c,updatePlanningData:m}},Qv=({children:n,firebaseServices:e,userId:t,isAuthReady:s,navigate:r,user:i})=>{const{db:a}=e,c=qv(a,t,s),h=Kv(a,t,s),f=Wv(a,t,s),m=c.isLoading||h.isLoading||f.isLoading,_=c.error||h.error||f.error,v=S.useMemo(()=>({navigate:r,user:i,...e,userId:t,isAuthReady:s,updatePdpData:c.updatePdpData,saveNewPlan:c.saveNewPlan,updateCommitmentData:h.updateCommitmentData,updatePlanningData:f.updatePlanningData,pdpData:c.pdpData,commitmentData:h.commitmentData,planningData:f.planningData,isLoading:m,error:_}),[r,i,e,t,s,m,_,c,h,f]);return s?l.jsx(Wh.Provider,{value:v,children:n}):l.jsx(l.Fragment,{})},Yv=()=>{const{navigate:n,user:e}=ce();return l.jsxs("div",{className:"p-8 space-y-8",children:[l.jsxs("h1",{className:"text-3xl font-extrabold text-[#002E47]",children:["Welcome back, ",e.name,"!"]}),l.jsx("p",{className:"text-lg text-gray-600",children:"Your hub for leadership practice, strategy, and growth."}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[l.jsxs(G,{title:"QuickStart Program Overview",icon:We,onClick:()=>n("quick-start-accelerator"),children:[l.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Review the core curriculum of the 4-Session QuickStart program: Feedback, Identity, Coaching, and Trust."}),l.jsx(K,{onClick:()=>n("quick-start-accelerator"),variant:"outline",className:"w-full",children:"Review Sessions"})]}),l.jsxs(G,{title:"Professional Development Plan (Prof Dev Plan)",icon:Ze,onClick:()=>n("prof-dev-plan"),className:"lg:col-span-1 border-4 border-[#47A88D] bg-[#47A88D]/10",children:[l.jsx("p",{className:"text-gray-700 font-medium text-sm mb-4",children:"Your personalized growth plan. Track your progress, set goals, and access your tailored learning path."}),l.jsx(K,{onClick:()=>n("prof-dev-plan"),className:"w-full bg-[#002E47] hover:bg-gray-800",children:"Start Development"})]}),l.jsxs(G,{title:"Coaching & Crucial Conversations Lab",icon:tn,onClick:()=>n("coaching-lab"),children:[l.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Practice high-stakes conversations and refine your feedback skills using structured templates and AI critique."}),l.jsx(K,{onClick:()=>n("coaching-lab"),variant:"outline",className:"w-full",children:"Go to Lab"})]}),l.jsxs(G,{title:"Daily Practice & Commitment",icon:Tn,onClick:()=>n("daily-practice"),children:[l.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Manage your micro-habits, log daily commitments, and track the consistent effort required for long-term growth."}),l.jsx(K,{onClick:()=>n("daily-practice"),variant:"outline",className:"w-full",children:"Go to Hub"})]}),l.jsxs(G,{title:"Vision & OKR Planning Hub",icon:ln,onClick:()=>n("planning-hub"),children:[l.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Draft your leadership vision and set measurable Quarterly Objectives and Key Results (OKRs)."}),l.jsx(K,{onClick:()=>n("planning-hub"),variant:"outline",className:"w-full",children:"Plan Strategy"})]}),l.jsxs(G,{title:"Business Readings",icon:Dr,onClick:()=>n("business-readings"),children:[l.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Access categorized, one-page summaries of top leadership and business books, generated on demand."}),l.jsx(K,{onClick:()=>n("business-readings"),variant:"outline",className:"w-full",children:"Explore Summaries"})]})]})]})},Jv=({setQuickStartView:n})=>{const{navigate:e}=ce(),[t,s]=S.useState("I am a dedicated leader who always tries to do the right thing for my team and my company. I believe in hard work."),[r,i]=S.useState(!1),[a,c]=S.useState(""),[h,f]=S.useState("");S.useEffect(()=>{if(!a){f("");return}(async()=>f(await zt(a)))()},[a]);const m=async()=>{var I,C,N,k;if(!t.trim()){alert("Please provide your Leadership Identity Statement draft first.");return}i(!0),c("");const _="You are an elite executive coach specializing in Leadership Identity Statement (LIS) development. Your task is to critique the user's LIS draft based on clarity, actionability, and aspirational alignment. Your critique must be polite, structured using Markdown, and focus on: 1) **Clarity and Specificity**: Is the language vague or highly specific? 2) **Action/Behavior Focus**: Does it focus on *what they do* (actionable) or just *what they believe* (passive)? 3) **Aspirational Rigor**: Does it set a high, measurable standard for their leadership? Conclude with a refined, concise LIS example using the core values from the user's draft.",v=`Critique this Leadership Identity Statement draft:

${t}`;try{const D={contents:[{role:"user",parts:[{text:v}]}],systemInstruction:{parts:[{text:_}]}};if(!ve()){c("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI coaching and critique features."),i(!1);return}const M=await Ht(D),P=(I=M==null?void 0:M.candidates)==null?void 0:I[0];P&&((k=(N=(C=P.content)==null?void 0:C.parts)==null?void 0:N[0])!=null&&k.text)?c(P.content.parts[0].text):c("Could not generate critique. The model may have blocked the request or the response was empty.")}catch(D){console.error("Gemini API Error:",D),c("An error occurred while connecting to the AI coach. Please check your inputs and network connection.")}finally{i(!1)}};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Leadership Identity Statement (LIS) Auditor"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Your LIS is the foundation of your leadership. Get expert feedback to ensure your statement is specific, actionable, and truly aligned with your highest self."}),l.jsxs(K,{onClick:()=>n("quick-start-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to QuickStart"]}),l.jsxs(G,{title:"Draft Your Leadership Identity Statement",icon:Vr,className:"mb-8 border-l-4 border-[#002E47]",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2",children:"Write your LIS below. It should define who you are when you're leading at your absolute best."}),l.jsx("textarea",{value:t,onChange:_=>s(_.target.value),className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-32",placeholder:"e.g., 'I am a visionary, transparent, and challenging leader who cultivates trust by owning failures and rewarding courageous feedback.'"}),l.jsx(an,{content:ve()?"Runs your draft through the AI Coach for structured critique.":"AI Critique is unavailable. Check App Settings for configuration.",children:l.jsx(K,{onClick:m,disabled:r||!t.trim(),className:"mt-4 w-full md:w-auto",children:r?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Auditing Identity..."]}):"Run LIS Audit"})})]}),h&&l.jsx(G,{title:"AI Coach Critique",className:"mt-8 bg-[#002E47]/10 border border-[#002E47]/20 rounded-3xl",children:l.jsx("div",{className:"prose max-w-none prose-h3:text-[#47A88D] prose-p:text-gray-700 prose-ul:space-y-2",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:h}})})})]})},Xv=()=>{const[n,e]=S.useState("quick-start-home"),t=[{id:1,title:"Delivering Effective Feedback",focus:"CLEAR Framework & The Magic Ratio (5:1)",keyRationale:"Feedback is the currency of growth. Master objectivity (SBI) and ensure positive reinforcement outweighs correction to build a high-trust team environment.",preWork:["Watch Session 1 Prep Video","Complete Pre-Session Exercises (Leadership Truths, CLEAR Performance)","Complete Workout Prep (Feedback Scenarios)"]},{id:2,title:"Anchoring Feedback with Identity",focus:"Leadership Identity Statement (LIS) & Anchored Feedback",keyRationale:"Your LIS is your North Star. Grounding every action and conversation in your core values ensures integrity and makes your leadership predictable and trustworthy.",preWork:["Watch Session 2 Prep Video","Complete Admired Leaders Exercise","Draft Leadership Identity Statement","Feedback Reflection & Scenarios"]},{id:3,title:"Coaching One-on-One (1:1)",focus:"1:1 Structure, Direct-Led Agenda, and Coaching for Growth",keyRationale:"Effective 1:1s are the most high-leverage time you spend. Shift from status updates to future-focused coaching and actively listening to employee challenges.",preWork:["Sign up for 1:1 with Trainer","Review 1:1 Notes & Topics","Prepare for Personalized Coaching Session"]},{id:4,title:"Building Vulnerability-Based Trust",focus:"Trust Fundamentals, 1:1 Habit, and Leading with Vulnerability",keyRationale:"Trust is the foundation for speed and psychological safety. Learn to lead by modeling vulnerability and commitment, creating space for the team to take risks and admit mistakes.",preWork:["Watch Session 4 Prep Video","Complete Pre-Session Exercises (Leadership Truths, 1:1s, Trust)","Complete Reflections (Feedback, 1:1, Vulnerability)"]}];return(()=>{switch(n){case"lis-auditor":return l.jsx(Jv,{setQuickStartView:e});case"quick-start-home":default:return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"4-Session QuickStart Program"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl",children:"This program is the foundational accelerator for the LeaderReps methodology. Review the sessions, core focus, and pre-work below."}),l.jsxs(G,{title:"Draft & Refine Your Leadership Identity",icon:Vr,onClick:()=>e("lis-auditor"),className:"mb-8 bg-[#47A88D]/10 border-4 border-[#47A88D]",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Access the **LIS Auditor** to receive expert critique on your personal leadership foundation statement. This is crucial for Session 2 pre-work!"}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Launch LIS Auditor →"})]}),l.jsx("div",{className:"space-y-6",children:t.map(r=>l.jsxs(G,{title:`Session ${r.id}: ${r.title}`,icon:We,className:"border-l-8 border-[#002E47]",children:[l.jsx("p",{className:"text-md font-semibold text-[#002E47] mb-4",children:"Why this session matters:"}),l.jsx("blockquote",{className:"border-l-4 border-[#47A88D] pl-4 py-1 mb-4 text-sm italic text-gray-600",children:r.keyRationale}),l.jsxs("div",{className:"md:flex md:space-x-8",children:[l.jsxs("div",{className:"md:w-1/2 mb-4 md:mb-0",children:[l.jsx("h3",{className:"text-lg font-semibold text-[#47A88D] mb-2",children:"Core Focus"}),l.jsx("p",{className:"text-gray-700",children:r.focus})]}),l.jsxs("div",{className:"md:w-1/2",children:[l.jsx("h3",{className:"text-lg font-semibold text-[#47A88D] mb-2",children:"Pre-Work Checklist"}),l.jsx("ul",{className:"list-disc pl-5 text-gray-700 space-y-1",children:r.preWork.map((i,a)=>l.jsx("li",{className:"text-sm",children:i},a))})]})]})]},r.id))})]})}})()},Sc={"Focus & Productivity":[{id:1,text:'Identify and block out 90 minutes for "Deep Work" on a high-leverage task.',isCustom:!1},{id:2,text:"Close email/chat apps entirely for the first two hours of the workday.",isCustom:!1},{id:3,text:"Review and confirm alignment with my top 3 OKRs before starting my day.",isCustom:!1},{id:4,text:"Decline one non-essential meeting to protect focused work time.",isCustom:!1},{id:5,text:"Process emails only during two dedicated 30-minute windows.",isCustom:!1},{id:6,text:"List the one non-negotiable win for tomorrow before leaving the office.",isCustom:!1},{id:7,text:"Do not check external news or social media before 10 AM.",isCustom:!1},{id:8,text:"Time-box all low-leverage administrative tasks to 60 minutes max.",isCustom:!1},{id:9,text:"Finish the day with a 15-minute desk clean and digital file purge.",isCustom:!1},{id:10,text:"Write a concise end-of-day summary for my team/manager (optional).",isCustom:!1}],"Feedback & Coaching":[{id:11,text:"Deliver one piece of specific, objective (SBI) constructive feedback.",isCustom:!1},{id:12,text:"Deliver one piece of specific, genuine positive reinforcement (5:1 Ratio).",isCustom:!1},{id:13,text:"Conduct one scheduled 1:1 session with a direct report, focusing on their agenda.",isCustom:!1},{id:14,text:'Use a powerful, open-ended question (e.g., "What is the biggest roadblock?") in a team meeting.',isCustom:!1},{id:15,text:"Paraphrase and validate a colleague’s emotion during a difficult discussion.",isCustom:!1},{id:16,text:"Actively listen for 5 minutes without interrupting anyone.",isCustom:!1},{id:17,text:'Ask "How can I support you?" instead of "Why did this happen?" during a performance conversation.',isCustom:!1},{id:18,text:"Mentor one junior colleague for 15 minutes on a specific skill.",isCustom:!1},{id:19,text:"Document one specific coaching action for each direct report.",isCustom:!1},{id:20,text:"Provide feedback to my own manager.",isCustom:!1}],"Trust & Identity":[{id:21,text:"Log one instance where I consciously acted in alignment with my Leadership Identity Statement (LIS).",isCustom:!1},{id:22,text:"Lead by modeling vulnerability: admit one specific error or uncertainty to the team.",isCustom:!1},{id:23,text:"Hold myself and one direct report accountable for a clear, measurable commitment.",isCustom:!1},{id:24,text:'Say "no" to a request that conflicts with my top strategic priority.',isCustom:!1},{id:25,text:"Practice silence during a debate to allow psychological safety for others.",isCustom:!1},{id:26,text:"Express gratitude publicly to a team member for courage or effort, not just results.",isCustom:!1},{id:27,text:"Engage in a difficult conversation I have been avoiding (Crucial Conversation).",isCustom:!1},{id:28,text:"Write down one core leadership value and define a concrete behavior that supports it.",isCustom:!1},{id:29,text:"Apologize sincerely and specifically for a mistake I made.",isCustom:!1},{id:30,text:"Ensure my body language and tone match my message (congruence).",isCustom:!1}],"Strategy & Planning":[{id:31,text:"Review the organizational Vision/Mission statement and relate it to my team’s QTR goals.",isCustom:!1},{id:32,text:'Refine one Key Result in the Planning Hub to be more clearly "from X to Y".',isCustom:!1},{id:33,text:'Conduct a mini "Pre-Mortem" audit on a minor decision I am making.',isCustom:!1},{id:34,text:"Delegate a task that I believe I could do better/faster, but that the other person needs for development.",isCustom:!1},{id:35,text:"Review my weekly calendar: is 80% of my time spent on tasks that drive the top 20% of results?",isCustom:!1},{id:36,text:"Proactively seek external data/competitive intelligence for future planning.",isCustom:!1},{id:37,text:"Update a project risk log with two new potential failure points.",isCustom:!1},{id:38,text:'Set clear "stop" criteria for a failing project or experiment.',isCustom:!1},{id:39,text:"Write a short one-page summary of a new business book or article.",isCustom:!1},{id:40,text:"Check if any daily commitments are misaligned with strategic objectives.",isCustom:!1}]},Zv=({commitment:n,onLogCommitment:e,onRemove:t})=>{const s=f=>f==="Committed"?"bg-green-100 text-green-800 border-green-500 shadow-md":f==="Missed"?"bg-red-100 text-red-800 border-red-500 shadow-md":"bg-gray-100 text-gray-700 border-gray-300 shadow-sm",r=f=>f==="Committed"?l.jsx(Lt,{className:"w-5 h-5 text-green-600"}):f==="Missed"?l.jsx(We,{className:"w-5 h-5 text-[#E04E1B] transform rotate-45"}):l.jsx(Tn,{className:"w-5 h-5 text-gray-500"}),i=n.status||"Pending",a=n.linkedTier?je[n.linkedTier]:null,c=a?`${a.id}: ${a.name}`:"N/A",h=n.targetColleague?`Focus: ${n.targetColleague}`:"Self-Focus";return l.jsxs("div",{className:`p-4 rounded-xl flex flex-col justify-between ${s(i)} transition-all duration-300`,children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2 text-lg font-semibold mb-2",children:[r(i),l.jsx("span",{className:"text-[#002E47] text-base",children:n.text})]}),l.jsx("button",{onClick:()=>t(n.id),className:"text-gray-400 hover:text-[#E04E1B] transition-colors p-1 rounded-full",children:l.jsx(Or,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"flex space-x-3 mb-3 overflow-x-auto",children:[l.jsxs("div",{className:"text-xs text-[#002E47] bg-[#002E47]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap",children:["Goal: ",n.linkedGoal||"N/A"]}),n.linkedTier&&l.jsxs("div",{className:"text-xs text-[#47A88D] bg-[#47A88D]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap",children:["Tier: ",c]}),l.jsx("div",{className:"text-xs text-[#E04E1B] bg-[#E04E1B]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap",children:h})]}),l.jsxs("div",{className:"flex space-x-2 mt-3 pt-3 border-t border-gray-300/50",children:[l.jsx(K,{onClick:()=>e(n.id,"Committed"),disabled:i==="Committed",className:"px-3 py-1 text-xs bg-[#47A88D] hover:bg-[#349881] disabled:bg-green-300 disabled:shadow-none",children:"Committed"}),l.jsx(K,{onClick:()=>e(n.id,"Missed"),disabled:i==="Missed",className:"px-3 py-1 text-xs bg-[#E04E1B] hover:bg-red-700 disabled:bg-red-300 disabled:shadow-none",children:"Missed"}),i!=="Pending"&&l.jsx(K,{onClick:()=>e(n.id,"Pending"),variant:"outline",className:"px-3 py-1 text-xs border-gray-400 text-gray-700 hover:bg-gray-200",children:"Reset"})]})]})},e0=({setView:n,initialGoal:e,initialTier:t})=>{var bt,J;const{updateCommitmentData:s,commitmentData:r,planningData:i,pdpData:a}=ce(),[c,h]=S.useState("bank"),[f,m]=S.useState(""),[_,v]=S.useState(""),[I,C]=S.useState(e||""),[N,k]=S.useState(t||""),[D,M]=S.useState(""),[P,V]=S.useState(!1),B=(r==null?void 0:r.active_commitments)||[],L=new Set(B.map(U=>U.id)),w=(bt=a==null?void 0:a.plan)==null?void 0:bt.find(U=>U.month===(a==null?void 0:a.currentMonth)),g=(w==null?void 0:w.requiredContent)||[],y=new Set(g.map(U=>`pdp-${U.id}`)),E=Object.values(Sc).flat().filter(U=>!L.has(U.id)&&U.text.toLowerCase().includes(f.toLowerCase())),T=((J=i==null?void 0:i.okrs)==null?void 0:J.map(U=>U.objective))||[],x=[i==null?void 0:i.vision,i==null?void 0:i.mission].filter(Boolean),fe=["--- Select the Goal this commitment supports ---",...T,...x,"Improve Feedback & Coaching Skills","Other / New Goal"],me=fe[0];S.useEffect(()=>{e&&e!==I&&C(e),t&&t!==N&&k(t)},[e,t]),S.useEffect(()=>{I||C(me)},[I,me]);const He=async(U,se)=>{if(!I||I===me||!N)return;V(!0);let we;se==="pdp"?we={id:`pdp-content-${U.id}-${Date.now()}`,text:`(PDP Focus) Complete: ${U.title} (${U.type})`,status:"Pending",isCustom:!0,linkedGoal:I,linkedTier:N,targetColleague:`Est. ${U.duration} min`}:we={...U,status:"Pending",linkedGoal:I,linkedTier:N,targetColleague:D.trim()||null};const oe=[...B,we];await s({active_commitments:oe}),e!==I&&C(me),t!==N&&k(""),v(""),M(""),V(!1)},qe=async()=>{if(_.trim()&&I&&I!==me&&N){V(!0);const U=Date.now(),se=[...B,{id:U,text:_.trim(),status:"Pending",isCustom:!0,linkedGoal:I,linkedTier:N,targetColleague:D.trim()||null}];await s({active_commitments:se}),v(""),e!==I&&C(me),t!==N&&k(""),M(""),V(!1)}},Ee=!!I&&I!==me&&!!N&&!P,Xe=U=>`px-4 py-2 font-semibold rounded-t-xl transition-colors ${c===U?"bg-[#FCFCFA] text-[#002E47] border-t-2 border-x-2 border-[#47A88D]":"bg-gray-200 text-gray-500 hover:text-[#002E47]"}`;return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Manage Your Scorecard Commitments"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Select the core micro-habits that directly support your current leadership development goals. You should aim for 3-5 active commitments."}),l.jsxs(K,{onClick:()=>n("scorecard"),variant:"secondary",className:"mb-8",disabled:P,children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Scorecard"]}),l.jsxs(G,{title:"Goal and Tier Alignment (Mandatory)",icon:lt,className:"mb-8 p-6 bg-[#47A88D]/10 border-2 border-[#47A88D]",children:[l.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Ensure your daily action is tied to a strategic goal **and** a core leadership tier."}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"1. Strategic Goal"}),l.jsx("select",{value:I,onChange:U=>C(U.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#002E47] focus:border-[#002E47] text-[#002E47] font-semibold",children:fe.map(U=>l.jsx("option",{value:U,disabled:U===me,children:U},U))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"2. Leadership Tier (T1-T5)"}),l.jsxs("select",{value:N,onChange:U=>k(U.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#002E47] focus:border-[#002E47] text-[#002E47] font-semibold",children:[l.jsx("option",{value:"",children:"--- Select Tier ---"}),Object.values(je).map(U=>l.jsxs("option",{value:U.id,children:[U.id,": ",U.name]},U.id))]})]})]}),l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"3. Target Colleague (Optional for inter-personal skills)"}),l.jsx("input",{type:"text",value:D,onChange:U=>M(U.target.value),placeholder:"e.g., Alex, Sarah, or Leave Blank for Self-Focus",className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D]"}),!Ee&&l.jsx("p",{className:"text-[#E04E1B] text-sm mt-3",children:"* Please select a Strategic Goal and a Leadership Tier to activate the 'Add' buttons."})]}),l.jsxs("div",{className:"flex space-x-2 border-b border-gray-300 -mb-px",children:[l.jsxs("button",{className:Xe("pdp"),onClick:()=>h("pdp"),children:[l.jsx(Ze,{className:"w-4 h-4 inline mr-1"})," PDP Content (",g.filter(U=>!y.has(`pdp-${U.id}`)).length,")"]}),l.jsxs("button",{className:Xe("bank"),onClick:()=>h("bank"),children:[l.jsx(Dr,{className:"w-4 h-4 inline mr-1"})," Commitment Bank (",E.length,")"]}),l.jsxs("button",{className:Xe("custom"),onClick:()=>h("custom"),children:[l.jsx(xn,{className:"w-4 h-4 inline mr-1"})," Custom Commitment"]})]}),l.jsxs("div",{className:"mt-0 bg-[#FCFCFA] p-6 rounded-b-3xl shadow-lg border-2 border-t-0 border-[#47A88D]/30",children:[c==="pdp"&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("p",{className:"text-sm text-gray-700",children:["These items are currently required for you to complete Month **",(w==null?void 0:w.month)||"N/A","** (",(w==null?void 0:w.theme)||"N/A Focus",") of your personalized plan."]}),l.jsx("div",{className:"h-96 overflow-y-auto pr-2 space-y-3 pt-2",children:g.length>0?g.filter(U=>!L.has(`pdp-content-${U.id}`)).map(U=>l.jsxs("div",{className:"flex justify-between items-center p-3 text-sm bg-[#47A88D]/5 rounded-lg border border-[#47A88D]/20",children:[l.jsxs("span",{className:"text-gray-800 font-medium",children:[U.title," (",U.type,")"]}),l.jsx(an,{content:"Adds this item to your daily scorecard for tracking (linked goal/tier required).",children:l.jsxs("button",{onClick:()=>He(U,"pdp"),disabled:!Ee,className:`font-semibold text-xs transition-colors p-1 flex items-center space-x-1 ${Ee?"text-[#47A88D] hover:text-[#349881]":"text-gray-400 cursor-not-allowed"}`,children:[l.jsx(xn,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Add to Scorecard"})]})})]},U.id)):l.jsx("p",{className:"text-gray-500 italic text-center py-10",children:"No required content for the current PDP month, or you have already added all items."})})]}),c==="bank"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("input",{type:"text",placeholder:"Filter Commitment Bank by keyword (e.g., 'feedback' or 'OKR')",value:f,onChange:U=>m(U.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] mb-4"}),l.jsxs("div",{className:"h-96 overflow-y-auto pr-2 space-y-3",children:[Object.entries(Sc).map(([U,se])=>{const we=se.filter(oe=>!L.has(oe.id)&&oe.text.toLowerCase().includes(f.toLowerCase()));return we.length===0?null:l.jsxs("div",{children:[l.jsx("h3",{className:"text-sm font-bold text-[#002E47] border-b pb-1 mb-2",children:U}),we.map(oe=>l.jsxs("div",{className:"flex justify-between items-center p-2 text-sm bg-gray-50 rounded-lg mb-1",children:[l.jsx("span",{className:"text-gray-800",children:oe.text}),l.jsx(an,{content:"Adds this commitment (linked goal/tier required).",children:l.jsx("button",{onClick:()=>He(oe,"bank"),disabled:!Ee,className:`font-semibold text-xs transition-colors p-1 ${Ee?"text-[#47A88D] hover:text-[#349881]":"text-gray-400 cursor-not-allowed"}`,children:l.jsx(xn,{className:"w-4 h-4"})})})]},oe.id))]},U)}),E.length===0&&f&&l.jsx("p",{className:"text-gray-500 italic mt-4 text-center",children:"No unselected commitments match your search."}),E.length===0&&!f&&l.jsx("p",{className:"text-gray-500 italic mt-4 text-center",children:"Select from the categories above once you have chosen a goal/tier."})]})]}),c==="custom"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("p",{className:"text-sm text-gray-700",children:"Define a hyper-specific, measurable action tailored to your unique challenges."}),l.jsx("textarea",{value:_,onChange:U=>v(U.target.value),placeholder:"e.g., Conduct a 10-minute debrief after every client meeting.",className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-20 mb-4"}),l.jsx(K,{onClick:qe,disabled:!_.trim()||!Ee,className:"w-full bg-[#47A88D] hover:bg-[#349881]",children:P?"Saving...":"Add Custom Commitment"})]})]})]})},t0=({initialGoal:n,initialTier:e})=>{const{commitmentData:t,planningData:s}=ce(),[r,i]=S.useState(n||e?"selector":"scorecard"),[a,c]=S.useState(!1),[h,f]=S.useState((t==null?void 0:t.reflection_journal)||"");S.useEffect(()=>{t&&(f(t.reflection_journal),(n||e)&&i("selector"))},[t,n,e]);const{isLoading:m,error:_}=ce();if(m)return l.jsx("div",{className:"p-8 min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Loading Daily Commitment Scorecard..."})]})});if(_)return l.jsx("div",{className:"p-8",children:l.jsxs("p",{className:"text-[#E04E1B] p-4 bg-red-100 rounded-xl",children:["Error loading data: ",_]})});const v=(t==null?void 0:t.active_commitments)||[],I=(t==null?void 0:t.history)||[],C=async(B,L)=>{const{updateCommitmentData:w}=ce();c(!0);const g=v.map(y=>y.id===B?{...y,status:L}:y);await w({active_commitments:g}),c(!1)},N=async B=>{const{updateCommitmentData:L}=ce();c(!0);const w=v.filter(g=>g.id!==B);await L({active_commitments:w}),c(!1)},k=async()=>{const{updateCommitmentData:B}=ce();c(!0),await B({reflection_journal:h}),c(!1)},D=()=>{const B=v.length;return`${v.filter(w=>w.status==="Committed").length} / ${B}`},P=(B=>{let L=0;const w=Array.isArray(B)?B:[];for(let g=w.length-1;g>=0;g--){const y=w[g].score.split("/");if(y.length!==2)continue;const[b,E]=y.map(Number);if(b===E&&E>0)L++;else{if(E>0)break;if(L>0)break}}return L})(I);return(()=>{var B;switch(r){case"selector":return l.jsx(e0,{setView:i,initialGoal:n,initialTier:e});case"scorecard":default:return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Daily Commitment Scorecard (Leadership Practice)"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Track your daily commitment to the non-negotiable leadership actions that reinforce your professional identity. Consistently hitting this score is the key to sustained executive growth."}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[l.jsxs("div",{className:"lg:col-span-2",children:[(n||e)&&l.jsxs("div",{className:"p-4 mb-6 bg-[#47A88D]/10 border border-[#47A88D] rounded-xl text-sm font-medium text-[#002E47]",children:[l.jsxs("p",{className:"font-bold flex items-center",children:[l.jsx(Nc,{className:"w-4 h-4 mr-2"})," Next Step Recommended:"]}),l.jsxs("p",{children:["Your new focus area is **",n||((B=je[e])==null?void 0:B.name)||"a new phase","**. Click 'Manage Commitments' to align your daily practice to this goal!"]})]}),l.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[l.jsxs("h3",{className:"text-2xl font-extrabold text-[#002E47]",children:["Today's Commitments (",v.length,")"]}),l.jsxs(K,{onClick:()=>i("selector"),variant:"outline",className:"text-sm px-4 py-2",disabled:a,children:[l.jsx(xn,{className:"w-4 h-4 mr-2"})," Manage Commitments"]})]}),l.jsxs(G,{title:"Current Commitments",icon:lt,className:"mb-8 border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsx("div",{className:"space-y-4",children:v.length>0?v.map(L=>l.jsx(Zv,{commitment:L,onLogCommitment:C,onRemove:N},L.id)):l.jsx("p",{className:"text-gray-500 italic text-center py-4",children:"Your scorecard is empty. Click 'Manage Commitments' to start building your daily practice!"})}),l.jsxs("div",{className:"mt-8 pt-4 border-t border-gray-200 flex justify-between items-center",children:[l.jsx("h3",{className:"text-2xl font-extrabold text-[#002E47]",children:"Daily Score:"}),l.jsx("span",{className:`text-4xl font-extrabold p-3 rounded-xl shadow-inner min-w-[100px] text-center ${v.length>0&&v.every(L=>L.status==="Committed")?"text-green-600 bg-green-50":"text-[#002E47] bg-gray-100"}`,children:D()})]})]})]}),l.jsx("div",{className:"lg:col-span-1 space-y-8",children:l.jsxs(G,{title:"Commitment History",icon:go,className:"bg-[#002E47]/10 border-2 border-[#002E47]/20",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"**Data is persistent and loaded from Firestore!** (Last 7 days)"}),l.jsxs("div",{className:"p-6 bg-[#FCFCFA] border border-gray-200 rounded-xl",children:[l.jsx("h4",{className:"text-lg font-semibold text-[#002E47] mb-2",children:"Last 7 Days"}),l.jsx("div",{className:"flex justify-between text-xs font-mono text-gray-700 space-x-1 overflow-x-auto",children:I.slice(-7).map(L=>l.jsxs("div",{className:"flex flex-col items-center min-w-[40px]",children:[l.jsx("span",{className:"font-bold",children:L.date.split("-").pop()}),l.jsx("span",{className:`text-lg font-extrabold ${L.score.split("/").length===2&&L.score.split("/")[0]===L.score.split("/")[1]&&Number(L.score.split("/")[1])>0?"text-green-600":"text-[#E04E1B]"}`,children:L.score})]},L.date))}),l.jsxs("p",{className:"mt-3 text-[#47A88D] font-medium",children:["Current Streak: ",P," ",P===1?"Day":"Days"]})]})]})})]}),l.jsxs(G,{title:"Reinforcement Journal",icon:jr,className:"bg-[#002E47]/10 border-2 border-[#002E47]/20 rounded-3xl mt-8",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"Reflect on today's performance. How did executing (or missing) these leadership commitments impact your team's momentum and your own executive presence? This reinforcement loop is vital."}),l.jsx("textarea",{value:h,onChange:L=>f(L.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-40",placeholder:"My reflection (required)..."}),l.jsx(K,{variant:"secondary",onClick:k,disabled:a,className:"mt-4 w-full",children:a?"Saving...":"Save Daily Reflection"})]})]})}})()},n0=({sender:n,text:e,isAI:t})=>l.jsx("div",{className:`flex mb-4 ${t?"justify-start":"justify-end"}`,children:l.jsxs("div",{className:`p-4 max-w-lg rounded-xl shadow-md ${t?"bg-[#002E47]/10 text-[#002E47] rounded-tl-none border border-[#002E47]/20":"bg-[#47A88D] text-white rounded-tr-none"}`,children:[l.jsxs("strong",{className:"font-bold text-sm",children:[n,":"]}),l.jsx("p",{className:"text-sm mt-1",children:e})]})}),s0=({history:n,setView:e})=>{const[t,s]=S.useState(""),[r,i]=S.useState(""),[a,c]=S.useState(!0);return S.useEffect(()=>{(async()=>{var _,v,I,C,N;if(n.length<5){s(`## Insufficient Data

To provide a meaningful score and critique, please complete at least 5 turns (your messages + Alex's responses) in the role-play simulator.`),c(!1);return}if(!ve()){s("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI coaching and critique features."),c(!1);return}const h=n.filter(k=>!k.system).map(k=>`${k.sender}: ${k.text}`).join(`
`),f=`You are a Senior Executive Coaching Auditor. Analyze the following conversation between a Manager ('You') and their report ('Alex'). Provide a clear score (out of 100) and structured feedback in Markdown, focusing on professional leadership skills.
            
            **Critique Structure:**
            1.  **Overall Score (## 95/100):** Provide a score out of 100 based on the manager's performance.
            2.  **SBI Effectiveness (### SBI Audit):** Did the manager effectively stick to objective facts (Situation/Behavior) and articulate the impact (Impact)?
            3.  **Active Listening & Empathy (### Empathy Score):** Did the manager use paraphrasing, open-ended questions, or validate Alex's emotions?
            4.  **Resolution Drive (### Bias for Action):** Did the manager guide the conversation toward a measurable commitment or next step?
            5.  **Key Takeaway (### Next Practice Point):** Provide one specific, actionable habit for the manager to work on.`,m=`Analyze the following role-play dialogue. The manager's goal was to address performance/behavior issues with Alex:

${h}`;try{const D=await Ht({contents:[{role:"user",parts:[{text:m}]}],systemInstruction:{parts:[{text:f}]}}),M=((N=(C=(I=(v=(_=D==null?void 0:D.candidates)==null?void 0:_[0])==null?void 0:v.content)==null?void 0:I.parts)==null?void 0:C[0])==null?void 0:N.text)||"Critique generation failed. Check API connection.";s(M)}catch(k){console.error("Critique API Error:",k),s("An error occurred during AI critique generation.")}finally{c(!1)}})()},[n,e]),S.useEffect(()=>{t&&(async()=>i(await zt(t)))()},[t]),a?l.jsx(G,{title:"Generating Session Critique...",icon:We,className:"mt-8 bg-[#47A88D]/10 border-2 border-[#47A88D]",children:l.jsxs("div",{className:"flex flex-col items-center justify-center h-40",children:[l.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-4 border-[#47A88D] mb-4"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Analyzing dialogue history and scoring performance..."})]})}):l.jsxs(G,{title:"Role-Play Session Audit",icon:Lt,className:"mt-8 bg-[#002E47]/10 border-4 border-[#002E47]/20",children:[l.jsx("div",{className:"prose max-w-none prose-h2:text-4xl prose-h2:text-[#E04E1B] prose-h2:font-extrabold prose-h3:text-[#47A88D] prose-p:text-gray-700 prose-ul:space-y-2",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:r}})}),l.jsx(K,{onClick:()=>e("coaching-lab-home"),className:"mt-8 w-full",children:"Return to Coaching Lab Home"})]})},r0=({scenario:n,setCoachingLabView:e})=>{const{db:t,userId:s}=ce(),[r,i]=S.useState([]),[a,c]=S.useState(""),[h,f]=S.useState(!1),[m,_]=S.useState(!1),[v,I]=S.useState(!1),C=Ad.useRef(null),N="coaching_sessions";S.useEffect(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[r]);const k=n.persona.split(" ")[1],D=async V=>{if(t&&s)try{await Rv(gv(t,`/artifacts/${jn}/users/${s}/${N}`),{userId:s,scenarioTitle:n.title,scenarioPersona:n.persona,date:new Date().toISOString(),history:V,status:"Completed"}),console.log("Coaching session saved successfully.")}catch(B){console.error("Error saving coaching session:",B)}I(!0)},M=async V=>{var w,g,y,b,E;f(!0);const B=`You are a direct report named 'Alex'. You embody the persona: ${n.persona}. Your current situation is: "${n.description}". The user is your manager.


Your task is to respond to the user's input, maintaining your ${k} persona and tone. Be realistic—don't resolve the conflict immediately. After 4-5 turns, you may begin to soften only if the manager demonstrates effective listening and SBI feedback. Keep your responses concise (2-3 sentences max).
Use the history below to guide your response. Do not break character or mention your persona.`,L=V.map(T=>({role:T.isAI?"model":"user",parts:[{text:T.text}]}));if(!ve()){i(T=>[...T,{sender:"System",text:"**ERROR**: The Gemini API Key is missing. AI Role-Play is unavailable. Please set `window.__GEMINI_API_KEY` to enable this feature.",isAI:!0,system:!0}]),f(!1);return}try{const x=await Ht({contents:L,systemInstruction:{parts:[{text:B}]}}),fe=((E=(b=(y=(g=(w=x==null?void 0:x.candidates)==null?void 0:w[0])==null?void 0:g.content)==null?void 0:y.parts)==null?void 0:b[0])==null?void 0:E.text)||"I seem to be having trouble processing that right now. Can you rephrase?";i(me=>[...me,{sender:"Alex",text:fe,isAI:!0}])}catch(T){console.error("AI Role-Play Error:",T),i(x=>[...x,{sender:"Alex",text:"A communication error occurred. Please try again.",isAI:!0}])}finally{f(!1)}},P=async()=>{if(!a.trim()||h)return;const V={sender:"You",text:a.trim(),isAI:!1},B=[...r,V];i(B),c(""),m||_(!0),await M(B)};return S.useEffect(()=>{!m&&!v&&(i([{sender:"System",text:`You are meeting with Alex (The ${k}) in the conference room. Alex looks visibly annoyed/distracted. Start the conversation with your opening statement.`,isAI:!0,system:!0}]),_(!0))},[m,v,k]),v?l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Session Complete: Audit Results"}),l.jsx(s0,{history:r,setView:e})]}):l.jsxs("div",{className:"p-8",children:[l.jsxs("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:["Role-Play Simulator: ",n.title]}),l.jsxs("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:["Practice your conversation with Alex, who is simulating **",n.persona,"** behavior. Focus on using empathy and clear SBI feedback."]}),l.jsxs(K,{onClick:()=>D(r),variant:"secondary",className:"mb-8 bg-[#E04E1B] border-red-500 hover:bg-red-700",children:[l.jsx(Vn,{className:"w-5 h-5 mr-2"})," End Session & Get Critique"]}),l.jsxs("div",{className:"flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6",children:[l.jsxs("div",{className:"flex-1 bg-[#FCFCFA] border border-gray-300 rounded-2xl shadow-lg flex flex-col h-[500px]",children:[l.jsx("div",{ref:C,className:"flex-1 overflow-y-auto p-4",children:r.map((V,B)=>l.jsx(n0,{sender:V.sender,text:V.text,isAI:V.isAI},B))}),l.jsxs("div",{className:"p-4 border-t border-gray-200 flex space-x-3",children:[l.jsx("input",{type:"text",value:a,onChange:V=>c(V.target.value),onKeyDown:V=>V.key==="Enter"&&P(),placeholder:"Type your response to Alex...",className:"flex-1 p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D]",disabled:h||!ve()}),l.jsx(K,{onClick:P,disabled:!a.trim()||h||!ve(),className:"px-4 py-3",children:h?"...":l.jsx(Nd,{className:"w-5 h-5"})})]})]}),l.jsx("div",{className:"lg:w-1/3",children:l.jsxs(G,{title:`Alex: The ${k}`,icon:cn,className:"h-full bg-[#002E47]/10 border-2 border-[#002E47]/20",children:[l.jsx("p",{className:"text-sm text-gray-700 font-semibold mb-2",children:"Scenario:"}),l.jsx("p",{className:"text-sm text-gray-600",children:n.description}),l.jsx("h4",{className:"font-bold text-[#002E47] mt-4 mb-2",children:"Goal Reminder:"}),l.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-1",children:[l.jsx("li",{children:"Establish clear, objective facts (S&B)."}),l.jsx("li",{children:"Lead with empathy, not accusation."}),l.jsx("li",{children:"Steer toward a forward-looking action plan."})]})]})})]})]})},i0=({scenario:n,setCoachingLabView:e})=>n?l.jsxs("div",{className:"p-8",children:[l.jsxs("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:["Prepare for: ",n.title]}),l.jsxs("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:["Scenario: ",n.description]}),l.jsxs(K,{onClick:()=>e("scenario-library"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Scenarios"]}),l.jsxs("div",{className:"space-y-8",children:[l.jsxs(G,{title:"Step 1: Define Your Objective (The Win)",icon:lt,children:[l.jsx("p",{className:"text-gray-700",children:"What is the **one critical outcome** you want from this conversation? What will success look like when you walk away? (Keep it measurable: commitment, change in process, etc.)"}),l.jsx("textarea",{className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-24",placeholder:"e.g., 'Ensure John commits to submitting reports by Thursday COB going forward.'"})]}),l.jsxs(G,{title:"Step 2: Draft Your SBI Feedback (The Facts)",icon:Ze,children:[l.jsx("p",{className:"text-gray-700 mb-4",children:"Draft the specific, objective feedback using the **SBI** (Situation, Behavior, Impact) model. Focus on observable facts, not judgment."}),l.jsxs("div",{className:"bg-[#002E47]/10 p-4 rounded-xl text-sm text-[#002E47] border border-[#002E47]/20",children:[l.jsx("strong",{children:"Tip:"})," Try the ",l.jsx("span",{className:"font-bold text-[#47A88D] cursor-pointer hover:underline",onClick:()=>e("feedback-prep"),children:"Feedback Prep Tool"})," for an AI critique of your draft!"]})]}),l.jsxs(G,{title:"Step 3: Plan Logistics and Mindset (The How)",icon:We,children:[l.jsx("p",{className:"text-gray-700",children:`When and where will you hold this conversation? What's your **"go-first" vulnerability statement** to open the discussion and establish psychological safety?`}),l.jsx("textarea",{className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-24",placeholder:"e.g., 'I plan to meet with her privately in the small conference room at 2 PM. My opening vulnerability will be admitting I should have addressed this sooner.'"})]})]}),l.jsx(K,{onClick:()=>e("role-play"),className:"mt-10 w-full md:w-auto",children:"Start Role-Play Simulation →"})]}):l.jsxs("div",{className:"p-8",children:[l.jsxs(K,{onClick:()=>e("scenario-library"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Scenarios"]}),l.jsx("p",{className:"text-gray-700",children:"No scenario selected."})]}),Rc=({setCoachingLabView:n,setSelectedScenario:e})=>{const t=[{id:1,title:"The Underperformer",description:"A high-potential team member is consistently missing deadlines due to distraction.",persona:"The Deflector"},{id:2,title:"The Boundary Pusher",description:"An employee repeatedly oversteps their authority when dealing with clients, creating tension.",persona:"The Defender"},{id:3,title:"The Silent Withdrawal",description:"A direct report has become quiet and disengaged in meetings following a minor project failure.",persona:"The Silent Stonewall"},{id:4,title:"The Emotional Reaction",description:"You need to deliver corrective feedback, and the employee is highly likely to become defensive or tearful.",persona:"The Emotional Reactor"},{id:5,title:"The Excessive Apologizer",description:"A team member makes a small mistake and immediately apologizes repeatedly, paralyzing forward progress.",persona:"The Over-Apologizer"},{id:6,title:"The Team Blamer",description:'An employee frequently attributes project failures to "someone else on the team" instead of taking personal responsibility.',persona:"The Blame-Shifter"},{id:7,title:"The Silent Observer",description:"A highly capable team member consistently fails to speak up or contribute ideas during brainstorms or strategy discussions.",persona:"The Passive Contributor"}];return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Scenario Library: Practice Conversations"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6",children:"Select a high-stakes scenario to practice your preparation process. Each scenario includes a unique persona for the AI simulator."}),l.jsxs(K,{onClick:()=>n("coaching-lab-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Coaching Lab"]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>l.jsxs(G,{title:s.title,className:"border-l-4 border-[#47A88D] rounded-3xl",onClick:()=>{e(s),n("scenario-prep")},children:[l.jsx("p",{className:"text-sm text-gray-700 mb-3",children:s.description}),l.jsxs("div",{className:"text-xs font-semibold text-[#002E47] bg-[#002E47]/10 px-3 py-1 rounded-full inline-block",children:["Persona: ",s.persona]}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Start Preparation →"})]},s.id))})]})},o0=({setCoachingLabView:n})=>{const{updateCommitmentData:e,navigate:t}=ce(),[s,r]=S.useState("During the Q3 Review meeting with the leadership team last Friday."),[i,a]=S.useState("You interrupted Sarah three times while she was presenting her analysis on customer churn data, dominating the conversation."),[c,h]=S.useState("This caused Sarah to lose her train of thought and weakened the confidence of other team members to contribute to the discussion, hindering a full review of the data."),[f,m]=S.useState(!1),[_,v]=S.useState(""),[I,C]=S.useState(""),[N,k]=S.useState(null);S.useEffect(()=>{if(!_){C("");return}(async()=>C(await zt(_)))();const P=_.match(/\*\*(Refined Feedback|Refined SBI)\*\*:?\s*([^*]+)/i);P&&P[2]?k(P[2].trim().replace(/\.$/,"")):k(null)},[_]);const D=async()=>{var L,w,g,y;if(m(!0),v(""),k(null),!ve()){v("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI coaching and critique features."),m(!1);return}const P=`S: ${s}
B: ${i}
I: ${c}`,V="You are an executive coach specializing in crucial conversations and the SBI (Situation, Behavior, Impact) feedback model. Analyze the user's provided feedback draft. Your critique must be polite, professional, and actionable. First, point out one strength. Second, point out one area for improvement, specifically focusing on ensuring the Behavior is objective and the Impact is linked to business results or team culture, not emotion. Then, provide the final refined version of the feedback, strictly adhering to the S-B-I format, labeling the final version with **Refined Feedback**.",B=`Critique and refine this SBI feedback draft:

${P}`;try{const E=await Ht({contents:[{role:"user",parts:[{text:B}]}],systemInstruction:{parts:[{text:V}]}}),T=(L=E==null?void 0:E.candidates)==null?void 0:L[0];T&&((y=(g=(w=T.content)==null?void 0:w.parts)==null?void 0:g[0])!=null&&y.text)?v(T.content.parts[0].text):v("Could not generate critique. The model may have blocked the request or the response was empty.")}catch(b){console.error("Gemini API Error:",b),v("An error occurred while connecting to the AI coach. Please check your inputs and network connection.")}finally{m(!1)}},M=async()=>{if(!N||!e)return;const P=`Practice delivering the refined SBI feedback: "${N}".`,V={id:Date.now(),text:P,status:"Pending",isCustom:!0,linkedGoal:"Improve Feedback & Coaching Skills",linkedTier:"T2",targetColleague:null};await e(L=>({active_commitments:[...(L==null?void 0:L.active_commitments)||[],V]}))?(alert("Commitment created! Review it in your Daily Practice Scorecard."),t("daily-practice",{initialGoal:V.linkedGoal,initialTier:V.linkedTier})):alert("Failed to save new commitment.")};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Feedback Prep Tool (SBI Critique)"}),l.jsxs("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:["Draft your difficult feedback using the ",l.jsx("strong",{children:"S"}),"ituation, ",l.jsx("strong",{children:"B"}),"ehavior, ",l.jsx("strong",{children:"I"}),"mpact model. Our AI coach will refine your draft for clarity and professionalism."]}),l.jsxs(K,{onClick:()=>n("coaching-lab-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Coaching Lab"]}),l.jsxs("div",{className:"space-y-6 mb-8",children:[l.jsxs(G,{title:"1. Situation (S)",icon:Ze,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2",children:"When and where did the behavior occur? (Be specific and fact-based)"}),l.jsx("textarea",{value:s,onChange:P=>r(P.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-16"})]}),l.jsxs(G,{title:"2. Behavior (B)",icon:Ze,children:[l.jsxs("p",{className:"text-gray-700 text-sm mb-2",children:["What did the person ",l.jsx("em",{children:"do"})," or ",l.jsx("em",{children:"say"}),"? (Must be observable, not a judgment)"]}),l.jsx("textarea",{value:i,onChange:P=>a(P.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-16"})]}),l.jsxs(G,{title:"3. Impact (I)",icon:Ze,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2",children:"What was the consequence of the behavior on the business, the team, or you?"}),l.jsx("textarea",{value:c,onChange:P=>h(P.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-16"})]})]}),l.jsx(an,{content:ve()?"Sends your draft to the AI Coach for deep critique.":"AI Critique is unavailable. Check App Settings for configuration.",children:l.jsx(K,{onClick:D,disabled:f||!s||!i||!c,className:"w-full md:w-auto",children:f?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Refining..."]}):"Refine Feedback"})}),I&&l.jsxs(G,{title:"AI Coach Critique & Refinement",className:"mt-8 bg-[#002E47]/10 border border-[#002E47]/20 rounded-3xl",children:[l.jsx("div",{className:"prose prose-xl max-w-none prose-h1:text-[#002E47] prose-h1:text-4xl prose-h2:text-[#002E47] prose-h3:text-[#47A88D] prose-headings:font-extrabold prose-p:my-6 prose-ul:space-y-3 prose-li:text-base prose-ul:list-disc",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:I}})}),N&&ve()&&l.jsxs(K,{onClick:M,className:"mt-6 w-full bg-[#349881] hover:bg-[#47A88D]",children:[l.jsx(xn,{className:"w-5 h-5 mr-2"})," Turn Refined Feedback into Daily Commitment"]}),!ve()&&l.jsx("p",{className:"text-xs text-[#E04E1B] mt-4 font-semibold",children:"AI Integration is currently disabled. See App Settings to enable AI-powered commitment creation."})]})]})},a0=({setCoachingLabView:n})=>{const{navigate:e}=ce(),[t,s]=S.useState({q1:"",q2:""}),[r,i]=S.useState(null),[a,c]=S.useState(""),[h,f]=S.useState(!1),m=v=>{s({...t,[v.target.name]:v.target.value}),i(null),c("")};S.useEffect(()=>{if(!r){c("");return}(async()=>c(await zt(r)))()},[r]);const _=async()=>{var C,N,k,D,M;if(!t.q1.trim()||!t.q2.trim()){alert("Please provide a response for both prompts before submitting for coach feedback.");return}if(f(!0),i(null),!ve()){i("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI coaching and critique features."),f(!1);return}const v=`Critique the following active listening responses from a manager:

**Prompt 1 (The Paraphrase):** The employee said, "I feel overwhelmed by the deadlines and the number of meetings this week." The manager's draft paraphrase is: "${t.q1.trim()}"

**Prompt 2 (Open-Ended Inquiry):** The situation is a team setback and defeat. The manager's draft open-ended question is: "${t.q2.trim()}"

Critique Guidelines (Use Markdown):
1.  **Paraphrase Critique (## The Paraphrase Audit):** Assess if the manager successfully confirmed understanding without adding judgment or offering a solution. Suggest a better, more concise option if needed.
2.  **Question Critique (## The Inquiry Audit):** Assess if the question is truly open-ended (not answerable with Yes/No) and if it successfully invites vulnerability and insight in a safe way. Provide a refined, more empathetic alternative.
3.  **Overall Takeaway (### Core Skill Focus):** Give one final, actionable coaching point.
`,I="You are an executive coach specializing in developing empathetic and effective active listening skills. Your critique must be objective, use clear Markdown formatting, and provide concrete, actionable alternatives for improvement.";try{const V=await Ht({contents:[{role:"user",parts:[{text:v}]}],systemInstruction:{parts:[{text:I}]}}),B=((M=(D=(k=(N=(C=V==null?void 0:V.candidates)==null?void 0:C[0])==null?void 0:N.content)==null?void 0:k.parts)==null?void 0:D[0])==null?void 0:M.text)||"Could not generate critique. Please try again.";i(B)}catch(P){console.error("Gemini API Error:",P),i("An error occurred while connecting to the AI coach. Please check your network connection.")}finally{f(!1)}};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Active Listening & Reflection Prompts"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Active listening means validating emotion and confirming understanding before attempting to solve the problem. Practice the two pillars below to build empathy and psychological safety in high-stakes conversations."}),l.jsxs(K,{onClick:()=>n("coaching-lab-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Coaching Lab"]}),l.jsxs("div",{className:"space-y-8",children:[l.jsxs(G,{title:"Reflection 1: The Paraphrase (Confirming Understanding)",icon:tn,children:[l.jsxs("p",{className:"text-gray-700 mb-3",children:['**Scenario:** A direct report just told you, "I feel overwhelmed by the deadlines and the number of meetings this week." How would you **paraphrase** their statement back to them? ',l.jsx("span",{className:"font-semibold text-[#47A88D]",children:"(Rule: Must not offer a solution or advice.)"})]}),l.jsx("textarea",{name:"q1",value:t.q1,onChange:m,className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-24",placeholder:"Draft your paraphrased response here..."})]}),l.jsxs(G,{title:"Reflection 2: Open-Ended Inquiry (Inviting Depth)",icon:tn,children:[l.jsx("p",{className:"text-gray-700 mb-3",children:"**Scenario:** Your team has just experienced a major setback on a flagship project. They are visibly defeated. What **open-ended question** would you use to invite them to share their feelings and insights, showing empathy and psychological safety?"}),l.jsx("textarea",{name:"q2",value:t.q2,onChange:m,className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-24",placeholder:"Draft your open-ended question here..."})]})]}),l.jsx(an,{content:ve()?"Submits your responses to the AI Coach for structured critique.":"Requires Gemini API Key to run. Check App Settings.",children:l.jsx(K,{onClick:_,disabled:h||!t.q1.trim()||!t.q2.trim(),className:"mt-10 w-full md:w-auto",children:h?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Auditing Listening Skills..."]}):"Submit for Coach Feedback"})}),a&&l.jsx(G,{title:"Active Listening Auditor Feedback",icon:Lt,className:"mt-8 bg-[#002E47]/10 border border-[#002E47]/20 rounded-3xl",children:l.jsx("div",{className:"prose max-w-none prose-h2:text-[#002E47] prose-h2:border-b prose-h2:pb-2 prose-h3:text-[#47A88D] prose-p:text-gray-700 prose-ul:space-y-2",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:a}})})})]})},l0=()=>{const{navigate:n}=ce(),[e,t]=S.useState("coaching-lab-home"),[s,r]=S.useState(null);return(()=>{const a={setCoachingLabView:t};switch(e){case"scenario-library":return l.jsx(Rc,{setCoachingLabView:t,setSelectedScenario:r});case"scenario-prep":return l.jsx(i0,{scenario:s,setCoachingLabView:t});case"role-play":return s?l.jsx(r0,{scenario:s,setCoachingLabView:t}):l.jsx(Rc,{setCoachingLabView:t,setSelectedScenario:r});case"feedback-prep":return l.jsx(o0,{...a});case"active-listening":return l.jsx(a0,{setCoachingLabView:t});case"coaching-lab-home":default:return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Coaching & Crucial Conversations Lab"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Practice key leadership interactions using guided tools and receive real-time AI critique to sharpen your skills."}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l.jsxs(G,{title:"Scenario Library",icon:cn,onClick:()=>t("scenario-library"),className:"border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Select a scenario to start a fully interactive AI role-play session. Practice maneuvering deflection and emotion."}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Launch Library →"})]}),l.jsxs(G,{title:"Feedback Prep Tool (SBI)",icon:Ze,onClick:()=>t("feedback-prep"),className:"border-l-4 border-[#002E47] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Draft difficult feedback using the SBI model and get instant, professional critique from our AI Coach on objectivity and impact."}),l.jsx("div",{className:"mt-4 text-[#002E47] font-semibold flex items-center",children:"Launch Prep Tool →"})]}),l.jsxs(G,{title:"Active Listening Prompts",icon:tn,onClick:()=>t("active-listening"),className:"border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Exercises to develop empathy, use paraphrasing, and ask powerful, open-ended questions to drive depth in conversations."}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Launch Exercises →"})]})]})]})}})()},c0=({book:n,setReadingView:e})=>{const{navigate:t}=ce(),[s,r]=S.useState({text:"",sources:[]}),[i,a]=S.useState(!1),[c,h]=S.useState(null),[f,m]=S.useState("");S.useEffect(()=>{if(!s.text){m("");return}(async()=>m(await zt(s.text)))()},[s.text]);const _=async()=>{var k,D,M,P;if(!n)return;if(a(!0),h(null),r({text:"",sources:[]}),!ve()){h("AI Generation Unavailable. The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set to enable this feature."),a(!1);return}const I=[{google_search:{}}],C=`You are a professional business copywriter and leadership marketing expert. Your task is to generate compelling, visually parsable flyer content based on the core lessons of the book "${n.title}" by ${n.author}". Structure the output strictly in Markdown with the following sections:


A single H1 tag (#) for the Catchy Headline/Promise (This must be the very first line).

A single bolded paragraph summarizing the PROBLEM the book solves (e.g., PROBLEM SOLVED: [Content]).

A single H3 tag (###) titled "KEY ACTIONS: IMPLEMENT NOW".

Three to four highly actionable takeaways using bolded bullet points.

A final, powerful Call to Action paragraph.
The tone must be energetic, persuasive, and focused purely on immediate leadership application.`,N=`Provide the leadership action flyer content for the book: "${n.title}"`;try{const B=await Ht({contents:[{role:"user",parts:[{text:N}]}],systemInstruction:{parts:[{text:C}]},tools:I}),L=(k=B==null?void 0:B.candidates)==null?void 0:k[0];if(L&&((P=(M=(D=L.content)==null?void 0:D.parts)==null?void 0:M[0])!=null&&P.text)){const w=L.content.parts[0].text;let g=[];const y=L.groundingMetadata;y&&y.groundingAttributions&&(g=y.groundingAttributions.map(b=>{var E,T;return{uri:(E=b.web)==null?void 0:E.uri,title:(T=b.web)==null?void 0:T.title}}).filter(b=>b.uri&&b.title)),r({text:w,sources:g})}else h("Could not generate flyer content. The model may have blocked the request or the response was empty.")}catch(V){console.error("API Fetch Error:",V),h("A network or API error occurred. Please try again.")}finally{a(!1)}};S.useEffect(()=>{n&&_()},[n==null?void 0:n.id]);const v=()=>n?i?l.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Generating **Visual Action Flyer** content..."})]}):c?l.jsxs("div",{className:"bg-[#E04E1B]/10 p-6 rounded-xl border-2 border-[#E04E1B] text-[#002E47]",children:[l.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center",children:[l.jsx(Vn,{className:"w-5 h-5 mr-2 text-[#E04E1B]"})," Generation Error"]}),l.jsx("p",{className:"text-sm",children:c}),c.includes("API Key is missing")&&l.jsx("p",{className:"text-xs mt-2 font-medium",children:"Please set your `window.__GEMINI_API_KEY` to enable summaries. See **App Settings** for details."})]}):f?l.jsxs("div",{className:"bg-gray-100 p-4 md:p-12 rounded-3xl shadow-2xl",children:[l.jsx("div",{className:"bg-[#FCFCFA] p-8 rounded-3xl shadow-2xl border-t-8 border-[#002E47]",children:l.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-10",children:[l.jsxs("div",{className:"lg:col-span-1 border-r border-indigo-100 lg:pr-8 mb-8 lg:mb-0",children:[l.jsx("div",{className:`prose max-w-none \r
              prose-h1:text-4xl prose-h1:text-[#47A88D] prose-h1:font-extrabold prose-h1:mt-0 prose-h1:mb-4\r
              prose-p:text-gray-700 prose-p:font-medium prose-p:text-lg prose-p:mt-6\r
              prose-h3:hidden prose-ul:hidden prose-blockquote:hidden\r
            `,dangerouslySetInnerHTML:{__html:f}}),l.jsx("h4",{className:"text-[#002E47] font-bold mt-8 mb-4 border-t pt-4",children:"Your Next Step:"}),l.jsx(K,{className:"w-full",children:"Integrate This Into Your PDP"}),l.jsx("p",{className:"text-xs text-gray-500 mt-4 italic",children:"Use these Key Actions in your Daily Commitment Scorecard for immediate impact."})]}),l.jsxs("div",{className:"lg:col-span-2",children:[l.jsxs("h2",{className:"text-2xl font-bold text-[#002E47] mb-6 flex items-center",children:[l.jsx(We,{className:"w-6 h-6 mr-3 text-[#47A88D]"}),"High-Impact Leadership Blueprint"]}),l.jsx("div",{className:`prose max-w-none \r
              prose-h1:hidden prose-h2:hidden \r
              prose-h3:text-[#002E47] prose-h3:font-extrabold prose-h3:mt-8 prose-h3:border-b prose-h3:pb-2\r
              prose-ul:list-none prose-ul:pl-0 prose-ul:space-y-4 prose-ul:mt-4\r
              prose-li:text-lg prose-li:text-gray-800\r
              prose-li:before:content-['✓'] prose-li:before:mr-3 prose-li:before:text-[#47A88D] prose-li:before:font-extrabold\r
              prose-p:text-xl prose-p:text-gray-700 prose-p:mt-0 prose-p:mb-6\r
            `,dangerouslySetInnerHTML:{__html:f}})]})]})}),s.sources.length>0&&l.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-300",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Sources:"}),l.jsx("ul",{className:"list-disc pl-5 text-xs text-gray-500 space-y-1",children:s.sources.map((I,C)=>l.jsx("li",{children:l.jsx("a",{href:I.uri,target:"_blank",rel:"noopener noreferrer",className:"hover:text-[#47A88D] transition-colors",children:I.title})},C))})]})]}):l.jsx("p",{className:"p-4 text-gray-600",children:"Preparing content..."}):l.jsx("p",{className:"text-gray-700",children:"No book selected."});return l.jsxs("div",{className:"p-8",children:[l.jsxs("h1",{className:"text-4xl font-extrabold text-[#002E47] mb-3",children:['"',(n==null?void 0:n.title)||"Book Title",'" - Leadership Action Flyer']}),l.jsx("h2",{className:"text-xl font-medium text-[#47A88D] mb-6",children:n?`By ${n.author} (Focus on Immediate Action)`:"Select a book"}),l.jsxs(K,{onClick:()=>e("books-list"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Books"]}),v()]})},u0=({category:n,setReadingView:e,setSelectedBook:t})=>{const s=fo[n]||[];return l.jsxs("div",{className:"p-8",children:[l.jsxs("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:[n," Reading List"]}),l.jsx("p",{className:"text-lg text-gray-600 mb-6",children:"Select a book below to generate a concise, one-page leadership flyer."}),l.jsxs(K,{onClick:()=>e("categories"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Categories"]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(r=>l.jsxs(G,{title:r.title,className:"border-l-4 border-[#47A88D] rounded-3xl",onClick:()=>{t(r),e("summary")},children:[l.jsxs("p",{className:"text-sm text-gray-700",children:["Author: ",r.author]}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Generate Action Flyer →"})]},r.id))})]})},h0=({setReadingView:n,setSelectedCategory:e})=>{const t=[{name:"Strategy",icon:ln,description:"Defining direction, setting priorities, and competitive analysis."},{name:"Culture",icon:cn,description:"Building high-performing teams, psychological safety, and radical candor."},{name:"Productivity",icon:We,description:"Time management, effective habits, and deep work principles."},{name:"Innovation",icon:Ze,description:"Fostering creativity, navigating disruption, and executing new ideas."},{name:"Personal Willpower",icon:lt,description:"Discipline, habit formation, and focused execution on goals."},{name:"Mental Fitness & Resilience",icon:Pc,description:"Emotional regulation, stress management, and growth mindset."}];return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Leadership Business Readings"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Browse curated action flyers of top business books, categorized by core leadership domain."}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>l.jsxs(G,{title:s.name,icon:s.icon,onClick:()=>{e(s.name),n("books-list")},children:[l.jsx("p",{className:"text-sm text-gray-700",children:s.description}),l.jsxs("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:["View Books (",fo[s.name]?fo[s.name].length:0,") →"]})]},s.name))})]})},d0=()=>{const[n,e]=S.useState("categories"),[t,s]=S.useState(null),[r,i]=S.useState(null);return(()=>{switch(n){case"books-list":return l.jsx(u0,{category:t,setReadingView:e,setSelectedBook:i});case"summary":return l.jsx(c0,{book:r,setReadingView:e});case"categories":default:return l.jsx(h0,{setReadingView:e,setSelectedCategory:s})}})()},f0=({setPlanningView:n})=>{const{planningData:e,updatePlanningData:t,updateCommitmentData:s,navigate:r}=ce(),[i,a]=S.useState((e==null?void 0:e.last_premortem_decision)||"Should we restructure the Product and Engineering teams into vertical, feature-specific groups?"),[c,h]=S.useState("Faster time-to-market and clearer ownership for key features."),[f,m]=S.useState(["Loss of technical expertise centralization.","Initial dips in morale due to fear of change."]),[_,v]=S.useState(!1),[I,C]=S.useState(""),[N,k]=S.useState(""),[D,M]=S.useState("");S.useEffect(()=>{e!=null&&e.last_premortem_decision&&a(e.last_premortem_decision)},[e==null?void 0:e.last_premortem_decision]),S.useEffect(()=>{if(!I){k(""),M("");return}(async()=>k(await zt(I)))();const g=I.match(/### Mitigation Strategy\s*([\s\S]*)/i);if(g&&g[1]){const y=g[1].trim().split(`
`).slice(0,3).join(" ").replace(/[\*\-]/g,"").trim();M(y)}},[I]);const P=(g,y)=>{const b=[...f];b[g]=y,m(b),C("")},V=()=>{m([...f,""])},B=g=>{m(f.filter((y,b)=>b!==g))},L=async()=>{var E,T,x,fe,me;const g=f.filter(He=>He.trim()).join("; ");if(!i.trim()||!c.trim()||!g){alert("Please fill in the Decision, Desired Outcome, and at least one Risk before running the audit.");return}if(v(!0),C(""),!ve()){C("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI auditing features."),v(!1);return}const y=`**Decision:** ${i}
**Desired Outcome:** ${c}
**Identified Risks:** ${g}`,b="You are the Decision-Making Auditor, acting as the 'Devil's Advocate' and a strategic planning expert. Your task is to perform a pre-mortem analysis. Critique the user's inputs based on: 1) **Unforeseen Blind Spots (Top 2-3 new risks)**: Identify risks the user is likely missing. 2) **Risk Amplification**: Select the user's biggest risk and explain how it could be worse. 3) **Mitigation Strategy**: Suggest a concrete action plan (1-2 steps) for the highest combined risk (yours or the user's). Use clear Markdown headings and bold key points. Use the following structure: ## Pre-Mortem Audit Results; ### Unforeseen Blind Spots; ### Risk Amplification; ### Mitigation Strategy";try{const qe=await Ht({contents:[{role:"user",parts:[{text:y}]}],systemInstruction:{parts:[{text:b}]}}),Ee=((me=(fe=(x=(T=(E=qe==null?void 0:qe.candidates)==null?void 0:E[0])==null?void 0:T.content)==null?void 0:x.parts)==null?void 0:fe[0])==null?void 0:me.text)||"Audit failed to generate results.";C(Ee),await t({last_premortem_decision:i})}catch(He){console.error("Gemini API Error:",He),C("An error occurred during the Pre-Mortem Audit. Please check your network connection.")}finally{v(!1)}},w=async()=>{if(!D||!s)return;const g=`(Pre-Mortem Mit.) Implement mitigation for decision: "${D}".`,y={id:Date.now(),text:g,status:"Pending",isCustom:!0,linkedGoal:"Risk Mitigation Strategy",linkedTier:"T5",targetColleague:null};await s(E=>({active_commitments:[...(E==null?void 0:E.active_commitments)||[],y]}))?(alert("Mitigation Commitment created! Review it in your Daily Practice Scorecard."),r("daily-practice",{initialGoal:y.linkedGoal,initialTier:y.linkedTier})):alert("Failed to save new commitment.")};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Decision-Making Matrix (Pre-Mortem Audit)"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Analyze high-stakes decisions by actively looking for failure points. The AI acts as your **Devil's Advocate**, identifying risks you missed."}),l.jsxs(K,{onClick:()=>n("planning-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Planning Hub"]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs(G,{title:"1. The Decision & Outcome",icon:ln,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2 font-semibold",children:"What is the critical decision you are facing?"}),l.jsx("textarea",{value:i,onChange:g=>a(g.target.value),className:"w-full p-3 mb-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-20",placeholder:"e.g., Should we expand into the European market next quarter?"}),l.jsx("p",{className:"text-gray-700 text-sm mb-2 font-semibold",children:"What is the specific desired outcome?"}),l.jsx("input",{type:"text",value:c,onChange:g=>h(g.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D]",placeholder:"e.g., Achieve $500k in ARR from the new region in Q4."})]}),l.jsxs(G,{title:"2. Identify Initial Risks",icon:Vn,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-3",children:"List the primary risks and failure modes you have already identified. (Minimum 2)"}),l.jsx("div",{className:"space-y-3",children:f.map((g,y)=>l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("input",{type:"text",value:g,onChange:b=>P(y,b.target.value),className:"flex-1 p-3 border border-gray-200 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] text-sm",placeholder:`Risk ${y+1}`}),l.jsx("button",{onClick:()=>B(y),className:"text-[#E04E1B] hover:text-red-700",children:l.jsx(Or,{className:"w-4 h-4"})})]},y))}),l.jsx(K,{onClick:V,variant:"outline",className:"mt-4 text-xs px-4 py-2 border-dashed text-[#002E47] hover:bg-[#002E47]/10",children:"+ Add Risk"})]})]}),l.jsx(an,{content:ve()?"Submits your decision analysis to the AI Auditor for risk identification.":"Requires Gemini API Key to run. Check App Settings.",children:l.jsx(K,{onClick:L,disabled:_||!i||!c||f.filter(g=>g.trim()).length<2,className:"mt-8 w-full md:w-auto",children:_?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Running Pre-Mortem Audit..."]}):"Run Pre-Mortem Audit"})}),N&&l.jsxs(G,{title:"Decision Audit & Blind Spots",className:"mt-8 bg-[#002E47]/10 border-4 border-[#002E47]/20 rounded-3xl",children:[l.jsx("div",{className:"prose max-w-none prose-h2:text-[#002E47] prose-h2:text-2xl prose-h3:text-[#47A88D] prose-p:text-gray-700 prose-ul:space-y-2",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:N}})}),D&&ve()&&l.jsxs(K,{onClick:w,className:"mt-6 w-full bg-[#349881] hover:bg-[#47A88D]",children:[l.jsx(xn,{className:"w-5 h-5 mr-2"})," Turn Mitigation Strategy into Daily Commitment"]})]})]})},m0=({setPlanningView:n})=>{const{planningData:e,updatePlanningData:t}=ce(),[s,r]=S.useState((e==null?void 0:e.vision)||""),[i,a]=S.useState((e==null?void 0:e.mission)||""),[c,h]=S.useState(!1);S.useEffect(()=>{e&&(r(e.vision),a(e.mission))},[e]);const f=async()=>{!s||!i||(h(!0),await t({vision:s,mission:i}),h(!1))};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Vision Statement Builder"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Define your aspirational 3-5 year leadership and team Vision and Mission, setting your strategic North Star."}),l.jsxs(K,{onClick:()=>n("planning-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Planning Hub"]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs(G,{title:"1. Define Your Vision (The Future State)",icon:ln,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2",children:"What does success look like 3-5 years from now? Keep it inspiring and memorable. **(Data is persistent)**"}),l.jsx("textarea",{value:s,onChange:m=>r(m.target.value),className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-32",placeholder:"e.g., 'To be the most trusted and innovative team in the industry, delivering exceptional value through empowered leadership.'"})]}),l.jsxs(G,{title:"2. Define Your Mission (The Purpose)",icon:lt,children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2",children:"Why does your team exist? What is the core business purpose and the primary value you deliver? **(Data is persistent)**"}),l.jsx("textarea",{value:i,onChange:m=>a(m.target.value),className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-24",placeholder:"e.g., 'To cultivate a culture of psychological safety that drives continuous improvement and world-class product delivery.'"})]}),l.jsx(G,{title:"Vision Checkpoints",icon:Lt,children:l.jsxs("ul",{className:"list-disc pl-5 text-sm text-gray-700 space-y-1",children:[l.jsx("li",{children:"Is your Vision concise (under 20 words)?"}),l.jsx("li",{children:"Is your Mission clear (defines purpose)?"}),l.jsx("li",{children:"Is it emotionally engaging?"})]})})]}),l.jsx(K,{onClick:f,disabled:c||!s||!i,className:"mt-8 w-full md:w-auto",children:c?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"})," Saving..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Lt,{className:"w-5 h-5 mr-2"})," Save Vision & Mission"]})})]})},p0=({setPlanningView:n})=>{const{planningData:e,updatePlanningData:t}=ce(),[s,r]=S.useState((e==null?void 0:e.okrs)||[]),[i,a]=S.useState(!1),[c,h]=S.useState(""),[f,m]=S.useState(""),[_,v]=S.useState(!1);S.useEffect(()=>{e!=null&&e.okrs&&r(e.okrs)},[e==null?void 0:e.okrs]),S.useEffect(()=>{if(!c){m("");return}(async()=>m(await zt(c)))()},[c]);const I=(P,V)=>{r(s.map(B=>B.id===P?{...B,objective:V}:B)),h("")},C=(P,V,B)=>{r(s.map(L=>L.id===P?{...L,keyResults:L.keyResults.map(w=>w.id===V?{...w,kr:B}:w)}:L)),h("")},N=P=>{r(s.map(V=>V.id===P?{...V,keyResults:[...V.keyResults,{id:Date.now(),kr:""}]}:V))},k=()=>{r([...s,{id:Date.now(),objective:"New Ambitious Objective",keyResults:[{id:Date.now()+1,kr:"e.g., Reduce X from Y to Z."}]}])},D=async()=>{a(!0);const P=s.filter(V=>V.objective.trim()&&V.keyResults.some(B=>B.kr.trim()));await t({okrs:P}),a(!1)},M=async()=>{var w,g,y,b;if(!s.every(E=>E.objective.trim()&&E.keyResults.every(T=>T.kr.trim()))){alert("Please fill out all Objective and Key Result fields before requesting a critique.");return}if(v(!0),h(""),!ve()){h("## AI Critique Unavailable\n\n**ERROR**: The Gemini API Key is missing. Please ensure `window.__GEMINI_API_KEY` is set in the environment to enable AI auditing features."),v(!1);return}const V=s.map((E,T)=>`Objective ${T+1}: ${E.objective}
Key Results:
${E.keyResults.map(x=>`- ${x.kr}`).join(`
`)}`).join(`

---

`),B="You are an expert Strategic Planning Coach and OKR Auditor. Your task is to critique the user's drafted Objectives and Key Results (OKRs). Focus your feedback on three points: 1) Is the Objective ambitious and inspiring? 2) Are the Key Results measurable, time-bound, and quantitative (ideally formatted 'from X to Y')? 3) Do the KRs collectively measure the Objective's success? Provide a professional summary critique and then a refined example for the weakest Objective, maintaining the Objective text but fixing the Key Results to be measurable (from X to Y).",L=`Critique this set of Quarterly OKRs:

${V}`;try{const T=await Ht({contents:[{role:"user",parts:[{text:L}]}],systemInstruction:{parts:[{text:B}]}}),x=(w=T==null?void 0:T.candidates)==null?void 0:w[0];x&&((b=(y=(g=x.content)==null?void 0:g.parts)==null?void 0:y[0])!=null&&b.text)?h(x.content.parts[0].text):h("Could not generate critique. The model may have blocked the request or the response was empty.")}catch(E){console.error("Gemini API Error:",E),h("An error occurred while connecting to the AI coach. Please check your inputs and network connection.")}finally{v(!1)}};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Quarterly OKR Drafting Tool"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Set 3-5 ambitious Objectives (What) and 3-4 Key Results (How) for the current quarter, directly tied to your Vision. Use the OKR Auditor below to ensure your KRs are measurable and high-impact. (Data is persistent)"}),l.jsxs(K,{onClick:()=>n("planning-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Planning Hub"]}),l.jsx("div",{className:"space-y-8",children:s.map(P=>l.jsxs(G,{title:`Objective: ${P.objective||"New Objective"}`,icon:lt,className:"border-l-4 border-[#002E47] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-2 font-semibold",children:"Objective (What to achieve? Must be Inspiring)"}),l.jsx("input",{type:"text",value:P.objective,onChange:V=>I(P.id,V.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] mb-6",placeholder:"e.g., Dramatically improve team execution quality and velocity"}),l.jsx("h3",{className:"text-lg font-semibold text-[#47A88D] mb-3",children:"Key Results (How to measure it? Must be 'from X to Y')"}),l.jsx("div",{className:"space-y-3",children:P.keyResults.map((V,B)=>l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsxs("span",{className:"font-mono text-sm text-gray-600",children:[B+1,"."]}),l.jsx("input",{type:"text",value:V.kr,onChange:L=>C(P.id,V.id,L.target.value),className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] text-sm",placeholder:"e.g., Reduce customer reported bugs from 45 to 15 by EOD Q2."})]},V.id))}),l.jsx(K,{onClick:()=>N(P.id),variant:"outline",className:"mt-4 text-xs px-4 py-2 border-dashed border-[#002E47]/30 text-[#002E47] hover:bg-[#002E47]/10",children:"+ Add Key Result"})]},P.id))}),l.jsxs("div",{className:"flex space-x-4 mt-8",children:[l.jsx(K,{onClick:k,variant:"outline",className:"w-full md:w-auto px-6 py-3 border-dashed border-[#47A88D] text-[#47A88D] hover:bg-[#47A88D]/10",children:"+ Add New Objective"}),l.jsx(K,{onClick:D,disabled:i,className:"w-full md:w-auto",children:i?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Saving..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Lt,{className:"w-5 h-5 mr-2"})," Save Quarterly OKRs"]})})]}),l.jsxs(G,{title:"OKR Auditor (AI Critique)",icon:tn,className:"mt-8 bg-[#47A88D]/10 border-2 border-[#47A88D]",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"Use the AI coach to review your drafted OKRs against industry best practices for measurability and ambition."}),l.jsx(an,{content:ve()?"Submits your OKRs to the AI Auditor for measurability and ambition critique.":"Requires Gemini API Key to run. Check App Settings.",children:l.jsx(K,{onClick:M,disabled:_,className:"w-full",children:_?l.jsxs("div",{className:"flex items-center justify-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Auditing Strategy..."]}):"Run OKR Audit"})}),f&&l.jsx("div",{className:"mt-6 pt-4 border-t border-[#47A88D]/30",children:l.jsx("div",{className:"prose max-w-none prose-h3:text-[#002E47] prose-p:text-gray-700 prose-ul:space-y-2",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:f}})})})]})]})},g0=({setPlanningView:n})=>{var s;const{planningData:e}=ce(),t=((s=e==null?void 0:e.okrs)==null?void 0:s.map((r,i)=>({id:r.id,title:r.objective,progress:i===0?.65:i===1?.8:.3,status:i===0?"On Track":i===1?"Ahead of Schedule":"At Risk"})))||[{id:1,title:"Improve Team Execution Quality (Mock)",progress:.65,status:"On Track"},{id:2,title:"Formalize Succession Planning (Mock)",progress:.8,status:"Ahead of Schedule"},{id:3,title:"Develop Cross-Functional Skills (Mock)",progress:.3,status:"At Risk"}];return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-4",children:"Strategic Alignment Tracker"}),l.jsx("p",{className:"text-lg text-gray-600 mb-6 max-w-3xl",children:"Review your current OKR progress and ensure your daily activity is aligned with your long-term Vision. (Goals are loaded from Firestore data)."}),l.jsxs(K,{onClick:()=>n("planning-home"),variant:"outline",className:"mb-8",children:[l.jsx(Ke,{className:"w-5 h-5 mr-2"})," Back to Planning Hub"]}),l.jsxs("div",{className:"space-y-6",children:[t.map(r=>l.jsxs(G,{title:r.title,icon:Lt,className:"border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("p",{className:"text-sm text-gray-700",children:["Progress: ",Math.round(r.progress*100),"%"]}),l.jsx("span",{className:`text-xs font-semibold px-3 py-1 rounded-full ${r.status==="On Track"?"bg-[#47A88D]/20 text-[#002E47]":r.status==="Ahead of Schedule"?"bg-[#002E47]/20 text-[#002E47]":"bg-[#E04E1B]/20 text-[#E04E1B]"}`,children:r.status})]}),l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:l.jsx("div",{className:"bg-[#47A88D] h-2.5 rounded-full transition-all duration-500",style:{width:`${r.progress*100}%`}})}),l.jsx("h3",{className:"text-lg font-semibold text-[#002E47] mt-4 mb-2",children:"Quarterly Reflection"}),l.jsxs("p",{className:"text-sm text-gray-700",children:[l.jsx("strong",{children:"What went well:"})," The team adopted the new execution checklist immediately, leading to better early-stage quality."]}),l.jsxs("p",{className:"text-sm text-gray-700 mt-2",children:[l.jsx("strong",{children:"Next steps:"})," Need to address Objective 3—the key result tracking is too passive. Must switch to a leading indicator."]})]},r.id)),l.jsxs(G,{title:"Vision Alignment Check",icon:jr,className:"bg-[#002E47]/10 border-2 border-[#002E47]/20 rounded-3xl",children:[l.jsxs("p",{className:"text-gray-700 text-sm",children:["Does your current priority list directly contribute to these Objectives? Use this space to log any activities that are draining time but ",l.jsx("strong",{children:"not"})," aligning with your Vision."]}),l.jsx("textarea",{className:"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:focus:border-[#47A88D] h-24",placeholder:"Log strategic misalignment issues here..."}),l.jsx(K,{variant:"secondary",className:"mt-4",children:"Save Reflection"})]})]})]})},y0=()=>{const{isLoading:n,error:e}=ce();if(n)return l.jsx("div",{className:"p-8 min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Loading Strategic Planning Hub..."})]})});if(e)return l.jsx("div",{className:"p-8",children:l.jsxs("p",{className:"text-[#E04E1B] p-4 bg-red-100 rounded-xl",children:["Error loading data: ",e]})});const[t,s]=S.useState("planning-home"),r={setPlanningView:s};return(()=>{switch(t){case"vision-builder":return l.jsx(m0,{...r});case"okr-drafting":return l.jsx(p0,{...r});case"alignment-tracker":return l.jsx(g0,{...r});case"pre-mortem":return l.jsx(f0,{...r});case"planning-home":default:return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Vision & OKR Planning Hub"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Transform abstract ideas into actionable goals. Build a clear Vision, draft measurable OKRs, and ensure strategic alignment. **(All data is persistent)**"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l.jsxs(G,{title:"Vision Builder",icon:ln,onClick:()=>s("vision-builder"),className:"border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Define your 3-5 year Vision and Mission Statement. Get clarity on your strategic North Star."}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Launch Tool →"})]}),l.jsxs(G,{title:"OKR Drafting Tool",icon:lt,onClick:()=>s("okr-drafting"),className:"border-l-4 border-[#002E47] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Structured templates for creating Quarterly Objectives and Key Results (KRs) with **AI Audit**. "}),l.jsx("div",{className:"mt-4 text-[#002E47] font-semibold flex items-center",children:"Launch Tool →"})]}),l.jsxs(G,{title:"Decision-Making Matrix (Pre-Mortem)",icon:Vn,onClick:()=>s("pre-mortem"),className:"border-l-4 border-[#E04E1B] rounded-3xl bg-[#E04E1B]/10",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Use the **Devil's Advocate AI** to identify critical blind spots and failure modes before you commit to a major decision."}),l.jsx("div",{className:"mt-4 text-[#E04E1B] font-semibold flex items-center",children:"Launch Auditor →"})]}),l.jsxs(G,{title:"Strategic Alignment Tracker",icon:We,onClick:()=>s("alignment-tracker"),className:"border-l-4 border-[#47A88D] rounded-3xl",children:[l.jsx("p",{className:"text-gray-700 text-sm",children:"Review your OKR progress, conduct quarterly reflections, and track how daily priorities map to your goals."}),l.jsx("div",{className:"mt-4 text-[#47A88D] font-semibold flex items-center",children:"Launch Tracker →"})]})]})]})}})()},_0=()=>{const{userId:n,auth:e,navigate:t}=ce(),s=async()=>{try{await vp(e)}catch(r){alert("Failed to sign out."),console.error("Sign out error:",r)}};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Application Settings & Configuration"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Manage API keys, user data, and system preferences here."}),l.jsxs(G,{title:"Gemini API Key Configuration",icon:yo,className:"border-l-4 border-[#47A88D]",children:[l.jsxs("p",{className:"text-[#E04E1B] font-semibold mb-3",children:[l.jsx(Vn,{className:"w-5 h-5 inline mr-2"})," Action Required for AI Features:"]}),l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"To unlock AI Coaching (SBI Critique, Role-Play, OKR Audit) and Leadership Book Summaries, you must set your Gemini API Key in the execution environment."}),l.jsxs("div",{className:"bg-gray-100 p-4 rounded-xl font-mono text-sm",children:[l.jsx("p",{className:"text-[#002E47] font-bold",children:"Required Global Variable:"}),l.jsx("code",{className:"text-[#47A88D] break-words",children:"window.__GEMINI_API_KEY"})]}),l.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"*This key is necessary for fetching real-time and generative content. It is securely managed by the environment and is not stored in Firestore."})]}),l.jsxs(G,{title:"Account & Data Maintenance",icon:cn,className:"mt-8 border-l-4 border-[#002E47]",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"Your current User ID (UID) is used to partition your personal data in the database."}),l.jsxs("div",{className:"bg-gray-100 p-4 rounded-xl font-mono text-sm mb-4",children:[l.jsx("p",{className:"text-[#002E47] font-bold",children:"Current User ID (UID):"}),l.jsx("code",{className:"text-[#47A88D] break-words",children:n})]}),l.jsx(K,{onClick:s,className:"w-full bg-[#E04E1B] hover:bg-red-700",children:"Sign Out (Ends Session)"})]})]})},v0=()=>{const{pdpData:n,updatePdpData:e,saveNewPlan:t,isLoading:s,error:r,userId:i,db:a,navigate:c}=ce();if(s||n===void 0)return l.jsx("div",{className:"p-8 min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Loading Personalized Development Plan..."})]})});if(r)return l.jsxs("div",{className:"p-8",children:[l.jsxs("p",{className:"text-[#E04E1B] p-4 bg-red-100 rounded-xl",children:["Application Error: ",r]}),l.jsx("p",{className:"text-gray-600 mt-4",children:"If this error persists, check your browser console for Firebase configuration or security rule errors."})]});if(n===null)return l.jsx(E0,{userId:i,saveNewPlan:t,isLoading:!1,error:null});const h={data:n,updatePdpData:e,saveNewPlan:t,db:a,userId:i,navigate:c};return l.jsx(b0,{...h})},x0=({isVisible:n,onClose:e,content:t})=>{var a;if(!n||!t)return null;const[s,r]=S.useState(""),i=Ic[t.type]?Ic[t.type](t.title,t.skill):`### Content Unavailable

No detailed mock content available for type: **${t.type}**`;return S.useEffect(()=>{(async()=>r(await zt(i)))()},[t.id,i]),l.jsx("div",{className:"fixed inset-0 bg-[#002E47]/80 z-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto p-8",children:[l.jsxs("div",{className:"flex justify-between items-start border-b pb-4 mb-6",children:[l.jsxs("h2",{className:"text-3xl font-extrabold text-[#002E47] flex items-center",children:[l.jsx(Dr,{className:"w-8 h-8 mr-3 text-[#47A88D]"}),t.title," (",t.type,")"]}),l.jsx("button",{onClick:e,className:"p-2 text-gray-500 hover:text-[#E04E1B] transition-colors",children:l.jsx(Or,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"mb-6 text-sm flex space-x-4 border-b pb-4",children:[l.jsxs("p",{className:"text-gray-700",children:["**Tier:** ",(a=je[t.tier])==null?void 0:a.name]}),l.jsxs("p",{className:"text-gray-700",children:["**Skill Focus:** ",t.skill]}),l.jsxs("p",{className:"text-gray-700",children:["**Est. Duration:** ",t.duration," min"]})]}),l.jsx("div",{className:"prose max-w-none text-gray-700",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:s}})}),l.jsx(K,{onClick:e,className:"mt-8 w-full",children:"Close & Return to Plan"})]})})},w0=({isVisible:n,onClose:e,tierId:t,planData:s})=>{if(!n||!t)return null;const r=je[t];if(!r)return null;const i=s.plan.filter(h=>h.tier===t&&h.month<s.currentMonth).sort((h,f)=>h.month-f.month),a=s.assessment.selfRatings[t],c=a>=8?"Mastery":a>=5?"Core":"Intro";return l.jsx("div",{className:"fixed inset-0 bg-[#002E47]/80 z-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto p-8",children:[l.jsxs("div",{className:"flex justify-between items-start border-b pb-4 mb-6",children:[l.jsxs("h2",{className:"text-3xl font-extrabold text-[#002E47] flex items-center",children:[l.jsx(mr,{className:"w-8 h-8 mr-3 text-[#47A88D]"}),"Completed Tier Review: ",r.name]}),l.jsx("button",{onClick:e,className:"p-2 text-gray-500 hover:text-[#E04E1B] transition-colors",children:l.jsx(Or,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"mb-6 space-y-2",children:[l.jsxs("p",{className:"text-md text-gray-700",children:["**Initial Self-Rating:** ",l.jsxs("span",{className:"font-bold text-[#47A88D]",children:[a,"/10"]}),"(Content difficulty generated at the **",c,"** level)"]}),l.jsxs("p",{className:"text-md text-gray-700",children:["**Duration:** ",i.length," Months (Completed **",i.filter(h=>h.status==="Completed").length,"** / ",i.length," Months)"]})]}),l.jsx("h3",{className:"text-xl font-bold text-[#002E47] mb-4 border-b pb-2",children:"Monthly Breakdown & Reflections"}),l.jsx("div",{className:"space-y-6",children:i.map(h=>l.jsxs("div",{className:"p-5 bg-gray-50 rounded-xl border-l-4 border-[#002E47]/50 shadow-sm",children:[l.jsxs("p",{className:"text-lg font-extrabold text-[#002E47] mb-2",children:["Month ",h.month," Focus: ",h.theme]}),l.jsxs("div",{className:"text-sm mb-3",children:[l.jsx("p",{className:"font-semibold text-[#47A88D]",children:"Completed Content:"}),l.jsx("ul",{className:"list-disc pl-5 text-gray-700",children:h.requiredContent.map(f=>l.jsxs("li",{className:`${f.status==="Completed"?"text-gray-600":"text-gray-400 italic"}`,children:[f.title," (",f.type,")"]},f.id))})]}),l.jsxs("p",{className:"text-sm text-gray-700",children:[l.jsx("span",{className:"font-semibold",children:"Reflection:"})," ",h.reflectionText||"No reflection logged."]})]},h.month))}),l.jsx(K,{onClick:e,className:"mt-8 w-full",children:"Close Review"})]})})},b0=({data:n,updatePdpData:e,saveNewPlan:t,db:s,userId:r,navigate:i})=>{var Ee,Xe,bt;const a=n.currentMonth,c=n.plan.find(J=>J.month===a),h=n.plan.find(J=>J.month===a+1),f=h?je[h.tier].name:null,m=h?h.tier:null,[_,v]=S.useState(!1),[I,C]=S.useState(null),[N,k]=S.useState(!1),[D,M]=S.useState(null),P=n.assessment,[V,B]=S.useState((c==null?void 0:c.reflectionText)||""),[L,w]=S.useState(!1),g=S.useMemo(()=>{const J=n.plan.filter(we=>we.month<a),U=new Set;return J.forEach(we=>U.add(we.tier)),Object.keys(je).filter(we=>{const oe=n.plan.filter(Et=>Et.tier===we);if(oe.length<4)return!1;const js=oe.find(Et=>Et.month<a);return js&&js.status==="Completed"})},[n.plan,a]);S.useEffect(()=>{c&&B(c.reflectionText||"")},[c]);const y=async()=>{const J=V;if(J.length<50){alert("Reflection required! Please write at least 50 characters to mark this month complete.");return}w(!0);try{const U=zh(s),se=it(s,`/artifacts/${jn}/users/${r}/${mo}/${po}`),we=n.plan.map(oe=>oe.month===a?{...oe,status:"Completed",reflectionText:J,monthCompletedDate:new Date().toISOString()}:oe);U.update(se,{plan:we,currentMonth:a+1,lastUpdate:new Date().toISOString()}),await U.commit(),B(""),alert("Month successfully completed! Advancing to the next phase."),f&&i("daily-practice",{initialGoal:f,initialTier:m})}catch(U){console.error("Error advancing month via batch:",U),alert(`Failed to complete month. Error: ${U.message}`)}finally{w(!1)}},b=async()=>{if(window.confirm("WARNING: Are you sure you want to discard this plan and regenerate? All plan history will be lost.")){w(!0);try{const U=it(s,`/artifacts/${jn}/users/${r}/${mo}/${po}`);await ii(U,{},{merge:!1}),alert("Plan successfully reset! Loading generator...")}catch(U){alert(`Failed to reset plan. Error: ${U.message}`)}finally{w(!1)}}},E=J=>{const U=n.plan.map(se=>{if(se.month===a){const we=se.requiredContent.map(oe=>oe.id===J?{...oe,status:oe.status==="Completed"?"Pending":"Completed"}:oe);return{...se,requiredContent:we}}return se});e({plan:U})},T=J=>{C(J),v(!0)},x=J=>{M(J),k(!0)};if(!c)return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Roadmap Complete!"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"Congratulations on completing your 24-month roadmap. You are now a **Seasoned Leader**!"}),l.jsx(K,{onClick:b,children:"Generate New Roadmap"})]});const fe=(Ee=c==null?void 0:c.requiredContent)==null?void 0:Ee.every(J=>J.status==="Completed"),me=fe&&V.length>=50,He=Math.min(100,a/24*100),qe=(Xe=je[c==null?void 0:c.tier])!=null&&Xe.icon?jv[je[c.tier].icon]:lt;return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Tracker Dashboard: Your 24-Month Roadmap"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"This plan is tailored to your **Manager Status, Self-Ratings, and Goal Priorities**. Focus on completing your monthly content and reflecting on your growth."}),l.jsxs(G,{title:`Roadmap Progress: Month ${a} of 24`,icon:Tn,className:"bg-[#002E47]/10 border-4 border-[#002E47]/20 mb-8",children:[l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:l.jsx("div",{className:"bg-[#47A88D] h-4 rounded-full transition-all duration-700",style:{width:`${He}%`}})}),l.jsxs("p",{className:"text-sm font-medium text-[#002E47]",children:[Math.round(He),"% Complete. Next Tier Focus in ",4-(a-1)%4," months."]}),l.jsx(K,{onClick:b,variant:"outline",className:"mt-4 text-xs px-4 py-2 text-[#E04E1B] border-[#E04E1B]/50 hover:bg-[#E04E1B]/10",children:"Start Over / Re-Generate Plan"})]}),g.length>0&&l.jsxs(G,{title:"Tier Review Center",icon:mr,className:"mb-8 border-l-4 border-[#002E47]",children:[l.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Review your progress and reflections for past, completed leadership tiers."}),l.jsx("div",{className:"flex flex-wrap gap-3",children:g.map(J=>{const U=je[J];return l.jsxs(K,{onClick:()=>T(J),variant:"outline",className:"text-xs px-4 py-2 border-[#002E47] text-[#002E47] hover:bg-[#002E47]/10",children:["Review ",U.id,": ",U.name]},J)})})]}),l.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-8",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[l.jsxs(G,{title:`Current Focus: ${c==null?void 0:c.theme}`,icon:qe,className:"border-l-8 border-[#47A88D]",children:[l.jsxs("div",{className:"mb-4 text-sm",children:[l.jsxs("p",{className:"font-bold text-[#002E47]",children:["Tier: ",(bt=je[c==null?void 0:c.tier])==null?void 0:bt.name]}),l.jsxs("p",{className:"text-gray-600",children:["Target Difficulty: **",(P==null?void 0:P.selfRatings[c==null?void 0:c.tier])>=8?"Mastery":(P==null?void 0:P.selfRatings[c==null?void 0:c.tier])>=5?"Core":"Intro","** (based on your self-rating of ",P==null?void 0:P.selfRatings[c==null?void 0:c.tier],"/10)"]})]}),l.jsx("h3",{className:"text-xl font-bold text-[#002E47] border-t pt-4 mt-4",children:"Required Content Items"}),l.jsx("div",{className:"space-y-3 mt-4",children:c==null?void 0:c.requiredContent.map(J=>l.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl shadow-sm",children:[l.jsxs("div",{className:"flex flex-col",children:[l.jsxs("p",{className:`font-semibold text-sm ${J.status==="Completed"?"line-through text-gray-500":"text-[#002E47]"}`,children:[J.title," (",J.type,")"]}),l.jsxs("p",{className:"text-xs text-gray-600",children:["~",J.duration," min | Difficulty: ",J.difficulty]})]}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx(K,{onClick:()=>x(J),className:"px-3 py-1 text-xs",variant:"outline",children:l.jsx(mr,{className:"w-4 h-4"})}),l.jsx(K,{onClick:()=>E(J.id),className:"px-3 py-1 text-xs",variant:J.status==="Completed"?"secondary":"primary",disabled:L,children:J.status==="Completed"?"Done ✓":"Mark Complete"})]})]},J.id))})]}),l.jsxs(G,{title:"Monthly Reflection",icon:jr,className:"bg-[#002E47]/10 border-2 border-[#002E47]/20",children:[l.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"Reflect on the growth you achieved this month. How did the content impact your daily leadership behavior? (**Minimum 50 characters required**)"}),l.jsx("textarea",{value:V,onChange:J=>B(J.target.value),className:"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-40",placeholder:"My reflection (required)..."}),l.jsxs("p",{className:`text-xs mt-1 ${V.length<50?"text-[#E04E1B]":"text-[#47A88D]"}`,children:[V.length," / 50 characters written."]})]})]}),l.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[l.jsxs(G,{title:"Advance Roadmap",icon:Nc,className:"bg-[#47A88D]/10 border-4 border-[#47A88D]",children:[l.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Once all content items are marked complete and you have written your reflection, click below to lock this month's progress and move to **Month ",a+1,"** of your plan."]}),l.jsx(K,{onClick:y,disabled:L||!me,className:"w-full bg-[#47A88D] hover:bg-[#349881]",children:L?"Processing...":`Complete Month ${a}`}),!fe&&l.jsx("p",{className:"text-[#E04E1B] text-xs mt-2",children:"* Finish all content items first."}),fe&&V.length<50&&l.jsx("p",{className:"text-[#E04E1B] text-xs mt-2",children:"* Reflection required (50 chars min)."})]}),h&&l.jsxs(G,{title:`Next Month: Month ${a+1}`,icon:Tn,className:"bg-[#FCFCFA]",children:[l.jsxs("p",{className:"text-sm font-semibold text-[#002E47] mb-2",children:["Tier: ",je[h.tier].name]}),l.jsx("p",{className:"text-md text-gray-700 mb-3",children:h.theme}),l.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-600 space-y-1",children:h.requiredContent.slice(0,3).map((J,U)=>l.jsxs("li",{children:[J.title," (~",J.duration," min)"]},U))}),l.jsxs("p",{className:"text-xs text-[#47A88D] mt-3",children:["Total est. time: ",h.totalDuration," min."]})]})]})]}),l.jsx(w0,{isVisible:_,onClose:()=>v(!1),tierId:I,planData:n}),l.jsx(x0,{isVisible:N,onClose:()=>k(!1),content:D})]})},E0=({userId:n,saveNewPlan:e,isLoading:t,error:s})=>{const[r,i]=S.useState("New"),[a,c]=S.useState([]),[h,f]=S.useState({T1:5,T2:5,T3:5,T4:5,T5:5}),[m,_]=S.useState(!1),v=a.length>=3,I=r&&a.length>0&&!m,C=D=>{c(M=>M.includes(D)?M.filter(P=>P!==D):v?(alert("You can select a maximum of 3 goal priorities."),M):[...M,D])},N=(D,M)=>{f(P=>({...P,[D]:parseInt(M)}))},k=async()=>{if(!I)return;_(!0);const D={managerStatus:r,goalPriorities:a,selfRatings:h,dateGenerated:new Date().toISOString()},M=Ov(D,n);await e(M)||alert("Failed to save the plan. Check the console for database errors."),_(!1)};return l.jsxs("div",{className:"p-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-[#002E47] mb-6",children:"Personalized 24-Month Plan Generator"}),l.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-3xl",children:"Answer a few questions about your current role and goals to instantly generate a hyper-personalized leadership roadmap designed to close your skill gaps over the next two years."}),s&&l.jsxs("p",{className:"text-[#E04E1B] p-4 bg-red-100 rounded-xl mb-6",children:["Application Error: ",s]}),l.jsxs("div",{className:"space-y-10",children:[l.jsxs(G,{title:"1. Your Management Experience",icon:cn,className:"border-l-4 border-[#47A88D]",children:[l.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-3",children:"Select your current status:"}),l.jsx("div",{className:"flex space-x-4",children:["New","Mid-Level","Seasoned"].map(D=>l.jsx("button",{onClick:()=>i(D),className:`px-4 py-2 rounded-xl font-semibold transition-all shadow-md ${r===D?"bg-[#47A88D] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:D},D))}),l.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"This sets your starting tier (e.g., New starts at T1: Self-Awareness)."})]}),l.jsxs(G,{title:"2. Goal Priorities (Max 3)",icon:lt,className:"border-l-4 border-[#002E47]",children:[l.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-3",children:"Which tiers are most important to you right now?"}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.values(je).map(D=>l.jsxs("label",{className:`flex items-center p-3 rounded-xl border-2 transition-all cursor-pointer ${a.includes(D.id)?"bg-[#002E47]/10 border-[#002E47]":"bg-[#FCFCFA] border-gray-200 hover:border-[#47A88D]"}`,children:[l.jsx("input",{type:"checkbox",checked:a.includes(D.id),onChange:()=>C(D.id),className:"h-5 w-5 text-[#47A88D] rounded mr-3",disabled:v&&!a.includes(D.id)}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-[#002E47]",children:D.name}),l.jsxs("p",{className:"text-xs text-gray-600",children:["(",D.id,")"]})]})]},D.id))})]}),l.jsxs(G,{title:"3. Self-Ratings (Skill Gap Assessment)",icon:go,className:"border-l-4 border-[#47A88D]",children:[l.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-6",children:"Rate your current effectiveness (1 = Low Skill/Confidence, 10 = Mastery):"}),Object.values(je).map(D=>l.jsxs("div",{className:"mb-6",children:[l.jsxs("p",{className:"font-semibold text-[#002E47] flex justify-between",children:[l.jsxs("span",{children:[D.name,":"]}),l.jsxs("span",{className:"text-xl font-extrabold text-[#47A88D]",children:[h[D.id],"/10"]})]}),l.jsx("input",{type:"range",min:"1",max:"10",value:h[D.id],onChange:M=>N(D.id,M.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-[#47A88D]"}),l.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Rating influences target **content difficulty** (Low rating = Intro/Core content; High rating = Mastery)."})]},D.id))]})]}),l.jsx(K,{onClick:k,disabled:!I||m,className:"mt-10 w-full md:w-auto",children:m?l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Generating 24-Month Plan..."]}):"Generate Personalized 24-Month Plan"}),l.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"*Your data will be securely saved to your private roadmap in Firestore."})]})},I0=({currentScreen:n,setCurrentScreen:e,user:t})=>{const s=[{name:"dashboard",icon:kd,label:"Dashboard"}],r=[{name:"quick-start-accelerator",icon:We,label:"QuickStart Accelerator"}],i=[{name:"prof-dev-plan",icon:Ze,label:"Prof Dev Plan"},{name:"daily-practice",icon:Tn,label:"Daily Practice & Scorecard"},{name:"business-readings",icon:Dr,label:"Leadership Readings"},{name:"coaching-lab",icon:tn,label:"Coaching & Crucial Labs"},{name:"planning-hub",icon:ln,label:"Strategic Planning Hub"}],a=[{name:"app-settings",icon:yo,label:"App Settings"}];return l.jsxs("div",{className:"w-64 bg-[#002E47] text-white flex-shrink-0 p-6 flex flex-col h-full rounded-tr-3xl rounded-br-3xl shadow-2xl",children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-10",children:[l.jsx(We,{className:"w-7 h-7 text-[#47A88D]"}),l.jsx("h1",{className:"text-xl font-bold",children:"LeaderReps"})]}),l.jsxs("nav",{className:"flex-1 space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs font-semibold uppercase text-indigo-300 mb-2",children:"Core Navigation"}),s.map(c=>l.jsx(rr,{name:c.name,icon:c.icon,currentScreen:n,onClick:e},c.name))]}),l.jsxs("div",{className:"pt-4 border-t border-indigo-700 space-y-2",children:[l.jsx("p",{className:"text-xs font-semibold uppercase text-indigo-300 mb-2",children:"QuickStart"}),r.map(c=>l.jsx(rr,{name:c.name,icon:c.icon,currentScreen:n,onClick:e},c.name))]}),l.jsxs("div",{className:"pt-4 border-t border-indigo-700 space-y-2",children:[l.jsx("p",{className:"text-xs font-semibold uppercase text-indigo-300 mb-2",children:"Tools & Labs"}),i.map(c=>l.jsx(rr,{name:c.name,icon:c.icon,currentScreen:n,onClick:e},c.name))]}),l.jsxs("div",{className:"pt-4 border-t border-indigo-700 space-y-2",children:[l.jsx("p",{className:"text-xs font-semibold uppercase text-indigo-300 mb-2",children:"User/App"}),a.map(c=>l.jsx(rr,{name:c.name,icon:c.icon,currentScreen:n,onClick:e},c.name))]})]}),l.jsxs("div",{className:"mt-8 pt-4 border-t border-indigo-700",children:[l.jsx("p",{className:"text-sm font-semibold text-indigo-300",children:"Logged in as:"}),l.jsx("p",{className:"text-sm text-white font-medium",children:(t==null?void 0:t.name)||"Guest"}),l.jsxs("p",{className:"text-xs text-indigo-400 mt-1 break-words",children:["UID: ",(t==null?void 0:t.userId)||"N/A"]})]})]})},N0=({initialState:n})=>{const[e,t]=S.useState(null),[s,r]=S.useState((n==null?void 0:n.screen)||"dashboard"),[i,a]=S.useState({db:null,auth:null}),[c,h]=S.useState(null),[f,m]=S.useState(!1),[_,v]=S.useState((n==null?void 0:n.params)||{}),[I,C]=S.useState(!0),N=S.useCallback((D,M={})=>{v(M),r(D)},[]);S.useEffect(()=>{let D,M,P;try{const V=typeof __firebase_config<"u"?JSON.parse(__firebase_config):{};D=Bc(V),M=yv(D),P=Br(D),Ng("debug"),a({db:M,auth:P});const B=_p(P,L=>{if(L){const w=L.uid;h(w),t({name:L.email||"Canvas User",userId:w}),C(!1)}else t(null),h(null),C(!0);m(!0)});return typeof __initial_auth_token<"u"&&__initial_auth_token&&dp(P,__initial_auth_token).catch(L=>console.error("Canvas Token Auth failed, waiting for user login:",L)),()=>B()}catch(V){console.error("Firebase setup failed:",V),m(!0)}},[]);const k=D=>{t(D),C(!1),c||h(D.userId||"mock-user-id")};return f?I||!e?l.jsx(Bv,{onLogin:k}):l.jsx(Qv,{firebaseServices:i,userId:c,isAuthReady:f,navigate:N,user:e,children:l.jsx(T0,{currentScreen:s,setCurrentScreen:N,user:e,navParams:_})}):l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3"}),l.jsx("p",{className:"text-[#47A88D] font-medium",children:"Initializing Authentication..."})]})})},T0=({currentScreen:n,setCurrentScreen:e,user:t,navParams:s})=>l.jsxs("div",{className:"min-h-screen flex bg-gray-100 font-sans antialiased",children:[l.jsx(I0,{currentScreen:n,setCurrentScreen:e,user:t}),l.jsx("main",{className:"flex-1 overflow-y-auto p-0",children:l.jsx(A0,{currentScreen:n,navParams:s})})]}),A0=({currentScreen:n,navParams:e})=>{switch(n){case"prof-dev-plan":return l.jsx(v0,{});case"daily-practice":return l.jsx(t0,{initialGoal:e.initialGoal,initialTier:e.initialTier});case"coaching-lab":return l.jsx(l0,{});case"planning-hub":return l.jsx(y0,{});case"business-readings":return l.jsx(d0,{});case"quick-start-accelerator":return l.jsx(Xv,{});case"app-settings":return l.jsx(_0,{});case"dashboard":default:return l.jsx(Yv,{})}};export{N0 as default};
