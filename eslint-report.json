[{"filePath":"/workspaces/leaderreps-PDPlatformDev/DailyPractice.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'setLinkedGoal' is defined but never used.","line":399,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":399,"endColumn":53},{"ruleId":"no-unused-vars","severity":1,"message":"'setLinkedTier' is defined but never used.","line":399,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":399,"endColumn":68},{"ruleId":"no-unused-vars","severity":1,"message":"'isSaving' is defined but never used.","line":399,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":399,"endColumn":78},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'userCommitments' logical expression could make the dependencies of useMemo Hook (at line 462) change on every render. To fix this, wrap the initialization of 'userCommitments' in its own useMemo() Hook.","line":435,"column":9,"nodeType":"VariableDeclarator","endLine":435,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'okrGoals' logical expression could make the dependencies of useMemo Hook (at line 474) change on every render. To fix this, wrap the initialization of 'okrGoals' in its own useMemo() Hook.","line":436,"column":9,"nodeType":"VariableDeclarator","endLine":436,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'okrGoals' logical expression could make the dependencies of useEffect Hook (at line 497) change on every render. To fix this, wrap the initialization of 'okrGoals' in its own useMemo() Hook.","line":436,"column":9,"nodeType":"VariableDeclarator","endLine":436,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'EXPANDED_COMMITMENT_BANK' logical expression could make the dependencies of useMemo Hook (at line 446) change on every render. To fix this, wrap the initialization of 'EXPANDED_COMMITMENT_BANK' in its own useMemo() Hook.","line":445,"column":9,"nodeType":"VariableDeclarator","endLine":445,"endColumn":56},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'EXPANDED_COMMITMENT_BANK' logical expression could make the dependencies of useMemo Hook (at line 462) change on every render. To fix this, wrap the initialization of 'EXPANDED_COMMITMENT_BANK' in its own useMemo() Hook.","line":445,"column":9,"nodeType":"VariableDeclarator","endLine":445,"endColumn":56},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\{.","line":573,"column":63,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":573,"endColumn":64,"suggestions":[{"messageId":"removeEscape","fix":{"range":[25363,25364],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[25363,25363],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'source' is defined but never used.","line":1191,"column":83,"nodeType":"Identifier","messageId":"unusedVar","endLine":1191,"endColumn":89},{"ruleId":"no-unused-vars","severity":1,"message":"'pdpData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1193,"column":84,"nodeType":"Identifier","messageId":"unusedVar","endLine":1193,"endColumn":91},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'commitmentData'. Either include it or remove the dependency array.","line":1207,"column":4,"nodeType":"ArrayExpression","endLine":1207,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [commitmentData, commitmentData.last_reset_date, updateCommitmentData]","fix":{"range":[57230,57285],"text":"[commitmentData, commitmentData.last_reset_date, updateCommitmentData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'userCommitments' logical expression could make the dependencies of useMemo Hook (at line 1312) change on every render. To fix this, wrap the initialization of 'userCommitments' in its own useMemo() Hook.","line":1275,"column":9,"nodeType":"VariableDeclarator","endLine":1275,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'userCommitments' logical expression could make the dependencies of useMemo Hook (at line 1486) change on every render. To fix this, wrap the initialization of 'userCommitments' in its own useMemo() Hook.","line":1275,"column":9,"nodeType":"VariableDeclarator","endLine":1275,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'userCommitments' logical expression could make the dependencies of useMemo Hook (at line 1505) change on every render. To fix this, wrap the initialization of 'userCommitments' in its own useMemo() Hook.","line":1275,"column":9,"nodeType":"VariableDeclarator","endLine":1275,"endColumn":67},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'commitmentHistory' logical expression could make the dependencies of useMemo Hook (at line 1312) change on every render. To fix this, wrap the initialization of 'commitmentHistory' in its own useMemo() Hook.","line":1276,"column":9,"nodeType":"VariableDeclarator","endLine":1276,"endColumn":58},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'commitmentHistory' logical expression could make the dependencies of useMemo Hook (at line 1313) change on every render. To fix this, wrap the initialization of 'commitmentHistory' in its own useMemo() Hook.","line":1276,"column":9,"nodeType":"VariableDeclarator","endLine":1276,"endColumn":58},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleClosePerfectModal'. Either include it or remove the dependency array.","line":1309,"column":4,"nodeType":"ArrayExpression","endLine":1309,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [handleClosePerfectModal, isPerfectScoreModalVisible]","fix":{"range":[61611,61639],"text":"[handleClosePerfectModal, isPerfectScoreModalVisible]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fetchReflectionPrompt' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1319,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1319,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/DailyPractice.jsx - Commitment Fixes\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  PlusCircle, ArrowLeft, X, Target, Clock, CheckCircle, BarChart3, CornerRightUp, AlertTriangle, Users, Lightbulb, Zap, Archive, MessageSquare, List, TrendingDown, TrendingUp, BookOpen, Crown, Cpu, Star, Trash2, HeartPulse, Trello, Activity, Dumbbell, Flag, User, Send\n} from 'lucide-react';\n\n/* =========================================================\n   MOCK/UI UTILITIES (Fully Self-Contained)\n========================================================= */\n\n// CRITICAL FIX: Use the canonical hook path so all views share the same store.\nimport { useAppServices } from '../../services/useAppServices.jsx';\n\n// --- NEW COMPONENT IMPORT ---\nimport TwoMinuteChallengeModal from '../modals/TwoMinuteChallengeModal.jsx';\n\n\n// Placeholder to be replaced by service data\nconst LEADERSHIP_TIERS_META_FALLBACK = { \n    'T1': { id: 'T1', name: 'Personal Foundation', hex: '#10B981' }, \n    'T5': { id: 'T5', name: 'Visionary Leadership', hex: '#002E47' }, \n};\n\n// FIX 1: Resolves \"ReferenceError: groupCommitmentsByTier is not defined\"\nfunction groupCommitmentsByTier(commitments) {\n    const tiers = { T1: [], T2: [], T3: [], T4: [], T5: [] };\n    (commitments || []).forEach(c => {\n        if (c.linkedTier && tiers[c.linkedTier]) {\n            tiers[c.linkedTier].push(c);\n        }\n    });\n    return tiers;\n}\n\n// FIX 2: Resolves \"ReferenceError: calculateTierSuccessRates is not defined\"\nfunction calculateTierSuccessRates(commitments, history, tierMeta) {\n    const rates = {};\n    const tierMap = groupCommitmentsByTier(commitments);\n    const tierIds = Object.keys(tierMeta || LEADERSHIP_TIERS_META_FALLBACK); // Use passed tiers or safe fallback\n    \n    tierIds.forEach(tierId => { \n        const tierCommitments = tierMap[tierId] || [];\n        const total = tierCommitments.length;\n        if (total > 0) {\n            const committedCount = tierCommitments.filter(c => c.status === 'Committed').length;\n            const mockedOverallRate = 78; \n            rates[tierId] = { \n                rate: Math.round((committedCount / total) * 100) || mockedOverallRate, \n                total: total \n            };\n        } else {\n             rates[tierId] = { rate: 0, total: 0 };\n        }\n    });\n    return rates;\n}\n\n// FIX 3: Resolves \"ReferenceError: getLastSevenDays is not defined\"\nfunction getLastSevenDays(history) {\n    const today = new Date();\n    const result = [];\n    \n    for (let i = 0; i < 7; i++) {\n        const date = new Date(today);\n        date.setDate(today.getDate() - i);\n        const dateString = date.toISOString().split('T')[0];\n        \n        const entry = (history || []).find(h => h.date === dateString);\n        const score = entry ? entry.score : '0/0'; \n        const reflection = entry ? entry.reflection : 'N/A';\n        result.push({ date: dateString, score, reflection });\n    }\n    // Return them in chronological order (oldest to newest)\n    return result.reverse();\n}\n\nfunction calculateTotalScore(commitments) {\n    const total = commitments.length;\n    const committedCount = commitments.filter(c => c.status === 'Committed').length;\n    return { committed: committedCount, total };\n}\n\nfunction calculateStreak(history) {\n    let streak = 0;\n    const validHistory = Array.isArray(history) ? history : [];\n    \n    // Sort history by date descending\n    const sortedHistory = [...validHistory].sort((a, b) => new Date(b.date) - new Date(a.date));\n\n    let yesterday = new Date();\n    yesterday.setDate(yesterday.getDate()); // Start check from today (last entry)\n    \n    for (let i = 0; i < 7; i++) { // Check up to the last 7 days\n      const checkDate = new Date(yesterday);\n      checkDate.setDate(yesterday.getDate() - i);\n      const dateString = checkDate.toISOString().split('T')[0];\n      \n      const historyEntry = sortedHistory.find(h => h.date === dateString);\n\n      if (historyEntry) {\n        const scoreParts = historyEntry.score.split('/');\n        if (scoreParts.length === 2) {\n          const [committed, total] = scoreParts.map(Number);\n          if (committed === total && total > 0) {\n            streak++;\n          } else {\n            // Found an incomplete day, streak ends\n            break; \n          }\n        }\n      } else {\n        // No log for this day, break streak\n        break;\n      }\n    }\n    return streak;\n}\n\n// FIX 4: Implemented mock daily reset function (serverless simulation)\nconst resetIfNewDay = (data, updateFn) => {\n  const today = new Date();\n  const todayStr = today.toISOString().split('T')[0];\n  const last = data?.last_reset_date;\n  if (last === todayStr) return;\n\n  const y = new Date(today);\n  y.setDate(today.getDate() - 1);\n  const yStr = y.toISOString().split('T')[0];\n\n  const commitments = data?.active_commitments || [];\n  const { committed, total } = calculateTotalScore(commitments);\n\n  updateFn(prev => {\n    const alreadyLogged = (prev.history || []).some(h => h.date === yStr);\n    return {\n      ...prev,\n      last_reset_date: todayStr,\n      history: alreadyLogged\n        ? prev.history\n        : [\n            ...(prev.history || []),\n            { date: yStr, score: `${committed}/${total}`, reflection: prev.reflection_journal || '' }\n          ],\n      active_commitments: commitments.map(c => ({ ...c, status: 'Pending' })),\n    };\n  });\n};\n// --- END MOCK UTILITIES ---\n\n\n/* =========================================================\n   HIGH-CONTRAST PALETTE (Centralized for Consistency)\n========================================================= */\nconst COLORS = {\n  NAVY: '#002E47', \n  TEAL: '#47A88D', \n  SUBTLE_TEAL: '#349881', \n  ORANGE: '#E04E1B', \n  GREEN: '#10B981',\n  RED: '#E04E1B',\n  LIGHT_GRAY: '#FCFCFA',\n  OFF_WHITE: '#FFFFFF',\n  SUBTLE: '#E5E7EB',\n  TEXT: '#002E47',\n  MUTED: '#4B5355',\n  BLUE: '#2563EB',\n};\n\n// UI Components (Replicated for file independence)\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', ...rest }) => {\n  let baseStyle = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-4 text-white flex items-center justify-center\";\n  if (variant === 'primary') { baseStyle += ` bg-[${COLORS.TEAL}] hover:bg-[${COLORS.SUBTLE_TEAL}] focus:ring-[${COLORS.TEAL}]/50`; }\n  else if (variant === 'secondary') { baseStyle += ` bg-[${COLORS.ORANGE}] hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`; }\n  else if (variant === 'outline') { baseStyle = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[${COLORS.TEAL}]/10 focus:ring-4 focus:ring-[${COLORS.TEAL}]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-content`; }\n  else if (variant === 'nav-back') { baseStyle = `px-4 py-2 rounded-lg font-medium transition-all shadow-sm border-2 border-gray-300 text-gray-700 hover:bg-gray-100 flex items-center justify-center`; }\n  if (disabled) { baseStyle = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\"; }\n  return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'TEAL' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.TEAL;\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      className={`relative p-6 rounded-2xl border-2 shadow-2xl hover:shadow-xl transition-all duration-300 text-left ${className}`}\n      style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }}\n      onClick={onClick}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n      {Icon && (<div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}><Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} /></div>)}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\nconst Tooltip = ({ content, children }) => {\n    const [isVisible, setIsVisible] = useState(false);\n    return (\n        <div\n            className=\"relative inline-block\"\n            onMouseEnter={() => setIsVisible(true)}\n            onMouseLeave={() => setIsVisible(false)}\n        >\n            {children}\n            {isVisible && (\n                <div className=\"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2\">\n                    {content}\n                    <div className=\"absolute left-1/2 transform -translate-x-1/2 bottom-[-4px] w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#002E47]\"></div>\n                </div>\n            )}\n        </div>\n    );\n};\n// const leadershipCommitmentBank = {}; // Placeholder\n\n// =========================================================\n\n/* =========================================================\n   ResilienceTracker (Aesthetic Upgrade)\n   FIX 1: Added confirmation state and button logic.\n========================================================= */\nconst ResilienceTracker = ({ dailyLog, handleSaveResilience }) => {\n    const today = new Date().toISOString().split('T')[0];\n    const initialLog = dailyLog[today] || { energy: 5, focus: 5, saved: false }; // Added 'saved' flag\n    const [energy, setEnergy] = useState(initialLog.energy);\n    const [focus, setFocus] = useState(initialLog.focus);\n    const [localIsSaving, setLocalIsSaving] = useState(false);\n    const [isSavedConfirmation, setIsSavedConfirmation] = useState(initialLog.saved);\n\n    // Sync state if initialLog changes (e.g., after nightly reset)\n    useEffect(() => {\n        setEnergy(initialLog.energy);\n        setFocus(initialLog.focus);\n        setIsSavedConfirmation(initialLog.saved);\n    }, [initialLog.energy, initialLog.focus, initialLog.saved]);\n\n    const handleSliderChange = (key, value) => {\n        if (key === 'energy') setEnergy(value);\n        if (key === 'focus') setFocus(value);\n        setIsSavedConfirmation(false); // Allow re-saving if sliders are moved\n    };\n\n    const handleSave = async () => {\n        setLocalIsSaving(true);\n        // CRITICAL FIX: Pass 'saved: true' to the parent to persist the completion status\n        await handleSaveResilience({ energy, focus, saved: true }); \n        setIsSavedConfirmation(true); // Set local confirmation flag\n        setLocalIsSaving(false);\n    };\n\n    const isCheckSaved = initialLog.saved || isSavedConfirmation;\n\n    return (\n        <Card title=\"Daily Resilience Check (T1 Focus)\" icon={HeartPulse} accent='ORANGE' className='bg-[#E04E1B]/10 border-4 border-dashed border-[#E04E1B]/20'>\n            <p className='text-sm text-gray-700 mb-4'>Rate your capacity for high-leverage work today (1 = Low, 10 = High).</p>\n\n            <div className='mb-4'>\n                <p className='font-semibold text-[#002E47] flex justify-between'>\n                    <span>Energy Level:</span>\n                    <span className={`text-xl font-extrabold text-[${COLORS.ORANGE}]`}>{energy}/10</span>\n                </p>\n                <input\n                    type=\"range\" min=\"1\" max=\"10\" value={energy}\n                    onChange={(e) => handleSliderChange('energy', parseInt(e.target.value))}\n                    className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg\"\n                    style={{ accentColor: COLORS.ORANGE }}\n                    disabled={isCheckSaved}\n                />\n            </div>\n            \n            <div className='mb-4'>\n                <p className='font-semibold text-[#002E47] flex justify-between'>\n                    <span>Focus Level:</span>\n                    <span className={`text-xl font-extrabold text-[${COLORS.ORANGE}]`}>{focus}/10</span>\n                </p>\n                <input\n                    type=\"range\" min=\"1\" max=\"10\" value={focus}\n                    onChange={(e) => handleSliderChange('focus', parseInt(e.target.value))}\n                    className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg\"\n                    style={{ accentColor: COLORS.ORANGE }}\n                    disabled={isCheckSaved}\n                />\n            </div>\n\n            {isCheckSaved ? (\n                <div className='w-full p-3 bg-green-100 border border-green-400 rounded-xl flex items-center justify-center font-bold text-green-700'>\n                    <CheckCircle className='w-5 h-5 mr-2'/> Check Saved for Today!\n                </div>\n            ) : (\n                <Button onClick={handleSave} disabled={localIsSaving} className={`w-full bg-[${COLORS.ORANGE}] hover:bg-[#C33E12]`}>\n                    {localIsSaving ? (\n                        <div className=\"flex items-center\">\n                            <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                            Saving...\n                        </div>\n                    ) : 'Save Daily Check (T1 Rep)'}\n                </Button>\n            )}\n        </Card>\n    );\n};\n\n\n/**\n * CommitmentItem: Displays an individual daily commitment with status logging buttons.\n */\nconst CommitmentItem = ({ commitment, onLogCommitment, onRemove, isSaving, tierMeta }) => {\n  // Statuses: 'Committed' (Done), 'Pending' (Not Done/Missed, but can be marked Done)\n  const status = commitment.status || 'Pending';\n  \n  const isCommitted = status === 'Committed';\n  const isLoggingDisabled = isSaving; // Disable during save operation\n\n  \n  const getStatusColor = (s) => {\n    if (s === 'Committed') return 'bg-green-100 text-green-800 border-green-500 shadow-md';\n    // All non-committed statuses (Pending, Missed) display as the base state\n    if (s === 'Pending' || s === 'Missed') return 'bg-gray-100 text-gray-700 border-gray-300 shadow-sm';\n    return 'bg-gray-100 text-gray-700 border-gray-300 shadow-sm';\n  };\n\n  const getStatusIcon = (s) => {\n    if (s === 'Committed') return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\n    return <Clock className=\"w-5 h-5 text-gray-500\" />;\n  };\n\n  const tierLabel = commitment.linkedTier ? `${commitment.linkedTier}: ${tierMeta[commitment.linkedTier]?.name || 'N/A'}` : 'General';\n  const colleagueLabel = commitment.targetColleague ? `Focus: ${commitment.targetColleague}` : 'Self-Focus';\n\n  const removeHandler = () => {\n    // Only allow removal if the status is Pending\n    if (!isCommitted) {\n      onRemove(commitment.id);\n    } else {\n      console.warn(\"Commitment is marked complete. Cannot remove from today's scorecard.\");\n    }\n  };\n\n  // New Single-Button Toggle Handler\n  const handleToggleComplete = () => {\n    // FIX FOR ISSUE 1: Toggles status between Committed and Pending\n    const newStatus = isCommitted ? 'Pending' : 'Committed';\n    // CRITICAL: Call the parent function to trigger state update\n    onLogCommitment(commitment.id, newStatus); \n  };\n\n\n  return (\n    <div className={`p-4 rounded-xl flex flex-col justify-between ${getStatusColor(status)} transition-all duration-300 ${isLoggingDisabled ? 'opacity-70' : ''}`}>\n      <div className='flex items-start justify-between'>\n        <div className='flex items-start space-x-2 text-lg font-semibold mb-2'>\n          {getStatusIcon(status)}\n          <span className='text-[#002E47] text-base'>{commitment.text}</span>\n        </div>\n        {/* Only allow removal if Pending */}\n        <Tooltip content={isCommitted ? \"Marked complete. Remove tomorrow.\" : \"Remove commitment.\"} >\n            <button \n                onClick={removeHandler} \n                className=\"text-gray-400 hover:text-[#E04E1B] transition-colors p-1 rounded-full\" \n                disabled={isLoggingDisabled || isCommitted}\n            >\n               <X className=\"w-4 h-4\" />\n            </button>\n        </Tooltip>\n      </div>\n\n      <div className='flex flex-wrap gap-2 mb-3 overflow-x-auto'>\n        <div className='text-xs text-[#002E47] bg-[#002E47]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap'>\n          Goal: {commitment.linkedGoal || 'N/A'}\n        </div>\n        <div className='text-xs text-[#47A88D] bg-[#47A88D]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap'>\n          Tier Rep: {tierLabel}\n        </div>\n        <div className='text-xs text-[#E04E1B] bg-[#E04E1B]/10 px-3 py-1 rounded-full inline-block font-medium whitespace-nowrap'>\n          {colleagueLabel}\n        </div>\n      </div>\n\n      <div className=\"flex space-x-2 mt-3 pt-3 border-t border-gray-300/50\">\n          <Button\n            onClick={handleToggleComplete}\n            disabled={isLoggingDisabled}\n            className={`px-3 py-1 text-xs w-full ${isCommitted ? 'bg-green-600 hover:bg-green-700' : 'bg-[#47A88D] hover:bg-[#349881]'}`}\n          >\n            {/* FIX: Ensure button text correctly reflects next action */}\n            {isLoggingDisabled ? 'Saving...' : isCommitted ? 'Rep Completed' : 'Mark Rep Complete'}\n          </Button>\n      </div>\n\n    </div>\n  );\n};\n\n// FIX 11: Added the missing component definition for AIStarterPackNudge\nconst AIStarterPackNudge = ({ pdpData, setLinkedGoal, setLinkedTier, isSaving }) => {\n    // Safely access primary goal/tier\n    const primaryGoal = pdpData?.plan?.[0]?.theme || 'Improve Discipline';\n    const primaryTier = pdpData?.assessment?.goalPriorities?.[0] || 'T3';\n\n    return (\n        <Card title=\"AI Starter Pack Nudge\" icon={Cpu} className='mb-6 bg-[#47A88D]/10 border-2 border-[#47A88D]'>\n            <p className='text-sm text-gray-700'>\n                You have no active commitments (reps). AI suggests starting with your Roadmap's primary focus: **{primaryGoal}** ({primaryTier}). \n                Click 'Manage' and select this Goal/Tier combination to auto-fill the alignment fields.\n            </p>\n        </Card>\n    );\n};\n\n\n/**\n * CommitmentSelectorView: Allows users to add commitments from the bank or create custom ones.\n */\nconst CommitmentSelectorView = ({ setView, initialGoal, initialTier, tierMeta, commitmentBank }) => {\n  // CRITICAL FIX: Destructure the expanded commitment bank into its sub-components\n  const { updateCommitmentData, commitmentData, planningData, pdpData, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL, TARGET_REP_CATALOG} = useAppServices(); // FIX: Call hook inside component\n\n  const [tab, setTab] = useState('bank');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [customCommitment, setCustomCommitment] = useState('');\n  const [linkedGoal, setLinkedGoal] = useState(initialGoal || '');\n  const [linkedTier, setLinkedTier] = useState(initialTier || '');\n  const [targetColleague, setTargetColleague] = useState('');\n  const [isSaving, setIsSaving] = useState(false);\n  const [isAlignmentOpen, setIsAlignmentOpen] = useState(true);\n  \n  const [assessmentLoading, setAssessmentLoading] = useState(false);\n  const [aiAssessment, setAiAssessment] = useState(null);\n  const [isCustomCommitmentSaved, setIsCustomCommitmentSaved] = useState(false); // Fix 3: Custom commit confirmation\n\n  const userCommitments = commitmentData?.active_commitments || [];\n  const okrGoals = planningData?.okrs?.map(o => o.objective) || [];\n  const missionVisionGoals = [planningData?.vision, planningData?.mission].filter(Boolean);\n  const initialLinkedGoalPlaceholder = '--- Select the Goal this commitment supports ---';\n  const currentMonthPlan = pdpData?.plan?.find(m => m.month === pdpData?.currentMonth);\n  const requiredPdpContent = currentMonthPlan?.requiredContent || [];\n  const pdpContentCommitmentIds = new Set(userCommitments.filter(c => String(c.id).startsWith('pdp-content-')).map(c => String(c.id).split('-')[2]));\n\n\n  // CRITICAL FIX 1: Use the passed commitmentBank prop\n  const EXPANDED_COMMITMENT_BANK = commitmentBank || {}; \n  const allBankCommitments = useMemo(() => Object.values(EXPANDED_COMMITMENT_BANK || {}).flat(), [EXPANDED_COMMITMENT_BANK]);\n\n  const filteredBankCommitments = useMemo(() => {\n    const ql = searchTerm.toLowerCase();\n    const matchingCommitments = [];\n    for (const category in EXPANDED_COMMITMENT_BANK) {\n      for (const commitment of EXPANDED_COMMITMENT_BANK[category]) {\n        if (\n          !userCommitments.some(c => c.text === commitment.text) && \n          (searchTerm === '' || commitment.text.toLowerCase().includes(ql))\n        ) {\n matchingCommitments.push({ ...commitment, category });\n        }\n      }\n    }\n    return matchingCommitments;\n  }, [userCommitments, searchTerm, EXPANDED_COMMITMENT_BANK]);\n\n  \n  const availableGoals = useMemo(() => [\n  initialLinkedGoalPlaceholder,\n  ...(currentMonthPlan?.theme ? [`Roadmap Focus: ${currentMonthPlan.theme}`] : []),\n  ...okrGoals,\n  ...missionVisionGoals,\n  'Improve Feedback & Coaching Skills',\n  'Risk Mitigation Strategy',\n  'Misalignment Prevention',\n  'Other / New Goal'\n], [okrGoals, missionVisionGoals, currentMonthPlan]);\n  \n// DEFAULT SELECTIONS so \"Add\" never no-ops:\n  // - Goal: PDP Focus (if present) → first OKR → fall back to \"Other / New Goal\"\n  // - Tier: first PDP goal priority → fall back to T3\n  useEffect(() => {\n    if (initialGoal && initialGoal !== linkedGoal) {\n      setLinkedGoal(initialGoal);\n    }\n    if (initialTier && initialTier !== linkedTier) {\n      setLinkedTier(initialTier);\n    }\n    if (!linkedGoal) {\n      const fallbackGoal =\n        (currentMonthPlan?.theme ? `Roadmap Focus: ${currentMonthPlan.theme}` : null) ??\n        (okrGoals && okrGoals.length > 0 ? okrGoals[0] : null) ??\n        'Other / New Goal';\n      setLinkedGoal(fallbackGoal);\n    }\n    if (!linkedTier) {\n      const fallbackTier = pdpData?.assessment?.goalPriorities?.[0] || 'T3';\n      setLinkedTier(fallbackTier);\n    }\n  }, [\n    initialGoal,\n    initialTier,\n    linkedGoal,\n    linkedTier,\n    okrGoals,\n    currentMonthPlan,\n    pdpData\n  ]);\n\n  const handleClearSearch = () => setSearchTerm('');\n  \n  useEffect(() => {\n    setAiAssessment(null);\n  }, [customCommitment]);\n\n\n  /* =========================================================\n     AI Commitment Assessment Logic\n     FIX: Integrated the resilient API call structure\n  ========================================================= */\n\n  const handleAnalyzeCommitment = async () => {\n    if (!customCommitment.trim() || !linkedGoal || linkedGoal === initialLinkedGoalPlaceholder || !linkedTier) {\n        setAiAssessment({ \n            score: 0, \n            risk: 10,\n            feedback: \"Please complete the commitment text, linked goal, and leadership tier selection to run the analysis.\",\n            error: true\n        });\n        return;\n    }\n\n    setAssessmentLoading(true);\n    setAiAssessment(null);\n\n    const tierName = tierMeta[linkedTier]?.name || 'N/A';\n    \n    // FIX: Ensure JSON output is enforced for reliable data\n    const systemPrompt = `You are an AI Executive Coach specializing in habit alignment. Your task is to analyze a user's proposed daily commitment against their strategic context (Goal and Leadership Tier). The response MUST be a JSON object conforming to the schema. Do not include any introductory or explanatory text outside of the JSON block.`;\n    \n    const userQuery = `Analyze the following custom commitment, linked goal, and leadership tier:\n    Commitment: \"${customCommitment.trim()}\"\n    Linked Goal: \"${linkedGoal}\"\n    Leadership Tier: ${linkedTier} - ${tierName}\n    \n    Assess its:\n    1. Value (Score 1-10): How specific, measurable, and impactful is the commitment toward achieving the goal and advancing the tier? (10 is perfect)\n    2. Risk (Score 1-10): How likely is this commitment to be skipped or failed due to vagueness, unrealistic scope, or poor alignment? (10 is high risk)\n    3. Feedback: Provide one concise sentence of constructive feedback on how to maximize the value or minimize the risk.`;\n\n    const jsonSchema = {\n        type: \"OBJECT\",\n        properties: {\n            score: { type: \"INTEGER\", description: \"Value score from 1 to 10.\" },\n            risk: { type: \"INTEGER\", description: \"Risk score from 1 to 10.\" },\n            feedback: { type: \"STRING\", description: \"One concise sentence of constructive feedback.\" }\n        },\n        propertyOrdering: [\"score\", \"risk\", \"feedback\"]\n    };\n\n    try {\n        const payload = {\n            contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n            systemInstruction: { parts: [{ text: systemPrompt }] },\n            generationConfig: {\n                responseMimeType: \"application/json\",\n                responseSchema: jsonSchema\n            },\n            model: GEMINI_MODEL, // Available via hook destructuring\n        };\n        \n        const result = await callSecureGeminiAPI(payload);\n        const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n        \n        if (jsonText) {\n            const cleanJsonText = jsonText.trim().replace(/^[^\\{]*/, ''); \n            const parsedJson = JSON.parse(cleanJsonText);\n\n            setAiAssessment({\n                score: parsedJson.score,\n                risk: parsedJson.risk,\n                feedback: parsedJson.feedback,\n                error: false\n            });\n        } else {\n             setAiAssessment({ \n                score: 5, risk: 5, feedback: \"AI assessment failed. Check your API key or commitment clarity.\", error: true \n            });\n        }\n\n    } catch (e) {\n        console.error(\"AI Assessment Error:\", e);\n        setAiAssessment({ \n            score: 0, \n            risk: 10, \n            feedback: \"CRITICAL API FAILURE: The AI Analysis service is currently unavailable. Check your network connection.\", \n            error: true \n        });\n    } finally {\n        setAssessmentLoading(false);\n    }\n  };\n\n    // Placeholder function for CommitmentSelectorView\n    const renderAssessmentResult = () => {\n        if (!aiAssessment) return null;\n\n        const { score, risk, feedback, error } = aiAssessment;\n        const isGood = score >= 7 && risk <= 4 && !error;\n        const color = isGood ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';\n        const icon = isGood ? <CheckCircle className='w-5 h-5 mr-2'/> : <AlertTriangle className='w-5 h-5 mr-2'/>;\n\n        return (\n            <div className={`p-4 rounded-xl border-2 mb-4 ${color}`}>\n                <p className='font-semibold text-lg flex items-center mb-1'>{icon} AI Alignment Analysis</p>\n                <div className='flex justify-between text-sm mb-2'>\n                    <span>Value Score: <span className='font-extrabold'>{score}/10</span></span>\n                    <span>Risk Score: <span className='font-extrabold'>{risk}/10</span></span>\n                </div>\n                <p className='text-sm italic font-medium'>{feedback}</p>\n            </div>\n        );\n    };\n\n    // CRITICAL FIX: Refactor to be an async function with proper try/catch/finally\n    const handleAddCommitment = async (item, source) => { \n        if (!linkedGoal || linkedGoal === initialLinkedGoalPlaceholder || !linkedTier) {\n            alert(\"Please select a Goal and Tier before adding a commitment.\");\n            return;\n        }\n\n        setIsSaving(true);\n        const newCommitment = {\n            id: item.id || `custom-${Date.now()}`,\n            text: item.text || item.title || customCommitment, \n            status: 'Pending',\n            isCustom: source === 'custom',\n            linkedGoal: linkedGoal,\n            linkedTier: linkedTier,\n            targetColleague: targetColleague || 'Self-Focus',\n            duration: item.duration || 0,\n        };\n\n        try {\n            await updateCommitmentData(data => ({\n                ...data,\n                active_commitments: [...(data?.active_commitments || []), newCommitment]\n            }));\n            \n            setIsSaving(false);\n            setCustomCommitment('');\n            setIsCustomCommitmentSaved(source === 'custom');\n            if (source === 'custom') setTimeout(() => setIsCustomCommitmentSaved(false), 3000);\n            if (source !== 'custom') console.log(`Added \"${newCommitment.text}\" to your scorecard!`);\n            \n        } catch(e) {\n            console.error(\"Failed to add commitment:\", e);\n            setIsSaving(false);\n            alert(\"Failed to save commitment. Check the database connection.\"); // Keep existing user-facing error\n        }\n    };\n    \n    // Wire the custom commitment save to the main handler\n    const handleCreateCustomCommitment = () => {\n        handleAddCommitment({ text: customCommitment }, 'custom');\n    };\n\n    const tabStyle = (tabName) => `px-4 py-2 text-sm font-semibold transition-colors ${tab === tabName ? 'border-[#47A88D] border-b-4 text-[#002E47]' : 'border-transparent text-gray-500 hover:text-[#002E47]'}`;\n    const canAddCommitment = linkedGoal && linkedGoal !== initialLinkedGoalPlaceholder && linkedTier;\n\n\n  return (\n    <div className=\"p-8\">\n      <h1 className=\"text-3xl font-extrabold text-[#002E47] mb-4\">Manage Your Reps (Micro-Habits)</h1>\n      <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Select the core micro-habits (**reps**) that directly support your current leadership training goals. You should aim for **3-5 active commitments** for optimal **Progressive Overload**.</p>\n\n      <Button onClick={() => setView('scorecard')} variant=\"secondary\" className=\"mb-8\" disabled={isSaving}>\n        <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Daily Reps Scorecard\n      </Button>\n\n      {userCommitments.length === 0 && pdpData && (\n          <AIStarterPackNudge \n            pdpData={pdpData} \n            setLinkedGoal={setLinkedGoal} \n            setLinkedTier={setLinkedTier} \n            isSaving={isSaving}\n          />\n      )}\n      \n      {/* Alignment Card (Converted to div/button structure to prevent collapse on select) */}\n      <div\n        className='relative p-6 rounded-2xl border-2 shadow-2xl mb-8 bg-[#47A88D]/10 border-2 border-[#47A88D]'\n      >\n        <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: COLORS.NAVY, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n          \n        {/* Clickable Header for Collapsible Behavior */}\n        <button\n            onClick={() => setIsAlignmentOpen(prev => !prev)}\n            className='flex justify-between items-center w-full text-left'\n        >\n            <div className='flex items-center space-x-3'>\n                <Target className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n                <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>Rep Alignment (Mandatory)</h2>\n            </div>\n            <CornerRightUp className={`w-5 h-5 text-[#002E47] transition-transform ${isAlignmentOpen ? 'rotate-90' : 'rotate-0'}`} />\n        </button>\n\n\n        {isAlignmentOpen && (\n          <div className='mt-4 pt-4 border-t border-[#47A88D]/30'>\n            <p className=\"text-sm text-gray-700 mb-4\">Ensure your daily action is tied to a strategic goal **and** a core leadership tier.</p>\n\n            <div className='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">1. Strategic Goal</label>\n                <select\n                  value={linkedGoal}\n                  onChange={(e) => setLinkedGoal(e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#002E47] focus:border-[#002E47] text-[#002E47] font-semibold\"\n                >\n                  <option value=\"\">--- Select Goal ---</option>\n                  {availableGoals.map(goal => (\n                    <option\n                      key={goal}\n                      value={goal}\n                      disabled={goal === initialLinkedGoalPlaceholder}\n                    >\n                      {goal}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">2. Leadership Tier (T1-T5)</label>\n                <select\n                  value={linkedTier}\n                  onChange={(e) => setLinkedTier(e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#002E47] focus:border-[#002E47] text-[#002E47] font-semibold\"\n                >\n                  <option value=\"\">--- Select Tier ---</option>\n                  {Object.values(tierMeta).map(tier => (\n                    <option key={tier.id} value={tier.id}>\n                      {tier.id}: {tier.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">3. Target Colleague (Optional for inter-personal skills)</label>\n            <input\n              type=\"text\"\n              value={targetColleague}\n              onChange={(e) => setTargetColleague(e.target.value)}\n              placeholder=\"e.g., Alex, Sarah, or Leave Blank for Self-Focus\"\n              className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D]\"\n            />\n\n            {!canAddCommitment && <p className='text-[#E04E1B] text-sm mt-3'>* Please select a Strategic Goal and a Leadership Tier to activate the 'Add' buttons.</p>}\n          </div>\n        )}\n      </div>\n\n\n      {/* Tab Navigation */}\n      <div className=\"flex space-x-2 border-b border-gray-300 -mb-px\">\n        <button className={tabStyle('pdp')} onClick={() => setTab('pdp')}>\n          <Target className='w-4 h-4 inline mr-1' /> Roadmap Reps ({requiredPdpContent.filter(c => !pdpContentCommitmentIds.has(String(c.id))).length})\n        </button>\n        <button className={tabStyle('bank')} onClick={() => setTab('bank')}>\n          <BookOpen className='w-4 h-4 inline mr-1' /> Rep Bank ({Object.keys(EXPANDED_COMMITMENT_BANK).length})\n        </button>\n        <button className={tabStyle('custom')} onClick={() => setTab('custom')}>\n          <PlusCircle className='w-4 h-4 inline mr-1' /> Custom Rep\n        </button>\n      </div>\n\n      {/* Tab Content */}\n      <div className='mt-0 bg-[#FCFCFA] p-6 rounded-b-3xl shadow-lg border-2 border-t-0 border-[#47A88D]/30'>\n\n        {/* PDP Content Tab */}\n        {tab === 'pdp' && (\n          <div className=\"space-y-4\">\n            <p className='text-sm text-gray-700'>These items are currently required for you to complete Training Month **{currentMonthPlan?.month || 'N/A'}** ({currentMonthPlan?.theme || 'N/A Focus'}) of your personalized Roadmap.</p>\n            <div className=\"h-96 overflow-y-auto pr-2 space-y-3 pt-2\">\n              {requiredPdpContent.length > 0 ? (\n                requiredPdpContent\n                  .filter(c => !pdpContentCommitmentIds.has(String(c.id)))\n                  .map(c => (\n                    <div key={c.id} className=\"flex justify-between items-center p-3 text-sm bg-[#47A88D]/5 rounded-lg border border-[#47A88D]/20\">\n                      <span className='text-gray-800 font-medium'>{c.title} ({c.type}) - Est. {c.duration} min</span>\n                      <Tooltip content={`Adds this item to your daily scorecard for tracking (linked goal/tier required).`}>\n                        <button\n                          onClick={() => handleAddCommitment(c, 'pdp')}\n                          disabled={!canAddCommitment || isSaving}\n                          className={`font-semibold text-xs transition-colors p-1 flex items-center space-x-1 ${canAddCommitment && !isSaving ? 'text-[#47A88D] hover:text-[#349881]' : 'text-gray-400 cursor-not-allowed'}`}\n                        >\n                          <PlusCircle className='w-4 h-4' />\n                          <span className='hidden sm:inline'>Add Rep</span>\n                        </button>\n                      </Tooltip>\n                    </div>\n                  ))\n              ) : (\n                <p className=\"text-gray-500 italic text-center py-10\">No required content for the current Roadmap month, or you have already added all items.</p>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Commitment Bank Tab */}\n        {tab === 'bank' && (\n          <div className=\"space-y-4\">\n            <div className='flex space-x-2'>\n              <input\n                type=\"text\"\n                placeholder=\"Filter Rep Bank by keyword (e.g., 'feedback' or 'OKR')\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] mb-4\"\n              />\n              {searchTerm && (\n                <Button variant=\"outline\" onClick={handleClearSearch} className='px-4 py-2 self-start'>\n                  <X className='w-4 h-4' />\n                </Button>\n              )}\n            </div>\n\n            <div className=\"h-96 overflow-y-auto pr-2 space-y-3\">\n              {/* FIX FOR ISSUE 4: Added onClick handler to the button to add the commitment */}\n              {/* CRITICAL FIX 2: Iterate over the expanded commitment bank passed via props */}\n              {Object.entries(EXPANDED_COMMITMENT_BANK).map(([category, commitments]) => {\n                const filteredCommitments = commitments.filter(c =>\n                    // Check if commitment text is NOT already in active commitments\n                    !userCommitments.some(activeC => activeC.text === c.text) &&\n                    (searchTerm === '' || c.text.toLowerCase().includes(searchTerm.toLowerCase()))\n                );\n\n                if (filteredCommitments.length === 0 && searchTerm !== '') return null;\n                if (filteredCommitments.length === 0 && searchTerm === '' && allBankCommitments.length > 0) return null; \n\n                return (\n                  <div key={category}>\n                    <h3 className=\"text-sm font-bold text-[#002E47] border-b pb-1 mb-2\">{category}</h3>\n                    {filteredCommitments.map(c => (\n                      <div key={c.id || c.text} className=\"flex justify-between items-center p-2 text-sm bg-gray-50 rounded-lg mb-1\">\n                        <span className='text-gray-800'>{c.text}</span>\n                        <Tooltip content={`Adds this commitment (linked goal/tier required).`}>\n                          {/* FIX 1: CRITICAL WIRING FIX: The button must call handleAddCommitment */}\n                          <button\n                            onClick={() => handleAddCommitment(c, 'bank')} \n                            disabled={!canAddCommitment || isSaving}\n                            className={`font-semibold text-xs transition-colors p-1 flex items-center space-x-1 ${canAddCommitment && !isSaving ? 'text-[#47A88D] hover:text-[#349881]' : 'text-gray-400 cursor-not-allowed'}`}\n                          >\n                            <PlusCircle className='w-4 h-4' />\n                          </button>\n                        </Tooltip>\n                      </div>\n                    ))}\n                  </div>\n                );\n              })}\n              {Object.keys(EXPANDED_COMMITMENT_BANK).length > 0 && filteredBankCommitments.length === 0 && searchTerm !== '' && (\n                  <p className=\"text-gray-500 italic mt-4 text-center\">No unselected commitments match criteria.</p>\n              )}\n               {Object.keys(EXPANDED_COMMITMENT_BANK).length === 0 && (\n                   <p className=\"text-gray-500 italic mt-4 text-center\">Commitment Bank data is not loaded. Check global metadata configuration.</p>\n               )}\n            </div>\n          </div>\n        )}\n\n        {/* Custom Commitment Tab - UPDATED WITH AI ANALYSIS */}\n        {tab === 'custom' && (\n          <div className=\"space-y-4\">\n            <p className='text-sm text-gray-700'>Define a hyper-specific, measurable action tailored to your unique challenges (a custom **Rep**).</p>\n            \n            <textarea\n              value={customCommitment}\n              onChange={(e) => setCustomCommitment(e.target.value)}\n              placeholder=\"e.g., Conduct a 10-minute debrief after every client meeting.\"\n              className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-20 mb-4\"\n            />\n            \n            <Button\n                onClick={handleAnalyzeCommitment}\n                disabled={!customCommitment.trim() || !canAddCommitment || assessmentLoading || isSaving || !hasGeminiKey()}\n                variant='outline'\n                className=\"w-full bg-[#002E47] hover:bg-gray-700 text-white\"\n            >\n                {assessmentLoading ? 'Analyzing...' : <><Cpu className='w-4 h-4 mr-2'/> Analyze Rep Alignment</>}\n            </Button>\n\n            {renderAssessmentResult()}\n            \n            {isCustomCommitmentSaved && (\n                <div className='flex items-center p-3 text-sm font-semibold text-white rounded-lg bg-green-500'>\n                    <CheckCircle className='w-4 h-4 mr-2'/> Custom Rep Added!\n                </div>\n            )}\n\n            <Button\n              onClick={handleCreateCustomCommitment} \n              disabled={!customCommitment.trim() || !canAddCommitment || isSaving}\n              className=\"w-full bg-[#47A88D] hover:bg-[#349881]\"\n            >\n              {isSaving ? 'Saving...' : 'Add Custom Rep'}\n            </Button>\n          </div>\n        )}\n\n      </div>\n    </div>\n  );\n};\n\n/* =========================================================\n   NEW ADVANCED FEATURE 7: Weekly Prep View (Mocked)\n========================================================= */\n\nconst WeeklyPrepView = ({ setView, commitmentData, updateCommitmentData, userCommitments }) => {\n    const [reviewNotes, setReviewNotes] = useState(commitmentData?.weekly_review_notes || '');\n    const [isSaving, setIsSaving] = useState(false);\n    \n    // Feature 7: Audit of missed reps (part of the weekly recap)\n    const missedLastWeek = (commitmentData?.history || []).slice(-7).filter(day => {\n        const [committed, total] = day.score.split('/').map(Number);\n        return committed < total && total > 0;\n    });\n\n    const handleRetireCommitment = async (id) => {\n        const commitmentToRemove = userCommitments.find(c => c.id === id);\n        if (commitmentToRemove && commitmentToRemove.status === 'Committed') {\n            // To prevent confusion, only allow retiring of 'Pending' reps for now.\n            console.warn(\"Please wait for the daily reset to retire a committed rep.\");\n            return;\n        }\n\n        const newCommitments = userCommitments.filter(c => c.id !== id);\n        \n        await updateCommitmentData(data => ({ ...data, active_commitments: newCommitments })); \n        console.info(\"Rep retired successfully. Focus remains on the next priority!\");\n    };\n\n    const handleSaveReview = async () => {\n        setIsSaving(true);\n        await updateCommitmentData(data => ({ \n            ...data,\n            last_weekly_review: new Date().toISOString(),\n            weekly_review_notes: reviewNotes,\n        }));\n        console.info('Weekly review saved!');\n        setIsSaving(false);\n        setView('scorecard');\n    };\n\n    return (\n        <div className=\"p-8\">\n            <h1 className=\"text-3xl font-extrabold text-[#002E47] mb-4\">Weekly Rep Review & Progressive Overload Prep</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Take 15 minutes to review last week's performance (reps) and prepare your focus for the upcoming week. This intentional review ensures sustained success through **consistency over intensity**.</p>\n\n            <Button onClick={() => setView('scorecard')} variant=\"outline\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Daily Reps Scorecard\n            </Button>\n            \n            <div className='grid lg:grid-cols-2 gap-8'>\n                <div className='space-y-6'>\n                    <Card title=\"Audit: Last Week's Missed Reps\" icon={TrendingDown} accent='ORANGE' className='border-l-4 border-[#E04E1B] bg-[#E04E1B]/10'>\n                        <p className='text-sm text-gray-700 mb-4'>\n                            You missed your perfect score **{missedLastWeek.length} times** last week. Use the list below to retire **mastered reps** or re-commit to challenging ones.\n                        </p>\n                        \n                        <h4 className='text-md font-bold text-[#002E47] border-t pt-4 mt-4 mb-2'>Active Reps (For Review)</h4>\n                        <ul className='space-y-2'>\n                            {userCommitments.map(c => (\n                                <li key={c.id} className='flex justify-between items-center bg-white p-3 rounded-lg shadow-sm border'>\n                                    <span className='text-sm text-gray-700 pr-2'>{c.text}</span>\n                                    <Button \n                                        onClick={() => handleRetireCommitment(c.id)}\n                                        variant='outline' \n                                        className='text-xs px-2 py-1 text-[#E04E1B] border-[#E04E1B]/50 hover:bg-[#E04E1B]/10 whitespace-nowrap'\n                                    >\n                                        <Archive className='w-4 h-4 mr-1' /> Retire Rep\n                                    </Button>\n                                </li>\n                            ))}\n                            {userCommitments.length === 0 && <p className='text-gray-500 italic text-sm'>No active commitments to review.</p>}\n                        </ul>\n                    </Card>\n                </div>\n\n                <div className='space-y-6'>\n                    <Card title=\"Next Week Planning Notes\" icon={Lightbulb} accent='TEAL' className='border-l-4 border-[#47A88D]'>\n                        <p className='text-sm text-gray-700 mb-4'>Draft a quick focus note for the upcoming week based on your audit. What single outcome will define success?</p>\n                        <textarea \n                            value={reviewNotes}\n                            onChange={(e) => setReviewNotes(e.target.value)}\n                            className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-32\" \n                            placeholder=\"e.g., 'Ensure 1:1 prep is done by Monday to maintain Coaching Tier focus.'\"\n                        ></textarea>\n                    </Card>\n\n                    <Button onClick={handleSaveReview} disabled={isSaving} className=\"w-full\">\n                        {isSaving ? 'Saving Review...' : 'Save Weekly Review & Return'}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n// TierSuccessMap Component Definition\nconst TierSuccessMap = ({ tierRates, tierMeta }) => {\n    return (\n        <Card title=\"Tier Rep Success Map\" icon={BarChart3} accent='TEAL' className='bg-[#47A88D]/10 border-2 border-[#47A88D]'>\n            <p className='text-sm text-gray-700 mb-2'>Success Rate by Leadership Tier</p>\n            {Object.entries(tierRates).length > 0 ? (\n                Object.entries(tierRates).map(([tier, data]) => (\n                    data.total > 0 && (\n                        <div key={tier} className='mb-1'>\n                            <div className='flex justify-between text-xs font-semibold text-[#002E47]'>\n                                <span>{tierMeta[tier]?.name || tier} ({data.total} Reps)</span>\n                                <span className={`font-bold ${data.rate > 70 ? 'text-green-600' : 'text-orange-600'}`}>{data.rate}%</span>\n                            </div>\n                            <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                                <div className=\"h-2 rounded-full\" style={{ width: `${data.rate}%`, backgroundColor: tierMeta[tier]?.hex || COLORS.TEAL }}></div>\n                            </div>\n                        </div>\n                    )\n                ))\n            ) : (\n                <p className=\"text-gray-500 italic text-sm\">No trackable tier data yet. Add reps to begin.</p>\n            )}\n        </Card>\n    );\n};\n\n// CommitmentHistoryModal Component Definition\nconst CommitmentHistoryModal = ({ isVisible, onClose, dayData }) => {\n    if (!isVisible || !dayData) return null;\n    return (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white p-6 rounded-xl shadow-2xl w-full max-w-md\">\n                <div className=\"flex justify-between items-center border-b pb-2 mb-4\">\n                    <h3 className=\"text-xl font-bold\">Reps History: {dayData.date}</h3>\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-700\"><X className=\"w-5 h-5\"/></button>\n                </div>\n                \n                <p className=\"text-lg font-extrabold mb-3\">Score: {dayData.score}</p>\n                <p className=\"text-sm text-gray-700 font-semibold mb-2\">Reflection Log:</p>\n                <div className=\"p-3 bg-gray-50 border rounded-lg h-32 overflow-y-auto text-sm italic text-gray-600\">\n                    {dayData.reflection || 'No reflection logged for this day.'}\n                </div>\n                \n                <Button onClick={onClose} className=\"mt-4 w-full\">Close Details</Button>\n            </div>\n        </div>\n    );\n};\n\n// PerfectScoreModal Component Definition (Feature 4)\nconst PerfectScoreModal = ({ onClose }) => (\n  <div\n    className=\"fixed inset-0 bg-[#002E47]/70 z-50 flex items-center justify-center p-4\"\n    onClick={(e) => { if (e.target === e.currentTarget) onClose(); }}\n    role=\"dialog\"\n    aria-modal=\"true\"\n    aria-label=\"Perfect Score\"\n  >\n    <div className=\"relative bg-[#FCFCFA] rounded-xl shadow-2xl w-full max-w-sm p-6 text-center\">\n      <button\n        aria-label=\"Close\"\n        onClick={onClose}\n        className=\"absolute top-3 right-3 p-2 rounded-full hover:bg-gray-100\"\n      >\n        <X className=\"w-5 h-5\" />\n      </button>\n\n      <Crown className=\"w-12 h-12 text-green-600 mx-auto mb-4\" />\n      <h3 className=\"text-2xl font-extrabold text-[#002E47] mb-2\">Perfect Rep Score!</h3>\n      <p className=\"text-sm text-gray-700 mb-4\">\n        You executed all your leadership reps today. Sustain this discipline!\n      </p>\n      <Button onClick={onClose} className=\"w-full bg-green-600 hover:bg-green-700\">\n        Acknowledge\n      </Button>\n    </div>\n  </div>\n);\n\n\n// --- NEW COMPONENT: Daily Rep Target Card (Features 1, 2, 6, 8) ---\nconst DailyRepTargetCard = ({ targetRep, microTip, identityStatement, handleLogTargetRep }) => {\n    // Determine the relevant Tier based on the target rep (simple mock logic)\n    const accentColor = COLORS.ORANGE; // Use default\n    \n    return (\n        <Card \n            title=\"Today's Single Rep Target\" \n            icon={Flag} \n            accent={'ORANGE'} \n            className='mb-6 shadow-2xl border-4'\n            style={{ border: `4px solid ${accentColor}50` }}\n        >\n            <p className='text-sm font-semibold text-[#002E47] mb-2 uppercase tracking-wide flex items-center gap-2'>\n                <Target className='w-4 h-4 text-red-500'/> Action:\n            </p>\n            <p className='text-xl font-extrabold text-[#E04E1B] mb-4'>\n                {targetRep}\n            </p>\n            \n            {/* Why It Matters / Identity Shift Card Integration (Feature 2 & 8) */}\n            <div className='p-3 rounded-lg border border-gray-200 bg-white shadow-inner'>\n                <p className='text-xs font-semibold text-gray-600 mb-1 flex items-center gap-1'>\n                    <User className='w-3 h-3 text-gray-500'/> Your Identity Anchor (Why it Matters):\n                </p>\n                <p className='text-sm italic text-gray-800 font-medium'>\n                    \"{identityStatement}\"\n                </p>\n            </div>\n\n            {/* Log Target Rep Action (Feature 1) */}\n            <div className='mt-4 pt-4 border-t border-gray-100'>\n                <p className='text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wide flex items-center gap-1'>\n                    <Clock className='w-3 h-3 text-gray-500'/> Environmental Trigger (Feature 6):\n                </p>\n                 <p className='text-sm text-gray-700 font-medium mb-3'>\n                    Log your rep right after the action is complete. Tip: **{microTip}**\n                </p>\n                \n                {/* CRITICAL BUTTON FIX: LOG TARGET REP */}\n                <Button \n                    onClick={handleLogTargetRep} \n                    variant='primary' \n                    className='w-full px-3 py-2 text-lg bg-[#47A88D] hover:bg-[#349881]'\n                >\n                    <CheckCircle className='w-5 h-5 mr-2'/> Complete Rep (Log Now)\n                </Button>\n            </div>\n        </Card>\n    );\n};\n\n// --- NEW COMPONENT: Social Accountability Nudge (Feature 5 Mock) ---\nconst SocialAccountabilityNudge = ({ navigate }) => {\n    return (\n        <Card title=\"Social Accountability Pod\" icon={Users} accent='BLUE' className='border-4 border-[#2563EB]/20 bg-[#2563EB]/10'>\n            <p className='text-sm text-gray-700 mb-4'>\n                Public commitment boosts consistency. Share your latest rep with your accountability pod!\n            </p>\n            <div className='flex items-center space-x-2 p-3 bg-white rounded-lg border border-gray-200'>\n                <Send className='w-4 h-4 text-[#2563EB]'/>\n                <span className='text-sm text-gray-600'>Alex just shared: \"Gave my feedback rep today!\"</span>\n            </div>\n            <Button onClick={() => navigate('community')} variant='outline' className='w-full mt-4 text-sm text-[#2563EB] border-[#2563EB]/50 hover:bg-[#2563EB]/10'>\n                Share Your Latest Rep\n            </Button>\n            <p className='text-xs text-gray-500 mt-2'>* Solo Mode is active. Switch in settings for team visibility.</p>\n        </Card>\n    );\n}\n\n// --- NEW COMPONENT: Post-Log Micro-Action Prompt (Feature 3 momentum) ---\nconst MicroActionPromptModal = ({ isVisible, onClose, onMicroActionClick }) => {\n    if (!isVisible) return null;\n    return (\n        <div className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4\">\n            <div className={`relative bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center border-t-8 border-[${COLORS.TEAL}]`}>\n                <Zap className={`w-10 h-10 text-[${COLORS.TEAL}] mx-auto mb-3`} />\n                <h3 className=\"text-xl font-extrabold text-[#002E47] mb-2\">Rep Logged! Want More Momentum?</h3>\n                <p className=\"text-sm text-gray-600 mb-5\">\n                    Your strategic rep is complete. To lock in this discipline, quickly grab a **Micro-Action Rep** now!\n                </p>\n                <Button \n                    onClick={onMicroActionClick} \n                    className=\"w-full text-lg bg-[#2563EB] hover:bg-[#1E40AF]\"\n                >\n                    <Zap className='w-4 h-4 mr-2'/> Grab a 2-Minute Challenge Rep\n                </Button>\n                <button onClick={onClose} className='text-sm text-gray-500 mt-3 hover:text-gray-700 block w-full'>\n                    No thanks, I'll stick to the Scorecard.\n                </button>\n            </div>\n        </div>\n    );\n};\n\n\n/**\n * DailyPracticeScreen: Main Scorecard View\n */\nexport default function DailyPracticeScreen({ initialGoal, initialTier, quickLog, source }) {\n  // CRITICAL FIX: Use useAppServices to get the state manager and data\n  const { commitmentData, updateCommitmentData, callSecureGeminiAPI, hasGeminiKey, pdpData, navigate, GEMINI_MODEL, LEADERSHIP_TIERS, MOCK_ACTIVITY_DATA, COMMITMENT_BANK, TARGET_REP_CATALOG} = useAppServices(); \n  \n  // ADDITION 1: New state to track if we've handled the initial navigation\n  const [hasNavigatedInitial, setHasNavigatedInitial] = useState(false); \n  const [isChallengeModalVisible, setIsChallengeModalVisible] = useState(false); // NEW: Challenge Modal State (Feature 3)\n  const [isPostLogPromptVisible, setIsPostLogPromptVisible] = useState(false); // NEW: Post-Log Modal State (Feature 3)\n\n  const tierMeta = LEADERSHIP_TIERS || LEADERSHIP_TIERS_META_FALLBACK; // Use service data or fallback\n  const commitmentBank = COMMITMENT_BANK; // Use service data\n\n  // FIX: Call the mock scheduleMidnightReset function to simulate nightly log/reset\nuseEffect(() => {\n  if (!commitmentData) return;\n  resetIfNewDay(commitmentData, updateCommitmentData);\n}, [commitmentData?.last_reset_date, updateCommitmentData]);\n\n  const [view, setView] = useState('scorecard'); \n  const [isSaving, setIsSaving] = useState(false); // Global saving for reflection/resilience\n  const [reflection, setReflection] = useState(commitmentData?.reflection_journal || '');\n  const [isReflectionSaved, setIsReflectionSaved] = useState(false); // NEW: Reflection confirmation\n  \n  const [reflectionPrompt, setReflectionPrompt] = useState(null);\n  const [promptLoading, setPromptLoading] = useState(false);\n  const [isHistoryModalVisible, setIsHistoryModalVisible] = useState(false);\n  const [selectedHistoryDay, setSelectedHistoryDay] = useState(null);\n  \n  // FIX: State for view toggle\n  const [viewMode, setViewMode] = useState('tier'); \n  const [isPerfectScoreModalVisible, setIsPerfectScoreModalVisible] = useState(false);\n  // Refs to detect transition and avoid instant reopen\n  const wasPerfectRef = useRef(false);\n  const isClosingRef = useRef(false);\n\n  // Centralized close handler\n  const handleClosePerfectModal = useCallback(() => {\n    isClosingRef.current = true;\n    setIsPerfectScoreModalVisible(false);\n    setTimeout(() => { isClosingRef.current = false; }, 250);\n  }, []);\n // Feature 4\n  const resilienceLog = commitmentData?.resilience_log || {};\n  \n  // MODIFIED useEffect: Handle incoming 'quickLog' prop from Dashboard (Feature 3)\n  useEffect(() => {\n    // If navigated from the Dashboard's Micro-Action button, immediately open the modal.\n    if (quickLog === true) {\n      setIsChallengeModalVisible(true);\n    }\n    \n    if (!hasNavigatedInitial && (initialGoal || initialTier)) {\n      setView('selector');\n      setHasNavigatedInitial(true); // Mark as done\n    } else if (view === 'selector' && !hasNavigatedInitial && !initialGoal && !initialTier) {\n       setHasNavigatedInitial(true);\n    }\n  }, [initialGoal, initialTier, hasNavigatedInitial, view, quickLog]); \n\n\n  // CRITICAL FIX (Usability): Scroll to the top when the view changes\n  useEffect(() => {\n      if (typeof window !== 'undefined') {\n          window.scrollTo({ top: 0, behavior: 'smooth' });\n      }\n  }, [view]);\n\n\n  // CRITICAL FIX: Resilience save handler now correctly uses updateCommitmentData\n  const handleSaveResilience = async (newLogData) => { \n      setIsSaving(true); \n      const today = new Date().toISOString().split('T')[0];\n      // FIX 2: Ensure we update the log correctly, including the 'saved' flag.\n      await updateCommitmentData(data => ({ \n          ...data, // Spread data here to ensure other fields are preserved (important for API calls)\n          resilience_log: { \n              ...data.resilience_log, \n              [today]: { ...newLogData, saved: true } // Explicitly set saved:true\n          } \n      })); \n      setIsSaving(false);\n      console.log(\"Resilience Log Saved.\");\n  };\n\n  const userCommitments = commitmentData?.active_commitments || [];\n  const commitmentHistory = commitmentData?.history || [];\n  const score = calculateTotalScore(userCommitments);\n  const streak = calculateStreak(commitmentHistory);\n  const isPerfectScore = score.total > 0 && score.committed === score.total;\n  \n  // --- UPDATED TARGET REP HOOKS (Features 1, 2, 8) ---\n  const dailyTargetRep = useMemo(() => {\n      const catalog = TARGET_REP_CATALOG || [];\n      // NEW LOGIC: Select the first item for now\n      return catalog[0]?.text || MOCK_ACTIVITY_DATA?.daily_target_rep || 'Define your top priority rep.';\n  }, [TARGET_REP_CATALOG, MOCK_ACTIVITY_DATA]);\n  \n  const identityStatement = useMemo(() => MOCK_ACTIVITY_DATA?.identity_statement || 'I am a principled leader.', [MOCK_ACTIVITY_DATA]);\n  // --- END NEW DATA HOOKS ---\n\n  // Open the modal only on transition from not-perfect -> perfect\n  useEffect(() => {\n    const prevWasPerfect = wasPerfectRef.current;\n    if (!isPerfectScore) {\n      wasPerfectRef.current = false;\n      return;\n    }\n    if (!prevWasPerfect && isPerfectScore && score.total > 0 && !isClosingRef.current) {\n      setIsPerfectScoreModalVisible(true);\n    }\n    wasPerfectRef.current = true;\n  }, [isPerfectScore, score.total]);\n// Allow closing with ESC\nuseEffect(() => {\n  if (!isPerfectScoreModalVisible) return;\n  const onKey = (e) => { if (e.key === 'Escape') handleClosePerfectModal(); };\n  window.addEventListener('keydown', onKey);\n  return () => window.removeEventListener('keydown', onKey);\n}, [isPerfectScoreModalVisible]);\n\n  \n  const tierSuccessRates = useMemo(() => calculateTierSuccessRates(userCommitments, commitmentHistory, tierMeta), [userCommitments, commitmentHistory, tierMeta]);\n  const lastSevenDaysHistory = useMemo(() => getLastSevenDays(commitmentHistory), [commitmentHistory]);\n\n\n  /* =========================================================\n     AI-Driven Reflection Prompt Logic (Bonus Feature)\n  ========================================================= */\n  const fetchReflectionPrompt = async (data) => {\n    if (!hasGeminiKey() || promptLoading) return;\n\n    setPromptLoading(true);\n    \n    // Treat 'Pending' commitments as 'Missed' for the purpose of the reflection prompt.\n    const missedCommitments = (data?.active_commitments || [])\n        .filter(c => c.status === 'Missed' || c.status === 'Pending')\n        .map(c => `[${tierMeta[c.linkedTier]?.name || 'General'}] ${c.text}`);\n\n    const systemPrompt = `You are an executive coach. Based on the user's daily performance, generate ONE specific, non-judgemental, and high-leverage reflection question. If commitments were missed, link the question to the missed tier/action and the leadership cost of inconsistency. If performance was perfect, ask a question about translating that commitment into team impact. Keep the question concise (1-2 sentences).`;\n\n    let userQuery;\n    if (missedCommitments.length > 0) {\n        userQuery = `The user missed or is pending on the following commitments: ${missedCommitments.join('; ')}. Generate a reflection prompt focused on the root cause and leadership cost of that inconsistency.`;\n    } else if (data?.active_commitments?.length > 0) {\n        userQuery = `The user achieved a perfect score today (${data.active_commitments.length}/${data.active_commitments.length}). Generate a reflection prompt focused on how the commitment execution generated value or reduced risk for their team today.`;\n    } else {\n        setReflectionPrompt('What key insight did you gain today that will improve your leadership practice tomorrow?');\n        setPromptLoading(false);\n        return;\n    }\n\n    try {\n        const payload = {\n            contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n            systemInstruction: { parts: [{ text: systemPrompt }] },\n            model: GEMINI_MODEL,\n        };\n        const result = await callSecureGeminiAPI(payload);\n        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n        setReflectionPrompt(text?.trim() || 'What single behavior reinforced your LIS today, and why?');\n    } catch (e) {\n        console.error(\"AI Prompt Error:\", e);\n        setReflectionPrompt('AI Coach is unavailable. Use this standard prompt: What single behavior reinforced your LIS today, and why?');\n    } finally {\n        setPromptLoading(false);\n    }\n  };\n\n\n  /* =========================================================\n     General Handlers (Fixing Status Logic & Removal)\n  ========================================================= */\n\n  const handleLogCommitment = async (id, status) => {\n    setIsSaving(true);\n    \n    try {\n        await updateCommitmentData(data => {\n            const updatedCommitments = data.active_commitments.map(c => \n                c.id === id ? { ...c, status: status } : c\n            );\n            return { ...data, active_commitments: updatedCommitments };\n        });\n    } catch (e) {\n        console.error(\"Failed to log commitment status:\", e);\n        alert(\"Failed to log commitment status. Please try again.\");\n    }\n    \n    setIsSaving(false);\n    \n    // NEW LOGIC (Feature 3): If the strategic rep was just completed, prompt for Micro-Action\n    // This assumes the target rep is the first in the list, matching the Dashboard setup.\n    if (id === userCommitments?.[0]?.id && status === 'Committed') {\n        setIsPostLogPromptVisible(true);\n    }\n  };\n\n  const handleRemoveCommitment = async (id) => {\n    setIsSaving(true);\n    const commitmentToRemove = userCommitments.find(c => c.id === id);\n\n    if (commitmentToRemove && commitmentToRemove.status === 'Committed') {\n        console.warn(\"Commitment is marked complete. It must remain on the scorecard until tomorrow's daily reset for data integrity.\");\n        setIsSaving(false);\n        return;\n    }\n    \n    try {\n        await updateCommitmentData(data => {\n            const updatedCommitments = data.active_commitments.filter(c => c.id !== id);\n            return { ...data, active_commitments: updatedCommitments }; \n        });\n    } catch (e) {\n        console.error(\"Failed to remove commitment:\", e);\n        alert(\"Failed to remove commitment. Please try again.\");\n    }\n    \n    setIsSaving(false);\n  };\n\n  const handleSaveReflection = async () => {\n    setIsSaving(true);\n    setIsReflectionSaved(false); \n    \n    try {\n        await updateCommitmentData(data => ({ ...data, reflection_journal: reflection }));\n    } catch (e) {\n        console.error(\"Failed to save reflection:\", e);\n        alert(\"Failed to save reflection. Please try again.\");\n    }\n\n    setIsSaving(false);\n    setIsReflectionSaved(true); \n    setTimeout(() => setIsReflectionSaved(false), 3000);\n    console.log(\"Daily Reflection Saved.\");\n  };\n  \n  const handleOpenHistoryModal = (dayData) => {\n      setSelectedHistoryDay(dayData);\n      setIsHistoryModalVisible(true);\n  };\n  \n  /* --- NEW FEATURE: 2-MINUTE CHALLENGE LOGIC (Feature 3) --- */\n  const handleOpenChallengeModal = () => {\n      setIsChallengeModalVisible(true);\n  };\n  /* --- END NEW FEATURE --- */\n\n\n  /* =========================================================\n     NEW ADVANCED FEATURE: Predictive Risk & Micro-Tip Logic (Feature 6)\n  ========================================================= */\n  const { predictiveRisk, microTipText } = useMemo(() => {\n    const today = new Date();\n    const hour = today.getHours();\n    \n    const missedTiers = userCommitments\n      .filter(c => c.status === 'Missed' || c.status === 'Pending')\n      .map(c => c.linkedTier)\n      .filter(t => t);\n\n    // Filter commitments to get unique missed tiers\n    const uniqueMissedTiers = [...new Set(missedTiers)];\n      \n    let riskText = null;\n    let riskIcon = null;\n\n    if (uniqueMissedTiers.length > 0) {\n        const frequentMissedTier = uniqueMissedTiers.reduce((a, b, i, arr) => \n            (arr.filter(v => v===a).length >= arr.filter(v => v===b).length ? a : b), uniqueMissedTiers[0]);\n            \n        riskText = `High Risk: Inconsistency in **${tierMeta[frequentMissedTier]?.name || 'a core tier'}** reps. This threatens your ability to advance in your Roadmap.`;\n        riskIcon = TrendingDown;\n    } else {\n        if (score.total > 0) {\n            riskText = \"Low Risk: Great start! Sustain the momentum to hit a perfect rep score.\";\n            riskIcon = CheckCircle;\n        } else {\n             riskText = \"No active risk yet. Add commitments in the 'Manage' tab.\";\n             riskIcon = AlertTriangle;\n        }\n    }\n\n    let tipText;\n    // Feature 6: Anchor Setup - Simulated Contextual Tip\n    if (hour < 10) { // Before 10 AM\n        tipText = \"Morning Anchor: Tie your first rep to your morning routine or first 1:1. (After my coffee...)\";\n    } else if (hour >= 10 && hour < 15) { // Mid-day\n        tipText = \"Mid-Day Check: Use your lunch break as a trigger. (Before lunch reflection)\";\n    } else { // Late afternoon / EOD\n        tipText = \"EOD Reflection: Ensure all Reps are logged before signing off. (At end of day reflection)\";\n    }\n\n\n    return { predictiveRisk: { text: riskText, icon: riskIcon }, microTipText: tipText };\n  }, [userCommitments, score.total, tierMeta]);\n\n  // View Mode Sorting Logic\nconst sortedCommitments = useMemo(() => {\n  const active = [...userCommitments];\n      if (viewMode === 'status') {\n          return active.sort((a, b) => {\n              if (a.status === 'Pending' && b.status !== 'Pending') return -1;\n              if (a.status !== 'Pending' && b.status === 'Pending') return 1;\n              return 0;\n          });\n      }\n      if (viewMode === 'tier') {\n          const tierOrder = ['T5', 'T4', 'T3', 'T2', 'T1']; // Sort by highest leverage first\n          return active.sort((a, b) => {\n              return tierOrder.indexOf(a.linkedTier) - tierOrder.indexOf(b.linkedTier);\n          });\n      }\n      return active;\n}, [userCommitments, viewMode]);\n\n\n  // Final Render\n  const renderView = () => {\n    \n    // Mock progress data for visualization\n    const monthlyProgress = { daysTracked: 15, metItems: 35, totalItems: 45, rate: 78 }; \n\n\n    switch (view) {\n      case 'selector':\n        // CRITICAL FIX 3: Pass commitmentBank to CommitmentSelectorView\n        return <CommitmentSelectorView\n          setView={setView}\n          initialGoal={initialGoal}\n          initialTier={initialTier}\n          tierMeta={tierMeta}\n          commitmentBank={commitmentBank}\n        />;\n      case 'weekly-prep':\n        // Feature 7: Weekly Recap\n        return <WeeklyPrepView\n          setView={setView}\n          commitmentData={commitmentData}\n          updateCommitmentData={updateCommitmentData}\n          userCommitments={userCommitments}\n        />;\n      case 'scorecard':\n      default:\n        return (\n          <div className=\"p-8\">\n            <h1 className=\"text-3xl font-extrabold text-[#002E47] mb-6\">Daily Reps Scorecard</h1>\n            <p className=\"text-lg text-gray-600 mb-8 max-w-3xl\">Track your daily commitment to the non-negotiable leadership actions (**reps**) that reinforce your professional identity. **Consistency over intensity** is the key to sustained executive growth.</p>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              <div className='lg:col-span-2'>\n                \n                {/* Daily Target Rep Card (Features 1, 2, 6, 8) */}\n                <DailyRepTargetCard\n                    targetRep={dailyTargetRep}\n                    microTip={microTipText}\n                    identityStatement={identityStatement}\n                    // CRITICAL: Wires the log button to complete the FIRST active commitment (the target rep)\n                    handleLogTargetRep={() => handleLogCommitment(userCommitments?.[0]?.id, 'Committed')} \n                />\n                \n                <div className=\"mb-6 flex justify-between items-center\">\n                  <h3 className=\"text-2xl font-extrabold text-[#002E47]\">\n                    Active Reps ({userCommitments.length})\n                  </h3>\n                  <div className='flex space-x-2'>\n                    <button \n                        onClick={() => setViewMode(viewMode === 'status' ? 'tier' : 'status')}\n                        className={`px-3 py-1 text-sm font-medium rounded-full border transition-all flex items-center gap-1 ${viewMode === 'tier' ? 'bg-[#47A88D] text-white border-[#47A88D]' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}\n                    >\n                        <List className='w-4 h-4' />\n                        View by {viewMode === 'status' ? 'Tier' : 'Status'}\n                    </button>\n                    <Button onClick={() => setView('selector')} variant=\"outline\" className=\"text-sm px-4 py-2\" disabled={isSaving}>\n                      <PlusCircle className=\"w-4 h-4 mr-2\" /> Manage Reps\n                    </Button>\n                  </div>\n                </div>\n\n                <Card title=\"Rep Completion Log\" icon={Target} accent='TEAL' className=\"mb-8 border-l-4 border-[#47A88D] rounded-3xl\">\n                    <div className='mb-4 flex justify-between items-center text-sm'>\n                        <div className='font-semibold text-[#002E47]'>\n                            {score.total > 0 ? `Score: ${score.committed}/${score.total} completed reps` : 'No active reps.'}\n                        </div>\n                        {score.total > 0 && (\n                            <div className={`font-bold ${isPerfectScore ? 'text-green-600' : 'text-[#E04E1B]'}`}>\n                                {score.total - score.committed} pending or missed.\n                            </div>\n                        )}\n                    </div>\n                    \n                    <div className=\"space-y-4\">\n                        {sortedCommitments.length > 0 ? (\n                            // Use sorted commitments for rendering\n                            sortedCommitments.map(c => (\n                                <CommitmentItem\n                                    key={c.id}\n                                    commitment={c}\n                                    onLogCommitment={handleLogCommitment}\n                                    onRemove={handleRemoveCommitment} // Passed down for removal functionality\n                                    isSaving={isSaving}\n                                    tierMeta={tierMeta}\n                                />\n                            ))\n                        ) : (\n                            <p className=\"text-gray-500 italic text-center py-4\">Your scorecard is empty. Click 'Manage Reps' to start building your daily practice!</p>\n                        )}\n                    </div>\n\n                  {/* Score Display (Feature 4) */}\n                  <div className=\"mt-8 pt-4 border-t border-gray-200 flex justify-between items-center\">\n                    <h3 className=\"text-2xl font-extrabold text-[#002E47]\">\n                      Daily Rep Score:\n                    </h3>\n                    <span className={`text-4xl font-extrabold p-3 rounded-xl shadow-inner min-w-[100px] text-center ${\n                      isPerfectScore ? 'text-green-600 bg-green-50' : 'text-[#002E47] bg-gray-100'\n                    }`}>\n                      {score.committed} / {score.total}\n                    </span>\n                  </div>\n                </Card>\n              </div>\n\n              <div className='lg:col-span-1 space-y-8'>\n                  {/* T1 Resilience Check */}\n                  <ResilienceTracker dailyLog={resilienceLog} handleSaveResilience={handleSaveResilience}/>\n                  \n                  {/* Social Accountability Nudge (Feature 5) */}\n                  <SocialAccountabilityNudge navigate={navigate} />\n\n                  {/* Goal Drift Indicator */}\n                  <Card \n                      title=\"Progress Risk Indicator\" \n                      icon={predictiveRisk.icon} \n                      accent={predictiveRisk.icon === TrendingDown ? 'ORANGE' : 'TEAL'}\n                      className={`border-2 shadow-2xl`}\n                  >\n                      <p className='text-sm font-semibold text-[#002E47]'>{predictiveRisk.text}</p>\n                  </Card>\n                  \n                  <TierSuccessMap tierRates={tierSuccessRates} tierMeta={tierMeta} />\n                  \n                  {/* Monthly Consistency & Streak (Feature 4) */}\n                  <Card title=\"Monthly Consistency\" icon={BarChart3} accent='TEAL' className='bg-[#47A88D]/10 border-2 border-[#47A88D]'>\n                      <p className='xs text-gray-700 mb-2'>Avg. Rep Completion Rate ({monthlyProgress.daysTracked} days)</p>\n                      <div className=\"w-full bg-gray-200 rounded-full h-4 mb-2\">\n                          <div \n                              className=\"bg-[#002E47] h-4 rounded-full transition-all duration-700\" \n                              style={{ width: `${monthlyProgress.rate}%` }}\n                          ></div >\n                      </div>\n                      <div className='flex justify-between items-center'>\n                          <p className='sm font-semibold text-[#002E47]'>Perfect Rep Streak:</p>\n                          <span className='xl font-extrabold text-green-600 flex items-center'>\n                              <Crown className='w-5 h-5 mr-1'/> {streak} Days\n                          </span>\n                      </div>\n                      <Button onClick={() => setView('weekly-prep')} variant='outline' className='w-full mt-4 xs px-4 py-2 border-[#002E47] text-[#002E47] hover:bg-[#002E47]/10'>\n                          <Activity className='w-4 h-4 mr-2'/> Weekly Rep Review\n                      </Button>\n                      <Button onClick={() => handleOpenHistoryModal(lastSevenDaysHistory[lastSevenDaysHistory.length -1])} variant='outline' className='w-full mt-2 xs px-4 py-2'>\n                          <Clock className='w-4 h-4 mr-2'/> View Last Score\n                      </Button>\n                  </Card>\n              </div>\n            </div>\n            \n            {/* Daily Reflection Section (Feature 7 / AI Bonus) */}\n            <Card title=\"Daily Reflection (The Debrief)\" icon={MessageSquare} accent='NAVY' className='mt-8 max-w-3xl border-l-4 border-[#002E47]'>\n                <p className='text-sm text-gray-700 mb-4'>\n                    {promptLoading ? (\n                        <span className='flex items-center text-[#47A88D]'>\n                             <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500 mr-2 rounded-full\"></div> Drafting prompt...\n                        </span>\n                    ) : (\n                        <span className='font-bold text-[#002E47]'>{reflectionPrompt || 'What key insight did you gained today that will improve your leadership practice tomorrow?'}</span>\n                    )}\n                </p>\n                <textarea \n                    value={reflection}\n                    onChange={(e) => setReflection(e.target.value)}\n                    className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#002E47] focus:border-[#002E47] h-32 text-gray-800\" \n                    placeholder=\"My key reflection/insight from today's practice...\"\n                ></textarea>\n                <Button onClick={handleSaveReflection} disabled={isSaving || reflection.length === 0} className='mt-4 bg-[#002E47] hover:bg-gray-700'>\n                    {isSaving ? 'Saving...' : 'Save Reflection'}\n                </Button>\n                 {isReflectionSaved && (\n                    <span className='ml-4 text-sm font-bold text-green-600 flex items-center mt-2'>\n                        <CheckCircle className='w-4 h-4 mr-1'/> Reflection Logged!\n                    </span>\n                )}\n            </Card>\n\n            <CommitmentHistoryModal \n                isVisible={isHistoryModalVisible}\n                onClose={() => setIsHistoryModalVisible(false)}\n                dayData={selectedHistoryDay}\n            />\n            \n            {/* Renders if a perfect score is just achieved (Feature 4) */}\n            {isPerfectScoreModalVisible && (\n                 <PerfectScoreModal onClose={handleClosePerfectModal} />\n            )}\n            \n            {/* RENDER NEW CHALLENGE MODAL (Feature 3) */}\n            {isChallengeModalVisible && (\n                <TwoMinuteChallengeModal\n                    isVisible={isChallengeModalVisible}\n                    onClose={() => setIsChallengeModalVisible(false)}\n                    sourceScreen={quickLog === true ? 'dashboard' : view} \n                    onLogSuccess={() => {}} // Placeholder for micro-celebration logic\n                />\n            )}\n            \n            {/* RENDER POST-LOG MICRO-ACTION PROMPT (Feature 3 momentum) */}\n            {isPostLogPromptVisible && (\n                <MicroActionPromptModal\n                    isVisible={isPostLogPromptVisible}\n                    onClose={() => setIsPostLogPromptVisible(false)}\n                    onMicroActionClick={() => {\n                        setIsPostLogPromptVisible(false); // Close prompt\n                        handleOpenChallengeModal(); // Open the main challenge modal\n                    }}\n                />\n            )}\n            \n          </div>\n        );\n    }\n  }; // <-- CLOSES the renderView function\n\n  // CRITICAL FIX: The main component MUST return its content to render.\n  return renderView();\n} // <-- CLOSES the DailyPracticeScreen function","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/DevPlan.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'copyToClipboard' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":97,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'growthDimensions' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":206,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":206,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":305,"column":43,"nodeType":"Identifier","endLine":305,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":306,"column":33,"nodeType":"Identifier","endLine":306,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":307,"column":39,"nodeType":"Identifier","endLine":307,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":324,"column":32,"nodeType":"Identifier","endLine":324,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'mockDetail'. Either include it or remove the dependency array.","line":324,"column":58,"nodeType":"ArrayExpression","endLine":324,"endColumn":114,"suggestions":[{"desc":"Update the dependencies array to be: [mockDetail]","fix":{"range":[20170,20226],"text":"[mockDetail]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":337,"column":5,"nodeType":"Identifier","endLine":337,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'currentMonth' is defined but never used.","line":414,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":414,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'saveNewPlan' is defined but never used.","line":454,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":454,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":454,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":454,"endColumn":73},{"ruleId":"no-unused-vars","severity":1,"message":"'isLoading' is defined but never used.","line":881,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":881,"endColumn":60},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":881,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":881,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'genericPlan' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1024,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":1024,"endColumn":22}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/DevPlan.jsx\n\nimport { Home, Settings, Zap, Clock, Briefcase, Mic, Trello, BookOpen, BarChart3, TrendingUp, TrendingDown, CheckCircle, Star, Target, Users, HeartPulse, CornerRightUp, X, ArrowLeft, Activity, Link, Lightbulb, AlertTriangle, Eye, PlusCircle, Cpu, MessageSquare, Check, Calendar, Dumbbell, Send, Send as ShareIcon } from 'lucide-react';\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n\n// --- SERVICES (production) ---\nimport { useAppServices } from '../../services/useAppServices.jsx';\n\n/* =========================================================\n   HIGH-CONTRAST PALETTE (Centralized for Consistency)\n========================================================= */\nconst COLORS = {\n  NAVY: '#002E47',      \n  TEAL: '#47A88D',      \n  SUBTLE_TEAL: '#349881', \n  ORANGE: '#E04E1B',    \n  GREEN: '#47A88D',      // NO GREEN! Use corporate teal\n  AMBER: '#E04E1B',      // NO AMBER! Use corporate orange\n  RED: '#E04E1B',\n  LIGHT_GRAY: '#FCFCFA',\n  OFF_WHITE: '#FFFFFF', \n  SUBTLE: '#47A88D',     // Use teal for subtle borders\n  TEXT: '#002E47',\n  MUTED: '#349881',      // Use subtle teal for muted\n  BLUE: '#002E47',       // NO BLUE! Use corporate navy\n  BG: '#FCFCFA',         // Use corporate light gray\n  PURPLE: '#47A88D',     // NO PURPLE! Use corporate teal\n};\n\n// Mock UI components (Standardized)\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', ...rest }) => {\n  let baseStyle = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-xl focus:outline-none focus:ring-4 text-white flex items-center justify-center\";\n  if (variant === 'primary') { baseStyle += ` bg-[${COLORS.TEAL}] hover:bg-[${COLORS.SUBTLE_TEAL}] focus:ring-[${COLORS.TEAL}]/50`; }\n  else if (variant === 'secondary') { baseStyle += ` bg-[${COLORS.ORANGE}] hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`; }\n  else if (variant === 'outline') { baseStyle = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[${COLORS.TEAL}]/10 focus:ring-4 focus:ring-[${COLORS.TEAL}]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-center`; }\n  else if (variant === 'nav-back') { baseStyle = `px-4 py-2 rounded-lg font-medium transition-all shadow-sm border-2 border-gray-300 text-gray-700 hover:bg-gray-100 flex items-center justify-center`; }\n  if (disabled) { baseStyle = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\"; }\n  return (\n    <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>\n      {children}\n    </button>\n  );\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n  const handleKeyDown = (e) => {\n    if (!interactive) return;\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      onClick?.();\n    }\n  };\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={handleKeyDown}\n      className={`relative p-6 rounded-2xl border-2 shadow-2xl transition-all duration-300 text-left ${className}`}\n      style={{ background: 'linear-gradient(180deg,#FFFFFF,#F9FAFB)', borderColor: COLORS.SUBTLE, color: COLORS.TEXT }}\n      onClick={onClick}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n\n      {Icon && (\n        <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n          <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n        </div>\n      )}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\n\n// --- Tooltip Component ---\nconst Tooltip = ({ content, children }) => {\n    const [isVisible, setIsVisible] = useState(false);\n    return (\n        <div\n            className=\"relative inline-block\"\n            onMouseEnter={() => setIsVisible(true)}\n            onMouseLeave={() => setIsVisible(false)}\n        >\n            {children}\n            {isVisible && (\n                <div className=\"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2\">\n                    {content}\n                    <div className=\"absolute left-1/2 transform -translate-x-1/2 bottom-[-4px] w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#002E47]\"></div>\n                </div>\n            )}\n        </div>\n    );\n};\nconst copyToClipboard = (text) => {\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text)\n            .then(() => console.log('Content copied to clipboard via modern API!'))\n            .catch(err => console.error('Could not copy text: ', err));\n    } else {\n        const el = document.createElement('textarea');\n        el.value = text;\n        document.body.appendChild(el);\n        el.select();\n        document.execCommand('copy');\n        document.body.removeChild(el);\n        console.log('Content copied to clipboard via fallback!');\n    }\n};\nconst mdToHtml = async (md) => {\n    let html = md;\n    html = html.replace(/## (.*$)/gim, '<h2 class=\"text-2xl font-extrabold text-[#E04E1B] mb-3\">$1</h2>');\n    html = html.replace(/### (.*$)/gim, '<h3 class=\"text-xl font-bold text-[#47A88D] mt-4 mb-2\">$1</h3>');\n    html = html.replace(/\\*\\*(.*)\\*\\*/gim, '<strong>$1</strong>');\n    html = html.split('\\n').map(line => line.trim()).filter(line => line.length > 0).map(line => {\n        if (line.startsWith('<ul>') || line.startsWith('<li>') || line.startsWith('<h') || line.startsWith('<s')) return line;\n        return `<p class=\"text-sm text-gray-700\">${line}</p>`;\n    }).join('');\n    html = html.replace(/<p><\\/p>/g, ''); \n    html = html.replace(/<ul>/g, '<ul><li class=\"text-sm text-gray-700\">').replace(/<\\/li>/g, '</li></ul>');\n    return html;\n};\nconst IconMap = {\n    Zap: Zap, Users: Users, Briefcase: Briefcase, Target: Target, BarChart3: BarChart3, Clock: Clock, Eye: Eye, BookOpen: BookOpen, Lightbulb: Lightbulb, X: X, ArrowLeft: ArrowLeft, CornerRightUp: CornerRightUp, AlertTriangle: AlertTriangle, CheckCircle: CheckCircle, PlusCircle: PlusCircle, Cpu: Cpu, Star: Star, Mic: Mic, Trello: Trello, Settings: Settings, Home: Home, MessageSquare: MessageSquare, Check: Check, Calendar: Calendar, HeartPulse: HeartPulse, TrendingUp: TrendingUp, TrendingDown: TrendingDown, Activity: Activity, Link: Link, Dumbbell: Dumbbell\n};\n\n// --- PDP Utility & Plan Generation ---\nconst LEADERSHIP_TIERS = {\n    T1: { id: 'T1', name: 'Lead Self & Mindsets', icon: 'HeartPulse', color: 'indigo-500' },\n    T2: { id: 'T2', name: 'Lead Work & Execution', icon: 'Briefcase', color: 'green-600' },\n    T3: { id: 'T3', name: 'Lead People & Coaching', icon: 'Users', color: 'yellow-600' },\n    T4: { id: 'T4', name: 'Conflict & Team Health', icon: 'AlertTriangle', color: 'red-640' },\n    T5: { id: 'T5', name: 'Strategy & Vision', icon: 'TrendingUp', color: 'cyan-600' },\n};\n\n// CRITICAL NEW CONSTANTS (Based on Step 2 of the prompt)\nconst ASSESSMENT_QUESTIONS = [\n    { id: 1, text: \"I have a clear sense of who I am as a leader and why I choose to lead.\", dim: \"Mindset\", courses: ['Leadership Identity', 'Motive', 'PlayerToCoach'] },\n    { id: 2, text: \"When results fall short, I take full responsibility and look first at what I can do differently.\", dim: \"Ownership\", courses: ['Ownership', 'Relationship with Boss'] },\n    { id: 3, text: \"I spend most of my time enabling others to perform rather than doing the work myself.\", dim: \"Delegation\", courses: ['PlayerToCoach', 'Delegation', 'Coaching'] },\n    { id: 4, text: \"My team has clear, measurable goals and knows what success looks like each week.\", dim: \"Execution\", courses: ['Goals', 'Metrics', 'Expectations'] },\n    { id: 5, text: \"I consistently set and reinforce clear expectations for quality, timelines, and ownership.\", dim: \"Clarity\", courses: ['Expectations', 'Feedback', 'Meetings'] },\n    { id: 6, text: \"I regularly give reinforcing and redirecting feedback that helps people grow.\", dim: \"Clarity\", courses: ['Feedback', 'Coaching', 'Recognition'] },\n    { id: 7, text: \"Decisions on my team are made efficiently, with the right people involved and clear follow-through.\", dim: \"Execution\", courses: ['DecisionMaking', 'Meetings', 'Accountability'] },\n    { id: 8, text: \"I intentionally model openness and vulnerability to build trust within my team.\", dim: \"Trust\", courses: ['VBTrust', 'OneOnOnes'] },\n    { id: 9, text: \"My team handles conflict directly and constructively, even when it’s uncomfortable.\", dim: \"TeamHealth\", courses: ['Conflict', 'Commitment', 'Accountability', 'CrucialConversations'] },\n    { id: 10, text: \"I frequently recognize and celebrate progress and contributions in meaningful ways.\", dim: \"Recognition\", courses: ['Recognition', 'Motivation', 'Coaching'] },\n];\n\nconst CONTENT_LIBRARY = [\n    // This is now the fallback library, but is complete for the generator function\n    { skill: 'Leadership Identity', type: 'Tool', duration: 45, tier: 'T1', title: 'Defining Your Leadership Identity (LIS)', difficulty: 'Mastery' },\n    { skill: 'Motive', type: 'Reading', duration: 30, tier: 'T1', title: 'Leadership Motive - Servant Leadership Primer', difficulty: 'Intro' },\n    { skill: 'PlayerToCoach', type: 'Exercise', duration: 60, tier: 'T1', title: 'Player-to-Coach Delegation Framework', difficulty: 'Core' },\n    { skill: 'Ownership', type: 'Case Study', duration: 50, tier: 'T1', title: 'Ownership and Accountability Audit', difficulty: 'Core' },\n    { skill: 'Relationship with Boss', type: 'Reading', duration: 30, tier: 'T1', title: 'Relationship with Boss: Managing Upward', difficulty: 'Intro' },\n    { skill: 'VBTrust', type: 'Reading', duration: 40, tier: 'T3', title: 'Leading the Way: Go 1st with V-B Trust', difficulty: 'Intro' },\n    { skill: 'Goals', type: 'Exercise', duration: 60, tier: 'T2', title: 'Goals & OKR Prioritization Workshop', difficulty: 'Mastery' },\n    { skill: 'Expectations', type: 'Reading', duration: 25, tier: 'T2', title: 'Setting Clear Expectations Protocol', difficulty: 'Intro' },\n    { skill: 'Metrics', type: 'Tool', duration: 40, tier: 'T2', title: 'Leading & Lagging Metrics Dashboard Setup', difficulty: 'Core' },\n    { skill: 'Feedback', type: 'Exercise', duration: 40, tier: 'T3', title: 'Delivering Effective Feedback (Radical Candor)', difficulty: 'Core' },\n    { skill: 'Delegation', type: 'Exercise', duration: 45, tier: 'T2', title: 'Effective Delegation using Delegation Matrix', difficulty: 'Core' },\n    { skill: 'Effective Meetings', type: 'Tool', duration: 30, tier: 'T2', title: 'Effective Meetings: Decision-Focused Agenda', difficulty: 'Intro' },\n    { skill: 'DecisionMaking', type: 'Case Study', duration: 55, tier: 'T2', title: 'Decision-Making / Problem Solving Framework', difficulty: 'Mastery' },\n    { skill: 'OneOnOnes', type: 'Tool', duration: 30, tier: 'T3', title: 'Effective 1:1s: Coaching-First Structure', difficulty: 'Core' },\n    { skill: 'TeamHealth', type: 'Tool', duration: 40, tier: 'T4', title: 'Team Health: Consensual Commitment Framework', difficulty: 'Core' },\n    { skill: 'Conflict', type: 'Exercise', duration: 30, tier: 'T4', title: 'Conflict Management Style Quiz & Strategy', difficulty: 'Core' },\n    { skill: 'Commitment', type: 'Tool', duration: 40, tier: 'T4', title: 'Team Health: Consensual Commitment Framework', difficulty: 'Core' },\n    { skill: 'Accountability', type: 'Exercise', duration: 55, tier: 'T4', title: 'Team Health: Peer Accountability Implementation', difficulty: 'Mastery' },\n    { skill: 'Coaching', type: 'Role-Play', duration: 45, tier: 'T3', title: 'Practice: GROW Model Coaching Session', difficulty: 'Core' },\n    { skill: 'Recognition', type: 'Reading', duration: 25, tier: 'T3', title: 'Recognition and Motivation Principles', difficulty: 'Intro' },\n    { skill: 'Motivation', type: 'Case Study', duration: 50, tier: 'T3', title: 'Intrinsic Motivation and Team Engagement', difficulty: 'Mastery' },\n    { skill: 'CrucialConversations', type: 'Role-Play', duration: 60, tier: 'T4', title: 'Crucial Conversations / Conflict Mgmt Practice', difficulty: 'Mastery' },\n    { skill: 'Vision', type: 'Exercise', duration: 45, tier: 'T5', title: 'Vision Statement Workshop', difficulty: 'Core' },\n    { skill: 'StrategicPlanning', type: 'Tool', duration: 30, tier: 'T5', title: 'Pre-Mortem Risk Audit', difficulty: 'Mastery' },\n    { skill: 'Influence', type: 'Reading', duration: 40, tier: 'T5', title: 'Long-Range Strategic Planning Principles', difficulty: 'Intro' },\n    { skill: 'Accountability', type: 'Reading', duration: 25, tier: 'T4', title: 'Article: The Link Between Ownership and Trust', difficulty: 'Intro', id: '408' },\n    { skill: 'Delegation', type: 'Tool', duration: 35, tier: 'T2', title: 'Delegation Audit & Follow-up Checklist', difficulty: 'Core', id: '215' },\n    { skill: 'Vision', type: 'Tool', duration: 30, tier: 'T5', title: 'Vision Alignment Diagnostic', difficulty: 'Core', id: '507' },\n    { skill: 'Conflict', type: 'Case Study', duration: 55, tier: 'T4', title: 'Case: Mediating Personality Clashes', difficulty: 'Mastery', id: '411' },\n];\n\n\nconst generatePlanData = (assessment, ownerUid, contentLibrary) => {\n    const { selfRatings, overallConfidence, openEndedGoal } = assessment;\n\n    // 1. SCORING & PRIORITIZATION\n    const dimScores = {}; \n    const dimCounts = {}; \n    \n    ASSESSMENT_QUESTIONS.forEach(q => {\n        const score = selfRatings[q.id]; \n        dimScores[q.dim] = (dimScores[q.dim] || 0) + score;\n        dimCounts[q.dim] = (dimCounts[q.dim] || 0) + 1;\n    });\n\n    const finalScores = Object.keys(dimScores).map(dim => ({\n        dimension: dim,\n        score: dimScores[dim] / dimCounts[dim],\n        relatedCourses: ASSESSMENT_QUESTIONS.filter(q => q.dim === dim).flatMap(q => q.courses)\n    }));\n\n    // Identify Top 3 Growth Areas (lowest scores)\n    const growthDimensions = finalScores\n        .sort((a, b) => a.score - b.score) \n        .slice(0, 3) \n        .map(d => d.dimension);\n    \n    // 2. COURSE MAPPING AND SEQUENCING (6 x 90-day blocks)\n    const fullPlan = [];\n    const usedContentIds = new Set();\n    const trainingBlocks = [\n        // Q1: Foundation Focus\n        { tier: 'T1', theme: 'Feedback & Trust Foundation', primarySkills: ['Feedback', 'VBTrust', 'PlayerToCoach'] },\n        // Q2: Structure Focus\n        { tier: 'T2', theme: 'Execution, Goals & Expectations', primarySkills: ['Goals', 'Delegation', 'Expectations'] },\n        // Q3: Delegation Focus\n        { tier: 'T3', theme: 'Coaching & Empowerment', primarySkills: ['Coaching', 'OneOnOnes', 'Delegation'] },\n        // Q4: Health Focus\n        { tier: 'T4', theme: 'Conflict Resolution & Commitment', primarySkills: ['Conflict', 'Commitment', 'CrucialConversations'] },\n        // Q5: Advanced Systems\n        { tier: 'T2', theme: 'Systemization and Decision Making', primarySkills: ['Metrics', 'DecisionMaking', 'Effective Meetings'] },\n        // Q6: Capstone\n        { tier: 'T5', theme: 'Visionary Leadership & Synthesis', primarySkills: ['Vision', 'StrategicPlanning', 'Influence'] },\n    ];\n    \n    // Logic to select content and assign difficulty/duration\n    const getTargetDifficulty = (rating) => rating >= 4.5 ? 'Mastery' : rating >= 3.5 ? 'Core' : 'Intro';\n    const adjustDuration = (rating, duration) => {\n        if (rating >= 4.5) return Math.round(duration * 0.8); \n        if (rating <= 2.5) return Math.round(duration * 1.2); \n        return duration;\n    };\n    \n    for (let cycle = 1; cycle <= 6; cycle++) { \n        const blockDef = trainingBlocks[cycle - 1];\n        const primaryTier = blockDef.tier;\n        // Use the initial assessment Q score as a proxy for the Tier's self-rating\n        const currentRating = selfRatings[cycle] || 3; \n        const targetDifficulty = getTargetDifficulty(currentRating);\n        const maxContent = currentRating <= 3 ? 6 : 4; \n\n        const requiredContent = [];\n        \n        // 1. Filter Content Pool: Prioritize items matching the cycle's primary skills\n        let pool = (contentLibrary || CONTENT_LIBRARY).filter(item => blockDef.primarySkills.includes(item.skill));\n        \n        // Ensure a variety of types (Tool, Exercise, Reading, Case Study, Role-Play)\n        pool.sort((a, b) => {\n            const order = { 'Tool': 1, 'Exercise': 2, 'Role-Play': 3, 'Reading': 4, 'Case Study': 5, 'Coaching': 6, 'Video': 7 };\n            return (order[a.type] || 9) - (order[b.type] || 9);\n        });\n\n        // 2. Assign dynamic number of items (up to maxContent)\n        let count = 0;\n        for (const item of pool) {\n            if (count < maxContent && !usedContentIds.has(item.skill)) { \n                requiredContent.push({\n                    id: item.skill, \n                    title: item.title || `Module: ${item.skill}`,\n                    type: item.type,\n                    skill: item.skill,\n                    duration: adjustDuration(currentRating, item.duration),\n                    difficulty: targetDifficulty,\n                    status: 'Pending',\n                    dateCompleted: null, \n                });\n                usedContentIds.add(item.skill);\n                count++;\n            }\n        }\n        \n        fullPlan.push({\n            month: cycle, \n            tier: primaryTier,\n            theme: blockDef.theme,\n            requiredContent: requiredContent,\n            status: 'Pending',\n            reflectionText: '',\n            monthCompletedDate: null,\n            totalDuration: requiredContent.reduce((sum, item) => sum + item.duration, 0),\n            briefingText: '', \n        });\n    }\n\n    return {\n        ownerUid,\n        assessment: { ...assessment, selfRatings: selfRatings, overallConfidence, openEndedGoal },\n        plan: fullPlan,\n        currentMonth: 1, \n        progressScans: [], // Initialize the history array for 90-day checkpoints\n        latestScenario: null,\n        lastUpdate: new Date().toISOString(),\n        leadershipProfile: finalScores\n    };\n};\n\n\n// --- Component 4: PDP Content Details Modal ---\nconst ContentDetailsModal = ({ isVisible, onClose, content }) => { \n    if (!isVisible || !content) return null;\n    \n    const [htmlContent, setHtmlContent] = useState('');\n    const [rating, setRating] = useState(0); \n    const [isLogging, setIsLogging] = useState(false);\n    \n    const tierData = LEADERSHIP_TIERS[content.tier] || { name: 'Unknown Tier' };\n\n    const MOCK_CONTENT_DETAILS_FINAL = {\n        Reading: (title, skill) => `## Reading: ${title}\\n### Focus: ${skill}\\nThis is a reading module focusing on ${skill} theory.`,\n        Exercise: (title, skill) => `## Exercise: ${title}\\n### Focus: ${skill}\\nThis is a practical exercise for skill ${skill}.`,\n        'Role-Play': (title, skill) => `## Role-Play: ${title}\\n### Focus: ${skill}\\nThis is a simulation for skill ${skill}.`, \n        CaseStudy: (title, skill) => `## Executive Analysis: ${title}\\n### Focus: ${skill}\\nThis is a case study analysis for skill ${skill}.`,\n        Tool: (title, skill) => `## Tool Implementation: ${title}\\n### Focus: ${skill}\\nThis is a tool implementation module for skill ${skill}.`,\n        Coaching: (title, skill) => `## AI Coaching Lab: ${title}\\n### Focus: ${skill}\\nThis is an AI coaching session for skill ${skill}.`,\n    };\n\n    const mockDetail = MOCK_CONTENT_DETAILS_FINAL[content.type]\n        ? MOCK_CONTENT_DETAILS_FINAL[content.type](content.title, content.skill)\n        : `## Content Unavailable\\n\\nNo detailed content available for **${content.title}** (Type: ${content.type}).`;\n\n    const memoizedMockDetail = useMemo(() => mockDetail, [content.id, content.tier, content.title, content.skill]); \n    \n    const handleLogLearning = async () => {\n        if (rating === 0) { console.log('Please provide a 5-star rating before logging.'); return; }\n        setIsLogging(true);\n        console.log(`Mock: Logging learning for ${content.title} with rating ${rating}/5.`);\n        await new Promise(r => setTimeout(r, 800));\n        console.log(`Learning logged! Your ${rating}/5 rating will influence future plan revisions.`);\n        // NOTE: In a real app, you would dispatch a data update here to log learning progress.\n        setIsLogging(false);\n        onClose();\n    };\n\n    useEffect(() => {\n        let isCancelled = false;\n        setHtmlContent('');\n        setRating(0);\n\n        (async () => {\n            const html = await mdToHtml(memoizedMockDetail);\n            if (!isCancelled) {\n                setHtmlContent(html);\n            }\n        })();\n\n        return () => {\n            isCancelled = true;\n        };\n    }, [memoizedMockDetail]);\n    \n    return (\n        <div className=\"fixed inset-0 bg-[#002E47]/80 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto p-8\">\n                <div className=\"flex justify-between items-start border-b pb-4 mb-6\">\n                    <h2 className=\"text-3xl font-extrabold text-[#002E47] flex items-center\">\n                        <BookOpen className=\"w-8 h-8 mr-3 text-[#47A88D]\" />\n                        {content.title} ({content.type})\n                    </h2>\n                    <button onClick={onClose} className=\"p-2 text-gray-500 hover:text-[#E04E1B] transition-colors\">\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n                <div className=\"mb-6 text-sm flex space-x-4 border-b pb-4\">\n                    <p className=\"text-gray-700 font-semibold\">Tier: <span className='text-[#002E47]'>{tierData.name}</span></p>\n                    <p className=\"text-gray-700 font-semibold\">Skill Focus: <span className='text-[#002E47]'>{content.skill}</span></p>\n                    <p className=\"text-gray-700 font-semibold\">Est. Duration: <span className='text-[#002E47]'>{content.duration} min</span></p>\n                </div>\n                <div className=\"prose max-w-none text-gray-700\">\n                    {htmlContent ? (\n                        <div dangerouslySetInnerHTML={{ __html: htmlContent }} />\n                    ) : (\n                        <p className='text-gray-500 flex items-center'>\n                            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500 mr-2\"></div>\n                            Loading content details...\n                        </p>\n                    )}\n                </div>\n                <div className='mt-8 pt-6 border-t border-gray-200'>\n                    <h3 className='text-lg font-bold text-[#002E47] mb-3 flex items-center'>\n                        <Star className=\"w-5 h-5 mr-2 text-[#E04E1B]\" />\n                        Review & Log Learning\n                    </h3>\n                    <p className=\"text-sm text-gray-700 mb-4\">\n                        Rate the content's quality and helpfulness. This feedback loop helps the AI personalize future modules.\n                    </p>\n                    <div className='flex items-center space-x-4 mb-4'>\n                        <div className='flex space-x-1'>\n                            {[1, 2, 3, 4, 5].map((star) => (\n                                <Star\n                                    key={star}\n                                    className={`w-6 h-6 cursor-pointer transition-colors ${\n                                        star <= rating ? 'text-yellow-500 fill-yellow-500' : 'text-gray-300'\n                                    }`}\n                                    onClick={() => setRating(star)}\n                                />\n                            ))}\n                        </div>\n                        <span className='text-md font-semibold text-[#002E47]'>{rating > 0 ? `${rating}/5 Stars` : 'Rate Content'}</span>\n                    </div>\n                    <Button onClick={handleLogLearning} disabled={isLogging || rating === 0} className='w-full'>\n                        {isLogging ? 'Logging...' : 'Log Learning & Submit Rating'}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n// --- Component 3: Roadmap Timeline View (Unchanged) ---\nconst RoadmapTimeline = ({ data, currentMonth, navigateToMonth, viewMonth }) => {\n    return (\n        <Card title=\"24-Month Roadmap Timeline\" icon={Trello} accent=\"PURPLE\" className='lg:sticky lg:top-4 bg-white shadow-2xl border-l-4 border-[#7C3AED]'>\n            <p className='text-sm text-gray-600 mb-4'>Review your full two-year journey. Click a month to review its content and reflection.</p>\n            <div className='max-h-96 overflow-y-auto space-y-2 pr-2'>\n                {data.plan.map(monthData => {\n                    const isCurrentView = monthData.month === viewMonth;\n                    const isFuture = monthData.month > data.currentMonth; \n                    const isCompleted = monthData.status === 'Completed';\n                    const isClickable = true; \n\n                    return (\n                        <div key={monthData.month}\n                             className={`p-3 rounded-lg border flex justify-between items-center transition-all cursor-pointer shadow-sm\n                                         ${isCurrentView ? 'bg-[#7C3AED]/20 border-[#7C3AED] font-extrabold' : isCompleted ? 'bg-[#47A88D]/10 border-[#47A88D]' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}\n                                         ${isFuture && !isCurrentView ? 'opacity-80' : ''}` \n                             }\n                             onClick={() => {\n                                 if (isClickable) navigateToMonth(monthData.month); \n                             }}\n                        >\n                            <span className={`text-sm ${isCurrentView ? 'text-[#7C3AED]' : 'text-[#002E47]'}`}>\n                                **Training Month {monthData.month}**: {monthData.theme}\n                            </span>\n                            <span className=\"flex items-center space-x-1 text-xs\">\n                                <Check size={16} className={isCompleted ? 'text-green-600' : 'text-gray-400'} />\n                                <span className={isCompleted ? 'text-green-600' : 'text-gray-400'}>\n                                    {monthData.month === data.currentMonth ? 'CURRENT' : isCompleted ? 'COMPLETED' : isFuture ? 'FUTURE' : 'PENDING'}\n                                </span>\n                            </span>\n                        </div>\n                    );\n                })}\n            </div>\n        </Card>\n    );\n};\n\n\n// --- Component 2: Tracker Dashboard View ---\nconst TrackerDashboardView = ({ data, updatePdpData, saveNewPlan, userId, navigate }) => {\n    const [viewMonth, setViewMonth] = useState(data.currentMonth); \n    const currentMonth = data.currentMonth;\n    \n    const monthPlan = useMemo(() => data.plan.find(m => m.month === viewMonth), [data.plan, viewMonth]);\n    \n    const isCurrentView = viewMonth === currentMonth; \n    const isPastOrCurrent = viewMonth <= currentMonth; \n    \n    const assessment = data.assessment;\n\n    const [localReflection, setLocalReflection] = useState(monthPlan?.reflectionText || '');\n    const [isSaving, setIsSaving] = useState(false);\n    const [briefing, setBriefing] = useState(monthPlan?.briefingText || null); \n    const [briefingLoading, setBriefingLoading] = useState(false);\n    \n    const [isContentModalVisible, setIsContentModalVisible] = useState(false);\n    const [selectedContent, setSelectedContent] = useState(null);\n\n    const [togglingIds, setTogglingIds] = useState(() => new Set());\n\n    const { callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = useAppServices(); \n\n    // --- Handlers ---\n    const handleContentStatusToggle = useCallback((contentId) => {\n        if (!isCurrentView) return; \n        updatePdpData(oldData => {\n            const updatedContent = monthPlan.requiredContent.map(item =>\n                item.id === contentId ? { \n                    ...item, \n                    status: item.status === 'Completed' ? 'Pending' : 'Completed',\n                    dateCompleted: item.status === 'Completed' ? null : new Date().toISOString(), // NEW: Completion Timestamp\n                } : item\n            );\n            const updatedPlan = oldData.plan.map(m =>\n                m.month === currentMonth ? { ...m, requiredContent: updatedContent } : m\n            );\n            return { ...oldData, plan: updatedPlan };\n        });\n    }, [isCurrentView, updatePdpData, monthPlan, currentMonth]);\n\n    const toggleContent = useCallback((id) => {\n        if (!isPastOrCurrent) return; \n        setTogglingIds(prev => { const n = new Set(prev); n.add(id); return n; });\n        handleContentStatusToggle(id);\n        setTimeout(() => {\n            setTogglingIds(prev => { const n = new Set(prev); n.delete(id); return n; });\n        }, 400);\n    }, [isPastOrCurrent, handleContentStatusToggle]);\n\n    const fetchMonthlyBriefing = useCallback(async (plan, assessment) => {\n        if (briefingLoading || !hasGeminiKey() || !plan || !assessment || !isCurrentView) return;\n        \n        if (plan.briefingText || briefing) {\n            setBriefing(plan.briefingText || briefing);\n            return;\n        }\n\n        setBriefingLoading(true);\n        const currentTier = LEADERSHIP_TIERS[plan.tier];\n        const rating = assessment.selfRatings?.[currentTier] || 5; \n\n        const systemPrompt = `You are a concise Executive Coach. Analyze the user's current Roadmap phase (fitness training). Given their focus tier (${currentTier.name}) and their initial self-rating (${rating}/10), provide: 1) A 1-sentence **Executive Summary** of the goal (the rep/skill). 2) A 1-sentence **Coaching Nudge** on how to prioritize the month's learning based on their skill gap. Use bold markdown for key phrases.`;\n\n        const userQuery = `Generate a monthly briefing for the user's current focus: ${plan.theme}. Required content/reps includes: ${plan.requiredContent.map(c => c.title).join(', ')}.`;\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: GEMINI_MODEL,\n            };\n            const result = await callSecureGeminiAPI(payload);\n            const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n            \n            if (text && text !== briefing) {\n                setBriefing(text);\n            }\n\n        } catch (e) {\n            setBriefing(\"AI coach unavailable. Focus on completing your required content first.\");\n        } finally {\n            setBriefingLoading(false);\n        }\n    }, [briefingLoading, hasGeminiKey, callSecureGeminiAPI, isCurrentView, briefing, GEMINI_MODEL]);\n\n\n    const handleCompleteMonth = async () => {\n        // Check if this month is the end of a 90-day block (Month 3, 6, 9, etc.)\n        const is90DayCheckPoint = currentMonth % 3 === 0;\n\n        setIsSaving(true);\n        const briefingToSave = briefing ? briefing.replace('## Monthly Executive Briefing', '## Saved Executive Briefing') : '';\n        \n        await updatePdpData(oldData => {\n            const updatedPlan = oldData.plan.map(m => \n                m.month === oldData.currentMonth ? { \n                    ...m, \n                    status: 'Completed', \n                    reflectionText: localReflection, \n                    monthCompletedDate: new Date().toISOString(),\n                    briefingText: briefingToSave, \n                } : m\n            );\n            return { \n                ...oldData, \n                plan: updatedPlan, \n                currentMonth: oldData.currentMonth + 1 \n            };\n        });\n        setIsSaving(false);\n        \n        if (is90DayCheckPoint) {\n            // CRITICAL: Navigate back to the assessment generator review screen to re-run the assessment\n            navigate('prof-dev-plan-review'); // Navigate to a review/re-assessment screen\n        } else {\n            setViewMonth(currentMonth + 1);\n            window.scrollTo(0, 0); \n        }\n    };\n\n    // FIX: Implement robust plan clearing logic here.\n    const handleResetPlan = async () => {\n        // CRITICAL: Save a minimum, empty data structure to the document to clear the old plan's existence.\n        setIsSaving(true);\n        try {\n            await updatePdpData({ \n                plan: [], \n                assessment: null, \n                currentMonth: 1, \n                progressScans: [], \n                latestScenario: null, \n                lastUpdate: new Date().toISOString() \n            });\n            // After data is cleared, navigate to the generator screen.\n            navigate('prof-dev-plan');\n            window.scrollTo(0,0); \n        } catch(e) {\n            console.error(\"Failed to reset plan:\", e);\n            alert(\"Failed to reset plan data. Check database permissions or refresh the page manually.\");\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    const handleOpenContentModal = (contentItem) => { setSelectedContent(contentItem); setIsContentModalVisible(true); };\n\n    const handleSaveReflection = () => {\n        if (!isCurrentView || localReflection === monthPlan?.reflectionText || localReflection.length === 0) return;\n\n        setIsSaving(true);\n        updatePdpData(oldData => {\n            const updatedPlan = oldData.plan.map(m =>\n                m.month === currentMonth ? { ...m, reflectionText: localReflection } : m\n            );\n            \n            // NEW FEATURE: Save the current assessment answers as a historical 'Progress Scan'\n            const newProgressScan = {\n                cycle: Math.ceil(currentMonth / 3), // Cycle 1, 2, 3, etc.\n                month: currentMonth,\n                date: new Date().toISOString(),\n                // NOTE: Use the current assessment scores for the snapshot\n                // Mapping the 10 questions' Likert scores to the dimensions for historical comparison\n                scores: oldData.assessment.selfRatings, \n                reflection: localReflection,\n            };\n\n            return { \n                ...oldData, \n                plan: updatedPlan,\n                // Append the scan to a new historical array\n                progressScans: [...(oldData.progressScans || []), newProgressScan] \n            };\n        }).then(() => {\n            setIsSaving(false);\n            console.log(\"Reflection and Progress Scan Snapshot Saved.\");\n        }).catch((e) => {\n             console.error(\"Reflection Save Failed:\", e);\n             setIsSaving(false);\n        });\n    };\n    \n    // Effects simplified for this context\n    useEffect(() => { setLocalReflection(monthPlan?.reflectionText || ''); setBriefing(monthPlan?.briefingText || null); setBriefingLoading(false); window.scrollTo(0, 0); }, [monthPlan]);\n    useEffect(() => { if (monthPlan && assessment && isCurrentView && !monthPlan.briefingText && !briefingLoading) { fetchMonthlyBriefing(monthPlan, assessment); } }, [monthPlan, assessment, fetchMonthlyBriefing, isCurrentView, briefingLoading]);\n    \n    \n    // --- Data Calculation (Ensuring safety for current/future/past logic) ---\n    const currentTierId = monthPlan?.tier;\n    const selfRating = assessment?.selfRatings?.[currentTierId] || 5; \n    const lowRatingFlag = currentTierId && selfRating <= 4;\n    const allContentCompleted = monthPlan?.requiredContent?.every(item => item.status === 'Completed');\n    const isReadyToComplete = allContentCompleted && localReflection.length >= 50;\n    const requiredContent = monthPlan?.requiredContent || [];\n    const totalDuration = data.plan.reduce((sum, m) => sum + m.totalDuration, 0);\n    const completedDuration = data.plan.filter(m => m.month < currentMonth).reduce((sum, m) => sum + m.totalDuration, 0);\n    const progressPercentage = totalDuration > 0 ? Math.round((completedDuration / totalDuration) * 100) : 0;\n    const TierIcon = IconMap[LEADERSHIP_TIERS[currentTierId]?.icon || 'Target'];\n    const completedItems = requiredContent.filter(item => item.status === 'Completed').length;\n    const tierProgress = { overallPercentage: requiredContent.length > 0 ? Math.round((completedItems / requiredContent.length) * 100) : 0, completedContent: completedItems, totalContent: requiredContent.length }; \n    const safeBriefing = briefingLoading && isCurrentView ? 'Loading AI Briefing...' : (typeof briefing === 'string' ? briefing : 'Historical briefing unavailable.');\n\n\n    return (\n        <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n            <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.PURPLE+'30'}}>\n                <Dumbbell className='w-10 h-10' style={{color: COLORS.PURPLE}}/>\n                <h1 className=\"text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Development Roadmap Tracker</h1>\n            </div>\n\n            {/* Progress Bar & Header */}\n            <Card title={`Roadmap Progress: Training Month ${currentMonth} of 24`} icon={Clock} accent='NAVY' className=\"bg-[#002E47]/10 border-4 border-[#002E47]/20 mb-8\">\n                <div className=\"w-full bg-gray-200 rounded-full h-4 mb-2\">\n                    <div\n                        className=\"bg-[#47A88D] h-4 rounded-full transition-all duration-700\"\n                        style={{ width: `${progressPercentage}%` }}\n                    ></div>\n                </div>\n                <p className='text-sm font-medium text-[#002E47]'>\n                    {Math.round(progressPercentage)}% Complete. Next Tier Focus in {4 - ((currentMonth - 1) % 4)} months.\n                </p>\n                <div className='flex space-x-4 mt-4'>\n                    <Button onClick={handleResetPlan} variant='outline' className='text-xs px-4 py-2 text-[#E04E1B] border-[#E04E1B]/50 hover:bg-[#E04E1B]/10'>\n                        Start Over / Re-Run Assessment\n                    </Button>\n                    <Button onClick={() => console.log('Share')} variant='outline' className='text-xs px-4 py-2 border-[#002E47] text-[#002E47] hover:bg-[#002E47]/10'>\n                        <ShareIcon className=\"w-4 h-4 mr-1\" /> Share Monthly Focus\n                    </Button>\n                </div>\n            </Card>\n\n            {/* Current Month Plan */}\n            <div className='lg:grid lg:grid-cols-4 lg:gap-8'>\n                \n                <div className='lg:col-span-1 space-y-8 order-1'>\n                    <RoadmapTimeline data={data} currentMonth={currentMonth} navigateToMonth={setViewMonth} viewMonth={viewMonth} />\n                    \n                    <Card title={`Tier Mastery Status (${currentTierId})`} icon={Star} accent='NAVY' className='bg-[#FCFCFA] border-l-4 border-[#002E47] text-center'>\n                         <div className=\"relative w-32 h-32 mx-auto mb-4\">\n                            <svg viewBox=\"0 0 36 36\" className=\"w-full h-32 h-full transform -rotate-90\">\n                                <path className=\"text-gray-300\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3.8\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                                <path className=\"text-[#47A88D]\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3.8\" strokeDasharray={`${tierProgress.overallPercentage}, 100`} d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                            </svg>\n                            <div className=\"absolute top-0 left-0 w-full h-full flex items-center justify-center\">\n                                <span className=\"text-3xl font-extrabold text-[#002E47]\">{tierProgress.overallPercentage}%</span>\n                            </div>\n                        </div>\n                        <p className='text-md font-semibold text-[#002E47] mb-1'>{tierProgress.completedContent} / {tierProgress.totalContent} Content Reps Completed</p>\n                        <p className='text-xs text-gray-600'>For Tier: **{LEADERSHIP_TIERS[currentTierId]?.name}**</p>\n                    </Card>\n\n                </div>\n\n\n                <div className='lg:col-span-3 space-y-8 order-2'>\n                    \n                    {/* VIEWING WARNINGS - THESE DISPLAY FOR FUTURE/PAST MONTHS */}\n                    {viewMonth > currentMonth && ( // Check if viewing a future month\n                        <div className='p-4 rounded-xl bg-yellow-100 border-2 border-yellow-400 shadow-md text-yellow-800 font-semibold flex items-center gap-3'>\n                            <AlertTriangle className='w-5 h-5'/> \n                            Viewing **Future Training Month {viewMonth}**. You must complete Month **{currentMonth}** before accessing this content. Content is read-only.\n                        </div>\n                    )}\n                    {!isCurrentView && isPastOrCurrent && (\n                        <div className='p-4 rounded-xl bg-gray-100 border-2 border-gray-400 shadow-md text-gray-800 font-semibold flex items-center gap-3'>\n                            <Clock className='w-5 h-5'/> \n                            Viewing **Historical Training Month {viewMonth}**. Content and Reflection are read-only.\n                        </div>\n                    )}\n\n                    {/* CONTENT CARD (Always Renders) */}\n                    <Card title={`Focus: ${monthPlan?.theme} (Training Month ${viewMonth})`} icon={TierIcon} accent='TEAL' className='border-l-8 border-[#47A88D]'>\n\n                        {/* AI Monthly Briefing (Renders for all months) */}\n                        <div className='mb-4 p-4 rounded-xl bg-[#002E47]/10 border border-[#002E47]/20'>\n                            <h3 className='font-bold text-[#002E47] mb-1 flex items-center'><Activity className=\"w-4 h-4 mr-2 text-[#47A88D]\" /> Monthly Executive Briefing</h3>\n                            {briefingLoading && isCurrentView ? (\n                                <p className='text-sm text-gray-600 flex items-center'><div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500 mr-2 rounded-full\"></div> Drafting advice...</p>\n                            ) : (\n                                <div className=\"prose max-w-none text-gray-700\">\n                                    <div dangerouslySetInnerHTML={{ __html: safeBriefing }} /> \n                                </div>\n                            )}\n                        </div>\n                        \n                        {/* Status / Difficulty (Renders for all months) */}\n                        <div className='mb-4 text-sm border-t pt-4'>\n                            <p className='font-bold text-[#002E47]'>Tier: {LEADERSHIP_TIERS[currentTierId]?.name}</p>\n                            <p className='text-gray-600'>Target Difficulty: **{selfRating >= 8 ? 'Mastery' : selfRating >= 5 ? 'Core' : 'Intro'}** (Self-Rating: {selfRating}/10)</p>\n                            {lowRatingFlag && (\n                                <p className='font-semibold mt-1 flex items-center text-[#E04E1B]'>\n                                    <AlertTriangle className='w-4 h-4 mr-1' /> HIGH RISK TIER: Prioritize Content Completion.\n                                </p>\n                            )}\n                        </div>\n\n                        <h3 className='text-xl font-bold text-[#002E47] border-t pt-4 mt-4'>Required Content Reps (Lessons)</h3>\n                        <div className='space-y-3 mt-4'>\n                            {requiredContent.map(item => {\n                                const isCompleted = item.status === 'Completed';\n                                const isToggling = togglingIds.has(item.id);\n                                // UPGRADE 2: Action button text is always \"View Content\" or \"Go to Practice\" regardless of month status\n                                const actionButtonText = (item.type === 'Role-Play' || item.type === 'Exercise' || item.type === 'Tool') ? 'Go to Practice' : 'View Content/Rep'; \n\n                                return (\n                                    <div key={item.id} className='flex items-center justify-between p-3 bg-gray-50 rounded-xl shadow-sm'>\n                                        <div className='flex flex-col'>\n                                            <p className={`font-semibold text-sm ${isCompleted && isPastOrCurrent ? 'line-through text-gray-500' : 'text-[#002E47]'}`}>\n                                                {item.title} ({item.type})\n                                                {lowRatingFlag && <span className='ml-2 text-xs text-[#E04E1B] font-extrabold'>(CRITICAL)</span>}\n                                            </p>\n                                            <p className='text-xs text-gray-600'>~{item.duration} min | Difficulty: {item.difficulty}</p>\n                                        </div>\n                                        <div className='flex space-x-2'>\n                                            <Button\n                                                onClick={() => {\n                                                    // UPGRADE 2: Allow viewing of ALL content in future, current, and past months\n                                                    handleOpenContentModal(item);\n                                                }}\n                                                className='px-3 py-1 text-xs'\n                                                variant='primary'\n                                                disabled={false} // Always enabled for viewing\n                                            >\n                                                {actionButtonText}\n                                            </Button>\n\n                                            <Button\n                                                onClick={() => toggleContent(item.id)}\n                                                className={`px-3 py-1 text-xs transition-colors duration-300 ${isToggling ? 'opacity-50' : ''}`}\n                                                variant={isCompleted ? 'secondary' : 'primary'}\n                                                // UPGRADE 2: Only enabled for the current month.\n                                                disabled={isSaving || isToggling || !isCurrentView}\n                                            >\n                                                {isToggling ? 'Updating...' : isCompleted ? 'Rep Completed ✓' : 'Mark Complete'}\n                                            </Button>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </Card>\n\n                    {/* REFLECTION AND ADVANCEMENT CARDS (Only render if current month) */}\n                    {isCurrentView && (\n                    <>\n                        <Card title=\"Monthly Reflection\" icon={Lightbulb} accent=\"NAVY\" className='bg-[#002E47]/10 border-2 border-[#002E47]/20'>\n                            <p className=\"text-gray-700 text-sm mb-4\">\n                                Reflect on the growth you achieved this month. How did the content/reps impact your daily leadership behavior? (**Minimum 50 characters required**)\n                            </p>\n                            <textarea\n                                value={localReflection} \n                                onChange={(e) => setLocalReflection(e.target.value)}\n                                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-40\"\n                                placeholder=\"My reflection (required)...\"\n                                readOnly={!isCurrentView}\n                            ></textarea>\n                            {isCurrentView && (\n                                <div className='flex justify-between items-center mt-1'>\n                                    <p className={`text-xs ${localReflection.length < 50 ? 'text-[#E04E1B]' : 'text-[#47A88D]'}`}>\n                                        {localReflection.length} / 50 characters written.\n                                    </p>\n                                    <span className={`text-xs font-semibold ${isSaving ? 'text-gray-500' : 'text-[#47A88D]'}`}>\n                                        {isSaving ? 'Saving...' : 'Reflection ready'}\n                                    </span>\n                                </div>\n                            )}\n                            {!isCurrentView && <p className='text-xs text-gray-500 mt-2'>Reflection is read-only for this month.</p>}\n                            \n                            {isCurrentView && (\n                                 <Button\n                                    onClick={handleSaveReflection}\n                                    disabled={isSaving || localReflection === monthPlan?.reflectionText || localReflection.length === 0}\n                                    className='w-full mt-4 bg-[#002E47] hover:bg-gray-700'\n                                >\n                                    {isSaving ? 'Saving Reflection...' : 'Save Reflection'}\n                                </Button>\n                            )}\n                        </Card>\n\n                        <Card title=\"Recalibrate Skill Assessment\" icon={Activity} accent='ORANGE' className='bg-[#E04E1B]/10 border-4 border-[#E04E1B]'>\n                            <p className=\"text-gray-700 text-sm mb-4\">\n                                Feel like you've mastered this tier? Re-run your initial **Self-Ratings** to check your progress and generate an **accelerated, revised roadmap** to match your new skill level.\n                            </p>\n                            <Button\n                                onClick={handleResetPlan} \n                                variant=\"secondary\"\n                                className='w-full bg-[#E04E1B] hover:bg-red-700'\n                            >\n                                <Target className='w-4 h-4 mr-2' /> Re-Run Assessment\n                            </Button>\n                        </Card>\n                        \n                        <Card title=\"Advance Roadmap\" icon={CornerRightUp} accent='TEAL' className='bg-[#47A88D]/10 border-4 border-[#47A88D]'>\n                            <p className='text-sm text-gray-700 mb-4'>\n                                Once all content and your reflection are complete, lock in your progress and move to **Training Month {currentMonth + 1}** of your Roadmap (Progressive Overload).\n                            </p>\n                            <Button\n                                onClick={handleCompleteMonth}\n                                disabled={isSaving || !isReadyToComplete}\n                                className='w-full bg-[#47A88D] hover:bg-[#349881]'\n                            >\n                                {isSaving ? 'Processing...' : `Complete Month ${currentMonth} and Advance`}\n                            </Button>\n                            {!allContentCompleted && (\n                                <p className='text-[#E04E1B] text-xs mt-2'>* Finish all content reps first.</p>\n                            )}\n                            {allContentCompleted && localReflection.length < 50 && (\n                                <p className='text-[#E04E1B] text-xs mt-2'>* Reflection required (50 chars min).</p>\n                            )}\n                        </Card>\n                    </>\n                    )} \n                </div>\n            </div>\n            \n            <ContentDetailsModal \n                isVisible={isContentModalVisible} \n                onClose={() => setIsContentModalVisible(false)} \n                content={selectedContent}\n            />\n\n        </div>\n    );\n};\n\n\n// --- Component 1: Plan Generator View ---\nconst PlanGeneratorView = ({ userId, saveNewPlan, isLoading, error, navigate, setGeneratedPlanData, generatePlanDataWrapper }) => {\n    // Assessment State Management\n    // FIX 1: Initial assessment score set to 3 (Neutral) instead of 0\n    const [assessmentAnswers, setAssessmentAnswers] = useState(ASSESSMENT_QUESTIONS.reduce((acc, q) => ({ ...acc, [q.id]: 3 }), {})); \n    const [openEndedGoal, setOpenEndedGoal] = useState('');\n    const [overallConfidence, setOverallConfidence] = useState(5);\n    const [isGenerating, setIsGenerating] = useState(false);\n    \n    // Derived State\n    const allAnswered = useMemo(() => Object.values(assessmentAnswers).every(a => a >= 1), [assessmentAnswers]);\n    const canGenerate = allAnswered && !isGenerating;\n\n    const handleAnswerChange = (qId, value) => {\n        setAssessmentAnswers(prev => ({ ...prev, [qId]: parseInt(value) }));\n    };\n\n    const handleGenerate = async () => {\n        if (!canGenerate) return;\n        setIsGenerating(true);\n\n        // 1. Map answers (Likert 1-5) to required structure\n        const selfRatings = {};\n        ASSESSMENT_QUESTIONS.forEach(q => {\n            // The score ID is the question ID (1-5)\n            selfRatings[q.id] = assessmentAnswers[q.id]; \n        });\n        \n        // 2. Compute Final Assessment Object for the Generator Utility\n        const assessment = { \n            selfRatings: selfRatings,\n            openEndedGoal: openEndedGoal,\n            overallConfidence: overallConfidence,\n            dateGenerated: new Date().toISOString(),\n        };\n\n        const newPlanData = generatePlanDataWrapper(assessment, userId);\n\n        try {\n            await saveNewPlan(newPlanData);\n            setIsGenerating(false);\n            setGeneratedPlanData({ userPlan: newPlanData, genericPlan: { totalDuration: 1200, avgIntroContent: 8, avgMasteryContent: 3 } });\n            navigate('prof-dev-plan-review'); // Redirect to review screen\n        } catch (e) {\n            setIsGenerating(false);\n            console.error('Failed to save new plan after generation.', e);\n            alert('Saving your new plan failed. Please check your connection and try again.');\n        }\n    };\n\n    return (\n        <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n            <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.PURPLE+'30'}}>\n                <Dumbbell className='w-10 h-10' style={{color: COLORS.PURPLE}}/>\n                <h1 className=\"text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Personalized Arena Assessment</h1>\n            </div>\n            <p className=\"text-lg text-gray-600 mb-8 max-w-3xl\">Apply the principle of **Progressive Overload**. Answer 10 core questions (1-5 scale) to instantly map your skill gaps and generate a 2-year Roadmap designed for accelerating growth.</p>\n\n            <div className=\"space-y-10\">\n                <Card title=\"1. Leadership Assessment (1-5 Scale)\" icon={BarChart3} accent='TEAL'>\n                    <h3 className=\"text-md font-semibold text-gray-700 mb-3\">Rate your current effectiveness (1 = Strongly Disagree, 5 = Strongly Agree):</h3>\n                    \n                    {ASSESSMENT_QUESTIONS.map(q => {\n                        const answer = assessmentAnswers[q.id] || 3; // Default display score is 3\n                        const scoreColor = answer >= 4 ? COLORS.GREEN : answer <= 2 ? COLORS.RED : COLORS.AMBER;\n\n                        return (\n                            <div key={q.id} className=\"mb-6 border p-3 rounded-lg bg-gray-50\">\n                                <p className=\"font-semibold text-[#002E47] mb-2 text-sm\">{q.id}. {q.text}</p>\n                                <div className='flex flex-col space-y-1'>\n                                    <p className=\"font-semibold text-[#002E47] flex justify-between\">\n                                        <span className='text-sm text-gray-600'>Rating:</span>\n                                        <span className='text-xl font-extrabold' style={{ color: scoreColor }}>{answer} / 5</span>\n                                    </p>\n                                    <input\n                                        type=\"range\"\n                                        min=\"1\" max=\"5\"\n                                        value={answer} // Pass the current state value\n                                        onChange={(e) => handleAnswerChange(q.id, e.target.value)}\n                                        className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg\"\n                                        style={{ accentColor: scoreColor }}\n                                    />\n                                    <div className='flex justify-between text-xs text-gray-500'>\n                                        <span>Strongly Disagree</span>\n                                        <span>Neutral</span>\n                                        <span>Strongly Agree</span>\n                                    </div>\n                                </div>\n                            </div>\n                        );\n                    })}\n                    {!allAnswered && <p className='text-[#E04E1B] text-xs mt-2'>* Please answer all 10 questions to continue.</p>}\n                </Card>\n                \n                <Card title=\"2. Final Input\" icon={MessageSquare} accent='ORANGE'>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">90-Day Goal (Optional Open-Ended)</label>\n                    <textarea\n                        value={openEndedGoal}\n                        onChange={(e) => setOpenEndedGoal(e.target.value)}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#E04E1B] focus:border-[#E04E1B] h-20\"\n                        placeholder=\"What’s one leadership behavior you most want to strengthen in the next 90 days?\"\n                    ></textarea>\n                    \n                    <label className=\"block text-sm font-medium text-gray-700 mt-4 mb-1\">Overall Confidence (1-10 Scale)</label>\n                    <div className='flex flex-col space-y-1'>\n                        <p className=\"font-semibold text-[#002E47] flex justify-between\">\n                            <span className='text-sm text-gray-600'>Overall Leadership Confidence:</span>\n                            <span className='text-xl font-extrabold' style={{ color: COLORS.BLUE }}>{overallConfidence} / 10</span>\n                        </p>\n                        <input\n                            type=\"range\"\n                            min=\"1\" max=\"10\"\n                            value={overallConfidence}\n                            onChange={(e) => setOverallConfidence(parseInt(e.target.value))}\n                            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg\"\n                            style={{ accentColor: COLORS.BLUE }}\n                        />\n                    </div>\n                </Card>\n            </div>\n\n            <Button onClick={handleGenerate} disabled={!canGenerate || isGenerating} className=\"mt-10 w-full md:w-auto\">\n                {isGenerating ? (\n                    <div className=\"flex items-center\">\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                        Generating 24-Month Roadmap...\n                    </div>\n                ) : 'Generate Personalized 24-Month Roadmap'}\n            </Button>\n            <p className='text-sm text-gray-500 mt-4'>*Your data will be securely saved to your private roadmap in Firestore.</p>\n        </div>\n    );\n};\n\n// --- Component 4: Plan Review Screen (Unchanged, relies on generator output) ---\nconst PlanReviewScreen = ({ generatedPlan, navigate, clearReviewData, finalizeWithData }) => { \n    if (!generatedPlan || !generatedPlan.userPlan || !generatedPlan.userPlan.leadershipProfile) return (\n         <div className=\"p-8 min-h-screen\">\n             <p className='text-xl text-[#E04E1B] font-bold'>Error: Personalized plan data is incomplete. Please re-run the assessment.</p>\n             <Button onClick={() => navigate('prof-dev-plan')} className='mt-4'>Go to Assessment</Button>\n         </div>\n    );\n\n    const userPlan = generatedPlan.userPlan;\n    const genericPlan = generatedPlan.genericPlan;\n    const leadershipProfile = userPlan.leadershipProfile; \n\n    const userTotalDuration = userPlan.plan.reduce((sum, m) => sum + m.totalDuration, 0);\n    // Use fixed mock values here since the full plan has 6 blocks * max 6 items = 36 total. \n    // We can simulate the personalization benefit based on the default library above.\n    const userIntroContent = userPlan.plan.flatMap(m => m.requiredContent).filter(c => c.difficulty === 'Intro').length || 12;\n    const userMasteryContent = userPlan.plan.flatMap(m => m.requiredContent).filter(c => c.difficulty === 'Mastery').length || 6; \n    \n    // Mock comparative data if not provided (safety)\n    const mockGenericTotalDuration = 1200;\n    const mockGenericMasteryContent = 3;\n    const mockGenericIntroContent = 8;\n    \n    const durationDifference = mockGenericTotalDuration - userTotalDuration;\n    const introDifference = mockGenericIntroContent - userIntroContent;\n    const masteryDifference = userMasteryContent - mockGenericMasteryContent;\n\n    const StatItem = ({ label, value, diff, unit = '', isPositiveBetter = true }) => {\n        const isGood = isPositiveBetter ? diff > 0 : diff < 0;\n        const diffColor = diff === 0 ? COLORS.MUTED : isGood ? COLORS.GREEN : COLORS.RED;\n        const diffSign = diff > 0 ? '+' : '';\n        return (\n            <div className='flex justify-between items-center py-2 border-b border-gray-200'>\n                <span className='font-semibold'>{label}:</span>\n                <div className='text-right'>\n                    <span className={`font-bold text-lg mr-2`} style={{color: COLORS.NAVY}}>{value} {unit}</span>\n                    <span className={`text-xs font-semibold`} style={{ color: diffColor }}>({diffSign}{diff} {unit})</span>\n                </div>\n            </div>\n        );\n    };\n    \n    const handleFinalize = async () => {\n        console.log(\"Roadmap review complete. Finalizing plan and redirecting to Tracker Dashboard...\");\n        if (typeof finalizeWithData === 'function') {\n            finalizeWithData(userPlan);\n        } else {\n            clearReviewData();\n            navigate('prof-dev-plan');\n        }\n        window.scrollTo(0, 0);\n    };\n\n    const handleStartOver = () => { \n        clearReviewData(); \n        navigate('prof-dev-plan');\n    };\n\n    return (\n        <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n            <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.GREEN+'30'}}>\n                <CheckCircle className='w-10 h-10' style={{color: COLORS.GREEN}}/>\n                <h1 className=\"text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Roadmap Successfully Generated!</h1>\n            </div>\n            <p className=\"text-lg text-gray-600 mb-8 max-w-3xl\">Review your personalized Roadmap highlights below. Your full 24-month training plan has been created and is ready to view in the Tracker Dashboard.</p>\n\n            <Card title=\"Leadership Profile Snapshot\" icon={Target} accent='ORANGE' className='mt-8 border-l-4 border-[#E04E1B] bg-[#E04E1B]/10'>\n                 <h3 className=\"text-xl font-extrabold text-[#002E47] mb-4\">Your Top 3 Growth Focus Areas:</h3>\n                 <div className='space-y-3 mb-6'>\n                    {leadershipProfile.slice(0, 3).map((d, i) => (\n                         <div key={d.dimension} className='p-3 bg-white rounded-lg shadow-sm border border-gray-200'>\n                            <p className='text-sm font-bold text-[#002E47]'>{i+1}. {d.dimension}</p>\n                            <p className='text-xs text-gray-600'>Average Score: {d.score.toFixed(2)} / 5.00</p>\n                        </div>\n                    ))}\n                </div>\n                \n                <h3 className=\"text-xl font-extrabold text-[#002E47] mb-4\">Comparison: Personalized vs. Generic</h3>\n                <div className='space-y-1 text-sm text-gray-700'>\n                    <StatItem \n                        label=\"Total Estimated Training Time\" \n                        value={userTotalDuration} \n                        unit=\"min\" \n                        diff={durationDifference} \n                        isPositiveBetter={false} \n                    />\n                    <StatItem \n                        label=\"Mastery Reps (High Skill)\" \n                        value={userMasteryContent} \n                        unit=\"items\" \n                        diff={masteryDifference} \n                        isPositiveBetter={true} \n                    />\n                    <StatItem \n                        label=\"Introductory Reps (Low Skill)\" \n                        value={userIntroContent} \n                        unit=\"items\" \n                        diff={introDifference} \n                        isPositiveBetter={false}\n                    />\n                </div>\n                <p className='text-xs text-gray-600 mt-4 italic'>\n                    *The AI tailored your content difficulty and sequence based on your specific Tiers and self-rated skill gaps to apply **Progressive Overload**.\n                </p>\n                \n                <div className='flex justify-between space-x-4 mt-6'>\n                    <Button onClick={handleStartOver} variant='outline' className='text-xs px-4 py-2 text-[#E04E1B] border-[#E04E1B]/50 hover:bg-[#E04E1B]/10'>\n                        <X className='w-4 h-4 mr-1'/> Start Over / Re-Run Assessment\n                    </Button>\n                    <Button onClick={handleFinalize} variant='primary'>\n                        <CornerRightUp className='w-4 h-4 mr-1'/> Go to Roadmap Tracker\n                    </Button>\n                </div>\n            </Card>\n        </div>\n    );\n};\n\n\n// --- Main Router (Enhanced with internal state) ---\nexport const ProfDevPlanScreen = ({ initialScreen }) => {\n    const [generatedPlanData, setGeneratedPlanData] = useState(null); \n    \n    \n    // Local override so Tracker shows a newly generated plan immediately\n    const [overridePdpData, setOverridePdpData] = useState(null);\nconst services = useAppServices(); \n    const { pdpData, isLoading, error, userId, navigate, updatePdpData, saveNewPlan, SKILL_CONTENT_LIBRARY } = services;\n\n    // Clear the local override once live pdpData has caught up\n    useEffect(() => {\n        if (!overridePdpData || !pdpData) return;\n        const liveTs = Date.parse(pdpData?.lastUpdate || 0) || 0;\n        const ovTs = Date.parse(overridePdpData?.lastUpdate || 0) || 0;\n        if (liveTs >= ovTs && Array.isArray(pdpData.plan) && pdpData.plan.length > 0) {\n            setOverridePdpData(null);\n        }\n    }, [pdpData, overridePdpData]);\n\n\n    // Pull the content library from the service, with a safety check\n    const contentLibrary = SKILL_CONTENT_LIBRARY?.items || CONTENT_LIBRARY; \n\n    const clearReviewData = useCallback(() => {\n        setGeneratedPlanData(null);\n    }, []);\n\n    // CRITICAL FIX: Router Logic Check for Plan Integrity\n    const planExistsAndIsValid = useMemo(() => {\n        // A plan is valid only if it exists AND contains the 'plan' array created by the new generator.\n        return pdpData !== null && Array.isArray(pdpData.plan) && pdpData.plan.length > 0;\n    }, [pdpData]);\n\n    \nlet currentView = 'loading';\nif (isLoading || pdpData === undefined) {\n    currentView = 'loading';\n} else if (error) {\n    currentView = 'error';\n} else if (generatedPlanData || initialScreen === 'prof-dev-plan-review') {\n    currentView = 'review';\n} else if (planExistsAndIsValid) {\n    currentView = 'tracker';\n} else {\n    currentView = 'generator';\n}\n\n    \n    // CRITICAL: Updated generatePlanData to take the library as an argument\n    const generatePlanDataWrapper = useCallback((assessment, ownerUid) => {\n        // Pass the contentLibrary (loaded from service or fallback) to the generator function\n        return generatePlanData(assessment, ownerUid, contentLibrary);\n    }, [contentLibrary]); \n\n    useEffect(() => {\n        if (initialScreen === 'prof-dev-plan-review' && pdpData && !generatedPlanData) {\n            // Mock generic plan data is passed to the review screen for comparison stats\n            setGeneratedPlanData({ userPlan: pdpData, genericPlan: { totalDuration: 1200, avgIntroContent: 8, avgMasteryContent: 3 } });\n        }\n    }, [initialScreen, pdpData, generatedPlanData]);\n\n\n    if (currentView === 'loading') { \n        return (\n            <div className=\"p-8 min-h-screen flex items-center justify-center\">\n                <div className=\"flex flex-col items-center\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3\"></div>\n                    <p className=\"text-[#47A88D] font-medium\">Loading Personalized Development Roadmap...</p>\n                </div>\n            </div>\n        );\n    }\n    if (currentView === 'error') { return React.createElement('div', null, 'Error...'); }\n    if (currentView === 'review') { return (\n        <PlanReviewScreen\n            generatedPlan={generatedPlanData}\n            navigate={navigate}\n            clearReviewData={clearReviewData}\n            finalizeWithData={(data) => {\n                setOverridePdpData(data);\n                clearReviewData();\n                navigate('prof-dev-plan');\n            }}\n        />\n    ); }\n    if (currentView === 'generator') { \n        return <PlanGeneratorView \n            userId={userId} \n            saveNewPlan={saveNewPlan} \n            isLoading={false} \n            error={null} \n            navigate={navigate} \n            setGeneratedPlanData={setGeneratedPlanData} \n            generatePlanDataWrapper={generatePlanDataWrapper} // Pass the content-aware generator\n        />; \n    }\n\n    // currentView === 'tracker'\n    // Pass the correct update function which is aware of the current view/logic\n    const trackerProps = { data: (overridePdpData || pdpData), updatePdpData, saveNewPlan, userId, navigate };\n    return <TrackerDashboardView {...trackerProps} />;\n};\n\nexport default ProfDevPlanScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/RoadmapTracker.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'copyToClipboard' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":97,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":22},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":145,"column":43,"nodeType":"Identifier","endLine":145,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":146,"column":33,"nodeType":"Identifier","endLine":146,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":147,"column":39,"nodeType":"Identifier","endLine":147,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":164,"column":32,"nodeType":"Identifier","endLine":164,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'mockDetail'. Either include it or remove the dependency array.","line":164,"column":58,"nodeType":"ArrayExpression","endLine":164,"endColumn":114,"suggestions":[{"desc":"Update the dependencies array to be: [mockDetail]","fix":{"range":[8888,8944],"text":"[mockDetail]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":177,"column":5,"nodeType":"Identifier","endLine":177,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'currentMonth' is defined but never used.","line":254,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":254,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'saveNewPlan' is defined but never used.","line":294,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":294,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":294,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":294,"endColumn":73},{"ruleId":"no-unused-vars","severity":1,"message":"'initialScreen' is defined but never used.","line":721,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":721,"endColumn":53},{"ruleId":"no-unused-vars","severity":1,"message":"'setOverridePdpData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":727,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":727,"endColumn":47}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/RoadmapTracker.jsx\n\nimport { Home, Settings, Zap, Clock, Briefcase, Mic, Trello, BookOpen, BarChart3, TrendingUp, TrendingDown, CheckCircle, Star, Target, Users, HeartPulse, CornerRightUp, X, ArrowLeft, Activity, Link, Lightbulb, AlertTriangle, Check, Calendar, Dumbbell, Send, Send as ShareIcon } from 'lucide-react';\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n\n// --- SERVICES (production) ---\nimport { useAppServices } from '../../services/useAppServices.jsx';\n\n/* =========================================================\n   HIGH-CONTRAST PALETTE (Centralized for Consistency)\n========================================================= */\nconst COLORS = {\n  NAVY: '#002E47',      \n  TEAL: '#47A88D',      \n  SUBTLE_TEAL: '#349881', \n  ORANGE: '#E04E1B',    \n  GREEN: '#10B981',\n  AMBER: '#F5A500', \n  RED: '#E04E1B',\n  LIGHT_GRAY: '#FCFCFA',\n  OFF_WHITE: '#FFFFFF', \n  SUBTLE: '#E5E7EB',\n  TEXT: '#002E47',\n  MUTED: '#4B5355',\n  BLUE: '#2563EB',\n  BG: '#F9FAFB', \n  PURPLE: '#7C3AED', \n};\n\n// Mock UI components (Standardized)\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', ...rest }) => {\n  let baseStyle = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-xl focus:outline-none focus:ring-4 text-white flex items-center justify-center\";\n  if (variant === 'primary') { baseStyle += ` bg-[${COLORS.TEAL}] hover:bg-[${COLORS.SUBTLE_TEAL}] focus:ring-[${COLORS.TEAL}]/50`; }\n  else if (variant === 'secondary') { baseStyle += ` bg-[${COLORS.ORANGE}] hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`; }\n  else if (variant === 'outline') { baseStyle = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[${COLORS.TEAL}]/10 focus:ring-4 focus:ring-[${COLORS.TEAL}]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-center`; }\n  else if (variant === 'nav-back') { baseStyle = `px-4 py-2 rounded-lg font-medium transition-all shadow-sm border-2 border-gray-300 text-gray-700 hover:bg-gray-100 flex items-center justify-center`; }\n  if (disabled) { baseStyle = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\"; }\n  return (\n    <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>\n      {children}\n    </button>\n  );\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n  const handleKeyDown = (e) => {\n    if (!interactive) return;\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      onClick?.();\n    }\n  };\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={handleKeyDown}\n      className={`relative p-6 rounded-2xl border-2 shadow-2xl transition-all duration-300 text-left ${className}`}\n      style={{ background: 'linear-gradient(180deg,#FFFFFF,#F9FAFB)', borderColor: COLORS.SUBTLE, color: COLORS.TEXT }}\n      onClick={onClick}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n\n      {Icon && (\n        <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n          <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n        </div>\n      )}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\n\n// --- Tooltip Component ---\nconst Tooltip = ({ content, children }) => {\n    const [isVisible, setIsVisible] = useState(false);\n    return (\n        <div\n            className=\"relative inline-block\"\n            onMouseEnter={() => setIsVisible(true)}\n            onMouseLeave={() => setIsVisible(false)}\n        >\n            {children}\n            {isVisible && (\n                <div className=\"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2\">\n                    {content}\n                    <div className=\"absolute left-1/2 transform -translate-x-1/2 bottom-[-4px] w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#002E47]\"></div>\n                </div>\n            )}\n        </div>\n    );\n};\nconst copyToClipboard = (text) => {\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text)\n            .then(() => console.log('Content copied to clipboard via modern API!'))\n            .catch(err => console.error('Could not copy text: ', err));\n    } else {\n        const el = document.createElement('textarea');\n        el.value = text;\n        document.body.appendChild(el);\n        el.select();\n        document.execCommand('copy');\n        document.body.removeChild(el);\n        console.log('Content copied to clipboard via fallback!');\n    }\n};\nconst mdToHtml = async (md) => {\n    let html = md;\n    html = html.replace(/## (.*$)/gim, '<h2 class=\"text-2xl font-extrabold text-[#E04E1B] mb-3\">$1</h2>');\n    html = html.replace(/### (.*$)/gim, '<h3 class=\"text-xl font-bold text-[#47A88D] mt-4 mb-2\">$1</h3>');\n    html = html.replace(/\\*\\*(.*)\\*\\*/gim, '<strong>$1</strong>');\n    html = html.split('\\n').map(line => line.trim()).filter(line => line.length > 0).map(line => {\n        if (line.startsWith('<ul>') || line.startsWith('<li>') || line.startsWith('<h') || line.startsWith('<s')) return line;\n        return `<p class=\"text-sm text-gray-700\">${line}</p>`;\n    }).join('');\n    html = html.replace(/<p><\\/p>/g, ''); \n    html = html.replace(/<ul>/g, '<ul><li class=\"text-sm text-gray-700\">').replace(/<\\/li>/g, '</li></ul>');\n    return html;\n};\n// FIX: Removed 'Eye' and other missing/unused icons from the import list based on the error.\nconst IconMap = {\n    Zap: Zap, Users: Users, Briefcase: Briefcase, Target: Target, BarChart3: BarChart3, Clock: Clock, BookOpen: BookOpen, Lightbulb: Lightbulb, X: X, ArrowLeft: ArrowLeft, CornerRightUp: CornerRightUp, AlertTriangle: AlertTriangle, CheckCircle: CheckCircle, Star: Star, Mic: Mic, Trello: Trello, Settings: Settings, Home: Home, Check: Check, Calendar: Calendar, HeartPulse: HeartPulse, TrendingUp: TrendingUp, TrendingDown: TrendingDown, Activity: Activity, Link: Link, Dumbbell: Dumbbell\n};\n\n// --- PDP Utility & Plan Generation stubs ---\nconst LEADERSHIP_TIERS = {\n    T1: { id: 'T1', name: 'Lead Self & Mindsets', icon: 'HeartPulse', color: 'indigo-500' },\n    T2: { id: 'T2', name: 'Lead Work & Execution', icon: 'Briefcase', color: 'green-600' },\n    T3: { id: 'T3', name: 'Lead People & Coaching', icon: 'Users', color: 'yellow-600' },\n    T4: { id: 'T4', name: 'Conflict & Team Health', icon: 'AlertTriangle', color: 'red-640' },\n    T5: { id: 'T5', name: 'Strategy & Vision', icon: 'TrendingUp', color: 'cyan-600' },\n};\n\n// NOTE: All assessment and generator constants/functions are removed from this file.\n\n// --- Component 4: PDP Content Details Modal ---\nconst ContentDetailsModal = ({ isVisible, onClose, content }) => { \n    if (!isVisible || !content) return null;\n    \n    const [htmlContent, setHtmlContent] = useState('');\n    const [rating, setRating] = useState(0); \n    const [isLogging, setIsLogging] = useState(false);\n    \n    const tierData = LEADERSHIP_TIERS[content.tier] || { name: 'Unknown Tier' };\n\n    const MOCK_CONTENT_DETAILS_FINAL = {\n        Reading: (title, skill) => `## Reading: ${title}\\n### Focus: ${skill}\\nThis is a reading module focusing on ${skill} theory.`,\n        Exercise: (title, skill) => `## Exercise: ${title}\\n### Focus: ${skill}\\nThis is a practical exercise for skill ${skill}.`,\n        'Role-Play': (title, skill) => `## Role-Play: ${title}\\n### Focus: ${skill}\\nThis is a simulation for skill ${skill}.`, \n        CaseStudy: (title, skill) => `## Executive Analysis: ${title}\\n### Focus: ${skill}\\nThis is a case study analysis for skill ${skill}.`,\n        Tool: (title, skill) => `## Tool Implementation: ${title}\\n### Focus: ${skill}\\nThis is a tool implementation module for skill ${skill}.`,\n        Coaching: (title, skill) => `## AI Coaching Lab: ${title}\\n### Focus: ${skill}\\nThis is an AI coaching session for skill ${skill}.`,\n    };\n\n    const mockDetail = MOCK_CONTENT_DETAILS_FINAL[content.type]\n        ? MOCK_CONTENT_DETAILS_FINAL[content.type](content.title, content.skill)\n        : `## Content Unavailable\\n\\nNo detailed content available for **${content.title}** (Type: ${content.type}).`;\n\n    const memoizedMockDetail = useMemo(() => mockDetail, [content.id, content.tier, content.title, content.skill]); \n    \n    const handleLogLearning = async () => {\n        if (rating === 0) { console.log('Please provide a 5-star rating before logging.'); return; }\n        setIsLogging(true);\n        console.log(`Mock: Logging learning for ${content.title} with rating ${rating}/5.`);\n        await new Promise(r => setTimeout(r, 800));\n        console.log(`Learning logged! Your ${rating}/5 rating will influence future plan revisions.`);\n        // NOTE: In a real app, you would dispatch a data update here to log learning progress.\n        setIsLogging(false);\n        onClose();\n    };\n\n    useEffect(() => {\n        let isCancelled = false;\n        setHtmlContent('');\n        setRating(0);\n\n        (async () => {\n            const html = await mdToHtml(memoizedMockDetail);\n            if (!isCancelled) {\n                setHtmlContent(html);\n            }\n        })();\n\n        return () => {\n            isCancelled = true;\n        };\n    }, [memoizedMockDetail]);\n    \n    return (\n        <div className=\"fixed inset-0 bg-[#002E47]/80 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto p-8\">\n                <div className=\"flex justify-between items-start border-b pb-4 mb-6\">\n                    <h2 className=\"text-3xl font-extrabold text-[#002E47] flex items-center\">\n                        <BookOpen className=\"w-8 h-8 mr-3 text-[#47A88D]\" />\n                        {content.title} ({content.type})\n                    </h2>\n                    <button onClick={onClose} className=\"p-2 text-gray-500 hover:text-[#E04E1B] transition-colors\">\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n                <div className=\"mb-6 text-sm flex space-x-4 border-b pb-4\">\n                    <p className=\"text-gray-700 font-semibold\">Tier: <span className='text-[#002E47]'>{tierData.name}</span></p>\n                    <p className=\"text-gray-700 font-semibold\">Skill Focus: <span className='text-[#002E47]'>{content.skill}</span></p>\n                    <p className=\"text-gray-700 font-semibold\">Est. Duration: <span className='text-[#002E47]'>{content.duration} min</span></p>\n                </div>\n                <div className=\"prose max-w-none text-gray-700\">\n                    {htmlContent ? (\n                        <div dangerouslySetInnerHTML={{ __html: htmlContent }} />\n                    ) : (\n                        <p className='text-gray-500 flex items-center'>\n                            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500 mr-2\"></div>\n                            Loading content details...\n                        </p>\n                    )}\n                </div>\n                <div className='mt-8 pt-6 border-t border-gray-200'>\n                    <h3 className='text-lg font-bold text-[#002E47] mb-3 flex items-center'>\n                        <Star className=\"w-5 h-5 mr-2 text-[#E04E1B]\" />\n                        Review & Log Learning\n                    </h3>\n                    <p className=\"text-sm text-gray-700 mb-4\">\n                        Rate the content's quality and helpfulness. This feedback loop helps the AI personalize future modules.\n                    </p>\n                    <div className='flex items-center space-x-4 mb-4'>\n                        <div className='flex space-x-1'>\n                            {[1, 2, 3, 4, 5].map((star) => (\n                                <Star\n                                    key={star}\n                                    className={`w-6 h-6 cursor-pointer transition-colors ${\n                                        star <= rating ? 'text-yellow-500 fill-yellow-500' : 'text-gray-300'\n                                    }`}\n                                    onClick={() => setRating(star)}\n                                />\n                            ))}\n                        </div>\n                        <span className='text-md font-semibold text-[#002E47]'>{rating > 0 ? `${rating}/5 Stars` : 'Rate Content'}</span>\n                    </div>\n                    <Button onClick={handleLogLearning} disabled={isLogging || rating === 0} className='w-full'>\n                        {isLogging ? 'Logging...' : 'Log Learning & Submit Rating'}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n// --- Component 3: Roadmap Timeline View (Unchanged) ---\nconst RoadmapTimeline = ({ data, currentMonth, navigateToMonth, viewMonth }) => {\n    return (\n        <Card title=\"24-Month Roadmap Timeline\" icon={Trello} accent=\"PURPLE\" className='lg:sticky lg:top-4 bg-white shadow-2xl border-l-4 border-[#7C3AED]'>\n            <p className='text-sm text-gray-600 mb-4'>Review your full two-year journey. Click a month to review its content and reflection.</p>\n            <div className='max-h-96 overflow-y-auto space-y-2 pr-2'>\n                {data.plan.map(monthData => {\n                    const isCurrentView = monthData.month === viewMonth;\n                    const isFuture = monthData.month > data.currentMonth; \n                    const isCompleted = monthData.status === 'Completed';\n                    const isClickable = true; \n\n                    return (\n                        <div key={monthData.month}\n                             className={`p-3 rounded-lg border flex justify-between items-center transition-all cursor-pointer shadow-sm\n                                         ${isCurrentView ? 'bg-[#7C3AED]/20 border-[#7C3AED] font-extrabold' : isCompleted ? 'bg-[#47A88D]/10 border-[#47A88D]' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}\n                                         ${isFuture && !isCurrentView ? 'opacity-80' : ''}` \n                             }\n                             onClick={() => {\n                                 if (isClickable) navigateToMonth(monthData.month); \n                             }}\n                        >\n                            <span className={`text-sm ${isCurrentView ? 'text-[#7C3AED]' : 'text-[#002E47]'}`}>\n                                **Training Month {monthData.month}**: {monthData.theme}\n                            </span>\n                            <span className=\"flex items-center space-x-1 text-xs\">\n                                <Check size={16} className={isCompleted ? 'text-green-600' : 'text-gray-400'} />\n                                <span className={isCompleted ? 'text-green-600' : 'text-gray-400'}>\n                                    {monthData.month === data.currentMonth ? 'CURRENT' : isCompleted ? 'COMPLETED' : isFuture ? 'FUTURE' : 'PENDING'}\n                                </span>\n                            </span>\n                        </div>\n                    );\n                })}\n            </div>\n        </Card>\n    );\n};\n\n\n// --- Component 2: Tracker Dashboard View ---\nconst TrackerDashboardView = ({ data, updatePdpData, saveNewPlan, userId, navigate }) => {\n    const [viewMonth, setViewMonth] = useState(data.currentMonth); \n    const currentMonth = data.currentMonth;\n    \n    const monthPlan = useMemo(() => data.plan.find(m => m.month === viewMonth), [data.plan, viewMonth]);\n    \n    const isCurrentView = viewMonth === currentMonth; \n    const isPastOrCurrent = viewMonth <= currentMonth; \n    \n    const assessment = data.assessment;\n\n    const [localReflection, setLocalReflection] = useState(monthPlan?.reflectionText || '');\n    const [isSaving, setIsSaving] = useState(false);\n    const [briefing, setBriefing] = useState(monthPlan?.briefingText || null); \n    const [briefingLoading, setBriefingLoading] = useState(false);\n    \n    const [isContentModalVisible, setIsContentModalVisible] = useState(false);\n    const [selectedContent, setSelectedContent] = useState(null);\n\n    const [togglingIds, setTogglingIds] = useState(() => new Set());\n\n    const { callSecureGeminiAPI, hasGeminiKey } = useAppServices(); \n\n    // --- Handlers ---\n    const handleContentStatusToggle = useCallback((contentId) => {\n        if (!isCurrentView) return; \n        updatePdpData(oldData => {\n            const updatedContent = monthPlan.requiredContent.map(item =>\n                item.id === contentId ? { \n                    ...item, \n                    status: item.status === 'Completed' ? 'Pending' : 'Completed',\n                    dateCompleted: item.status === 'Completed' ? null : new Date().toISOString(), // NEW: Completion Timestamp\n                } : item\n            );\n            const updatedPlan = oldData.plan.map(m =>\n                m.month === currentMonth ? { ...m, requiredContent: updatedContent } : m\n            );\n            return { ...oldData, plan: updatedPlan };\n        });\n    }, [isCurrentView, updatePdpData, monthPlan, currentMonth]);\n\n    const toggleContent = useCallback((id) => {\n        if (!isPastOrCurrent) return; \n        setTogglingIds(prev => { const n = new Set(prev); n.add(id); return n; });\n        handleContentStatusToggle(id);\n        setTimeout(() => {\n            setTogglingIds(prev => { const n = new Set(prev); n.delete(id); return n; });\n        }, 400);\n    }, [isPastOrCurrent, handleContentStatusToggle]);\n\n    const fetchMonthlyBriefing = useCallback(async (plan, assessment) => {\n        if (briefingLoading || !hasGeminiKey() || !plan || !assessment || !isCurrentView) return;\n        \n        if (plan.briefingText || briefing) {\n            setBriefing(plan.briefingText || briefing);\n            return;\n        }\n\n        setBriefingLoading(true);\n        // NOTE: We don't have the assessment questions defined here, \n        // so we use a mock rating to prevent errors during the API call setup.\n        const currentTier = LEADERSHIP_TIERS[plan.tier];\n        const rating = 5; // Use 5 as a safe default mock rating since assessment data is outside this component\n\n        const systemPrompt = `You are a concise Executive Coach. Analyze the user's current Roadmap phase (fitness training). Given their focus tier (${currentTier.name}) and their initial self-rating (${rating}/10), provide: 1) A 1-sentence **Executive Summary** of the goal (the rep/skill). 2) A 1-sentence **Coaching Nudge** on how to prioritize the month's learning based on their skill gap. Use bold markdown for key phrases.`;\n\n        const userQuery = `Generate a monthly briefing for the user's current focus: ${plan.theme}. Required content/reps includes: ${plan.requiredContent.map(c => c.title).join(', ')}.`;\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: 'gemini-2.5-flash', // Use model name directly as GEMINI_MODEL is not available here\n            };\n            const result = await callSecureGeminiAPI(payload);\n            const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n            \n            if (text && text !== briefing) {\n                setBriefing(text);\n            }\n\n        } catch (e) {\n            setBriefing(\"AI coach unavailable. Focus on completing your required content first.\");\n        } finally {\n            setBriefingLoading(false);\n        }\n    }, [briefingLoading, hasGeminiKey, callSecureGeminiAPI, isCurrentView, briefing]);\n\n\n    const handleCompleteMonth = async () => {\n        // Check if this month is the end of a 90-day block (Month 3, 6, 9, etc.)\n        const is90DayCheckPoint = currentMonth % 3 === 0;\n\n        setIsSaving(true);\n        const briefingToSave = briefing ? briefing.replace('## Monthly Executive Briefing', '## Saved Executive Briefing') : '';\n        \n        await updatePdpData(oldData => {\n            const updatedPlan = oldData.plan.map(m => \n                m.month === oldData.currentMonth ? { \n                    ...m, \n                    status: 'Completed', \n                    reflectionText: localReflection, \n                    monthCompletedDate: new Date().toISOString(),\n                    briefingText: briefingToSave, \n                } : m\n            );\n            return { \n                ...oldData, \n                plan: updatedPlan, \n                currentMonth: oldData.currentMonth + 1 \n            };\n        });\n        setIsSaving(false);\n        \n        if (is90DayCheckPoint) {\n            // CRITICAL: Navigate to the old generator screen to trigger the re-assessment flow if needed\n            navigate('prof-dev-plan-review'); // Navigate to a review/re-assessment screen\n        } else {\n            setViewMonth(currentMonth + 1);\n            window.scrollTo(0, 0); \n        }\n    };\n\n    // FIX: Implement robust plan clearing logic here.\n    const handleResetPlan = async () => {\n        // CRITICAL: Save a minimum, empty data structure to the document to clear the old plan's existence.\n        setIsSaving(true);\n        try {\n            await updatePdpData({ \n                plan: [], \n                assessment: null, \n                currentMonth: 1, \n                progressScans: [], \n                latestScenario: null, \n                lastUpdate: new Date().toISOString() \n            });\n            // After data is cleared, navigate to the generator screen.\n            navigate('prof-dev-plan');\n            window.scrollTo(0,0); \n        } catch(e) {\n            console.error(\"Failed to reset plan:\", e);\n            alert(\"Failed to reset plan data. Check database permissions or refresh the page manually.\");\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    const handleOpenContentModal = (contentItem) => { setSelectedContent(contentItem); setIsContentModalVisible(true); };\n\n    const handleSaveReflection = () => {\n        if (!isCurrentView || localReflection === monthPlan?.reflectionText || localReflection.length === 0) return;\n\n        setIsSaving(true);\n        updatePdpData(oldData => {\n            const updatedPlan = oldData.plan.map(m =>\n                m.month === currentMonth ? { ...m, reflectionText: localReflection } : m\n            );\n            \n            // NOTE: Use the current assessment scores for the snapshot\n            const selfRatings = data.assessment?.selfRatings || {};\n            const newProgressScan = {\n                cycle: Math.ceil(currentMonth / 3), \n                month: currentMonth,\n                date: new Date().toISOString(),\n                scores: selfRatings, \n                reflection: localReflection,\n            };\n\n            return { \n                ...oldData, \n                plan: updatedPlan,\n                progressScans: [...(oldData.progressScans || []), newProgressScan] \n            };\n        }).then(() => {\n            setIsSaving(false);\n            console.log(\"Reflection and Progress Scan Snapshot Saved.\");\n        }).catch((e) => {\n             console.error(\"Reflection Save Failed:\", e);\n             setIsSaving(false);\n        });\n    };\n    \n    // Effects simplified for this context\n    useEffect(() => { setLocalReflection(monthPlan?.reflectionText || ''); setBriefing(monthPlan?.briefingText || null); setBriefingLoading(false); window.scrollTo(0, 0); }, [monthPlan]);\n    useEffect(() => { if (monthPlan && assessment && isCurrentView && !monthPlan.briefingText && !briefingLoading) { fetchMonthlyBriefing(monthPlan, assessment); } }, [monthPlan, assessment, fetchMonthlyBriefing, isCurrentView, briefingLoading]);\n    \n    \n    // --- Data Calculation ---\n    const currentTierId = monthPlan?.tier;\n    const selfRating = data.assessment?.selfRatings?.[currentTierId] || 5; // Use 5 as a fallback\n    const lowRatingFlag = currentTierId && selfRating <= 4;\n    const allContentCompleted = monthPlan?.requiredContent?.every(item => item.status === 'Completed');\n    const isReadyToComplete = allContentCompleted && localReflection.length >= 50;\n    const requiredContent = monthPlan?.requiredContent || [];\n    const totalDuration = data.plan.reduce((sum, m) => sum + m.totalDuration, 0);\n    const completedDuration = data.plan.filter(m => m.month < currentMonth).reduce((sum, m) => sum + m.totalDuration, 0);\n    const progressPercentage = totalDuration > 0 ? Math.round((completedDuration / totalDuration) * 100) : 0;\n    const TierIcon = IconMap[LEADERSHIP_TIERS[currentTierId]?.icon || 'Target'];\n    const completedItems = requiredContent.filter(item => item.status === 'Completed').length;\n    const tierProgress = { overallPercentage: requiredContent.length > 0 ? Math.round((completedItems / requiredContent.length) * 100) : 0, completedContent: completedItems, totalContent: requiredContent.length }; \n    const safeBriefing = briefingLoading && isCurrentView ? 'Loading AI Briefing...' : (typeof briefing === 'string' ? briefing : 'Historical briefing unavailable.');\n\n\n    return (\n        <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n            <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.PURPLE+'30'}}>\n                <Dumbbell className='w-10 h-10' style={{color: COLORS.PURPLE}}/>\n                <h1 className=\"text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Development Roadmap Tracker</h1>\n            </div>\n\n            {/* Progress Bar & Header */}\n            <Card title={`Roadmap Progress: Training Month ${currentMonth} of 24`} icon={Clock} accent='NAVY' className=\"bg-[#002E47]/10 border-4 border-[#002E47]/20 mb-8\">\n                <div className=\"w-full bg-gray-200 rounded-full h-4 mb-2\">\n                    <div\n                        className=\"bg-[#47A88D] h-4 rounded-full transition-all duration-700\"\n                        style={{ width: `${progressPercentage}%` }}\n                    ></div>\n                </div>\n                <p className='text-sm font-medium text-[#002E47]'>\n                    {Math.round(progressPercentage)}% Complete. Next Tier Focus in {4 - ((currentMonth - 1) % 4)} months.\n                </p>\n                <div className='flex space-x-4 mt-4'>\n                    <Button onClick={handleResetPlan} variant='outline' className='text-xs px-4 py-2 text-[#E04E1B] border-[#E04E1B]/50 hover:bg-[#E04E1B]/10'>\n                        Start Over / Re-Run Assessment\n                    </Button>\n                    <Button onClick={() => console.log('Share')} variant='outline' className='text-xs px-4 py-2 border-[#002E47] text-[#002E47] hover:bg-[#002E47]/10'>\n                        <ShareIcon className=\"w-4 h-4 mr-1\" /> Share Monthly Focus\n                    </Button>\n                </div>\n            </Card>\n\n            {/* Current Month Plan */}\n            <div className='lg:grid lg:grid-cols-4 lg:gap-8'>\n                \n                <div className='lg:col-span-1 space-y-8 order-1'>\n                    <RoadmapTimeline data={data} currentMonth={currentMonth} navigateToMonth={setViewMonth} viewMonth={viewMonth} />\n                    \n                    <Card title={`Tier Mastery Status (${currentTierId})`} icon={Star} accent='NAVY' className='bg-[#FCFCFA] border-l-4 border-[#002E47] text-center'>\n                         <div className=\"relative w-32 h-32 mx-auto mb-4\">\n                            <svg viewBox=\"0 0 36 36\" className=\"w-full h-32 h-full transform -rotate-90\">\n                                <path className=\"text-gray-300\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3.8\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                                <path className=\"text-[#47A88D]\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3.8\" strokeDasharray={`${tierProgress.overallPercentage}, 100`} d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                            </svg>\n                            <div className=\"absolute top-0 left-0 w-full h-full flex items-center justify-center\">\n                                <span className=\"text-3xl font-extrabold text-[#002E47]\">{tierProgress.overallPercentage}%</span>\n                            </div>\n                        </div>\n                        <p className='text-md font-semibold text-[#002E47] mb-1'>{tierProgress.completedContent} / {tierProgress.totalContent} Content Reps Completed</p>\n                        <p className='text-xs text-gray-600'>For Tier: **{LEADERSHIP_TIERS[currentTierId]?.name}**</p>\n                    </Card>\n\n                </div>\n\n\n                <div className='lg:col-span-3 space-y-8 order-2'>\n                    \n                    {/* VIEWING WARNINGS - THESE DISPLAY FOR FUTURE/PAST MONTHS */}\n                    {viewMonth > currentMonth && ( // Check if viewing a future month\n                        <div className='p-4 rounded-xl bg-yellow-100 border-2 border-yellow-400 shadow-md text-yellow-800 font-semibold flex items-center gap-3'>\n                            <AlertTriangle className='w-5 h-5'/> \n                            Viewing **Future Training Month {viewMonth}**. You must complete Month **{currentMonth}** before accessing this content. Content is read-only.\n                        </div>\n                    )}\n                    {!isCurrentView && isPastOrCurrent && (\n                        <div className='p-4 rounded-xl bg-gray-100 border-2 border-gray-400 shadow-md text-gray-800 font-semibold flex items-center gap-3'>\n                            <Clock className='w-5 h-5'/> \n                            Viewing **Historical Training Month {viewMonth}**. Content and Reflection are read-only.\n                        </div>\n                    )}\n\n                    {/* CONTENT CARD (Always Renders) */}\n                    <Card title={`Focus: ${monthPlan?.theme} (Training Month ${viewMonth})`} icon={TierIcon} accent='TEAL' className='border-l-8 border-[#47A88D]'>\n\n                        {/* AI Monthly Briefing (Renders for all months) */}\n                        <div className='mb-4 p-4 rounded-xl bg-[#002E47]/10 border border-[#002E47]/20'>\n                            <h3 className='font-bold text-[#002E47] mb-1 flex items-center'><Activity className=\"w-4 h-4 mr-2 text-[#47A88D]\" /> Monthly Executive Briefing</h3>\n                            {briefingLoading && isCurrentView ? (\n                                <p className='text-sm text-gray-600 flex items-center'><div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500 mr-2 rounded-full\"></div> Drafting advice...</p>\n                            ) : (\n                                <div className=\"prose max-w-none text-gray-700\">\n                                    <div dangerouslySetInnerHTML={{ __html: safeBriefing }} /> \n                                </div>\n                            )}\n                        </div>\n                        \n                        {/* Status / Difficulty (Renders for all months) */}\n                        <div className='mb-4 text-sm border-t pt-4'>\n                            <p className='font-bold text-[#002E47]'>Tier: {LEADERSHIP_TIERS[currentTierId]?.name}</p>\n                            <p className='text-gray-600'>Target Difficulty: **{selfRating >= 8 ? 'Mastery' : selfRating >= 5 ? 'Core' : 'Intro'}** (Self-Rating: {selfRating}/10)</p>\n                            {lowRatingFlag && (\n                                <p className='font-semibold mt-1 flex items-center text-[#E04E1B]'>\n                                    <AlertTriangle className='w-4 h-4 mr-1' /> HIGH RISK TIER: Prioritize Content Completion.\n                                </p>\n                            )}\n                        </div>\n\n                        <h3 className='text-xl font-bold text-[#002E47] border-t pt-4 mt-4'>Required Content Reps (Lessons)</h3>\n                        <div className='space-y-3 mt-4'>\n                            {requiredContent.map(item => {\n                                const isCompleted = item.status === 'Completed';\n                                const isToggling = togglingIds.has(item.id);\n                                // UPGRADE 2: Action button text is always \"View Content\" or \"Go to Practice\" regardless of month status\n                                const actionButtonText = (item.type === 'Role-Play' || item.type === 'Exercise' || item.type === 'Tool') ? 'Go to Practice' : 'View Content/Rep'; \n\n                                return (\n                                    <div key={item.id} className='flex items-center justify-between p-3 bg-gray-50 rounded-xl shadow-sm'>\n                                        <div className='flex flex-col'>\n                                            <p className={`font-semibold text-sm ${isCompleted && isPastOrCurrent ? 'line-through text-gray-500' : 'text-[#002E47]'}`}>\n                                                {item.title} ({item.type})\n                                                {lowRatingFlag && <span className='ml-2 text-xs text-[#E04E1B] font-extrabold'>(CRITICAL)</span>}\n                                            </p>\n                                            <p className='text-xs text-gray-600'>~{item.duration} min | Difficulty: {item.difficulty}</p>\n                                        </div>\n                                        <div className='flex space-x-2'>\n                                            <Button\n                                                onClick={() => {\n                                                    // UPGRADE 2: Allow viewing of ALL content in future, current, and past months\n                                                    handleOpenContentModal(item);\n                                                }}\n                                                className='px-3 py-1 text-xs'\n                                                variant='primary'\n                                                disabled={false} // Always enabled for viewing\n                                            >\n                                                {actionButtonText}\n                                            </Button>\n\n                                            <Button\n                                                onClick={() => toggleContent(item.id)}\n                                                className={`px-3 py-1 text-xs transition-colors duration-300 ${isToggling ? 'opacity-50' : ''}`}\n                                                variant={isCompleted ? 'secondary' : 'primary'}\n                                                // UPGRADE 2: Only enabled for the current month.\n                                                disabled={isSaving || isToggling || !isCurrentView}\n                                            >\n                                                {isToggling ? 'Updating...' : isCompleted ? 'Rep Completed ✓' : 'Mark Complete'}\n                                            </Button>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </Card>\n\n                    {/* REFLECTION AND ADVANCEMENT CARDS (Only render if current month) */}\n                    {isCurrentView && (\n                    <>\n                        <Card title=\"Monthly Reflection\" icon={Lightbulb} accent=\"NAVY\" className='bg-[#002E47]/10 border-2 border-[#002E47]/20'>\n                            <p className=\"text-gray-700 text-sm mb-4\">\n                                Reflect on the growth you achieved this month. How did the content/reps impact your daily leadership behavior? (**Minimum 50 characters required**)\n                            </p>\n                            <textarea\n                                value={localReflection} \n                                onChange={(e) => setLocalReflection(e.target.value)}\n                                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-40\"\n                                placeholder=\"My reflection (required)...\"\n                                readOnly={!isCurrentView}\n                            ></textarea>\n                            {isCurrentView && (\n                                <div className='flex justify-between items-center mt-1'>\n                                    <p className={`text-xs ${localReflection.length < 50 ? 'text-[#E04E1B]' : 'text-[#47A88D]'}`}>\n                                        {localReflection.length} / 50 characters written.\n                                    </p>\n                                    <span className={`text-xs font-semibold ${isSaving ? 'text-gray-500' : 'text-[#47A88D]'}`}>\n                                        {isSaving ? 'Saving...' : 'Reflection ready'}\n                                    </span>\n                                </div>\n                            )}\n                            {!isCurrentView && <p className='text-xs text-gray-500 mt-2'>Reflection is read-only for this month.</p>}\n                            \n                            {isCurrentView && (\n                                 <Button\n                                    onClick={handleSaveReflection}\n                                    disabled={isSaving || localReflection === monthPlan?.reflectionText || localReflection.length === 0}\n                                    className='w-full mt-4 bg-[#002E47] hover:bg-gray-700'\n                                >\n                                    {isSaving ? 'Saving Reflection...' : 'Save Reflection'}\n                                </Button>\n                            )}\n                        </Card>\n\n                        <Card title=\"Recalibrate Skill Assessment\" icon={Activity} accent='ORANGE' className='bg-[#E04E1B]/10 border-4 border-[#E04E1B]'>\n                            <p className=\"text-gray-700 text-sm mb-4\">\n                                Feel like you've mastered this tier? Re-run your initial **Self-Ratings** to check your progress and generate an **accelerated, revised roadmap** to match your new skill level.\n                            </p>\n                            <Button\n                                onClick={handleResetPlan} \n                                variant=\"secondary\"\n                                className='w-full bg-[#E04E1B] hover:bg-red-700'\n                            >\n                                <Target className='w-4 h-4 mr-2' /> Re-Run Assessment\n                            </Button>\n                        </Card>\n                        \n                        <Card title=\"Advance Roadmap\" icon={CornerRightUp} accent='TEAL' className='bg-[#47A88D]/10 border-4 border-[#47A88D]'>\n                            <p className='text-sm text-gray-700 mb-4'>\n                                Once all content and your reflection are complete, lock in your progress and move to **Training Month {currentMonth + 1}** of your Roadmap (Progressive Overload).\n                            </p>\n                            <Button\n                                onClick={handleCompleteMonth}\n                                disabled={isSaving || !isReadyToComplete}\n                                className='w-full bg-[#47A88D] hover:bg-[#349881]'\n                            >\n                                {isSaving ? 'Processing...' : `Complete Month ${currentMonth} and Advance`}\n                            </Button>\n                            {!allContentCompleted && (\n                                <p className='text-[#E04E1B] text-xs mt-2'>* Finish all content reps first.</p>\n                            )}\n                            {allContentCompleted && localReflection.length < 50 && (\n                                <p className='text-[#E04E1B] text-xs mt-2'>* Reflection required (50 chars min).</p>\n                            )}\n                        </Card>\n                    </>\n                    )} \n                </div>\n            </div>\n            \n            <ContentDetailsModal \n                isVisible={isContentModalVisible} \n                onClose={() => setIsContentModalVisible(false)} \n                content={selectedContent}\n            />\n\n        </div>\n    );\n};\n\n\n// --- Main Router (Simplified to only be the Tracker View) ---\nexport const RoadmapTrackerScreen = ({ initialScreen }) => {\n    // The service layer (useAppServices) still provides the data, but we use it directly.\n    const services = useAppServices(); \n    const { pdpData, isLoading, error, userId, navigate, updatePdpData, saveNewPlan, SKILL_CONTENT_LIBRARY } = services;\n\n    // Local override state is no longer strictly needed but kept for safety/future dev\n    const [overridePdpData, setOverridePdpData] = useState(null);\n    const [pdpIsReady, setPdpIsReady] = useState(false);\n\n    // CRITICAL: New logic for plan existence check\n    const planExistsAndIsValid = useMemo(() => {\n        const data = overridePdpData || pdpData;\n        return data !== null && Array.isArray(data?.plan) && data.plan.length > 0;\n    }, [pdpData, overridePdpData]);\n    \n    // Safety check: When initial data loads, set the ready flag\n    useEffect(() => {\n        if (pdpData !== undefined && !pdpIsReady) {\n            setPdpIsReady(true);\n        }\n    }, [pdpData, pdpIsReady]);\n\n    if (isLoading || !pdpIsReady) {\n        return (\n            <div className=\"p-8 min-h-screen flex items-center justify-center\">\n                <div className=\"flex flex-col items-center\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#47A88D] mb-3\"></div>\n                    <p className=\"text-[#47A88D] font-medium\">Loading Roadmap Data...</p>\n                </div>\n            </div>\n        );\n    }\n    \n    if (error || !planExistsAndIsValid) {\n        // If data is missing or invalid, prompt the user to go to the generator screen.\n        return (\n            <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n                <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.RED+'30'}}>\n                    <AlertTriangle className='w-10 h-10' style={{color: COLORS.RED}}/>\n                    <h1 className=\"text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Roadmap Required</h1>\n                </div>\n                <p className=\"text-lg text-gray-600 mb-8 max-w-3xl\">\n                    Your personalized development plan has not been generated yet. Please complete the initial assessment to unlock the Roadmap Tracker.\n                </p>\n                <Button onClick={() => navigate('prof-dev-plan')} variant='secondary' className='bg-[#E04E1B] hover:bg-red-700'>\n                    <Target className='w-5 h-5 mr-2' /> Go to Assessment Generator\n                </Button>\n            </div>\n        );\n    }\n\n    // Tracker View: If the plan is valid, show the tracker dashboard\n    const trackerProps = { data: (overridePdpData || pdpData), updatePdpData, saveNewPlan, userId, navigate };\n    return <TrackerDashboardView {...trackerProps} />;\n};\n\nexport default RoadmapTrackerScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/generate_flyers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/import-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/migrate-READY-TO-RUN.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token }","line":420,"column":3,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// MIGRATION SCRIPT: leadership_plan → development_plan\n// READY TO RUN VERSION\n// Just update Firebase config and run: node migrate-READY-TO-RUN.js\n\nrequire('dotenv').config();\n\nconst { initializeApp } = require('firebase/app');\nconst { \n  getFirestore, \n  collection, \n  getDocs, \n  doc, \n  getDoc,\n  setDoc,\n  serverTimestamp \n} = require('firebase/firestore');\n\n// ============================================\n// CONFIGURATION - UPDATE THIS!\n// ============================================\n\nconst FIREBASE_CONFIG = {\n  apiKey: process.env.VITE_FIREBASE_API_KEY,\n  authDomain: process.env.VITE_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.VITE_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.VITE_FIREBASE_APP_ID,\n  measurementId: process.env.VITE_FIREBASE_MEASUREMENT_ID\n};\n\nconst MIGRATION_CONFIG = {\n  sourceCollection: 'leadership_plan',\n  sourcePath: 'profile/roadmap',\n  targetCollection: 'development_plan',\n  targetPath: 'user_state/profile',\n  dryRun: true,  // ⚠️ Set to false for actual migration\n  backupToConsole: true,\n  verifyAfterMigration: true,\n};\n\n// ============================================\n// MIGRATION CLASS\n// ============================================\n\nclass DevelopmentPlanMigration {\n  constructor(config) {\n    this.config = config;\n    this.app = null;\n    this.db = null;\n    this.migrationLog = [];\n    this.errors = [];\n    this.backupData = {};\n  }\n\n  async initialize() {\n    console.log('🔥 Initializing Firebase...');\n    this.app = initializeApp(FIREBASE_CONFIG);\n    this.db = getFirestore(this.app);\n    console.log('✅ Firebase initialized');\n  }\n  \n  async discoverUsers() {\n    console.log('📋 STEP 1: Discovering users...');\n    console.log('='.repeat(60));\n    \n    try {\n      const sourceCollectionRef = collection(this.db, this.config.sourceCollection);\n      const snapshot = await getDocs(sourceCollectionRef);\n      \n      const userIds = [];\n      snapshot.forEach(docSnap => {\n        userIds.push(docSnap.id);\n      });\n      \n      console.log(`✅ Found ${userIds.length} user(s) with data`);\n      userIds.forEach((uid, idx) => {\n        console.log(`   ${idx + 1}. ${uid}`);\n      });\n      \n      this.migrationLog.push({\n        step: 'discovery',\n        timestamp: new Date().toISOString(),\n        usersFound: userIds.length,\n        userIds\n      });\n      \n      return userIds;\n    } catch (error) {\n      console.error('❌ Error discovering users:', error);\n      this.errors.push({ step: 'discovery', error: error.message });\n      throw error;\n    }\n  }\n\n  async backupUserData(userId) {\n    console.log(`\\n💾 Backing up data for user: ${userId}`);\n    \n    try {\n      const sourcePath = `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`;\n      const docRef = doc(this.db, sourcePath);\n      const docSnap = await getDoc(docRef);\n      \n      if (docSnap.exists()) {\n        const data = docSnap.data();\n        this.backupData[userId] = {\n          sourcePath,\n          data,\n          timestamp: new Date().toISOString()\n        };\n        \n        console.log(`✅ Backed up ${Object.keys(data).length} fields`);\n        \n        if (this.config.backupToConsole) {\n          console.log('📄 Data preview:', {\n            currentCycle: data.currentCycle,\n            assessmentCount: data.assessmentHistory?.length || 0,\n            planCount: data.planHistory?.length || 0,\n            hasFocusAreas: !!data.currentPlan?.focusAreas,\n            focusAreaCount: data.currentPlan?.focusAreas?.length || 0\n          });\n        }\n        \n        return data;\n      } else {\n        console.log(`⚠️ No data found at ${sourcePath}`);\n        return null;\n      }\n    } catch (error) {\n      console.error(`❌ Error backing up user ${userId}:`, error);\n      this.errors.push({ step: 'backup', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  async migrateUser(userId, data) {\n    console.log(`\\n🔄 Migrating user: ${userId}`);\n    console.log('='.repeat(60));\n    \n    if (!data) {\n      console.log('⏭️ No data to migrate, skipping');\n      return { skipped: true };\n    }\n\n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      \n      const migrationData = {\n        ...data,\n        _migratedAt: serverTimestamp(),\n        _migratedFrom: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        _migrationVersion: '1.0.0'\n      };\n      \n      console.log(`📍 Target path: ${targetPath}`);\n      console.log(`📦 Migrating ${Object.keys(migrationData).length} fields`);\n      \n      if (this.config.dryRun) {\n        console.log('🔍 DRY RUN: Would write to:', targetPath);\n        console.log('🔍 DRY RUN: Data preview:', {\n          currentCycle: migrationData.currentCycle,\n          hasFocusAreas: !!migrationData.currentPlan?.focusAreas,\n          assessmentCount: migrationData.assessmentHistory?.length || 0\n        });\n        return { dryRun: true, targetPath, dataSize: Object.keys(migrationData).length };\n      }\n      \n      const docRef = doc(this.db, targetPath);\n      await setDoc(docRef, migrationData);\n      \n      console.log('✅ Migration successful!');\n      \n      this.migrationLog.push({\n        step: 'migration',\n        userId,\n        sourcePath: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        targetPath,\n        timestamp: new Date().toISOString(),\n        fieldsCount: Object.keys(migrationData).length\n      });\n      \n      return { success: true, targetPath };\n    } catch (error) {\n      console.error(`❌ Error migrating user ${userId}:`, error);\n      this.errors.push({ step: 'migration', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  async verifyMigration(userId, originalData) {\n    console.log(`\\n🔍 Verifying migration for user: ${userId}`);\n    \n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      const docRef = doc(this.db, targetPath);\n      const docSnap = await getDoc(docRef);\n      \n      if (!docSnap.exists()) {\n        console.log('❌ VERIFICATION FAILED: Document does not exist!');\n        return { success: false, reason: 'Document not found' };\n      }\n      \n      const migratedData = docSnap.data();\n      \n      const checks = {\n        currentCycle: originalData.currentCycle === migratedData.currentCycle,\n        hasCurrentPlan: !!migratedData.currentPlan,\n        hasFocusAreas: !!migratedData.currentPlan?.focusAreas,\n        focusAreaCount: originalData.currentPlan?.focusAreas?.length === migratedData.currentPlan?.focusAreas?.length,\n        assessmentCount: originalData.assessmentHistory?.length === migratedData.assessmentHistory?.length,\n        planHistoryCount: originalData.planHistory?.length === migratedData.planHistory?.length,\n      };\n      \n      const allChecksPassed = Object.values(checks).every(v => v === true);\n      \n      console.log('📊 Verification Results:');\n      Object.entries(checks).forEach(([key, passed]) => {\n        console.log(`   ${passed ? '✅' : '❌'} ${key}`);\n      });\n      \n      if (allChecksPassed) {\n        console.log('✅ VERIFICATION PASSED!');\n      } else {\n        console.log('⚠️ VERIFICATION ISSUES DETECTED');\n      }\n      \n      this.migrationLog.push({\n        step: 'verification',\n        userId,\n        checks,\n        allChecksPassed,\n        timestamp: new Date().toISOString()\n      });\n      \n      return { success: allChecksPassed, checks };\n    } catch (error) {\n      console.error(`❌ Error verifying user ${userId}:`, error);\n      this.errors.push({ step: 'verification', userId, error: error.message });\n      return { success: false, error: error.message };\n    }\n  }\n\n  async run() {\n    console.log('\\n');\n    console.log('='.repeat(80));\n    console.log('🚀 DEVELOPMENT PLAN MIGRATION');\n    console.log('='.repeat(80));\n    console.log(`From: ${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`);\n    console.log(`To:   ${this.config.targetCollection}/${'{userId}'}/${this.config.targetPath}`);\n    console.log(`Mode: ${this.config.dryRun ? '🔍 DRY RUN' : '🔥 LIVE MIGRATION'}`);\n    console.log('='.repeat(80));\n    console.log('\\n');\n\n    try {\n      await this.initialize();\n      \n      const userIds = await this.discoverUsers();\n      \n      if (userIds.length === 0) {\n        console.log('\\n⚠️ No users found to migrate!');\n        return { success: false, reason: 'No users found' };\n      }\n      \n      const results = [];\n      \n      for (const userId of userIds) {\n        console.log('\\n' + '━'.repeat(80));\n        console.log(`👤 Processing User: ${userId}`);\n        console.log('━'.repeat(80));\n        \n        try {\n          const originalData = await this.backupUserData(userId);\n          const migrationResult = await this.migrateUser(userId, originalData);\n          \n          let verificationResult = null;\n          if (!this.config.dryRun && this.config.verifyAfterMigration) {\n            verificationResult = await this.verifyMigration(userId, originalData);\n          }\n          \n          results.push({\n            userId,\n            backup: !!originalData,\n            migration: migrationResult,\n            verification: verificationResult\n          });\n          \n        } catch (error) {\n          console.error(`❌ Failed to process user ${userId}:`, error);\n          results.push({\n            userId,\n            error: error.message\n          });\n        }\n      }\n      \n      this.printSummary(results);\n      \n      return {\n        success: true,\n        results,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      }; \n      \n    } catch (error) {\n      console.error('\\n❌ MIGRATION FAILED:', error);\n      return {\n        success: false,\n        error: error.message,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      };\n    }\n  }\n\n  printSummary(results) {\n    console.log('\\n\\n');\n    console.log('='.repeat(80));\n    console.log('📊 MIGRATION SUMMARY');\n    console.log('='.repeat(80));\n    \n    const total = results.length;\n    const successful = results.filter(r => r.migration?.success || r.migration?.dryRun).length;\n    const failed = results.filter(r => r.error).length;\n    const verified = results.filter(r => r.verification?.success).length;\n    \n    console.log(`\\n✨ Total Users: ${total}`);\n    console.log(`✅ Successful: ${successful}`);\n    console.log(`❌ Failed: ${failed}`);\n    if (this.config.verifyAfterMigration && !this.config.dryRun) {\n      console.log(`🔍 Verified: ${verified}`);\n    }\n    \n    if (this.errors.length > 0) {\n      console.log('\\n⚠️ ERRORS ENCOUNTERED:');\n      this.errors.forEach((error, idx) => {\n        console.log(`   ${idx + 1}. ${error.step}: ${error.error}`);\n      });\n    }\n    \n    if (this.config.dryRun) {\n      console.log('\\n🔍 DRY RUN COMPLETE - No changes made');\n      console.log('💡 Set dryRun: false to perform actual migration');\n    } else {\n      console.log('\\n✅ MIGRATION COMPLETE!');\n      console.log('💾 Backup data saved in memory');\n    }\n    \n    console.log('='.repeat(80));\n    console.log('\\n');\n  }\n\n  exportBackup() {\n    const backup = {\n      timestamp: new Date().toISOString(),\n      source: `${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`,\n      data: this.backupData,\n      log: this.migrationLog\n    };\n    \n    console.log('\\n💾 BACKUP DATA:');\n    console.log(JSON.stringify(backup, null, 2));\n    \n    return backup;\n  }\n}\n\n// ============================================\n// AUTO-EXECUTE ON RUN\n// ============================================\n\nasync function main() {\n  // Check if Firebase config is updated\n  if (!FIREBASE_CONFIG.apiKey || FIREBASE_CONFIG.apiKey === \"YOUR_API_KEY\") {\n    console.log('\\n');\n    console.log('⚠️ '.repeat(40));\n    console.log('❌ ERROR: Firebase credentials not configured!');\n    console.log('⚠️ '.repeat(40));\n    console.log('\\n');\n    console.log('📝 REQUIRED STEPS:');\n    console.log('   1. Make sure you have a .env file with your Firebase credentials.');\n    console.log('   2. Update FIREBASE_CONFIG (lines 10-17) with your actual credentials');\n    console.log('   3. Get credentials from: https://console.firebase.google.com');\n    console.log('   4. Save the file');\n    console.log('   5. Run again: node migrate-READY-TO-RUN.js');\n    console.log('\\n');\n    process.exit(1);\n  }\n\n  // Run migration\n  const migration = new DevelopmentPlanMigration(MIGRATION_CONFIG);\n  const result = await migration.run();\n  \n  // Offer to export backup\n  if (result.success) {\n    console.log('\\n💡 TIP: To export backup data, run this in Node REPL:');\n    console.log('   const { DevelopmentPlanMigration } = require(\"./migrate-READY-TO-RUN.js\");');\n    console.log('   const m = new DevelopmentPlanMigration(...);');\n    console.log('   m.exportBackup();');\n  }\n  \n  process.exit(result.success ? 0 : 1);\n}\n\n// Run if executed directly\nif (require.main === module) {\n  main().catch(error => {\n    console.error('Fatal error:', error);\n    process.exit(1);\n  });\n}\n\nmodule.exports = { DevelopmentPlanMigration, MIGRATION_CONFIG };\n    console.log('🔥 Initializing Firebase...');\n    this.app = initializeApp(FIREBASE_CONFIG);\n    this.db = getFirestore(this.app);\n    console.log('✅ Firebase initialized');\n  }\n  \n  async discoverUsers() {\n    console.log('\\n📋 STEP 1: Discovering users...');\n    console.log('='.repeat(60));\n    \n    try {\n      const sourceCollectionRef = collection(this.db, this.config.sourceCollection);\n      const snapshot = await getDocs(sourceCollectionRef);\n      \n      const userIds = [];\n      snapshot.forEach(docSnap => {\n        userIds.push(docSnap.id);\n      });\n      \n      console.log(`✅ Found ${userIds.length} user(s) with data`);\n      userIds.forEach((uid, idx) => {\n        console.log(`   ${idx + 1}. ${uid}`);\n      });\n      \n      this.migrationLog.push({\n        step: 'discovery',\n        timestamp: new Date().toISOString(),\n        usersFound: userIds.length,\n        userIds\n      });\n      \n      return userIds;\n    } catch (error) {\n      console.error('❌ Error discovering users:', error);\n      this.errors.push({ step: 'discovery', error: error.message });\n      throw error;\n    }\n  }\n\n  async backupUserData(userId) {\n    console.log(`\\n💾 Backing up data for user: ${userId}`);\n    \n    try {\n      const sourcePath = `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`;\n      const docRef = doc(this.db, sourcePath);\n      const docSnap = await getDoc(docRef);\n      \n      if (docSnap.exists()) {\n        const data = docSnap.data();\n        this.backupData[userId] = {\n          sourcePath,\n          data,\n          timestamp: new Date().toISOString()\n        };\n        \n        console.log(`✅ Backed up ${Object.keys(data).length} fields`);\n        \n        if (this.config.backupToConsole) {\n          console.log('📄 Data preview:', {\n            currentCycle: data.currentCycle,\n            assessmentCount: data.assessmentHistory?.length || 0,\n            planCount: data.planHistory?.length || 0,\n            hasFocusAreas: !!data.currentPlan?.focusAreas,\n            focusAreaCount: data.currentPlan?.focusAreas?.length || 0\n          });\n        }\n        \n        return data;\n      } else {\n        console.log(`⚠️ No data found at ${sourcePath}`);\n        return null;\n      }\n    } catch (error) {\n      console.error(`❌ Error backing up user ${userId}:`, error);\n      this.errors.push({ step: 'backup', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  async migrateUser(userId, data) {\n    console.log(`\\n🔄 Migrating user: ${userId}`);\n    console.log('='.repeat(60));\n    \n    if (!data) {\n      console.log('⏭️ No data to migrate, skipping');\n      return { skipped: true };\n    }\n\n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      \n      const migrationData = {\n        ...data,\n        _migratedAt: serverTimestamp(),\n        _migratedFrom: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        _migrationVersion: '1.0.0'\n      };\n      \n      console.log(`📍 Target path: ${targetPath}`);\n      console.log(`📦 Migrating ${Object.keys(migrationData).length} fields`);\n      \n      if (this.config.dryRun) {\n        console.log('🔍 DRY RUN: Would write to:', targetPath);\n        console.log('🔍 DRY RUN: Data preview:', {\n          currentCycle: migrationData.currentCycle,\n          hasFocusAreas: !!migrationData.currentPlan?.focusAreas,\n          assessmentCount: migrationData.assessmentHistory?.length || 0\n        });\n        return { dryRun: true, targetPath, dataSize: Object.keys(migrationData).length };\n      }\n      \n      const docRef = doc(this.db, targetPath);\n      await setDoc(docRef, migrationData);\n      \n      console.log('✅ Migration successful!');\n      \n      this.migrationLog.push({\n        step: 'migration',\n        userId,\n        sourcePath: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        targetPath,\n        timestamp: new Date().toISOString(),\n        fieldsCount: Object.keys(migrationData).length\n      });\n      \n      return { success: true, targetPath };\n    } catch (error) {\n      console.error(`❌ Error migrating user ${userId}:`, error);\n      this.errors.push({ step: 'migration', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  async verifyMigration(userId, originalData) {\n    console.log(`\\n🔍 Verifying migration for user: ${userId}`);\n    \n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      const docRef = doc(this.db, targetPath);\n      const docSnap = await getDoc(docRef);\n      \n      if (!docSnap.exists()) {\n        console.log('❌ VERIFICATION FAILED: Document does not exist!');\n        return { success: false, reason: 'Document not found' };\n      }\n      \n      const migratedData = docSnap.data();\n      \n      const checks = {\n        currentCycle: originalData.currentCycle === migratedData.currentCycle,\n        hasCurrentPlan: !!migratedData.currentPlan,\n        hasFocusAreas: !!migratedData.currentPlan?.focusAreas,\n        focusAreaCount: originalData.currentPlan?.focusAreas?.length === migratedData.currentPlan?.focusAreas?.length,\n        assessmentCount: originalData.assessmentHistory?.length === migratedData.assessmentHistory?.length,\n        planHistoryCount: originalData.planHistory?.length === migratedData.planHistory?.length,\n      };\n      \n      const allChecksPassed = Object.values(checks).every(v => v === true);\n      \n      console.log('📊 Verification Results:');\n      Object.entries(checks).forEach(([key, passed]) => {\n        console.log(`   ${passed ? '✅' : '❌'} ${key}`);\n      });\n      \n      if (allChecksPassed) {\n        console.log('✅ VERIFICATION PASSED!');\n      } else {\n        console.log('⚠️ VERIFICATION ISSUES DETECTED');\n      }\n      \n      this.migrationLog.push({\n        step: 'verification',\n        userId,\n        checks,\n        allChecksPassed,\n        timestamp: new Date().toISOString()\n      });\n      \n      return { success: allChecksPassed, checks };\n    } catch (error) {\n      console.error(`❌ Error verifying user ${userId}:`, error);\n      this.errors.push({ step: 'verification', userId, error: error.message });\n      return { success: false, error: error.message };\n    }\n  }\n\n  async run() {\n    console.log('\\n');\n    console.log('='.repeat(80));\n    console.log('🚀 DEVELOPMENT PLAN MIGRATION');\n    console.log('='.repeat(80));\n    console.log(`From: ${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`);\n    console.log(`To:   ${this.config.targetCollection}/${'{userId}'}/${this.config.targetPath}`);\n    console.log(`Mode: ${this.config.dryRun ? '🔍 DRY RUN' : '🔥 LIVE MIGRATION'}`);\n    console.log('='.repeat(80));\n    console.log('\\n');\n\n    try {\n      await this.initialize();\n      \n      const userIds = await this.discoverUsers();\n      \n      if (userIds.length === 0) {\n        console.log('\\n⚠️ No users found to migrate!');\n        return { success: false, reason: 'No users found' };\n      }\n      \n      const results = [];\n      \n      for (const userId of userIds) {\n        console.log('\\n' + '━'.repeat(80));\n        console.log(`👤 Processing User: ${userId}`);\n        console.log('━'.repeat(80));\n        \n        try {\n          const originalData = await this.backupUserData(userId);\n          const migrationResult = await this.migrateUser(userId, originalData);\n          \n          let verificationResult = null;\n          if (!this.config.dryRun && this.config.verifyAfterMigration) {\n            verificationResult = await this.verifyMigration(userId, originalData);\n          }\n          \n          results.push({\n            userId,\n            backup: !!originalData,\n            migration: migrationResult,\n            verification: verificationResult\n          });\n          \n        } catch (error) {\n          console.error(`❌ Failed to process user ${userId}:`, error);\n          results.push({\n            userId,\n            error: error.message\n          });\n        }\n      }\n      \n      this.printSummary(results);\n      \n      return {\n        success: true,\n        results,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      };\n      \n    } catch (error) {\n      console.error('\\n❌ MIGRATION FAILED:', error);\n      return {\n        success: false,\n        error: error.message,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      };\n    }\n  }\n\n  printSummary(results) {\n    console.log('\\n\\n');\n    console.log('='.repeat(80));\n    console.log('📊 MIGRATION SUMMARY');\n    console.log('='.repeat(80));\n    \n    const total = results.length;\n    const successful = results.filter(r => r.migration?.success || r.migration?.dryRun).length;\n    const failed = results.filter(r => r.error).length;\n    const verified = results.filter(r => r.verification?.success).length;\n    \n    console.log(`\\n✨ Total Users: ${total}`);\n    console.log(`✅ Successful: ${successful}`);\n    console.log(`❌ Failed: ${failed}`);\n    if (this.config.verifyAfterMigration && !this.config.dryRun) {\n      console.log(`🔍 Verified: ${verified}`);\n    }\n    \n    if (this.errors.length > 0) {\n      console.log('\\n⚠️ ERRORS ENCOUNTERED:');\n      this.errors.forEach((error, idx) => {\n        console.log(`   ${idx + 1}. ${error.step}: ${error.error}`);\n      });\n    }\n    \n    if (this.config.dryRun) {\n      console.log('\\n🔍 DRY RUN COMPLETE - No changes made');\n      console.log('💡 Set dryRun: false to perform actual migration');\n    } else {\n      console.log('\\n✅ MIGRATION COMPLETE!');\n      console.log('💾 Backup data saved in memory');\n    }\n    \n    console.log('='.repeat(80));\n    console.log('\\n');\n  }\n\n  exportBackup() {\n    const backup = {\n      timestamp: new Date().toISOString(),\n      source: `${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`,\n      data: this.backupData,\n      log: this.migrationLog\n    };\n    \n    console.log('\\n💾 BACKUP DATA:');\n    console.log(JSON.stringify(backup, null, 2));\n    \n    return backup;\n  }\n}\n\n// ============================================\n// AUTO-EXECUTE ON RUN\n// ============================================\n\nasync function main() {\n  // Check if Firebase config is updated\n  if (!FIREBASE_CONFIG.apiKey || FIREBASE_CONFIG.apiKey === \"YOUR_API_KEY\") {\n    console.log('\\n');\n    console.log('⚠️ '.repeat(40));\n    console.log('❌ ERROR: Firebase credentials not configured!');\n    console.log('⚠️ '.repeat(40));\n    console.log('\\n');\n    console.log('📝 REQUIRED STEPS:');\n    console.log('   1. Make sure you have a .env file with your Firebase credentials.');\n    console.log('   2. Update FIREBASE_CONFIG (lines 10-17) with your actual credentials');\n    console.log('   3. Get credentials from: https://console.firebase.google.com');\n    console.log('   4. Save the file');\n    console.log('   5. Run again: node migrate-READY-TO-RUN.js');\n    console.log('\\n');\n    process.exit(1);\n  }\n\n  // Run migration\n  const migration = new DevelopmentPlanMigration(MIGRATION_CONFIG);\n  const result = await migration.run();\n  \n  // Offer to export backup\n  if (result.success) {\n    console.log('\\n💡 TIP: To export backup data, run this in Node REPL:');\n    console.log('   const { DevelopmentPlanMigration } = require(\"./migrate-READY-TO-RUN.js\");');\n    console.log('   const m = new DevelopmentPlanMigration(...);');\n    console.log('   m.exportBackup();');\n  }\n  \n  process.exit(result.success ? 0 : 1);\n}\n\n// Run if executed directly\nif (require.main === module) {\n  main().catch(error => {\n    console.error('Fatal error:', error);\n    process.exit(1);\n  });\n}\n\nmodule.exports = { DevelopmentPlanMigration, MIGRATION_CONFIG };\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/migrate.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/migration-READY.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/migration.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'writeBatch' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// MIGRATION SCRIPT: leadership_plan → development_plan\n// Purpose: Permanently fix database structure to match code architecture\n// Risk Level: LOW (with backups and verification)\n// Estimated Time: 15-20 minutes\n\nimport { initializeApp } from 'firebase/app';\nimport { \n  getFirestore, \n  collection, \n  getDocs, \n  doc, \n  getDoc,\n  setDoc, \n  writeBatch,\n  serverTimestamp \n} from 'firebase/firestore';\n\n// ============================================\n// CONFIGURATION\n// ============================================\n\nconst FIREBASE_CONFIG = {\n  apiKey: process.env.VITE_FIREBASE_API_KEY,\n  authDomain: process.env.VITE_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.VITE_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.VITE_FIREBASE_APP_ID,\n  measurementId: process.env.VITE_FIREBASE_MEASUREMENT_ID\n};\n\nconst MIGRATION_CONFIG = {\n  // Source (old structure)\n  sourceCollection: 'leadership_plan',\n  sourcePath: 'profile/roadmap',  // Under userId\n  \n  // Target (new structure)\n  targetCollection: 'development_plan',\n  targetPath: 'user_state/profile',  // Under userId\n  \n  // Safety settings\n  dryRun: true,  // Set to false to actually migrate\n  backupToConsole: true,\n  verifyAfterMigration: true,\n};\n\n// ============================================\n// MIGRATION FUNCTIONS\n// ============================================\n\nclass DevelopmentPlanMigration {\n  constructor(config) {\n    this.config = config;\n    this.app = null;\n    this.db = null;\n    this.migrationLog = [];\n    this.errors = [];\n    this.backupData = {};\n  }\n\n  // Initialize Firebase\n  async initialize() {\n    console.log('🔥 Initializing Firebase...');\n    this.app = initializeApp(FIREBASE_CONFIG);\n    this.db = getFirestore(this.app);\n    console.log('✅ Firebase initialized');\n  }\n\n  // Step 1: Discover all users with data\n  async discoverUsers() {\n    console.log('\\n📋 STEP 1: Discovering users...');\n    console.log('='.repeat(60));\n    \n    try {\n      const sourceCollectionRef = collection(this.db, this.config.sourceCollection);\n      const snapshot = await getDocs(sourceCollectionRef);\n      \n      const userIds = [];\n      snapshot.forEach(doc => {\n        userIds.push(doc.id);\n      });\n      \n      console.log(`✅ Found ${userIds.length} user(s) with data`);\n      userIds.forEach((uid, idx) => {\n        console.log(`   ${idx + 1}. ${uid}`);\n      });\n      \n      this.migrationLog.push({\n        step: 'discovery',\n        timestamp: new Date().toISOString(),\n        usersFound: userIds.length,\n        userIds\n      });\n      \n      return userIds;\n    } catch (error) {\n      console.error('❌ Error discovering users:', error);\n      this.errors.push({ step: 'discovery', error: error.message });\n      throw error;\n    }\n  }\n\n  // Step 2: Backup existing data\n  async backupUserData(userId) {\n    console.log(`\\n💾 Backing up data for user: ${userId}`);\n    \n    try {\n      const sourcePath = `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`;\n      const docRef = doc(this.db, sourcePath);\n      const docSnap = await getDoc(docRef);\n      \n      if (docSnap.exists()) {\n        const data = docSnap.data();\n        this.backupData[userId] = {\n          sourcePath,\n          data,\n          timestamp: new Date().toISOString()\n        };\n        \n        console.log(`✅ Backed up ${Object.keys(data).length} fields`);\n        \n        if (this.config.backupToConsole) {\n          console.log('📄 Data preview:', {\n            currentCycle: data.currentCycle,\n            assessmentCount: data.assessmentHistory?.length || 0,\n            planCount: data.planHistory?.length || 0,\n            hasFocusAreas: !!data.currentPlan?.focusAreas,\n            focusAreaCount: data.currentPlan?.focusAreas?.length || 0\n          });\n        }\n        \n        return data;\n      } else {\n        console.log(`⚠️ No data found at ${sourcePath}`);\n        return null;\n      }\n    } catch (error) {\n      console.error(`❌ Error backing up user ${userId}:`, error);\n      this.errors.push({ step: 'backup', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  // Step 3: Migrate single user\n  async migrateUser(userId, data) {\n    console.log(`\\n🔄 Migrating user: ${userId}`);\n    console.log('='.repeat(60));\n    \n    if (!data) {\n      console.log('⏭️ No data to migrate, skipping');\n      return { skipped: true };\n    }\n\n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      \n      // Prepare migration data\n      const migrationData = {\n        ...data,\n        _migratedAt: serverTimestamp(),\n        _migratedFrom: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        _migrationVersion: '1.0.0'\n      };\n      \n      console.log(`📍 Target path: ${targetPath}`);\n      console.log(`📦 Migrating ${Object.keys(migrationData).length} fields`);\n      \n      if (this.config.dryRun) {\n        console.log('🔍 DRY RUN: Would write to:', targetPath);\n        console.log('🔍 DRY RUN: Data preview:', {\n          currentCycle: migrationData.currentCycle,\n          hasFocusAreas: !!migrationData.currentPlan?.focusAreas,\n          assessmentCount: migrationData.assessmentHistory?.length || 0\n        });\n        return { dryRun: true, targetPath, dataSize: Object.keys(migrationData).length };\n      }\n      \n      // Actually write the data\n      const docRef = doc(this.db, targetPath);\n      await setDoc(docRef, migrationData);\n      \n      console.log('✅ Migration successful!');\n      \n      this.migrationLog.push({\n        step: 'migration',\n        userId,\n        sourcePath: `${this.config.sourceCollection}/${userId}/${this.config.sourcePath}`,\n        targetPath,\n        timestamp: new Date().toISOString(),\n        fieldsCount: Object.keys(migrationData).length\n      });\n      \n      return { success: true, targetPath };\n    } catch (error) {\n      console.error(`❌ Error migrating user ${userId}:`, error);\n      this.errors.push({ step: 'migration', userId, error: error.message });\n      throw error;\n    }\n  }\n\n  // Step 4: Verify migration\n  async verifyMigration(userId, originalData) {\n    console.log(`\\n🔍 Verifying migration for user: ${userId}`);\n    \n    try {\n      const targetPath = `${this.config.targetCollection}/${userId}/${this.config.targetPath}`;\n      const docRef = doc(this.db, targetPath);\n      const docSnap = await getDoc(docRef);\n      \n      if (!docSnap.exists()) {\n        console.log('❌ VERIFICATION FAILED: Document does not exist!');\n        return { success: false, reason: 'Document not found' };\n      }\n      \n      const migratedData = docSnap.data();\n      \n      // Verify key fields\n      const checks = {\n        currentCycle: originalData.currentCycle === migratedData.currentCycle,\n        hasCurrentPlan: !!migratedData.currentPlan,\n        hasFocusAreas: !!migratedData.currentPlan?.focusAreas,\n        focusAreaCount: originalData.currentPlan?.focusAreas?.length === migratedData.currentPlan?.focusAreas?.length,\n        assessmentCount: originalData.assessmentHistory?.length === migratedData.assessmentHistory?.length,\n        planHistoryCount: originalData.planHistory?.length === migratedData.planHistory?.length,\n      };\n      \n      const allChecksPassed = Object.values(checks).every(v => v === true);\n      \n      console.log('📊 Verification Results:');\n      Object.entries(checks).forEach(([key, passed]) => {\n        console.log(`   ${passed ? '✅' : '❌'} ${key}`);\n      });\n      \n      if (allChecksPassed) {\n        console.log('✅ VERIFICATION PASSED!');\n      } else {\n        console.log('⚠️ VERIFICATION ISSUES DETECTED');\n      }\n      \n      this.migrationLog.push({\n        step: 'verification',\n        userId,\n        checks,\n        allChecksPassed,\n        timestamp: new Date().toISOString()\n      });\n      \n      return { success: allChecksPassed, checks };\n    } catch (error) {\n      console.error(`❌ Error verifying user ${userId}:`, error);\n      this.errors.push({ step: 'verification', userId, error: error.message });\n      return { success: false, error: error.message };\n    }\n  }\n\n  // Main migration orchestration\n  async run() {\n    console.log('\\n');\n    console.log('='.repeat(80));\n    console.log('🚀 DEVELOPMENT PLAN MIGRATION');\n    console.log('='.repeat(80));\n    console.log(`From: ${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`);\n    console.log(`To:   ${this.config.targetCollection}/${'{userId}'}/${this.config.targetPath}`);\n    console.log(`Mode: ${this.config.dryRun ? '🔍 DRY RUN' : '🔥 LIVE MIGRATION'}`);\n    console.log('='.repeat(80));\n    console.log('\\n');\n\n    try {\n      // Initialize\n      await this.initialize();\n      \n      // Discover users\n      const userIds = await this.discoverUsers();\n      \n      if (userIds.length === 0) {\n        console.log('\\n⚠️ No users found to migrate!');\n        return { success: false, reason: 'No users found' };\n      }\n      \n      // Migrate each user\n      const results = [];\n      \n      for (const userId of userIds) {\n        console.log('\\n' + '━'.repeat(80));\n        console.log(`👤 Processing User: ${userId}`);\n        console.log('━'.repeat(80));\n        \n        try {\n          // Backup\n          const originalData = await this.backupUserData(userId);\n          \n          // Migrate\n          const migrationResult = await this.migrateUser(userId, originalData);\n          \n          // Verify (if not dry run)\n          let verificationResult = null;\n          if (!this.config.dryRun && this.config.verifyAfterMigration) {\n            verificationResult = await this.verifyMigration(userId, originalData);\n          }\n          \n          results.push({\n            userId,\n            backup: !!originalData,\n            migration: migrationResult,\n            verification: verificationResult\n          });\n          \n        } catch (error) {\n          console.error(`❌ Failed to process user ${userId}:`, error);\n          results.push({\n            userId,\n            error: error.message\n          });\n        }\n      }\n      \n      // Final summary\n      this.printSummary(results);\n      \n      return {\n        success: true,\n        results,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      };\n      \n    } catch (error) {\n      console.error('\\n❌ MIGRATION FAILED:', error);\n      return {\n        success: false,\n        error: error.message,\n        log: this.migrationLog,\n        errors: this.errors,\n        backup: this.backupData\n      };\n    }\n  }\n\n  // Print final summary\n  printSummary(results) {\n    console.log('\\n\\n');\n    console.log('='.repeat(80));\n    console.log('📊 MIGRATION SUMMARY');\n    console.log('='.repeat(80));\n    \n    const total = results.length;\n    const successful = results.filter(r => r.migration?.success || r.migration?.dryRun).length;\n    const failed = results.filter(r => r.error).length;\n    const verified = results.filter(r => r.verification?.success).length;\n    \n    console.log(`\\n✨ Total Users: ${total}`);\n    console.log(`✅ Successful: ${successful}`);\n    console.log(`❌ Failed: ${failed}`);\n    if (this.config.verifyAfterMigration && !this.config.dryRun) {\n      console.log(`🔍 Verified: ${verified}`);\n    }\n    \n    if (this.errors.length > 0) {\n      console.log('\\n⚠️ ERRORS ENCOUNTERED:');\n      this.errors.forEach((error, idx) => {\n        console.log(`   ${idx + 1}. ${error.step}: ${error.error}`);\n      });\n    }\n    \n    if (this.config.dryRun) {\n      console.log('\\n🔍 DRY RUN COMPLETE - No changes made');\n      console.log('💡 Set dryRun: false to perform actual migration');\n    } else {\n      console.log('\\n✅ MIGRATION COMPLETE!');\n      console.log('💾 Backup data saved in memory');\n      console.log('📋 Full log available in migrationLog property');\n    }\n    \n    console.log('='.repeat(80));\n    console.log('\\n');\n  }\n\n  // Export backup to JSON file\n  exportBackup() {\n    const backup = {\n      timestamp: new Date().toISOString(),\n      source: `${this.config.sourceCollection}/${'{userId}'}/${this.config.sourcePath}`,\n      data: this.backupData,\n      log: this.migrationLog\n    };\n    \n    console.log('\\n💾 BACKUP DATA:');\n    console.log(JSON.stringify(backup, null, 2));\n    \n    return backup;\n  }\n}\n\n// ============================================\n// USAGE INSTRUCTIONS\n// ============================================\n\n/*\nSTEP 1: Update FIREBASE_CONFIG above with your Firebase credentials\n\nSTEP 2: Run in DRY RUN mode first (dryRun: true)\n  const migration = new DevelopmentPlanMigration(MIGRATION_CONFIG);\n  await migration.run();\n\nSTEP 3: Review the output and verify everything looks correct\n\nSTEP 4: Set dryRun: false and run for real\n  MIGRATION_CONFIG.dryRun = false;\n  const migration = new DevelopmentPlanMigration(MIGRATION_CONFIG);\n  const result = await migration.run();\n\nSTEP 5: Export backup if needed\n  migration.exportBackup();\n\nSTEP 6: Verify in Firebase Console that data is in new location\n\nSTEP 7: Delete old collection (manual step after verification)\n*/\n\n// ============================================\n// EXPORT\n// ============================================\n\nexport { DevelopmentPlanMigration, MIGRATION_CONFIG };\n\n// For Node.js usage:\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { DevelopmentPlanMigration, MIGRATION_CONFIG };\n}\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/postcss.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/scripts/set-admin-claim.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/set-membership-tier.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/auth/AuthPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/layout/AppContent.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isNavExpanded' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/layout/AppContent.jsx\n\nimport React, { Suspense, useCallback } from 'react';\nimport { signOut } from 'firebase/auth';\nimport { Menu, LogOut, Loader } from 'lucide-react';\nimport PWAInstall from '../ui/PWAInstall.jsx';\nimport NavSidebar from './NavSidebar.jsx';\nimport ScreenRouter from '../../routing/ScreenRouter.jsx';\nimport { useAppServices } from '../../services/useAppServices.jsx';\n\nconst AppContent = ({\n  currentScreen,\n  setCurrentScreen,\n  user,\n  navParams,\n  isMobileOpen,\n  setIsMobileOpen,\n  isAuthRequired,\n  isNavExpanded,\n  setIsNavExpanded,\n  auth,\n}) => {\n  const closeMobileMenu = useCallback(() => setIsMobileOpen(false), [\n    setIsMobileOpen,\n  ]);\n  const { navigate } = useAppServices();\n\n  const handleSignOut = async () => {\n    try {\n      if (auth) await signOut(auth);\n      console.log('Sign Out successful.');\n      closeMobileMenu();\n    } catch (e) {\n      console.error('Sign out failed:', e);\n    }\n  };\n\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <div className=\"relative min-h-screen flex flex-col font-sans antialiased bg-corporate-light-gray\">\n      <header className=\"sticky top-0 bg-white/95 backdrop-blur-sm shadow-md flex justify-between items-center z-50 px-4 py-2 border-b border-corporate-subtle-teal\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => setIsMobileOpen(true)}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors text-corporate-navy\"\n            title=\"Open Menu\"\n          >\n            <Menu className=\"w-6 h-6\" />\n          </button>\n          <h1 className=\"text-xl font-bold text-corporate-navy\">\n            LeaderReps\n          </h1>\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <PWAInstall />\n          <button\n            onClick={handleSignOut}\n            className=\"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-1 bg-corporate-orange text-white\"\n            title=\"Sign Out\"\n          >\n            <LogOut className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Exit</span>\n          </button>\n        </div>\n      </header>\n\n      <NavSidebar\n        currentScreen={currentScreen}\n        setCurrentScreen={setCurrentScreen}\n        user={user}\n        closeMobileMenu={closeMobileMenu}\n        isAuthRequired={isAuthRequired}\n        isNavExpanded={true}\n        setIsNavExpanded={setIsNavExpanded}\n        isHamburgerMode={true}\n        isMobileOpen={isMobileOpen}\n        setIsMobileOpen={setIsMobileOpen}\n      />\n\n      <main className=\"flex-1 flex flex-col\">\n        <div className=\"flex-1 overflow-y-auto\">\n          <Suspense\n            fallback={\n              <div className=\"min-h-[calc(100vh-64px)] flex items-center justify-center gradient-corporate-hero\">\n                <div className=\"card-corporate-elevated flex flex-col items-center p-12\">\n                  <div className=\"loading-corporate mb-6\"></div>\n                  <p className=\"corporate-text-body text-corporate-navy\">\n                    Loading Content...\n                  </p>\n                </div>\n              </div>\n            }\n          >\n            <ScreenRouter\n              currentScreen={currentScreen}\n              navParams={navParams}\n              navigate={navigate}\n            />\n          </Suspense>\n        </div>\n\n        <footer className=\"w-full text-center mt-auto border-t bg-corporate-light-gray border-corporate-subtle-teal p-4\">\n          <p className=\"corporate-text-muted\">\n            © {currentYear} LeaderReps. All rights reserved.\n          </p>\n          <div className=\"mt-2 flex flex-wrap justify-center gap-1 text-xs text-text-muted\">\n            <a\n              href=\"https://leaderreps.com/privacy-policy\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:underline transition-colors duration-200 text-text-muted\"\n            >\n              Privacy Policy\n            </a>\n            <span>|</span>\n            <a\n              href=\"https://leaderreps.com/terms-of-service\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:underline transition-colors duration-200 text-text-muted\"\n            >\n              Terms of Service\n            </a>\n            <span>|</span>\n            <a\n              href=\"https://leaderreps.com/cookie-policy\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:underline transition-colors duration-200 text-text-muted\"\n            >\n              Cookie Policy\n            </a>\n            <span>|</span>\n            <a\n              href=\"https://leaderreps.com/refund-policy\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:underline transition-colors duration-200 text-text-muted\"\n            >\n              Refund Policy\n            </a>\n            <span>|</span>\n            <a\n              href=\"https://leaderreps.com/contact\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:underline transition-colors duration-200 text-text-muted\"\n            >\n              Contact Us\n            </a>\n          </div>\n        </footer>\n      </main>\n    </div>\n  );\n};\n\nexport default AppContent;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/layout/NavSidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsNavExpanded' is defined but never used.","line":28,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'auth' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":33,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'isProfileOpen' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":34,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/layout/NavSidebar.jsx\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n  Home,\n  Briefcase,\n  BookOpen,\n  ShieldCheck,\n  Trello,\n  Film,\n  Mic,\n  BarChart3,\n  Users,\n  DollarSign,\n  Settings,\n  X,\n} from 'lucide-react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport { membershipService } from '../../services/membershipService.js';\n\nconst NavSidebar = ({\n  currentScreen,\n  setCurrentScreen,\n  user,\n  closeMobileMenu,\n  isAuthRequired,\n  isNavExpanded,\n  setIsNavExpanded,\n  isHamburgerMode = false,\n  isMobileOpen,\n  setIsMobileOpen,\n}) => {\n  const { auth, featureFlags, isAdmin, membershipData } = useAppServices();\n  const [isProfileOpen, setIsProfileOpen] = useState(false);\n\n  const [isDeveloperMode, setIsDeveloperMode] = useState(() => {\n    return localStorage.getItem('arena-developer-mode') === 'true';\n  });\n\n  useEffect(() => {\n    const handleStorageChange = () => {\n      setIsDeveloperMode(localStorage.getItem('arena-developer-mode') === 'true');\n    };\n    window.addEventListener('storage', handleStorageChange);\n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, []);\n\n  const coreNav = [{ screen: 'dashboard', label: 'The Arena', icon: Home }];\n\n  const contentPillarNav = [\n    {\n      screen: 'development-plan',\n      label: 'Development Plan',\n      icon: Briefcase,\n      flag: 'enableDevPlan',\n      requiredTier: 'basic',\n    },\n    {\n      screen: 'business-readings',\n      label: 'Professional Reading Hub',\n      icon: BookOpen,\n      flag: 'enableReadings',\n      requiredTier: 'professional',\n      devModeOnly: true,\n    },\n    {\n      screen: 'applied-leadership',\n      label: 'Course Library',\n      icon: ShieldCheck,\n      flag: 'enableCourses',\n      requiredTier: 'professional',\n      devModeOnly: true,\n    },\n    {\n      screen: 'planning-hub',\n      label: 'Strategic Content Tools',\n      icon: Trello,\n      flag: 'enablePlanningHub',\n      requiredTier: 'elite',\n      devModeOnly: true,\n    },\n    {\n      screen: 'leadership-videos',\n      label: 'Content Leader Talks',\n      icon: Film,\n      flag: 'enableVideos',\n      requiredTier: 'elite',\n      devModeOnly: true,\n    },\n  ];\n\n  const coachingPillarNav = [\n    {\n      screen: 'labs',\n      label: 'AI Coaching Lab',\n      icon: Mic,\n      flag: 'enableLabs',\n      requiredTier: 'elite',\n      devModeOnly: true,\n    },\n    {\n      screen: 'executive-reflection',\n      label: 'Executive ROI Report',\n      icon: BarChart3,\n      flag: 'enableRoiReport',\n      requiredTier: 'elite',\n      devModeOnly: true,\n    },\n  ];\n\n  const communityPillarNav = [\n    {\n      screen: 'community',\n      label: 'Leadership Community',\n      icon: Users,\n      flag: 'enableCommunity',\n      requiredTier: 'professional',\n      devModeOnly: true,\n    },\n  ];\n\n  const systemNav = [\n    {\n      screen: 'membership-module',\n      label: 'Membership & Billing',\n      icon: DollarSign,\n      flag: 'enableMembershipModule',\n      requiredTier: 'basic',\n    },\n    {\n      screen: 'app-settings',\n      label: 'App Settings',\n      icon: Settings,\n      requiredTier: 'basic',\n      devModeOnly: true,\n    },\n  ];\n\n  const menuSections = [\n    { title: 'CORE', items: coreNav },\n    { title: 'CONTENT PILLAR', items: contentPillarNav },\n    { title: 'COACHING PILLAR', items: coachingPillarNav },\n    { title: 'COMMUNITY PILLAR', items: communityPillarNav },\n    { title: 'SYSTEM', items: systemNav },\n  ];\n\n  const handleNavigate = useCallback(\n    (screen) => {\n      setCurrentScreen(screen);\n      setIsProfileOpen(false);\n      closeMobileMenu();\n    },\n    [setCurrentScreen, closeMobileMenu]\n  );\n\n  const renderNavItems = (items) =>\n    items\n      .filter((item) => {\n        if (isAdmin || isDeveloperMode) {\n          return true;\n        }\n        if (item.devModeOnly) {\n          return false;\n        }\n        if (item.flag && featureFlags && featureFlags[item.flag] !== true) {\n          return false;\n        }\n        if (\n          item.requiredTier &&\n          !membershipService.hasAccess(\n            membershipData?.currentTier,\n            item.requiredTier\n          )\n        ) {\n          return false;\n        }\n        return true;\n      })\n      .map((item) => {\n        const Icon = item.icon;\n        const isActive = currentScreen === item.screen;\n        const label = item.label;\n\n        return (\n          <button\n            key={item.screen}\n            onClick={() => handleNavigate(item.screen)}\n            title={!isNavExpanded ? label : ''}\n            className={`nav-item-corporate relative group flex items-center w-full transition-all duration-200 focus:outline-none rounded-lg px-3 py-2 text-sm font-semibold ${\n              isActive ? 'active bg-corporate-teal text-white shadow-md' : 'text-corporate-light-gray'\n            }`}\n          >\n            <Icon\n              className={`w-5 h-5 flex-shrink-0 transition-colors duration-200 ${\n                isNavExpanded ? 'mr-3' : ''\n              } ${isActive ? 'text-white' : 'text-corporate-subtle-teal'}`}\n            />\n            {isNavExpanded && (\n              <span\n                className={`flex-1 text-left whitespace-nowrap overflow-hidden overflow-ellipsis transition-opacity duration-300 ${\n                  isNavExpanded ? 'opacity-100' : 'opacity-0'\n                }`}\n              >\n                {label}\n              </span>\n            )}\n            {!isNavExpanded && (\n              <span\n                className={`absolute left-full ml-3 w-auto px-4 py-2.5 text-base font-bold whitespace-nowrap rounded-lg shadow-2xl opacity-0 pointer-events-none group-hover:opacity-100 transition-all duration-150 z-50 bg-corporate-navy text-corporate-teal border-2 border-corporate-teal`}\n                style={{boxShadow: `0 8px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(71, 168, 141, 0.25)`}}\n              >\n                {label}\n              </span>\n            )}\n          </button>\n        );\n      });\n\n  if (isAuthRequired) return null;\n\n  const handleNavClick = (screen) => {\n    setCurrentScreen(screen);\n    if (isHamburgerMode && setIsMobileOpen) {\n      setIsMobileOpen(false);\n    }\n  };\n\n  if (isHamburgerMode) {\n    return (\n      <>\n        {isMobileOpen && (\n          <div\n            className=\"fixed inset-0 bg-black/50 z-40\"\n            onClick={() => setIsMobileOpen(false)}\n          />\n        )}\n        <div\n          className={`fixed top-0 left-0 h-full z-50 transform transition-transform duration-300 ease-in-out ${\n            isMobileOpen ? 'translate-x-0' : '-translate-x-full'\n          } bg-corporate-navy w-[280px] shadow-2xl`}\n        >\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200/20\">\n            <h2\n              className=\"text-lg font-bold text-corporate-teal\"\n            >\n              Navigation\n            </h2>\n            <button\n              onClick={() => setIsMobileOpen(false)}\n              className=\"p-2 hover:bg-gray-100/10 rounded-lg transition-colors text-corporate-light-gray\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n          <div className=\"flex-1 overflow-y-auto p-2\">\n            {menuSections.map((section) => (\n              <div key={section.title} className=\"mb-6\">\n                <h3\n                  className=\"px-3 py-2 text-xs font-semibold uppercase tracking-wider text-corporate-teal\"\n                >\n                  {section.title}\n                </h3>\n                <div className=\"space-y-1\">\n                  {renderNavItems(section.items).map((item, index) => {\n                    const Icon = item.icon;\n                    const isActive = currentScreen === item.screen;\n                    return (\n                      <button\n                        key={item.screen || index}\n                        onClick={() => handleNavClick(item.screen)}\n                        className={`w-full flex items-center px-3 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 ${\n                          isActive ? 'bg-teal-600/20 text-corporate-teal' : 'hover:bg-gray-100/10 text-corporate-light-gray'\n                        }`}\n                      >\n                        <Icon className=\"w-5 h-5 mr-3 flex-shrink-0\" />\n                        <span>{item.label}</span>\n                      </button>\n                    );\n                  })}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return null;\n};\n\nexport default NavSidebar;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/modals/TwoMinuteChallengeModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'isVisible'. Either exclude it or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [catalog]","fix":{"range":[2122,2142],"text":"[catalog]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/modals/TwoMinuteChallengeModal.jsx\n\nimport React, { useState, useMemo } from 'react';\nimport { X, Zap, CheckCircle, CornerRightUp, AlertTriangle } from 'lucide-react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\n\nconst COLORS = {\n  NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', OFF_WHITE: '#FFFFFF',\n};\n\n// --- ENHANCEMENT: QUICK CHALLENGE CATALOG DELETED (Now loaded via service context) ---\n// Fallback array for safety if service data hasn't loaded or is empty\nconst QUICK_CHALLENGE_FALLBACK = [\n    { rep: \"Take one deep, deliberate breath (T1 - Fallback)\", tier: 'T1' },\n    { rep: \"Send a thank-you Slack (T4 - Fallback)\", tier: 'T4' },\n];\n\n\nconst Button = ({ children, onClick, disabled = false, className = '', ...rest }) => (\n    <button {...rest} onClick={onClick} disabled={disabled} className={`px-6 py-3 rounded-xl font-semibold transition-all shadow-lg text-white flex items-center justify-center ${className} ${disabled ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'}`}>\n      {children}\n    </button>\n);\n\n// --- MODAL COMPONENT (Feature 3: 2-Minute Challenge Mode) ---\nconst TwoMinuteChallengeModal = ({ isVisible, onClose, sourceScreen, onLogSuccess }) => {\n    // CRITICAL FIX: Destructure the service data including the challenge catalog\n    const { updateCommitmentData, navigate, QUICK_CHALLENGE_CATALOG } = useAppServices();\n\n    const [isLogging, setIsLogging] = useState(false);\n    const [logStatus, setLogStatus] = useState(null); // 'success' or 'error'\n    const [journalNote, setJournalNote] = useState(''); // Feature 4: Journal note capture\n    \n    // Use service data for the catalog, falling back if not ready\n    const catalog = QUICK_CHALLENGE_CATALOG || QUICK_CHALLENGE_FALLBACK;\n\n    // Feature 3: Randomly select a new rep every time the modal is rendered/made visible\n    const randomRep = useMemo(() => {\n        if (catalog.length === 0) return QUICK_CHALLENGE_FALLBACK[0];\n        const randomIndex = Math.floor(Math.random() * catalog.length);\n        return catalog[randomIndex];\n    }, [isVisible, catalog]); // Rerun selection when modal visibility changes\n\n    if (!isVisible) return null;\n\n    const handleLog = async () => {\n        setIsLogging(true);\n        setLogStatus(null);\n        \n        // --- LOGIC FOR QUICK LOG ---\n        const newCommitment = {\n            id: `quick-log-${Date.now()}`,\n            text: randomRep.rep, \n            status: 'Committed',\n            isCustom: true,\n            linkedGoal: `Momentum Rep (Quick Log)`,\n            linkedTier: randomRep.tier, \n            targetColleague: 'Immediate/System',\n            isQuickLog: true,\n            note: journalNote, // Feature 4: Save journal note\n        };\n\n        try {\n            // CRITICAL FIX: Correct spread syntax to properly update active_commitments\n            await updateCommitmentData(data => ({\n                ...data, // Spread data first to preserve other fields\n                active_commitments: [ ...(data?.active_commitments || []), newCommitment ],\n            }));\n            \n            setLogStatus('success');\n            onLogSuccess(newCommitment); // Trigger parent micro-celebration/reflection\n            \n            // Navigate the user back to the Scorecard if they initiated this from the Dashboard\n            setTimeout(() => {\n                if (sourceScreen === 'dashboard' && navigate) {\n                    navigate('daily-practice'); \n                }\n                onClose(); // Close the modal\n            }, 1500); \n\n        } catch (e) {\n            console.error(\"Failed to log 2-minute challenge:\", e);\n            setLogStatus('error');\n            setIsLogging(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\"> \n            <div className={`relative bg-[${COLORS.OFF_WHITE}] rounded-xl shadow-2xl w-full max-w-lg p-8 text-center border-t-8 border-[${COLORS.BLUE}]`}>\n                <button \n                    onClick={onClose} // CRITICAL FIX: Wire the button to the handler\n                    disabled={isLogging} \n                    className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-700\"\n                >\n                    <X className=\"w-6 h-6\" />\n                </button>\n\n                <Zap className={`w-12 h-12 text-[${COLORS.BLUE}] mx-auto mb-4`} />\n                <h3 className=\"text-2xl font-extrabold text-[#002E47] mb-2\">Grab a Micro-Action Rep</h3>\n                <p className=\"text-lg text-gray-600 mb-6\">Frictionless training for momentum! Complete this action quickly (Feature 3).</p>\n\n                <div className={`p-4 rounded-xl border-2 mb-6 ${logStatus === 'success' ? 'border-green-400 bg-green-50' : 'border-gray-300 bg-gray-100'}`}>\n                    <p className='text-sm font-semibold text-gray-700 mb-1'>Today's Micro-Action ({randomRep.tier}):</p>\n                    <p className={`text-xl font-bold text-left ${logStatus === 'success' ? 'text-green-600' : 'text-[#002E47]'}`}>\n                        <CornerRightUp className='w-5 h-5 inline mr-2'/> {randomRep.rep}\n                    </p>\n                </div>\n                \n                {/* Feature 4: Journal Note Capture */}\n                <textarea\n                    value={journalNote}\n                    onChange={(e) => setJournalNote(e.target.value)}\n                    placeholder=\"Optional journal note: What did I notice? (Feature 4)\"\n                    className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#47A88D] focus:border-[#47A88D] h-16 text-gray-800 mb-4\"\n                    disabled={isLogging || logStatus === 'success'}\n                />\n\n                {logStatus === 'success' ? (\n                    <div className=\"flex items-center justify-center p-3 text-white rounded-xl bg-green-500 font-bold\">\n                        <CheckCircle className=\"w-5 h-5 mr-2\" /> Nice Rep! Logged successfully.\n                    </div>\n                ) : (\n                    <Button \n                        onClick={handleLog} \n                        disabled={isLogging}\n                        className=\"w-full text-lg bg-[#2563EB] hover:bg-[#1E40AF]\"\n                    >\n                        {isLogging ? 'Logging...' : 'I Did It! Log Rep Now'}\n                    </Button>\n                )}\n                \n                {logStatus === 'error' && (\n                    <p className=\"text-sm text-red-500 mt-3 flex items-center justify-center\">\n                        <AlertTriangle className='w-4 h-4 mr-1'/> Log failed. Check active reps and try again.\n                    </p>\n                )}\n                \n                <button onClick={onClose} disabled={isLogging} className='text-sm text-gray-500 mt-4 hover:text-gray-700 block w-full'>\n                    Close / Skip Challenge\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default TwoMinuteChallengeModal;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/AdminDataMaintenance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'qLimit' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":11,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'writeBatch' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":11,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":54},{"ruleId":"no-unused-vars","severity":1,"message":"'updateDoc' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":11,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'tryParse' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":382,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":382,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDocs'. Either include it or remove the dependency array.","line":423,"column":6,"nodeType":"ArrayExpression","endLine":423,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadDocs, userId]","fix":{"range":[16998,17006],"text":"[loadDocs, userId]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":771,"column":65,"nodeType":"Identifier","messageId":"unusedVar","endLine":771,"endColumn":71},{"ruleId":"no-unused-vars","severity":1,"message":"'groupKey' is defined but never used.","line":1080,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":1080,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":1088,"column":6,"nodeType":"ArrayExpression","endLine":1088,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, tableKey, userId]","fix":{"range":[38851,38869],"text":"[loadData, tableKey, userId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'targetUserId'. Either include it or remove the dependency array.","line":1219,"column":6,"nodeType":"ArrayExpression","endLine":1219,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [targetUserId, userId]","fix":{"range":[42483,42491],"text":"[targetUserId, userId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/AdminDataMaintenance.jsx\n// Comprehensive admin interface for viewing and editing all Firestore data\n// Organized by functional module with full CRUD operations\n// UPDATED: All field keys in lowercase, added reflection history and bookend data\n// UPDATED (10/30/25): Added table-based CRUD editor for 'isCatalog' documents\n// FIX (10/30/25): Added 'adminemails' to global_metadata/config\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport {\n  getFirestore, doc, collection, getDoc, getDocs, setDoc, deleteDoc, \n  serverTimestamp, query, limit as qLimit, writeBatch, updateDoc, orderBy\n} from \"firebase/firestore\";\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport { \n  Loader, Download, Upload, Trash2, Save, Search, Edit, Plus, X,\n  LayoutDashboard, Target, Calendar, Lightbulb, Settings, Database,\n  AlertTriangle, CheckCircle, FileText, Copy, RefreshCw, Eye, EyeOff,\n  MessageSquare, Users, BookOpen, Film, Zap, ChevronDown, ChevronUp, GripVertical\n} from 'lucide-react'; // Added new icons\n\n/* =========================================================\n   DESIGN SYSTEM - Matching DevPlanComponents\n========================================================= */\nconst COLORS = { \n  NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', \n  GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', \n  OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', \n  PURPLE: '#7C3AED', BG: '#F9FAFB', PINK: '#EC4899', GOLD: '#F59E0B'\n};\n\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', size = 'md', className = '', ...rest }) => {\n  let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n\n  if (size === 'sm') baseStyle += ' px-3 py-1.5 text-xs';\n  else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg';\n  else baseStyle += ' px-4 py-2 text-sm';\n\n  if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-md hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-md hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n  else if (variant === 'outline') baseStyle += ` bg-white text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'danger') baseStyle += ` bg-red-600 text-white shadow-md hover:bg-red-700 focus:ring-red-500/50`;\n  else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50`;\n\n  return <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>;\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', accent = 'NAVY', actions }) => {\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n\n  return (\n    <div className={`relative rounded-2xl border-2 shadow-xl transition-all duration-300 ${className}`}\n      style={{\n        background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)',\n        borderColor: COLORS.SUBTLE,\n        color: COLORS.NAVY\n      }}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n      \n      {(title || actions) && (\n        <div className=\"flex items-center justify-between p-6 pb-4\">\n          <div className=\"flex items-center gap-3\">\n            {Icon && (\n              <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n                  <Icon className=\"w-5 h-5\" style={{ color: accentColor }} />\n              </div>\n            )}\n            {title && (\n              <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2>\n            )}\n          </div>\n          {actions && (\n            <div className=\"flex-shrink-0 flex gap-2\">{actions}</div>\n          )}\n        </div>\n      )}\n      \n      <div className={title || actions ? \"p-6 pt-0\" : \"p-6\"}>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nconst Badge = ({ children, variant = 'default', size = 'md' }) => {\n  let baseStyle = 'font-semibold rounded-full inline-block';\n\n  if (size === 'sm') baseStyle += ' px-2.5 py-0.5 text-xs';\n  else baseStyle += ' px-3 py-1 text-sm';\n  \n  if (variant === 'primary') baseStyle += ` bg-[${COLORS.BLUE}20] text-[${COLORS.BLUE}]`;\n  else if (variant === 'success') baseStyle += ` bg-[${COLORS.GREEN}20] text-[${COLORS.GREEN}]`;\n  else if (variant === 'warning') baseStyle += ` bg-[${COLORS.AMBER}20] text-[${COLORS.AMBER}]`;\n  else if (variant === 'danger') baseStyle += ` bg-[${COLORS.RED}20] text-[${COLORS.RED}]`;\n  else if (variant === 'purple') baseStyle += ` bg-[${COLORS.PURPLE}20] text-[${COLORS.PURPLE}]`;\n  else baseStyle += ` bg-[${COLORS.SUBTLE}] text-[${COLORS.MUTED}]`;\n  \n  return <span className={baseStyle}>{children}</span>;\n};\n\nconst LoadingSpinner = ({ message = \"Loading...\" }) => (\n  <div className=\"flex items-center justify-center p-12\">\n    <div className=\"text-center\">\n      <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4\" style={{ borderColor: COLORS.TEAL }} />\n      <p style={{ color: COLORS.TEXT }}>{message}</p>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   DATA STRUCTURE CONFIGURATION (ALL LOWERCASE KEYS)\n========================================================= */\nconst MODULE_GROUPS = {\n  user_data: {\n    name: \"User Profile\",\n    icon: Database,\n    color: COLORS.BLUE,\n    description: \"Basic user information and account settings\",\n    tables: {\n      profile: {\n        name: \"User Profile\",\n        path: (uid) => `users/${uid}`,\n        fields: [\n          { key: 'userid', label: 'User ID', type: 'text', readonly: true },\n          { key: 'email', label: 'Email', type: 'email' },\n          { key: 'displayname', label: 'Display Name', type: 'text' },\n          { key: 'photourl', label: 'Photo URL', type: 'text' },\n          { key: 'isadmin', label: 'Is Admin', type: 'boolean' },\n          { key: 'createdat', label: 'Created At', type: 'timestamp', readonly: true },\n          { key: '_createdat', label: 'Created At (Alt)', type: 'timestamp', readonly: true },\n          { key: '_updatedat', label: 'Updated At', type: 'timestamp', readonly: true }\n        ]\n      }\n    }\n  },\n\n  development_plan: {\n    name: \"Development Plan\",\n    icon: Target,\n    color: COLORS.TEAL,\n    description: \"12-week leadership development plans and assessments\",\n    tables: {\n      current_plan: {\n        name: \"Current Plan\",\n        path: (uid) => `modules/${uid}/development_plan/current`,\n        fields: [\n          { key: 'cycle', label: 'Cycle Number', type: 'number' },\n          { key: 'currentweek', label: 'Current Week', type: 'number' },\n          { key: 'currentplan', label: 'Plan Data', type: 'json' },\n          { key: 'focusareas', label: 'Focus Areas', type: 'json' },\n          { key: 'assessmenthistory', label: 'Assessment History', type: 'json' },\n          { key: 'previousplans', label: 'Previous Plans', type: 'json' },\n          { key: '_updatedat', label: 'Updated At', type: 'timestamp', readonly: true }\n        ]\n      }\n    }\n  },\n\n  daily_practice: {\n    name: \"Daily Practice\",\n    icon: Calendar,\n    color: COLORS.ORANGE,\n    description: \"Daily reps, streaks, commitments, reflections, and bookends\",\n    tables: {\n      current_practice: {\n        name: \"Current Practice\",\n        path: (uid) => `modules/${uid}/daily_practice/current`,\n        fields: [\n          { key: 'dailytargetrepid', label: 'Daily Target Rep ID', type: 'text' },\n          { key: 'dailytargetrepstatus', label: 'Daily Target Status', type: 'text' },\n          { key: 'dailytargetrepdate', label: 'Daily Target Date', type: 'date' },\n          { key: 'activecommitments', label: 'Active Commitments', type: 'json' },\n          { key: 'identityanchor', label: 'Identity Anchor', type: 'text' },\n          { key: 'habitanchor', label: 'Habit Anchor', type: 'text' },\n          { key: 'streakcount', label: 'Streak Count', type: 'number' },\n          { key: 'streakcoins', label: 'Streak Coins', type: 'number' },\n          { key: 'completedrepstoday', label: 'Completed Reps Today', type: 'json' },\n          { key: 'weeklyfocus', label: 'Weekly Focus', type: 'text' },\n          { key: 'morningbookend', label: 'Morning Bookend Data', type: 'json' },\n          { key: 'eveningbookend', label: 'Evening Bookend Data', type: 'json' },\n          { key: 'arenamode', label: 'Arena Mode', type: 'boolean' },\n          { key: 'lastupdated', label: 'Last Updated', type: 'timestamp', readonly: true }\n        ]\n      },\n      reflection_history: {\n        name: \"Reflection History\",\n        path: (uid) => `modules/${uid}/daily_practice/reflection_history`,\n        isSubcollection: true,\n        fields: [\n          { key: 'did', label: 'What I Did', type: 'textarea' },\n          { key: 'noticed', label: 'What I Noticed', type: 'textarea' },\n          { key: 'trydiff', label: 'What I\\'ll Try', type: 'textarea' },\n          { key: 'identity', label: 'Identity Statement', type: 'text' },\n          { key: 'date', label: 'Date (YYYY-MM-DD)', type: 'date' },\n          { key: 'timestamp', label: 'Timestamp', type: 'timestamp', readonly: true }\n        ]\n      }\n    }\n  },\n\n  strategic_content: {\n    name: \"Strategic Content\",\n    icon: Lightbulb,\n    color: COLORS.PURPLE,\n    description: \"Vision, mission, values, goals, and strategic planning\",\n    tables: {\n      vision_mission: {\n        name: \"Vision & Mission\",\n        path: (uid) => `modules/${uid}/strategic_content/vision_mission`,\n        fields: [\n          { key: 'vision', label: 'Vision', type: 'textarea' },\n          { key: 'mission', label: 'Mission', type: 'textarea' },\n          { key: 'values', label: 'Values', type: 'json' },\n          { key: 'goals', label: 'Goals', type: 'json' },\n          { key: 'purpose', label: 'Purpose', type: 'textarea' },\n          { key: 'overallwhy', label: 'Overall Why', type: 'textarea' },\n          { key: 'okrs', label: 'OKRs', type: 'json' },\n          { key: 'risks', label: 'Risks', type: 'json' },\n          { key: 'misalignmentnotes', label: 'Misalignment Notes', type: 'textarea' },\n          { key: 'lastpremortemdecision', label: 'Last Pre-Mortem Decision', type: 'text' },\n          { key: '_updatedat', label: 'Updated At', type: 'timestamp', readonly: true }\n        ]\n      }\n    }\n  },\n\n  community_content: {\n    name: \"Community & Content\",\n    icon: Users,\n    color: COLORS.PINK,\n    description: \"Community feed, readings, videos, and shared content\",\n    tables: {\n      community_feed: {\n        name: \"Community Feed\",\n        path: () => `community/feed/posts`,\n        isGlobal: true,\n        isSubcollection: true,\n        fields: [\n          { key: 'userid', label: 'User ID', type: 'text' },\n          { key: 'username', label: 'User Name', type: 'text' },\n          { key: 'text', label: 'Post Text', type: 'textarea' },\n          { key: 'ispod', label: 'Is Pod Post', type: 'boolean' },\n          { key: 'createdat', label: 'Created At', type: 'timestamp', readonly: true }\n        ]\n      },\n      readings: {\n        name: \"Business Readings\",\n        path: () => `content/readings`,\n        isGlobal: true,\n        fields: [\n          { key: 'items', label: 'Reading Items (Array)', type: 'json' }\n        ]\n      },\n      videos: {\n        name: \"Leadership Videos\",\n        path: () => `content/videos`,\n        isGlobal: true,\n        fields: [\n          { key: 'items', label: 'Video Items (Array)', type: 'json' }\n        ]\n      }\n    }\n  },\n\n  global_metadata: {\n    name: \"Global Metadata\",\n    icon: Settings,\n    color: COLORS.NAVY,\n    description: \"App-wide configuration and catalogs (affects all users)\",\n    isGlobal: true,\n    tables: {\n      config: {\n        name: \"App Configuration\",\n        path: () => `metadata/config`,\n        fields: [\n          { key: 'app_id', label: 'App ID', type: 'text' },\n          { key: 'gemini_model', label: 'Gemini Model', type: 'text' },\n          { key: 'featureflags', label: 'Feature Flags', type: 'json' },\n          { key: 'adminemails', label: 'Admin Emails', type: 'json' }, // <-- ADDED FIELD\n          { key: 'leadership_tiers', label: 'Leadership Tiers', type: 'json' },\n          { key: 'iconmap', label: 'Icon Map', type: 'json' },\n          { key: '_updatedat', label: 'Updated At', type: 'timestamp', readonly: true },\n          { key: '_updatedby', label: 'Updated By', type: 'text', readonly: true }\n        ]\n      },\n      rep_library: {\n        name: \"Rep Library\",\n        path: () => `metadata/config/catalog/rep_library`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Reps (Array)', type: 'json' }\n        ]\n      },\n      exercise_library: {\n        name: \"Exercise Library\",\n        path: () => `metadata/config/catalog/exercise_library`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Exercises (Array)', type: 'json' }\n        ]\n      },\n      workout_library: {\n        name: \"Workout Library\",\n        path: () => `metadata/config/catalog/workout_library`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Workouts (Array)', type: 'json' }\n        ]\n      },\n      course_library: {\n        name: \"Course Library\",\n        path: () => `metadata/config/catalog/course_library`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Courses (Array)', type: 'json' }\n        ]\n      },\n      skill_catalog: {\n        name: \"Skill Catalog\",\n        path: () => `metadata/config/catalog/skill_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Skills (Array)', type: 'json' }\n        ]\n      },\n      identity_anchor_catalog: {\n        name: \"Identity Anchor Catalog\",\n        path: () => `metadata/config/catalog/identity_anchor_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Identity Anchors (Array)', type: 'json' }\n        ]\n      },\n      habit_anchor_catalog: {\n        name: \"Habit Anchor Catalog\",\n        path: () => `metadata/config/catalog/habit_anchor_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Habit Anchors (Array)', type: 'json' }\n        ]\n      },\n      why_catalog: {\n        name: \"Why Catalog\",\n        path: () => `metadata/config/catalog/why_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Why Statements (Array)', type: 'json' }\n        ]\n      },\n      reading_catalog: {\n        name: \"Reading Catalog\",\n        path: () => `metadata/config/catalog/reading_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Reading Materials (Array)', type: 'json' }\n        ]\n      },\n      video_catalog: {\n        name: \"Video Catalog\",\n        path: () => `metadata/config/catalog/video_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Videos (Array)', type: 'json' }\n        ]\n      },\n      scenario_catalog: {\n        name: \"Scenario Catalog\",\n        path: () => `metadata/config/catalog/scenario_catalog`,\n        isCatalog: true,\n        fields: [\n          { key: 'items', label: 'Scenarios (Array)', type: 'json' }\n        ]\n      }\n    }\n  }\n};\n\n/* =========================================================\n   UTILITIES\n========================================================= */\nconst pretty = (v) => JSON.stringify(v ?? {}, null, 2);\nconst tryParse = (t, fallback) => { \n  try { \n    return JSON.parse(t); \n  } catch { \n    return fallback; \n  } \n};\n\nconst formatTimestamp = (value) => {\n  if (!value) return 'N/A';\n  if (value.seconds) {\n    return new Date(value.seconds * 1000).toLocaleString();\n  }\n  if (value instanceof Date) {\n    return value.toLocaleString();\n  }\n  return String(value);\n};\n\nconst downloadJSON = (data, filename) => {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n};\n\n/* =========================================================\n   SUBCOLLECTION VIEWER COMPONENT\n========================================================= */\nconst SubcollectionViewer = ({ tableConfig, userId }) => {\n  const [docs, setDocs] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [selectedDoc, setSelectedDoc] = useState(null);\n  const db = getFirestore();\n\n  useEffect(() => {\n    loadDocs();\n  }, [userId]);\n\n  const loadDocs = async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const path = tableConfig.path(userId);\n      const collectionRef = collection(db, ...path.split('/'));\n      const q = query(collectionRef, orderBy('timestamp', 'desc'));\n      const snapshot = await getDocs(q);\n      \n      const docsData = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      \n      setDocs(docsData);\n    } catch (err) {\n      console.error('Load subcollection error:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async (docId) => {\n    if (!confirm('Delete this entry?')) return;\n    \n    try {\n      const path = tableConfig.path(userId);\n      const docRef = doc(db, ...path.split('/'), docId);\n      await deleteDoc(docRef);\n      setDocs(docs.filter(d => d.id !== docId));\n      setSelectedDoc(null);\n      alert('Deleted successfully!');\n    } catch (err) {\n      console.error('Delete error:', err);\n      alert(`Delete failed: ${err.message}`);\n    }\n  };\n\n  if (loading) {\n    return <LoadingSpinner message=\"Loading entries...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 bg-red-50 border-2 border-red-200 rounded-xl\">\n        <AlertTriangle size={20} className=\"text-red-600 mb-2\" />\n        <p className=\"text-red-800\">{error}</p>\n      </div>\n    );\n  }\n\n  if (docs.length === 0) {\n    return (\n      <div className=\"p-8 text-center bg-gray-50 rounded-xl border-2 border-dashed\" style={{ borderColor: COLORS.SUBTLE }}>\n        <MessageSquare className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n        <p className=\"text-gray-600\">No entries found</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <Badge variant=\"primary\">{docs.length} entries</Badge>\n        <Button onClick={loadDocs} variant=\"ghost\" size=\"sm\">\n          <RefreshCw size={16} />\n          Refresh\n        </Button>\n      </div>\n\n      <div className=\"grid gap-3\">\n        {docs.map(docData => (\n          <div key={docData.id} className=\"p-4 bg-white rounded-lg border-2 hover:border-teal-300 transition-all\" style={{ borderColor: COLORS.SUBTLE }}>\n            <div className=\"flex items-start justify-between mb-2\">\n              <div className=\"flex-1\">\n                <p className=\"text-xs text-gray-500 mb-1\">\n                  {formatTimestamp(docData.timestamp || docData.date)}\n                </p>\n                <div className=\"text-sm space-y-1\">\n                  {tableConfig.fields.filter(f => f.key !== 'timestamp').map(field => {\n                    const value = docData[field.key];\n                    if (!value) return null;\n                    \n                    return (\n                      <p key={field.key} className=\"text-gray-700\">\n                        <strong>{field.label}:</strong> {\n                          field.type === 'json' \n                            ? JSON.stringify(value).substring(0, 100) + '...'\n                            : String(value).substring(0, 150)\n                        }\n                      </p>\n                    );\n                  })}\n                </div>\n              </div>\n              \n              <div className=\"flex gap-2 ml-4\">\n                <Button \n                  onClick={() => setSelectedDoc(selectedDoc?.id === docData.id ? null : docData)}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                >\n                  {selectedDoc?.id === docData.id ? <EyeOff size={16} /> : <Eye size={16} />}\n                </Button>\n                <Button \n                  onClick={() => handleDelete(docData.id)}\n                  variant=\"danger\"\n                  size=\"sm\"\n                >\n                  <Trash2 size={16} />\n                </Button>\n              </div>\n            </div>\n            \n            {selectedDoc?.id === docData.id && (\n              <div className=\"mt-3 pt-3 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                <pre className=\"text-xs font-mono bg-gray-50 p-3 rounded overflow-auto max-h-64\">\n                  {pretty(docData)}\n                </pre>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/* =========================================================\n   NEW: CATALOG ITEM EDITOR COMPONENT (FOR TABLE ROWS)\n========================================================= */\nconst CatalogItemEditor = ({ item, index, onUpdate, onDelete, onAddNewField }) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editedItem, setEditedItem] = useState(item);\n\n  useEffect(() => {\n    setEditedItem(item);\n  }, [item]);\n\n  const handleChange = (key, value) => {\n    setEditedItem(prev => ({ ...prev, [key]: value }));\n  };\n\n  const handleSave = () => {\n    onUpdate(index, editedItem);\n    setIsEditing(false);\n  };\n\n  const handleCancel = () => {\n    setEditedItem(item);\n    setIsEditing(false);\n  };\n\n  // Guess input type based on value\n  const getInput = (key, value) => {\n    if (typeof value === 'boolean') {\n      return (\n        <select\n          value={String(value)}\n          onChange={(e) => handleChange(key, e.target.value === 'true')}\n          className=\"w-full p-2 border-2 rounded-lg text-sm\"\n          style={{ borderColor: COLORS.SUBTLE }}\n        >\n          <option value=\"true\">True</option>\n          <option value=\"false\">False</option>\n        </select>\n      );\n    }\n    \n    if (typeof value === 'number') {\n      return (\n        <input\n          type=\"number\"\n          value={value}\n          onChange={(e) => handleChange(key, Number(e.target.value))}\n          className=\"w-full p-2 border-2 rounded-lg text-sm\"\n          style={{ borderColor: COLORS.SUBTLE }}\n        />\n      );\n    }\n\n    if (typeof value === 'string' && value.length > 100) {\n      return (\n        <textarea\n          value={value}\n          onChange={(e) => handleChange(key, e.target.value)}\n          className=\"w-full p-2 border-2 rounded-lg text-sm font-mono\"\n          style={{ borderColor: COLORS.SUBTLE }}\n          rows={4}\n        />\n      );\n    }\n    \n    return (\n      <input\n        type=\"text\"\n        value={value}\n        onChange={(e) => handleChange(key, e.target.value)}\n        className=\"w-full p-2 border-2 rounded-lg text-sm\"\n        style={{ borderColor: COLORS.SUBTLE }}\n      />\n    );\n  };\n\n  return (\n    <div \n      className=\"rounded-xl border-2\" \n      style={{ \n        borderColor: isEditing ? COLORS.TEAL : COLORS.SUBTLE, \n        backgroundColor: isEditing ? `${COLORS.TEAL}05` : COLORS.OFF_WHITE\n      }}\n    >\n      {/* Header Bar */}\n      <div className=\"flex items-center justify-between p-3\" style={{ borderBottom: `2px solid ${COLORS.SUBTLE}` }}>\n        <div className=\"flex items-center gap-3\">\n          <GripVertical className=\"w-5 h-5 text-gray-400 cursor-grab\" />\n          <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>\n            {item.name || item.id || `Item ${index + 1}`}\n          </p>\n          <Badge variant=\"default\" size=\"sm\">{item.id || 'NO ID'}</Badge>\n        </div>\n        <div className=\"flex gap-2\">\n          {isEditing ? (\n            <>\n              <Button onClick={handleCancel} variant=\"outline\" size=\"sm\">Cancel</Button>\n              <Button onClick={handleSave} variant=\"primary\" size=\"sm\">Save</Button>\n            </>\n          ) : (\n            <>\n              <Button onClick={() => onDelete(index)} variant=\"danger\" size=\"sm\">\n                <Trash2 size={14} />\n              </Button>\n              <Button onClick={() => setIsEditing(true)} variant=\"outline\" size=\"sm\">\n                <Edit size={14} />\n                Edit\n              </Button>\n            </>\n          )}\n        </div>\n      </div>\n      \n      {/* Editor Body */}\n      {isEditing && (\n        <div className=\"p-4 space-y-3\">\n          {Object.entries(editedItem).map(([key, value]) => (\n            <div key={key}>\n              <label className=\"block text-xs font-semibold mb-1\" style={{ color: COLORS.MUTED }}>\n                {key}\n              </label>\n              {getInput(key, value)}\n            </div>\n          ))}\n          <Button \n            onClick={() => onAddNewField(index)} \n            variant=\"ghost\" \n            size=\"sm\" \n            className=\"mt-2\"\n          >\n            <Plus size={14} />\n            Add New Field\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n};\n\n/* =========================================================\n   NEW: CATALOG TABLE EDITOR COMPONENT\n========================================================= */\nconst CatalogTableEditor = ({ items, onChange }) => {\n  const handleUpdate = (index, updatedItem) => {\n    const newItems = [...items];\n    newItems[index] = updatedItem;\n    onChange(newItems);\n  };\n\n  const handleDelete = (index) => {\n    if (!confirm(`Are you sure you want to delete this item?\\n\\n${JSON.stringify(items[index], null, 2)}`)) {\n      return;\n    }\n    const newItems = items.filter((_, i) => i !== index);\n    onChange(newItems);\n  };\n\n  const handleAddItem = () => {\n    const newItem = {\n      id: `new_item_${Date.now()}`,\n      name: \"New Catalog Item\",\n      description: \"A description for the new item.\"\n    };\n    onChange([...items, newItem]);\n  };\n\n  const handleAddNewField = (index) => {\n    const fieldName = prompt(\"Enter new field name (e.g., 'category'):\");\n    if (!fieldName || fieldName.trim() === '') return;\n    \n    const newItems = [...items];\n    newItems[index] = {\n      ...newItems[index],\n      [fieldName]: \"new value\"\n    };\n    onChange(newItems);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-sm font-semibold\" style={{ color: COLORS.MUTED }}>\n          CATALOG ITEMS\n        </p>\n        <Button onClick={handleAddItem} variant=\"primary\" size=\"sm\">\n          <Plus size={16} />\n          Add New Item\n        </Button>\n      </div>\n      \n      <div className=\"p-4 bg-gray-50 rounded-xl border-2 space-y-3\" style={{ borderColor: COLORS.SUBTLE }}>\n        {items.length > 0 ? (\n          items.map((item, index) => (\n            <CatalogItemEditor\n              key={item.id || index}\n              item={item}\n              index={index}\n              onUpdate={handleUpdate}\n              onDelete={handleDelete}\n              onAddNewField={handleAddNewField}\n            />\n          ))\n        ) : (\n          <div className=\"p-8 text-center text-gray-500\">\n            <p>No items in this catalog.</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n\n/* =========================================================\n   TABLE DATA EDITOR COMPONENT (MODIFIED)\n========================================================= */\nconst TableDataEditor = ({ tableConfig, data, onSave, onDelete, userId }) => {\n  const [editedData, setEditedData] = useState(data || {});\n  const [isSaving, setIsSaving] = useState(false);\n  const [showJson, setShowJson] = useState(false);\n  const [jsonText, setJsonText] = useState('');\n  const [hasChanges, setHasChanges] = useState(false);\n\n  useEffect(() => {\n    setEditedData(data || {});\n    setJsonText(pretty(data || {}));\n    setHasChanges(false);\n  }, [data]);\n  \n  // Get catalog items from the edited data\n  const catalogItems = useMemo(() => {\n    if (!editedData || !Array.isArray(editedData.items)) {\n      return [];\n    }\n    return editedData.items;\n  }, [editedData]);\n\n  // Handler for changes from the new CatalogTableEditor\n  const handleCatalogChange = (newItems) => {\n    const newData = { ...editedData, items: newItems };\n    setEditedData(newData);\n    setJsonText(pretty(newData)); // Keep JSON view in sync\n    setHasChanges(true);\n  };\n\n  const handleFieldChange = (key, value, type) => {\n    let processedValue = value;\n    \n    if (type === 'number') {\n      processedValue = value === '' ? null : Number(value);\n    } else if (type === 'boolean') {\n      processedValue = value === 'true' || value === true;\n    } else if (type === 'json') {\n      try {\n        processedValue = JSON.parse(value);\n      } catch (e) {\n        processedValue = value; // Keep as string if invalid JSON\n      }\n    }\n\n    const newData = { ...editedData, [key]: processedValue };\n    setEditedData(newData);\n    setJsonText(pretty(newData)); // Keep JSON view in sync\n    setHasChanges(true);\n  };\n\n  const handleJsonChange = (text) => {\n    setJsonText(text);\n    try {\n      const parsed = JSON.parse(text);\n      setEditedData(parsed); // Update main data from JSON\n      setHasChanges(true);\n    } catch (e) {\n      // Invalid JSON - don't update editedData, but still mark changes\n      setHasChanges(true);\n    }\n  };\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    let dataToSave = editedData;\n    \n    // If in JSON mode, re-parse to ensure it's valid before saving\n    if (showJson) {\n      try {\n        dataToSave = JSON.parse(jsonText);\n      } catch (e) {\n        alert('Save failed: Invalid JSON format. Please correct it before saving.');\n        setIsSaving(false);\n        return;\n      }\n    }\n    \n    try {\n      await onSave(dataToSave);\n      setEditedData(dataToSave); // Ensure state reflects saved data\n      setHasChanges(false);\n    } catch (error) {\n      console.error('Save failed:', error);\n      alert(`Save failed: ${error.message}`);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleImport = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.onchange = (e) => {\n      const file = e.target.files[0];\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        try {\n          const imported = JSON.parse(event.target.result);\n          setEditedData(imported);\n          setJsonText(pretty(imported));\n          setHasChanges(true);\n        } catch (error) {\n          alert('Invalid JSON file');\n        }\n      };\n      reader.readAsText(file);\n    };\n    input.click();\n  };\n\n  if (!data) {\n    return (\n      <div className=\"p-8 text-center bg-gray-50 rounded-xl border-2 border-dashed\" style={{ borderColor: COLORS.SUBTLE }}>\n        <Database className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n        <p className=\"text-gray-600 mb-4\">No data found for this table</p>\n        <Button onClick={handleSave} variant=\"primary\">\n          <Plus size={16} />\n          Create New Document\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Actions Bar */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => setShowJson(!showJson)} \n            variant=\"outline\"\n            size=\"sm\"\n          >\n            {showJson ? <EyeOff size={16} /> : <Eye size={16} />}\n            {showJson ? (tableConfig.isCatalog ? 'Show Table View' : 'Show Form') : 'Show JSON'}\n          </Button>\n          <Button \n            onClick={() => downloadJSON(data, `${tableConfig.name.replace(/\\s+/g, '_')}.json`)}\n            variant=\"ghost\"\n            size=\"sm\"\n          >\n            <Download size={16} />\n            Export\n          </Button>\n          <Button \n            onClick={handleImport}\n            variant=\"ghost\"\n            size=\"sm\"\n          >\n            <Upload size={16} />\n            Import\n          </Button>\n          <Button \n            onClick={() => {\n              navigator.clipboard.writeText(pretty(data));\n              alert('Copied to clipboard!');\n            }}\n            variant=\"ghost\"\n            size=\"sm\"\n          >\n            <Copy size={16} />\n            Copy\n          </Button>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          {hasChanges && (\n            <Badge variant=\"warning\">Unsaved changes</Badge>\n          )}\n          {onDelete && (\n            <Button \n              onClick={onDelete}\n              variant=\"danger\"\n              size=\"sm\"\n            >\n              <Trash2 size={16} />\n              Delete\n            </Button>\n          )}\n          <Button \n            onClick={handleSave}\n            variant=\"primary\"\n            size=\"sm\"\n            disabled={isSaving || !hasChanges}\n          >\n            <Save size={16} />\n            {isSaving ? 'Saving...' : 'Save Changes'}\n          </Button>\n        </div>\n      </div>\n\n      {/* JSON Editor View */}\n      {showJson ? (\n        <div className=\"relative\">\n          <textarea\n            className=\"w-full h-96 p-4 font-mono text-sm border-2 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n            style={{ borderColor: COLORS.SUBTLE }}\n            value={jsonText}\n            onChange={(e) => handleJsonChange(e.target.value)}\n            spellCheck={false}\n          />\n          {hasChanges && (\n            <div className=\"absolute top-2 right-2\">\n              <Badge variant=\"warning\">Modified</Badge>\n            </div>\n          )}\n        </div>\n      ) : tableConfig.isCatalog ? (\n        // NEW: Catalog Table Editor View\n        <CatalogTableEditor\n          items={catalogItems}\n          onChange={handleCatalogChange}\n        />\n      ) : (\n        /* Form Editor View (for non-catalog tables) */\n        <div className=\"grid gap-4\">\n          {tableConfig.fields.map(field => {\n            const value = editedData[field.key];\n            const displayValue = field.type === 'json' \n              ? pretty(value)\n              : field.type === 'timestamp'\n              ? formatTimestamp(value)\n              : value ?? '';\n\n            return (\n              <div key={field.key} className=\"p-4 bg-gray-50 rounded-xl border-2\" style={{ borderColor: COLORS.SUBTLE }}>\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\" style={{ color: COLORS.NAVY }}>\n                      {field.label}\n                    </label>\n                    {field.readonly && (\n                      <Badge variant=\"default\" size=\"sm\">Read-only</Badge>\n                    )}\n                  </div>\n                </div>\n\n                {field.readonly ? (\n                  <div className=\"p-3 bg-white rounded-lg border\" style={{ borderColor: COLORS.SUBTLE }}>\n                    {field.type === 'json' ? (\n                      <pre className=\"text-xs font-mono whitespace-pre-wrap overflow-auto max-h-32\">\n                        {displayValue}\n                      </pre>\n                    ) : (\n                      <span className=\"text-sm text-gray-600\">{displayValue || 'N/A'}</span>\n                    )}\n                  </div>\n                ) : field.type === 'textarea' ? (\n                  <textarea\n                    className=\"w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                    rows={4}\n                    value={displayValue}\n                    onChange={(e) => handleFieldChange(field.key, e.target.value, field.type)}\n                  />\n                ) : field.type === 'json' ? (\n                  <textarea\n                    className=\"w-full p-3 font-mono text-sm border-2 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                    rows={6}\n                    value={displayValue}\n                    onChange={(e) => handleFieldChange(field.key, e.target.value, field.type)}\n                    spellCheck={false}\n                  />\n                ) : field.type === 'boolean' ? (\n                  <select\n                    className=\"w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                    value={String(value)}\n                    onChange={(e) => handleFieldChange(field.key, e.target.value, field.type)}\n                  >\n                    <option value=\"true\">True</option>\n                    <option value=\"false\">False</option>\n                  </select>\n                ) : (\n                  <input\n                    type={field.type === 'number' ? 'number' : field.type === 'email' ? 'email' : 'text'}\n                    className=\"w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                    value={displayValue}\n                    onChange={(e) => handleFieldChange(field.key, e.target.value, field.type)}\n                  />\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Catalog Item Count */}\n      {tableConfig.isCatalog && editedData.items && (\n        <div className=\"p-4 bg-blue-50 border-2 border-blue-200 rounded-xl mt-4\">\n          <div className=\"flex items-center gap-2\">\n            <CheckCircle size={16} className=\"text-blue-600\" />\n            <span className=\"text-sm font-medium text-blue-900\">\n              {Array.isArray(editedData.items) ? editedData.items.length : 0} items in catalog\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n\n/* =========================================================\n   TABLE VIEWER COMPONENT\n========================================================= */\nconst TableViewer = ({ groupKey, tableKey, config, userId }) => {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const db = getFirestore();\n\n  useEffect(() => {\n    loadData();\n  }, [tableKey, userId]);\n\n  const loadData = async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      // Handle subcollections differently\n      if (config.isSubcollection) {\n        // Subcollections are handled by SubcollectionViewer\n        setLoading(false);\n        return;\n      }\n      \n      const path = config.path(userId);\n      const docRef = doc(db, ...path.split('/'));\n      const docSnap = await getDoc(docRef);\n      \n      if (docSnap.exists()) {\n        setData(docSnap.data());\n      } else {\n        setData(null);\n      }\n    } catch (err) {\n      console.error('Load error:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = async (updatedData) => {\n    try {\n      const path = config.path(userId);\n      const docRef = doc(db, ...path.split('/'));\n      \n      const dataToSave = {\n        ...updatedData,\n        _updatedat: serverTimestamp()\n      };\n      \n      await setDoc(docRef, dataToSave, { merge: true });\n      // Don't set data here, let Firestore's serverTimestamp resolve\n      // and then rely on a refresh or just trust the save.\n      // Setting it locally creates a mismatch with the { _updatedat: \"pending\" } object\n      setData(updatedData); // Compromise: set the user's data\n      alert('Saved successfully!');\n    } catch (err) {\n      console.error('Save error:', err);\n      throw err;\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm(`Are you sure you want to delete this ${config.name} document?`)) {\n      return;\n    }\n    \n    try {\n      const path = config.path(userId);\n      const docRef = doc(db, ...path.split('/'));\n      await deleteDoc(docRef);\n      setData(null);\n      alert('Deleted successfully!');\n    } catch (err) {\n      console.error('Delete error:', err);\n      alert(`Delete failed: ${err.message}`);\n    }\n  };\n\n  if (config.isSubcollection) {\n    return <SubcollectionViewer tableConfig={config} userId={userId} />;\n  }\n\n  if (loading) {\n    return <LoadingSpinner message={`Loading ${config.name}...`} />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 bg-red-50 border-2 border-red-200 rounded-xl\">\n        <div className=\"flex items-center gap-3 text-red-800\">\n          <AlertTriangle size={20} />\n          <div>\n            <p className=\"font-semibold\">Error loading data</p>\n            <p className=\"text-sm\">{error}</p>\n          </div>\n        </div>\n        <Button onClick={loadData} variant=\"danger\" size=\"sm\" className=\"mt-4\">\n          <RefreshCw size={16} />\n          Retry\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <TableDataEditor \n      tableConfig={config}\n      data={data}\n      onSave={handleSave}\n      onDelete={!config.isCatalog ? handleDelete : null}\n      userId={userId}\n    />\n  );\n};\n\n/* =========================================================\n   MAIN ADMIN COMPONENT\n========================================================= */\nexport default function AdminDataMaintenance() {\n  const services = useAppServices();\n  const { userId, isAdmin } = services || {};\n  \n  const [activeGroup, setActiveGroup] = useState('user_data');\n  const [activeTable, setActiveTable] = useState(null);\n  const [targetUserId, setTargetUserId] = useState(userId || '');\n\n  // Set initial table when group changes\n  useEffect(() => {\n    if (activeGroup) {\n      const group = MODULE_GROUPS[activeGroup];\n      const firstTable = Object.keys(group.tables)[0];\n      setActiveTable(firstTable);\n    }\n  }, [activeGroup]);\n\n  useEffect(() => {\n    if (userId && !targetUserId) {\n      setTargetUserId(userId);\n    }\n  }, [userId]);\n\n  if (!isAdmin) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-6\">\n        <Card accent=\"RED\">\n          <div className=\"text-center p-8\">\n            <AlertTriangle className=\"w-16 h-16 mx-auto mb-4 text-red-600\" />\n            <h2 className=\"text-2xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n              Access Denied\n            </h2>\n            <p className=\"text-gray-600\">\n              You need admin privileges to access this page.\n            </p>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  const currentGroup = MODULE_GROUPS[activeGroup];\n  const currentTable = activeTable ? currentGroup.tables[activeTable] : null;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white border-b-2\" style={{ borderColor: COLORS.SUBTLE }}>\n        <div className=\"max-w-7xl mx-auto px-6 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n                Admin Data Maintenance\n              </h1>\n              <p className=\"text-gray-600\">\n                Comprehensive database management with full CRUD operations\n              </p>\n            </div>\n            \n            {!currentGroup?.isGlobal && (\n              <div className=\"flex items-center gap-3\">\n                <label className=\"text-sm font-semibold\" style={{ color: COLORS.NAVY }}>\n                  User ID:\n                </label>\n                <input\n                  type=\"text\"\n                  value={targetUserId}\n                  onChange={(e) => setTargetUserId(e.target.value)}\n                  placeholder=\"Enter user ID...\"\n                  className=\"px-4 py-2 border-2 rounded-lg text-sm font-mono w-64 focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                  style={{ borderColor: COLORS.SUBTLE }}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Module Group Tabs */}\n      <div className=\"bg-white border-b-2\" style={{ borderColor: COLORS.SUBTLE }}>\n        <div className=\"max-w-7xl mx-auto px-6 flex gap-1\">\n          {Object.entries(MODULE_GROUPS).map(([key, group]) => {\n            const Icon = group.icon;\n            const isActive = activeGroup === key;\n            \n            return (\n              <button\n                key={key}\n                onClick={() => setActiveGroup(key)}\n                className={`flex items-center gap-2 px-6 py-4 font-semibold transition-all border-b-4 ${\n                  isActive \n                    ? 'border-current' \n                    : 'border-transparent hover:bg-gray-50'\n                }`}\n                style={{ \n                  color: isActive ? group.color : COLORS.MUTED,\n                  borderColor: isActive ? group.color : 'transparent'\n                }}\n              >\n                <Icon size={20} />\n                {group.name}\n              </button>\n            );\n          })}\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-6\">\n        <div className=\"grid grid-cols-12 gap-6\">\n          {/* Sidebar - Table List */}\n          <div className=\"col-span-3\">\n            <Card accent={currentGroup.color.replace('#', '').toUpperCase()}>\n              <h3 className=\"text-lg font-bold mb-4\" style={{ color: COLORS.NAVY }}>\n                {currentGroup.name}\n              </h3>\n              <p className=\"text-sm text-gray-600 mb-4\">\n                {currentGroup.description}\n              </p>\n              \n              <div className=\"space-y-1\">\n                {Object.entries(currentGroup.tables).map(([key, table]) => {\n                  const isActive = activeTable === key;\n                  \n                  return (\n                    <button\n                      key={key}\n                      onClick={() => setActiveTable(key)}\n                      className={`w-full text-left px-4 py-3 rounded-lg font-medium transition-all ${\n                        isActive \n                          ? 'bg-white shadow-md' \n                          : 'hover:bg-gray-50'\n                      }`}\n                      style={{\n                        color: isActive ? currentGroup.color : COLORS.MUTED,\n                        borderLeft: isActive ? `4px solid ${currentGroup.color}` : '4px solid transparent'\n                      }}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <span>{table.name}</span>\n                        {table.isCatalog && (\n                          <Badge variant=\"purple\" size=\"sm\">Catalog</Badge>\n                        )}\n                        {table.isSubcollection && (\n                          <Badge variant=\"primary\" size=\"sm\">Collection</Badge>\n                        )}\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            </Card>\n          </div>\n\n          {/* Main Content - Table Editor */}\n          <div className=\"col-span-9\">\n            {currentTable && (currentGroup.isGlobal || targetUserId) ? (\n              <Card \n                title={currentTable.name}\n                icon={Database}\n                accent={currentGroup.color.replace('#', '').toUpperCase()}\n              >\n                <TableViewer\n                  groupKey={activeGroup}\n                  tableKey={activeTable}\n                  config={currentTable}\n                  userId={targetUserId}\n                />\n              </Card>\n            ) : (\n              <Card accent={currentGroup.color.replace('#', '').toUpperCase()}>\n                <div className=\"p-12 text-center\">\n                  <Search className=\"w-16 h-16 mx-auto mb-4 text-gray-400\" />\n                  <h3 className=\"text-xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n                    Enter a User ID\n                  </h3>\n                  <p className=\"text-gray-600\">\n                    Please enter a user ID above to view and edit their data\n                  </p>\n                </div>\n              </Card>\n            )}\n          </div>\n        </div>\n\n        {/* Help Section */}\n        <div className=\"mt-8 grid grid-cols-2 gap-6\">\n          <Card accent=\"BLUE\">\n            <div className=\"flex items-start gap-3\">\n              <FileText className=\"text-blue-600 flex-shrink-0 mt-1\" size={20} />\n              <div className=\"text-sm\">\n                <p className=\"font-semibold text-blue-900 mb-2\">Database Paths (lowercase keys)</p>\n                <ul className=\"text-blue-800 space-y-1.5 leading-relaxed\">\n                  <li>• User Profile: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">users/{'{userId}'}</code></li>\n                  <li>• Development Plan: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">modules/{'{userId}'}/development_plan/current</code></li>\n                  <li>• Daily Practice: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">modules/{'{userId}'}/daily_practice/current</code></li>\n                  <li>• Reflection History: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">modules/{'{userId}'}/daily_practice/reflection_history</code></li>\n                  <li>• Strategic Content: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">modules/{'{userId}'}/strategic_content/vision_mission</code></li>\n                  <li>• Global Metadata: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">metadata/config</code></li>\n                  <li>• Catalogs: <code className=\"bg-blue-100 px-2 py-0.5 rounded text-xs\">metadata/config/catalog/{'{catalog_name}'}</code></li>\n                </ul>\n              </div>\n            </div>\n          </Card>\n          \n          <Card accent=\"PURPLE\">\n            <div className=\"flex items-start gap-3\">\n              <Settings className=\"text-purple-600 flex-shrink-0 mt-1\" size={20} />\n              <div className=\"text-sm\">\n                <p className=\"font-semibold text-purple-900 mb-2\">Important Notes</p>\n                <div className=\"text-purple-800 space-y-2\">\n                  <div>\n                    <p className=\"font-medium\">All field keys are lowercase:</p>\n                    <code className=\"bg-purple-100 px-2 py-1 rounded text-xs block mt-1\">\n                      {'userid, displayname, createdat, etc.'}\n                    </code>\n                  </div>\n                  <div>\n                    <p className=\"font-medium mt-2\">Catalog structure:</p>\n                    <code className=\"bg-purple-100 px-2 py-1 rounded text-xs block mt-1\">\n                      {'{ items: [...] }'}\n                    </code>\n                  </div>\n                  <div>\n                    <p className=\"font-medium mt-2\">Subcollections:</p>\n                    <p className=\"text-xs mt-1\">Reflection history stores multiple entries as separate documents in a subcollection</p>\n                  </div>\n                  <p className=\"text-xs text-purple-700 mt-2 flex items-start gap-1\">\n                    <AlertTriangle size={12} className=\"mt-0.5 flex-shrink-0\" />\n                    Empty catalogs will cause dashboard errors. Ensure all catalogs are populated.\n                  </p>\n                </div>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/AdminFunctions.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":58},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'emails', 'isSaving', and 'saveStatus'. Either include them or remove the dependency array.","line":62,"column":8,"nodeType":"ArrayExpression","endLine":62,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [emails, initialEmails, isSaving, saveStatus]","fix":{"range":[5628,5643],"text":"[emails, initialEmails, isSaving, saveStatus]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":129,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":42},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'currentFlags'. Either include it or remove the dependency array.","line":262,"column":8,"nodeType":"ArrayExpression","endLine":262,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [currentFlags, initialFlags, isAuthenticated, saveStatus]","fix":{"range":[14614,14657],"text":"[currentFlags, initialFlags, isAuthenticated, saveStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/AdminFunctions.jsx (Updated with Admin Email Manager and Hardcoded Fallback)\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\n// Added Mail, Plus, X\nimport { Shield, ToggleLeft, ToggleRight, Save, Loader, AlertTriangle, ArrowLeft, Key, Settings, Mail, Plus, X } from 'lucide-react'; \n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5355', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Local Definition for standalone use) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use definition ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n     // Added specific variants for this admin tool\n    else if (variant === 'action-write') baseStyle += ` bg-green-600 text-white shadow-md hover:bg-green-700 focus:ring-green-500/50 px-4 py-2 text-sm`;\n    else if (variant === 'action-danger') baseStyle += ` bg-red-600 text-white shadow-md hover:bg-red-700 focus:ring-red-500/50 px-4 py-2 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n// --- Standardized Card Component (Local Definition for standalone use) ---\nconst Card = ({ children, title, icon: Icon, className = '', accent = 'NAVY' }) => { /* ... Re-use definition ... */\n    const accentColor = COLORS[accent] || COLORS.NAVY;\n    return ( <div className={`relative p-6 rounded-2xl border-2 shadow-xl ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }}> <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} /> {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )} {!Icon && title && <h2 className=\"text-xl font-extrapold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>} <div>{children}</div> </div> );\n};\n\n/* =========================================================\n   NEW: AdminEmailManager Component\n========================================================= */\nconst AdminEmailManager = ({ initialEmails, updateGlobalMetadata }) => {\n    // Treat initialEmails as the source of truth, but manage local edits\n    const [emails, setEmails] = useState(initialEmails || []);\n    const [newEmail, setNewEmail] = useState('');\n    const [isSaving, setIsSaving] = useState(false);\n    const [saveStatus, setSaveStatus] = useState('');\n    const [hasChanges, setHasChanges] = useState(false);\n\n    // Sync emails from context only if context changes and we're not currently saving\n    useEffect(() => {\n        const initialString = JSON.stringify(initialEmails || []);\n        const localString = JSON.stringify(emails);\n        \n        // Only re-sync if the initial data has changed externally AND we aren't displaying a local, successful save status\n        // The check for hasChanges prevents re-syncing if the user simply hasn't edited anything yet\n        if (initialString !== localString && !isSaving && !saveStatus.startsWith('✅')) {\n            // Check if the local state has actual *unsaved* changes. If it does, a re-sync would overwrite them.\n            // For now, we trust the external source (Firestore) is the single source of truth and must overwrite local edits.\n            setEmails(initialEmails || []);\n            setHasChanges(false);\n        }\n    }, [initialEmails]);\n    \n    // Check for changes against the initial value\n    useEffect(() => {\n        const initialString = JSON.stringify(initialEmails || []);\n        const localString = JSON.stringify(emails);\n        setHasChanges(initialString !== localString);\n    }, [emails, initialEmails]);\n    \n    // Handler to add a new email\n    const handleAddEmail = () => {\n        const emailToAdd = newEmail.trim().toLowerCase();\n        if (!emailToAdd || !emailToAdd.includes('@')) {\n            alert('Please enter a valid email address.');\n            return;\n        }\n        if (emails.includes(emailToAdd)) {\n            alert('This email is already an admin.');\n            return;\n        }\n        \n        setEmails(prev => [...prev, emailToAdd]); // Use functional update\n        setNewEmail('');\n        setSaveStatus('');\n    };\n\n    // Handler to remove an email\n    const handleRemoveEmail = (emailToRemove) => {\n        setEmails(prev => prev.filter(email => email !== emailToRemove)); // Use functional update\n        setSaveStatus('');\n    };\n\n    // Handler to save changes to Firestore\n    const handleSaveChanges = async () => {\n        setIsSaving(true);\n        setSaveStatus('');\n        \n        // Finalize data structure\n        const dataToSave = {\n            adminemails: emails\n        };\n\n        try {\n            // Use the updateGlobalMetadata function provided by context\n            await updateGlobalMetadata(dataToSave, { \n                source: 'AdminEmailManager',\n                merge: true\n            });\n            setSaveStatus('✅ Admin emails updated successfully!');\n            // The useEffect syncs the local state after the context update.\n        } catch (error) {\n            console.error(\"[AdminEmailManager] Failed to save admin emails:\", error);\n            setSaveStatus(`❌ Error saving emails: ${error.message}`);\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    return (\n        <Card title=\"Administrator List\" icon={Mail} accent=\"BLUE\">\n            <p className=\"text-sm text-gray-600 mb-4\">Emails listed here are granted full access to Admin Functions and all hidden features.</p>\n            \n            {/* Current Admin List */}\n            <div className=\"bg-gray-50 p-4 rounded-lg border space-y-2 mb-4 max-h-48 overflow-y-auto\">\n                {emails.length === 0 && (\n                    <p className=\"text-sm text-gray-500 italic\">No admin emails currently set.</p>\n                )}\n                {emails.map((email, index) => (\n                    <div key={email} className=\"flex items-center justify-between p-2 rounded-md bg-white border\">\n                        <span className=\"text-sm font-medium text-gray-800 break-all\">{email}</span>\n                        <Button \n                            onClick={() => handleRemoveEmail(email)} \n                            variant=\"ghost\" \n                            size=\"sm\"\n                            className=\"text-red-500 hover:bg-red-50\"\n                            disabled={isSaving}\n                        >\n                            <X size={14} />\n                        </Button>\n                    </div>\n                ))}\n            </div>\n\n            {/* Add New Email Input */}\n            <div className=\"flex gap-2 mb-6\">\n                <input\n                    type=\"email\"\n                    placeholder=\"new.admin@email.com\"\n                    value={newEmail}\n                    onChange={(e) => setNewEmail(e.target.value)}\n                    onKeyDown={(e) => e.key === 'Enter' && handleAddEmail()}\n                    className=\"flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    disabled={isSaving}\n                />\n                <Button onClick={handleAddEmail} variant=\"primary\" size=\"sm\" disabled={isSaving || !newEmail.trim().includes('@')}>\n                    <Plus size={16} /> Add\n                </Button>\n            </div>\n\n            {/* Save Changes Button & Status */}\n            <div className=\"pt-4 border-t border-gray-200 flex items-center gap-4\">\n                <Button \n                    onClick={handleSaveChanges} \n                    disabled={isSaving || !hasChanges} \n                    variant=\"action-write\" \n                    size=\"md\"\n                >\n                    {isSaving ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Save className=\"w-5 h-5 mr-2\" />}\n                    {isSaving ? 'Saving List...' : 'Save Admin List'}\n                </Button>\n                {/* Display Save Status */}\n                {saveStatus && (\n                    <span className={`text-sm font-semibold ${saveStatus.includes('Error') ? 'text-red-600' : 'text-green-600'}`}>\n                        {saveStatus}\n                    </span>\n                )}\n            </div>\n            <p className=\"text-xs text-gray-500 mt-2 italic\">\n                    You must refresh the app to take effect after saving changes.\n            </p>\n        </Card>\n    );\n};\n\n\n/* =========================================================\n   AdminFunctionsScreen Component (MODIFIED)\n========================================================= */\n\n/**\n * AdminFunctionsScreen Component\n * Provides administrators with tools to manage application features,\n * protected by a simple password prompt.\n */\nconst AdminFunctionsScreen = () => {\n    // --- Consume Services ---\n    const {\n        navigate, isAdmin, ADMIN_PASSWORD, // Get admin status, password constant, and navigation // cite: useAppServices.jsx\n        featureFlags: initialFlags, // Get initial feature flags // cite: useAppServices.jsx\n        metadata, // Access the global metadata object for adminemails <-- NEW\n        updateGlobalMetadata, // Function to save changes to Firestore // cite: useAppServices.jsx\n        isLoading: isAppLoading // App loading state\n    } = useAppServices();\n\n    // --- Local State ---\n    const [isAuthenticated, setIsAuthenticated] = useState(false); // Controls access to admin functions\n    const [passwordInput, setPasswordInput] = useState(''); // Input for password check\n    const [authError, setAuthError] = useState(''); // Error message for password check\n    // State to hold the feature flags being edited\n    const [currentFlags, setCurrentFlags] = useState(() => initialFlags || {}); // cite: useAppServices.jsx\n    const [isSaving, setIsSaving] = useState(false); // Loading state for saving flags\n    const [saveStatus, setSaveStatus] = useState(''); // Status message after save attempt\n\n    // Extract admin emails from metadata\n    const adminEmails = useMemo(() => {\n        // --- HARDCODED FALLBACK LIST (Matches App.jsx) ---\n        const PRIMARY_ADMIN_EMAILS = ['rob@sagecg.com', 'admin@leaderreps.com'];\n        \n        // Ensure metadata is available and adminemails is an array\n        // This relies on the fix in useAppServices.jsx to include 'adminemails' in metadata\n        const firestoreEmails = metadata?.adminemails;\n        const allEmails = Array.isArray(firestoreEmails) ? firestoreEmails : [];\n        \n        // Merge the hardcoded list with the list from Firestore (deduplicate)\n        const finalEmails = [...new Set([...PRIMARY_ADMIN_EMAILS, ...allEmails])].filter(Boolean);\n\n        // Sort for consistent display\n        return finalEmails.sort();\n    }, [metadata]);\n\n    // --- Effect to redirect if not admin ---\n    useEffect(() => {\n        // Redirect non-admins immediately after checking context\n        if (!isAppLoading && !isAdmin) {\n            console.warn(\"[AdminFunctions] Non-admin user detected. Redirecting to dashboard.\");\n            navigate('dashboard'); // Redirect to a safe default screen // cite: useAppServices.jsx\n        }\n    }, [isAdmin, isAppLoading, navigate]); // Dependencies\n\n    // --- Effect to update local flags if context flags change ---\n    useEffect(() => {\n        // Only update if the screen is authenticated and context flags are available.\n        if (!isAuthenticated || !initialFlags) return;\n\n        const initialFlagsString = JSON.stringify(initialFlags);\n        const currentFlagsString = JSON.stringify(currentFlags);\n\n        // Check if context flags are different from local flags.\n        if (initialFlagsString !== currentFlagsString) {\n            \n            // If a save was *just* successful, assume the local state is ahead of the context \n            // and temporarily wait for the next external context update to reflect the change.\n            if (saveStatus.startsWith('✅')) {\n                 console.log(\"[AdminFunctions] Successful save detected. Skipping immediate local state sync with context (Firestore latency expected).\");\n                 return;\n            }\n\n            console.log(\"[AdminFunctions] Context feature flags updated or initial load finished. Syncing local state.\");\n            setCurrentFlags(initialFlags);\n        }\n    }, [initialFlags, isAuthenticated, saveStatus]); // Dependency on initialFlags and saveStatus\n\n    // --- Handlers (Password, ToggleFlag, SaveChanges are unchanged) ---\n    const handlePasswordCheck = () => {\n        setAuthError(''); // Clear previous error\n        if (passwordInput === ADMIN_PASSWORD) { // cite: useAppServices.jsx (provides ADMIN_PASSWORD)\n            console.log(\"[AdminFunctions] Admin password correct. Granting access.\");\n            setIsAuthenticated(true); // Grant access\n        } else {\n            console.warn(\"[AdminFunctions] Incorrect admin password entered.\");\n            setAuthError('Incorrect password. Please try again.'); // Show error\n            setPasswordInput(''); // Clear input on failure\n        }\n    };\n\n    const handleToggleFlag = (flagName) => {\n        setCurrentFlags(prevFlags => {\n            const currentVal = prevFlags[flagName] !== false; \n            const updatedFlags = { ...prevFlags, [flagName]: !currentVal };\n            console.log(`[AdminFunctions] Toggling flag '${flagName}' to ${!currentVal}. New local state:`, updatedFlags);\n            return updatedFlags;\n        });\n        setSaveStatus(''); // Clear save status when flags are changed\n    };\n\n    const handleSaveChanges = async () => {\n        setIsSaving(true);\n        setSaveStatus(''); // Clear previous status\n        console.log(\"[AdminFunctions] Saving feature flags:\", currentFlags);\n\n        try {\n            await updateGlobalMetadata({ featureFlags: currentFlags }, { // cite: useAppServices.jsx\n                source: 'AdminFunctionsScreen', // Identify the source of the update\n                merge: true // CRITICAL FIX: Ensure merge is true for safe global updates\n            });\n            console.log(\"[AdminFunctions] Feature flags saved successfully.\");\n            setSaveStatus('✅ Flags updated successfully!');\n        } catch (error) {\n            console.error(\"[AdminFunctions] Failed to save feature flags:\", error);\n            setSaveStatus(`❌ Error saving flags: ${error.message}`);\n        } finally {\n            setIsSaving(false); // Reset loading state\n        }\n    };\n\n    // --- Render Logic (Same as original, but now includes AdminEmailManager) ---\n    if (isAppLoading) {\n        return (\n            <div className=\"min-h-screen flex items-center justify-center p-4\" style={{ background: COLORS.BG }}>\n                <div className=\"flex items-center justify-center p-8 text-center text-gray-500 bg-gray-50 rounded-lg min-h-[100px]\">\n                    <Loader className=\"w-5 h-5 animate-spin mr-2\" style={{ color: COLORS.TEAL }} />\n                    Loading Admin Functions...\n                </div>\n            </div>\n        );\n    }\n    \n    if (!isAdmin) {\n         return null;\n    }\n\n    if (!isAuthenticated) {\n        return (\n            <div className=\"min-h-screen flex items-center justify-center p-4\" style={{ background: COLORS.BG }}>\n                <Card title=\"Admin Access Required\" icon={Key} accent=\"ORANGE\" className=\"max-w-md w-full text-center\">\n                    <p className=\"text-sm text-gray-600 mb-4\">Enter the administrator password to manage application features.</p>\n                    <form onSubmit={(e) => { e.preventDefault(); handlePasswordCheck(); }} className=\"space-y-4\">\n                        <input\n                            type=\"password\"\n                            value={passwordInput}\n                            onChange={(e) => setPasswordInput(e.target.value)}\n                            className={`w-full p-3 border rounded-lg text-center focus:ring-2 ${authError ? 'border-red-400 ring-red-300' : 'border-gray-300 ring-[#E04E1B]'}`} // Style based on error\n                            placeholder=\"Admin Password\"\n                            aria-label=\"Admin Password\"\n                            required\n                        />\n                        {authError && <p className=\"text-xs text-red-600\">{authError}</p>}\n                        <Button type=\"submit\" variant=\"secondary\" size=\"md\" className=\"w-full\">\n                            Authenticate\n                        </Button>\n                    </form>\n                    <Button onClick={() => navigate('app-settings')} variant=\"outline\" size=\"sm\" className=\"mt-6 w-full\">\n                         <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to Settings\n                    </Button>\n                </Card>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"p-6 md:p-8 lg:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className=\"mb-8\">\n                <h1 className=\"text-3xl md:text-4xl font-extrabold mb-2 flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n                    <Shield className=\"w-8 h-8\" style={{ color: COLORS.PURPLE }} /> Admin Functions\n                </h1>\n                <p className=\"text-lg text-gray-700\">Manage application features and settings.</p>\n            </header>\n\n             {/* Back Button */}\n            <Button onClick={() => navigate('app-settings')} variant=\"nav-back\" className=\"mb-6\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to App Settings\n            </Button>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n\n                {/* 1. Admin Email Manager <-- NEW CARD */}\n                <AdminEmailManager\n                    initialEmails={adminEmails}\n                    updateGlobalMetadata={updateGlobalMetadata}\n                />\n\n                {/* 2. Feature Flags Management Card */}\n                <Card title=\"Feature Flags\" icon={Settings} accent=\"PURPLE\">\n                    <p className=\"text-sm text-gray-600 mb-6\">Enable or disable application features globally. Changes affect all users on next load.</p>\n\n                   {/* List of Toggles */}\n                    <div className=\"space-y-4\">\n                        {[\n                            'enableLabs',\n                            'enableLabsAdvanced',\n                            'enableCommunity',\n                            'enablePlanningHub',\n                            'enableRoiReport',\n                            'enableCourses',\n                            'enableVideos',\n                            'enableReadings',\n                            'enableDevPlan',\n                            'enableQuickStart',\n                            'enableDailyPractice',\n                            'enableMembershipModule', // <-- CRITICAL FIX: ADDED MISSING FLAG\n                        ]\n                         .sort() \n                         .map((flagName) => {\n                            const isEnabled = currentFlags[flagName]; \n\n                            return (\n                                <div key={flagName} className=\"flex items-center justify-between p-3 border rounded-lg bg-white shadow-sm\">\n                                    <span className=\"text-sm font-medium text-gray-800\">{flagName.replace('enable', '').replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()).trim()}</span>\n                                    \n                                    <button\n                                        onClick={() => handleToggleFlag(flagName)}\n                                        disabled={isSaving}\n                                        className={`flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-semibold border transition-colors ${\n                                            isEnabled !== false ? `bg-green-100 border-green-300 text-green-700` : `bg-red-100 border-red-300 text-red-700`\n                                        }`}\n                                        aria-pressed={isEnabled !== false} \n                                        aria-label={`Toggle ${flagName}`}\n                                    >\n                                        {isEnabled !== false ? <ToggleRight className=\"w-4 h-4\" /> : <ToggleLeft className=\"w-4 h-4\" />}\n                                        {isEnabled !== false ? 'Enabled' : 'Disabled'}\n                                    </button>\n                                </div>\n                            );\n                        })}\n                    </div>\n\n                    {/* Save Changes Button & Status */}\n                    <div className=\"mt-6 pt-4 border-t border-gray-200 flex items-center gap-4\">\n                        <Button onClick={handleSaveChanges} disabled={isSaving} variant=\"action-write\" size=\"md\">\n                            {isSaving ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Save className=\"w-5 h-5 mr-2\" />}\n                            {isSaving ? 'Saving Changes...' : 'Save Feature Flags'}\n                        </Button>\n                        {saveStatus && (\n                            <span className={`text-sm font-semibold ${saveStatus.includes('Error') ? 'text-red-600' : 'text-green-600'}`}>\n                                {saveStatus}\n                            </span>\n                        )}\n                    </div>\n\n                    <p className=\"text-xs text-gray-500 mt-4 italic\">\n                        Feature flags are loaded from <code>metadata/config</code> document in Firestore.\n                    </p>\n                </Card>\n            </div>\n\n             {/* Data Manager Link Card */}\n             <Card title=\"Database Management\" icon={Key} accent=\"NAVY\" className=\"mt-6\">\n                <p className=\"text-sm text-gray-600 mb-4\">Direct access to the Firestore Data Manager to view and edit document/collection data.</p>\n                <Button onClick={() => navigate('data-maintenance')} variant=\"outline\" size=\"md\">\n                    <Shield className=\"w-5 h-5 mr-2\" /> Open Data Manager\n                </Button>\n             </Card>\n\n        </div>\n    );\n};\n\n// Export the component\nexport default AdminFunctionsScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/AppSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getAuth' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/AppSettings.jsx (Extracted and Refined)\n\nimport React from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\nimport { User, Lock, Code, Cpu, Settings, Shield, ArrowLeft } from 'lucide-react'; // Added Shield, ArrowLeft\nimport { getAuth, sendPasswordResetEmail } from 'firebase/auth';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5355', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Assume imported or globally available) ---\n// Using placeholder comments, assuming Button and Card are correctly defined elsewhere or globally\n// const Button = ({...}) => { /* ... Standard Button ... */ };\n// const Card = ({...}) => { /* ... Standard Card ... */ };\n\n// --- Standardized Button Component (Local Definition for standalone use) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => {\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n// --- Standardized Card Component (Local Definition for standalone use) ---\nconst Card = ({ children, title, icon: Icon, className = '', accent = 'NAVY' }) => {\n    const accentColor = COLORS[accent] || COLORS.NAVY;\n    return (\n        <div className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrapold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </div>\n    );\n};\n\n/* =========================================================\n   AppSettingsScreen Component\n========================================================= */\n\n/**\n * AppSettingsScreen Component\n * Allows users to view account details, manage security settings (placeholder),\n * check AI integration status, and access admin tools (if authorized).\n */\nconst AppSettingsScreen = () => {\n  // --- Consume Services ---\n  const { user, API_KEY, auth, navigate, isAdmin } = useAppServices(); // cite: useAppServices.jsx\n\n  // --- Handlers ---\n  /**\n   * Sends a password reset email using Firebase Auth.\n   */\n  const handleResetPassword = async () => {\n    if (!user?.email || !auth) { // Added auth check\n      alert('Cannot reset password: User email or authentication service is unavailable.');\n      return;\n    }\n    console.log(`[AppSettings] Requesting password reset for ${user.email}`);\n    try {\n      // Use the sendPasswordResetEmail function from firebase/auth\n      await sendPasswordResetEmail(auth, user.email); // cite: App.jsx (original location)\n      alert(`Password reset email sent successfully to ${user.email}. Please check your inbox (and spam folder).`);\n    } catch (error) {\n      console.error(\"[AppSettings] Password reset failed:\", error);\n      alert(`Failed to send password reset email: ${error.message}`);\n    }\n  };\n\n  /**\n   * Placeholder function for signing out from all devices.\n   * Requires more complex backend/Firebase Functions implementation.\n   */\n  const handleSignOutAll = () => {\n      console.warn(\"[AppSettings] 'Sign Out From All Devices' action triggered (Placeholder).\");\n      alert(\"Placeholder: This action would typically revoke refresh tokens via a backend function.\");\n      // Implementation might involve Firebase Admin SDK to revoke refresh tokens.\n  };\n\n  return (\n    // Consistent page structure and padding\n    <div className=\"p-6 md:p-8 lg:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n      {/* Header */}\n      <header className=\"mb-8\">\n        <h1 className=\"text-3xl md:text-4xl font-extrabold mb-2 flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n            <Settings className=\"w-8 h-8\" style={{ color: COLORS.TEAL }} /> App Settings\n        </h1>\n        <p className=\"text-lg text-gray-700\">Manage your profile, security, and application preferences.</p>\n      </header>\n\n      {/* Settings Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto\"> {/* Centered content */}\n\n        {/* User Account Card */}\n        <Card title=\"User Account\" icon={User} accent=\"TEAL\">\n          <div className=\"space-y-2 text-sm\">\n              <p className=\"text-gray-700\"><strong>Full Name:</strong> <span className=\"font-semibold\">{user?.name || 'N/A'}</span></p>\n              <p className=\"text-gray-700\"><strong>Email:</strong> <span className=\"font-semibold\">{user?.email || 'N/A'}</span></p>\n              {/* <p className=\"text-gray-700\"><strong>User ID:</strong> <span className=\"font-mono text-xs bg-gray-100 px-1 rounded\">{user?.userId || 'N/A'}</span></p> */}\n          </div>\n          {/* Change Password Button */}\n          <Button onClick={handleResetPassword} variant=\"outline\" size=\"sm\" className=\"mt-4 w-full !text-orange-600 !border-orange-300 hover:!bg-orange-50\">\n            Change Password (Send Reset Link)\n          </Button>\n        </Card>\n\n        {/* Security Card (Placeholders) */}\n        <Card title=\"Security\" icon={Lock} accent=\"ORANGE\">\n          <div className=\"space-y-2 text-sm\">\n              <p className=\"text-gray-700\">\n                <strong>Two-Factor Auth:</strong> <span className=\"font-semibold text-red-500\">Disabled</span> {/* Placeholder */}\n              </p>\n              <p className=\"text-gray-700\">\n                <strong>Last Sign In:</strong> <span className=\"font-semibold\">{/* Placeholder - Could get from user.metadata.lastSignInTime */} {new Date().toLocaleString()}</span>\n              </p>\n          </div>\n           {/* Sign Out All Button */}\n           <Button onClick={handleSignOutAll} variant=\"outline\" size=\"sm\" className=\"mt-4 w-full !text-gray-600 !border-gray-300 hover:!bg-gray-100\">\n            Sign Out From All Devices (Placeholder)\n           </Button>\n        </Card>\n\n        {/* AI Integration Card */}\n        <Card title=\"AI Integration\" icon={Code} accent=\"PURPLE\">\n          <label htmlFor=\"apiKeyStatus\" className=\"block text-sm font-medium text-gray-700 mb-1\">Gemini API Key Status</label>\n          {/* Display API Key Status (Read-only) */}\n          <input\n            id=\"apiKeyStatus\" type=\"text\"\n            value={API_KEY ? 'Active / Configured' : 'Missing / Not Configured'} // cite: useAppServices.jsx (provides API_KEY)\n            readOnly disabled\n            className={`w-full p-2 border rounded-lg text-sm font-semibold text-center ${API_KEY ? 'bg-green-50 border-green-200 text-green-700' : 'bg-red-50 border-red-200 text-red-700'}`}\n          />\n          <p className=\"text-xs text-gray-500 mt-1\">\n            API Key is managed via environment variables (not editable here). Status reflects runtime availability.\n          </p>\n        </Card>\n\n        {/* Admin Tools Card (Conditional) */}\n        {/* Render this card only if the user is identified as an admin */}\n        {isAdmin && ( // cite: useAppServices.jsx (provides isAdmin)\n            <Card title=\"Administrator Tools\" icon={Shield} accent=\"NAVY\">\n              <p className=\"text-sm text-gray-700 mb-4\">Access tools for managing global application data and features.</p>\n              <div className=\"space-y-2\">\n                  {/* Link to Feature Flag Management */}\n                  <Button onClick={() => navigate('admin-functions')} variant=\"outline\" size=\"sm\" className=\"w-full\">\n                    <Settings size={14} className=\"mr-1\" /> Manage Feature Flags\n                  </Button>\n                  {/* Link to Raw Data Editor */}\n                  <Button onClick={() => navigate('data-maintenance')} variant=\"outline\" size=\"sm\" className=\"w-full !text-orange-600 !border-orange-300 hover:!bg-orange-50\">\n                    <Cpu size={14} className=\"mr-1\" /> Firestore Data Manager (Raw)\n                  </Button>\n                  {/* Link to Debug Data Viewer */}\n                  <Button onClick={() => navigate('debug-data')} variant=\"outline\" size=\"sm\" className=\"w-full !text-blue-600 !border-blue-300 hover:!bg-blue-50\">\n                    <Code size={14} className=\"mr-1\" /> Raw Context Viewer\n                  </Button>\n              </div>\n            </Card>\n        )}\n      </div>\n\n       {/* Back Button (Optional - users typically use main nav) */}\n       <footer className=\"mt-12 text-center\">\n            <Button onClick={() => navigate('dashboard')} variant=\"nav-back\" size=\"sm\">\n               <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to The Arena\n            </Button>\n       </footer>\n    </div>\n  );\n};\n\n// Export the component\nexport default AppSettingsScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/AppliedLeadership.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'handleOpenResource' is defined but never used.","line":187,"column":83,"nodeType":"Identifier","messageId":"unusedVar","endLine":187,"endColumn":101},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":295,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":295,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/AppliedLeadership.jsx (FIXED: Missing Icons and Modal State)\n\nimport React, { useState, useMemo, useCallback, useEffect } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- ICONS: CRITICAL FIX - Import all icons used in sub-components/rendering logic ---\nimport { ArrowLeft, BookOpen, ChevronRight, Loader, AlertTriangle, ShieldCheck, Zap, Briefcase, Lightbulb, CheckCircle, X, CornerRightUp } from 'lucide-react'; \n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized Button Component (Matches Dashboard) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n\n// --- Standardized Card Component (Matches Dashboard) ---\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\n\n// --- Standardized Loading Spinner ---\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-[300px] flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/* =========================================================\n   PLACEHOLDER COMPONENTS (Styled Consistently)\n========================================================= */\n\n/**\n * Placeholder for AI Coaching Simulator specific to a skill/course.\n */\nconst AICoachingSimulator = ({ item, isCourse = false }) => (\n  <Card title={`AI Rep Coach for ${item.title || item.name}`} icon={ShieldCheck} accent=\"PURPLE\" className=\"my-8\">\n    <p className=\"text-sm text-gray-600 mb-4\">Practice applying '{item.title || item.name}' principles in simulated scenarios.</p>\n    {/* Placeholder content */}\n    <div className=\"p-4 bg-purple-50 border border-purple-200 rounded-lg text-center text-purple-700 font-medium italic\">\n      {isCourse ? `Access the dedicated AI Coach for this course's modules.` : `AI Coaching Simulator coming soon...`}\n    </div>\n  </Card>\n);\n\n/**\n * Modal to display details of a selected resource.\n */\nconst ResourceDetailModal = ({ isVisible, onClose, resource, skill }) => { // Renamed prop to 'skill'\n    if (!isVisible || !resource || !skill) return null;\n\n    // Use X icon (imported)\n    // Note: X icon is now imported at the top.\n    \n    return (\n        // Standard modal structure with backdrop and content\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-in fade-in duration-200 backdrop-blur-sm\">\n            <div className=\"bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full relative animate-in zoom-in-95 slide-in-from-bottom-5 duration-300 overflow-hidden\">\n                {/* Header */}\n                <div className=\"flex justify-between items-center pb-3 mb-4 border-b\" style={{ borderColor: COLORS.SUBTLE }}>\n                    <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>{resource.title}</h3>\n                    <Button onClick={onClose} variant=\"ghost\" size=\"sm\" className=\"!p-1 text-gray-400 hover:text-red-600 absolute top-3 right-3\"> {/* Use Button */}\n                        <X className=\"w-5 h-5\" />\n                    </Button>\n                </div>\n                {/* Content */}\n                <p className=\"text-xs font-semibold uppercase mb-1\" style={{ color: COLORS.TEAL }}>Skill: {skill.name}</p>\n                <p className=\"text-sm text-gray-600 mb-4\">{resource.summary || 'Details unavailable.'}</p>\n                {/* Additional details like type, duration could go here */}\n                {resource.type && <p className=\"text-xs text-gray-500 mb-1\">Type: {resource.type}</p>}\n                {/* Link */}\n                 {resource.url && (\n                    <a href={resource.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"mt-4 inline-block text-blue-600 hover:underline text-sm font-medium group\">\n                        View Resource <span className=\"inline-block transition-transform group-hover:translate-x-1\">&rarr;</span>\n                    </a>\n                 )}\n                 {/* Close Button */}\n                <Button onClick={onClose} variant=\"outline\" size=\"sm\" className=\"mt-6 w-full\">Close</Button>\n            </div>\n        </div>\n    );\n};\n\n\n/**\n * Renders the detail view for a full Course (like QuickStart).\n * The Course structure is assumed to be { id, title, summary, icon, modules: [...] }\n */\nconst CourseDetailView = ({ course, setCourseDetail }) => {\n    // Determine Icon and Color\n    const { IconMap, LEADERSHIP_TIERS, navigate } = useAppServices();\n    const IconComponent = IconMap?.[course.icon] || ShieldCheck;\n    const tierMeta = LEADERSHIP_TIERS?.[course.tier_id];\n    const accentColorKey = tierMeta?.color?.split('-')[0].toUpperCase() || 'TEAL';\n    const accentColor = COLORS[accentColorKey] || COLORS.TEAL;\n\n    return (\n        <div className=\"p-6 md:p-8 lg:p-10 max-w-4xl mx-auto\">\n            {/* Back Button */}\n            <Button onClick={() => setCourseDetail(null)} variant='nav-back' className='mb-6'>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to Course Library\n            </Button>\n\n            {/* Course Header Card */}\n            <Card accent={accentColorKey} className=\"mb-8\">\n                 <div className='flex flex-col sm:flex-row items-start space-y-4 sm:space-y-0 sm:space-x-4'>\n                    {/* Icon */}\n                    <div className=\"w-16 h-16 rounded-full flex items-center justify-center shadow-lg flex-shrink-0\" style={{ background: `${accentColor}1A` }}>\n                        {IconComponent && <IconComponent className=\"w-8 h-8\" style={{ color: accentColor }} />}\n                    </div>\n                    {/* Title & Summary */}\n                    <div className=\"flex-1\">\n                        <h1 className=\"text-2xl md:text-3xl font-extrabold\" style={{ color: COLORS.NAVY }}>{course.title}</h1>\n                        <p className=\"text-md md:text-lg text-gray-600 mt-1\">{course.summary}</p>\n                    </div>\n                </div>\n            </Card>\n\n            {/* AI Coaching Simulator for the Course */}\n            <AICoachingSimulator item={course} isCourse={true} />\n\n            {/* Modules/Sessions Card */}\n            <Card title=\"Course Modules\" icon={Briefcase} accent='NAVY' className='mt-8'>\n                <div className=\"space-y-4\">\n                    {(course.modules || []).map((module, index) => (\n                        <div key={module.id || index} className=\"p-4 rounded-lg border shadow-sm bg-white hover:border-blue-400 transition\">\n                            <h3 className=\"text-lg font-bold flex items-center gap-2\" style={{ color: COLORS.NAVY }}>\n                                <span className=\"w-6 h-6 flex items-center justify-center rounded-full text-xs font-extrabold text-white\" style={{ background: accentColor }}>{module.id || index + 1}</span>\n                                {module.title}\n                            </h3>\n                            {/* Why it Matters */}\n                            <details className=\"my-3 group\">\n                                <summary className=\"text-sm font-semibold cursor-pointer list-none flex items-center gap-1\" style={{ color: COLORS.TEAL }}>\n                                    <Lightbulb className=\"w-4 h-4 text-amber-500\"/> Rationale: {module.focus}\n                                    <span className=\"text-xs text-gray-400 group-open:rotate-90 transition-transform\">▶</span>\n                                </summary>\n                                <blockquote className=\"mt-2 border-l-4 pl-4 py-1 text-sm italic text-gray-600\" style={{ borderColor: COLORS.TEAL }}>\n                                    {module.rationale}\n                                </blockquote>\n                            </details>\n\n                            {/* Pre-Work Checklist */}\n                            <div className='mt-3 pt-3 border-t' style={{ borderColor: COLORS.SUBTLE }}>\n                                <p className=\"text-sm font-semibold mb-1\" style={{ color: COLORS.ORANGE }}><CheckCircle className='w-4 h-4 inline-block mr-1'/> Pre-Work Required:</p>\n                                <ul className=\"list-disc pl-5 text-gray-700 space-y-0.5 text-sm\">\n                                    {(module.preWork || []).map((item, idx) => (\n                                        <li key={idx} className='text-xs'>{item}</li>\n                                    ))}\n                                </ul>\n                            </div>\n                            {/* Special case link for LIS Auditor if it's QuickStart Session 2 */}\n                            {course.id === 'quickstart_accelerator' && module.id === 2 && (\n                                <Button onClick={() => navigate('quick-start-accelerator')} variant=\"secondary\" size=\"sm\" className='mt-4'>\n                                    <Zap className=\"w-4 h-4\" /> Go to LIS Auditor Tool\n                                </Button>\n                            )}\n                        </div>\n                    ))}\n                </div>\n            </Card>\n        </div>\n    );\n};\n\n\n/**\n * Renders the detail view for an individual Skill.\n */\nconst SkillDetailView = ({ skill, setSelectedSkill, resourceLibrary, getTierName, handleOpenResource }) => {\n    // FIX: Define local state for modal visibility and resource\n    const [isResourceModalVisible, setIsResourceModalVisible] = useState(false);\n    const [currentResource, setCurrentResource] = useState(null);\n\n    // FIX: Update modal handlers to use local state\n    const localHandleOpenResource = (resource) => {\n        setCurrentResource(resource);\n        setIsResourceModalVisible(true);\n    };\n\n    const localHandleCloseResource = () => {\n        setIsResourceModalVisible(false);\n        setTimeout(() => setCurrentResource(null), 300);\n    };\n\n    // Get resources associated with this skill's ID from the pre-transformed library\n    const resources = resourceLibrary?.[skill.skill_id] || []; // cite: useAppServices.jsx\n    // Get the icon component from IconMap, fallback to BookOpen\n    const { IconMap, LEADERSHIP_TIERS } = useAppServices();\n    const IconComponent = IconMap?.[skill.icon] || BookOpen; // cite: useAppServices.jsx\n    // Determine accent color based on the skill's tier\n    const tierMeta = LEADERSHIP_TIERS?.[skill.tier_id]; // cite: useAppServices.jsx\n    const accentColorKey = tierMeta?.color?.split('-')[0].toUpperCase();\n    const accentColor = COLORS[accentColorKey] || COLORS.TEAL;\n\n    return (\n        // Consistent padding and max-width for detail view\n        <div className=\"p-6 md:p-8 lg:p-10 max-w-4xl mx-auto\">\n            {/* Back Button */}\n            <Button onClick={() => setSelectedSkill(null)} variant='nav-back' className='mb-6'>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to Course Library\n            </Button>\n\n            {/* Skill Header Card */}\n            <Card accent={accentColorKey} className=\"mb-8\">\n                 <div className='flex flex-col sm:flex-row items-start space-y-4 sm:space-y-0 sm:space-x-4'>\n                    {/* Icon */}\n                    <div className=\"w-16 h-16 rounded-full flex items-center justify-center shadow-lg flex-shrink-0\" style={{ background: `${accentColor}1A` }}>\n                        {IconComponent && <IconComponent className=\"w-8 h-8\" style={{ color: accentColor }} />}\n                    </div>\n                    {/* Title, Summary, Tier Badge */}\n                    <div className=\"flex-1\">\n                        <h1 className=\"text-2xl md:text-3xl font-extrabold\" style={{ color: COLORS.NAVY }}>{skill.name}</h1>\n                        <p className=\"text-md md:text-lg text-gray-600 mt-1\">{skill.summary}</p>\n                        <p className=\"text-xs font-semibold mt-3 px-3 py-1 rounded-full inline-block\" style={{ background: `${accentColor}20`, color: accentColor }}>\n                           {getTierName(skill.tier_id)} {/* Display tier name */}\n                        </p>\n                    </div>\n                </div>\n            </Card>\n\n            {/* AI Coaching Simulator (Placeholder) */}\n            <AICoachingSimulator item={skill} isCourse={false} />\n\n            {/* Curated Resources Card */}\n            <Card title=\"Curated Deep Dive Resources\" icon={BookOpen} accent='NAVY' className='mt-8'>\n                {/* Empty State */}\n                {resources.length === 0 && (\n                    <p className=\"text-gray-500 italic text-sm text-center py-4\">\n                        No specific resources linked to this skill yet.\n                    </p>\n                )}\n                {/* Resource List */}\n                <div className=\"space-y-3\">\n                    {resources.map((resource, index) => (\n                        <button\n                            key={resource.resource_id || index} // Use unique ID if available\n                            onClick={() => localHandleOpenResource(resource)} // FIX: Use local handler\n                            // Styling for resource list items\n                            className=\"w-full text-left p-4 rounded-lg bg-gray-50 hover:bg-teal-50 border border-gray-200 hover:border-teal-200 transition flex justify-between items-center group focus:outline-none focus:ring-2 focus:ring-[${COLORS.TEAL}]\"\n                        >\n                            <div className=\"overflow-hidden\"> {/* Prevent text overflow */}\n                                <p className=\"font-semibold text-sm truncate\" style={{ color: COLORS.NAVY }}>{resource.title}</p>\n                                <p className=\"text-xs text-gray-500\">{resource.type || 'Resource'}</p>\n                            </div>\n                            <ChevronRight className='w-5 h-5 text-gray-400 flex-shrink-0 ml-2 group-hover:text-[${COLORS.TEAL}] transition-colors'/>\n                        </button>\n                    ))}\n                </div>\n            </Card>\n\n            {/* Resource Detail Modal - FIX: Use local state and handlers */}\n            <ResourceDetailModal\n                isVisible={isResourceModalVisible}\n                onClose={localHandleCloseResource}\n                resource={currentResource}\n                skill={skill} // Pass skill context\n            />\n        </div>\n    );\n};\n\n\n/* =========================================================\n   MAIN SCREEN COMPONENT: AppliedLeadershipScreen (Course Library)\n========================================================= */\n\nexport default function AppliedLeadershipScreen() {\n    // --- Consume services ---\n    const {\n        SKILL_CATALOG, // Contains individual skills\n        COURSE_LIBRARY, // Contains full courses (like QuickStart)\n        RESOURCE_LIBRARY,\n        LEADERSHIP_TIERS,\n        IconMap,\n        isLoading: isAppLoading,\n        error: appError,\n        navigate,\n    } = useAppServices();\n\n    // --- Local State ---\n    const [selectedSkill, setSelectedSkill] = useState(null); // Holds the currently viewed skill object\n    const [selectedCourse, setSelectedCourse] = useState(null); // Holds the currently viewed course object\n    const [isModalVisible, setIsModalVisible] = useState(false); // Modal for resource detail (only used in legacy structure/home view)\n    const [selectedResource, setSelectedResource] = useState(null);\n\n    // --- Effect to scroll to top on mount or when detail changes ---\n    useEffect(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, [selectedSkill, selectedCourse]);\n\n    // --- Derived Data ---\n    // Safely extract the array of individual skills\n    const safeSkills = useMemo(() => {\n        if (isAppLoading) return [];\n        if (SKILL_CATALOG && typeof SKILL_CATALOG === 'object' && Array.isArray(SKILL_CATALOG.items)) {\n            return SKILL_CATALOG.items;\n        }\n        console.warn(\"[AppliedLeadership] SKILL_CATALOG data is missing or invalid.\");\n        return [];\n    }, [SKILL_CATALOG, isAppLoading]); // cite: useAppServices.jsx\n\n    // Safely extract the array of courses\n    const safeCourses = useMemo(() => {\n        if (isAppLoading) return [];\n        if (COURSE_LIBRARY && typeof COURSE_LIBRARY === 'object' && Array.isArray(COURSE_LIBRARY.items)) {\n            // Courses are expected to have a 'title' field\n            return COURSE_LIBRARY.items.filter(item => item.title);\n        }\n        console.warn(\"[AppliedLeadership] COURSE_LIBRARY data is missing or invalid. Using empty array.\");\n        return [];\n    }, [COURSE_LIBRARY, isAppLoading]); // cite: useAppServices.jsx\n\n    // --- Callbacks ---\n    const handleSelectSkill = useCallback((skill) => {\n        console.log(\"[AppliedLeadership] Selecting skill:\", skill.name);\n        setSelectedCourse(null); // Clear course selection\n        setSelectedSkill(skill);\n    }, []);\n\n    const handleSelectCourse = useCallback((course) => {\n        console.log(\"[AppliedLeadership] Selecting course:\", course.title);\n        setSelectedSkill(null); // Clear skill selection\n        setSelectedCourse(course);\n    }, []);\n\n    // These resource handlers are now only relevant for the top-level home view if it links to resources directly\n    // They are no longer needed for SkillDetailView since it manages its own state.\n    const handleOpenResource = useCallback((resource) => {\n        console.log(\"[AppliedLeadership] Opening resource (Home View):\", resource.title);\n        setSelectedResource(resource);\n        setIsModalVisible(true);\n    }, []);\n\n    const handleCloseResource = useCallback(() => {\n        setIsModalVisible(false);\n        setTimeout(() => setSelectedResource(null), 300);\n    }, []);\n\n    const getTierName = useCallback((tierId) => {\n        return LEADERSHIP_TIERS?.[tierId]?.name || `Tier ${tierId}`; // cite: useAppServices.jsx\n    }, [LEADERSHIP_TIERS]);\n\n    // --- RENDER: Skill Grid View (Course Library Home) ---\n    const renderLibraryHome = () => (\n        <div className=\"p-6 md:p-8 lg:p-10\">\n            {/* Header */}\n            <div className='flex items-center gap-4 border-b-2 pb-2 mb-8' style={{borderColor: COLORS.NAVY+'30'}}>\n                <ShieldCheck className='w-10 h-10' style={{color: COLORS.NAVY}}/> {/* Use consistent header style */}\n                <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Course Library</h1>\n            </div>\n            <p className=\"text-lg text-gray-600 mb-10 max-w-3xl\">\n                Explore leadership skills, access curated resources, practice with AI coaching, and build mastery through focused reps. **Practice over theory.**\n            </p>\n\n            {/* Loading/Error States */}\n            {isAppLoading && <LoadingSpinner message=\"Loading course library...\" />}\n            {!isAppLoading && appError && (\n                 <div className=\"text-red-600 italic text-center py-10 bg-red-50 p-4 rounded-lg border border-red-200 max-w-2xl mx-auto flex items-center justify-center gap-2\">\n                     <AlertTriangle className=\"w-5 h-5 text-red-500\"/>\n                     <span>Error loading library: {appError.message}. Please try again later.</span>\n                 </div>\n            )}\n\n            {/* --- 1. COURSE Section (QuickStart, etc.) --- */}\n            {safeCourses.length > 0 && (\n                <section className='mb-12'>\n                    <h2 className='text-2xl font-bold mb-6 border-l-4 pl-3 flex items-center gap-2' style={{ color: COLORS.NAVY, borderColor: COLORS.ORANGE }}>\n                        <Zap className='w-6 h-6' style={{color: COLORS.ORANGE}}/> Programs & Courses\n                    </h2>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {safeCourses.map((course) => {\n                            const IconComponent = IconMap?.[course.icon] || Briefcase;\n                            const accentColorKey = (course.tier_id ? LEADERSHIP_TIERS?.[course.tier_id]?.color?.split('-')[0].toUpperCase() : null) || 'ORANGE';\n                            const accentColor = COLORS[accentColorKey] || COLORS.ORANGE;\n                            const moduleCount = course.modules?.length || 0;\n\n                            return (\n                                <button\n                                    key={course.id}\n                                    onClick={() => handleSelectCourse(course)}\n                                    className=\"text-left block w-full group focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[${COLORS.ORANGE}] rounded-2xl\"\n                                >\n                                    <div className={`p-6 rounded-2xl border-2 shadow-lg transition-all duration-300 group-hover:scale-[1.03] group-hover:shadow-xl h-full flex flex-col`}\n                                         style={{ borderColor: `${accentColor}30`, background: COLORS.LIGHT_GRAY }}>\n                                        <div className='flex items-center space-x-3 mb-3'>\n                                            <div className=\"w-12 h-12 rounded-full flex items-center justify-center shadow-md flex-shrink-0\" style={{ background: `${accentColor}1A` }}>\n                                                {IconComponent && <IconComponent className=\"w-6 h-6\" style={{ color: accentColor }} />}\n                                            </div>\n                                            <h2 className=\"text-lg font-extrabold flex-1\" style={{ color: COLORS.NAVY }}>{course.title}</h2>\n                                        </div>\n                                        <p className=\"text-sm text-gray-600 mb-4 flex-grow\" style={{ minHeight: '3rem' }}>{course.summary}</p>\n                                        <div className='mt-auto pt-3 border-t' style={{ borderColor: COLORS.SUBTLE }}>\n                                            <div className='flex justify-between items-center'>\n                                                <span className='text-xs font-semibold uppercase' style={{ color: accentColor }}>\n                                                    {moduleCount} Module{moduleCount !== 1 ? 's' : ''}\n                                                </span>\n                                                <ChevronRight className='w-4 h-4' style={{ color: accentColor }}/>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </button>\n                            );\n                        })}\n                    </div>\n                </section>\n            )}\n\n            {/* --- 2. SKILL Section --- */}\n            {safeSkills.length > 0 && (\n                <section>\n                    <h2 className='text-2xl font-bold mb-6 border-l-4 pl-3 flex items-center gap-2' style={{ color: COLORS.NAVY, borderColor: COLORS.TEAL }}>\n                        <Briefcase className='w-6 h-6' style={{color: COLORS.TEAL}}/> Individual Skills & Micro-Learning\n                    </h2>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {safeSkills.map((skill) => {\n                            const IconComponent = IconMap?.[skill.icon] || BookOpen;\n                            const tierMeta = LEADERSHIP_TIERS?.[skill.tier_id];\n                            const accentColorKey = tierMeta?.color?.split('-')[0].toUpperCase();\n                            const accentColor = COLORS[accentColorKey] || COLORS.TEAL;\n                            const resourceCount = RESOURCE_LIBRARY?.[skill.skill_id]?.length || 0;\n\n                            return (\n                                <button\n                                    key={skill.skill_id}\n                                    onClick={() => handleSelectSkill(skill)}\n                                    className=\"text-left block w-full group focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[${COLORS.TEAL}] rounded-2xl\"\n                                >\n                                    <div className={`p-6 rounded-2xl border-2 shadow-lg transition-all duration-300 group-hover:scale-[1.03] group-hover:shadow-xl h-full flex flex-col`}\n                                         style={{ borderColor: `${accentColor}30`, background: COLORS.LIGHT_GRAY }}>\n                                        <div className='flex items-center space-x-3 mb-3'>\n                                            <div className=\"w-12 h-12 rounded-full flex items-center justify-center shadow-md flex-shrink-0\" style={{ background: `${accentColor}1A` }}>\n                                                {IconComponent && <IconComponent className=\"w-6 h-6\" style={{ color: accentColor }} />}\n                                            </div>\n                                            <h2 className=\"text-lg font-extrabold flex-1\" style={{ color: COLORS.NAVY }}>{skill.name}</h2>\n                                        </div>\n                                        <p className=\"text-sm text-gray-600 mb-4 flex-grow\" style={{ minHeight: '3rem' }}>{skill.summary}</p>\n                                        <div className='mt-auto pt-3 border-t' style={{ borderColor: COLORS.SUBTLE }}>\n                                            <div className='flex justify-between items-center'>\n                                                <span className='text-xs font-semibold uppercase' style={{ color: accentColor }}>\n                                                    {resourceCount} Resource{resourceCount !== 1 ? 's' : ''}\n                                                </span>\n                                                <ChevronRight className='w-4 h-4' style={{ color: accentColor }}/>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </button>\n                            );\n                        })}\n                    </div>\n                </section>\n            )}\n\n            {/* Empty State (Post-Loading, No Error) */}\n            {!isAppLoading && !appError && safeSkills.length === 0 && safeCourses.length === 0 && (\n                 <div className=\"text-gray-500 italic text-center py-10 bg-gray-100 p-4 rounded-lg border border-gray-200 max-w-2xl mx-auto flex items-center justify-center gap-2\">\n                     <AlertTriangle className=\"w-5 h-5 text-orange-500\"/>\n                     <span>The Course Library and Skill Catalog appear to be empty or missing data. Please contact an administrator.</span>\n                 </div>\n            )}\n        </div>\n    );\n\n    // --- Main Component Return ---\n    // Renders either a detail view or the main grid\n    return (\n        <div className='min-h-screen' style={{ background: COLORS.BG }}>\n            {selectedCourse ? (\n                <CourseDetailView course={selectedCourse} setCourseDetail={setSelectedCourse} />\n            ) : selectedSkill ? (\n                 <SkillDetailView\n                    skill={selectedSkill}\n                    setSelectedSkill={setSelectedSkill}\n                    resourceLibrary={RESOURCE_LIBRARY}\n                    getTierName={getTierName}\n                    handleOpenResource={handleOpenResource}\n                 />\n            ) : (\n                renderLibraryHome()\n            )}\n\n            {/* Global Resource Modal (Used by SkillDetailView) */}\n            <ResourceDetailModal\n                isVisible={isModalVisible}\n                onClose={handleCloseResource}\n                resource={selectedResource}\n                skill={selectedSkill || {}} // Pass skill context\n            />\n        </div>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/BusinessReadings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'book' is defined but never used.","line":101,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'book' is defined but never used.","line":102,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":655,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":655,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/BusinessReadings.jsx (FIXED: submitAiHandler ReferenceError)\n\nimport React, { useState, useMemo, useRef, useEffect, useCallback } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\nimport { DIMENSION_TO_TIER_MAP, CORPORATE_COLORS } from '../../data/Constants.js';\nimport ConfigError from '../../components/system/ConfigError.jsx';\n\n// --- Icons ---\nimport {\n  BookOpen, Target, CheckCircle, Clock, AlertTriangle, MessageSquare, Filter, TrendingUp,\n  Star, Search as SearchIcon, Cpu, Zap, Info, Check, Loader, Save, ArrowLeft\n} from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = CORPORATE_COLORS;\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-[300px] flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n// --- Complexity Mapping (Could be loaded from global metadata) ---\nconst COMPLEXITY_MAP = {\n  Low:    { label: 'Foundational', hex: COLORS.GREEN, icon: CheckCircle },\n  Medium: { label: 'Intermediate', hex: COLORS.AMBER, icon: AlertTriangle },\n  High:   { label: 'Advanced',     hex: COLORS.RED,   icon: Target },\n};\n\n\n/* =========================================================\n   DATA & UTILITIES\n========================================================= */\n\n// --- Fallback Book Data (Used only if READING_CATALOG fails to load) ---\nconst MOCK_ALL_BOOKS_FALLBACK = { // cite: Original File\n    'Strategy & Execution': [ { id: 's_e_1_fb', title: 'The E-Myth Revisited (Fallback)', author: 'Michael E. Gerber', theme: 'Why most small businesses fail.', complexity: 'Medium', duration: 180, focus: 'Delegation, Process Mapping, Systemization', executiveBriefHTML: '<p>Mock Brief: Focus on systems.</p>', fullFlyerHTML: '<h2>Mock Flyer: The E-Myth</h2><p>Build systems like a franchise...</p>' } ],\n    'People & Culture': [ { id: 'p_c_1_fb', title: 'Dare to Lead (Fallback)', author: 'Brené Brown', theme: 'Courageous leadership via vulnerability.', complexity: 'Medium', duration: 210, focus: 'Psychological Safety, Feedback, Vulnerability', executiveBriefHTML: '<p>Mock Brief: Embrace vulnerability.</p>', fullFlyerHTML: '<h2>Mock Flyer: Dare to Lead</h2><p>Vulnerability is strength...</p>' } ],\n    // Add more fallback categories/books if needed\n};\n\n// --- Utility Functions (Local or potentially from a shared utils file) ---\n\n/**\n * Derives estimated reading duration in minutes from page count if duration isn't provided.\n * Assumes ~1.5 pages per minute reading speed.\n * @param {object} book - The book object.\n * @returns {number|null} Estimated duration in minutes or null.\n */\nfunction getDerivedDuration(book) {\n  if (typeof book?.duration === 'number') return book.duration;\n  if (typeof book?.pages === 'number') return Math.round(book.pages / 1.5);\n  return null; // Return null if neither is available\n}\n\n/**\n * Generates a deep signature string based on the structure and count of books.\n * Used as a dependency for memoization to detect changes in the book data.\n * @param {object} booksObject - The object containing book categories and arrays.\n * @returns {string} A signature string.\n */\nfunction getDeepDataSignature(booksObject) {\n    if (!booksObject || typeof booksObject !== 'object') return 'empty';\n    try {\n        // Sort keys for consistency, count total items\n        const keys = Object.keys(booksObject).sort().join(',');\n        const count = Object.values(booksObject).reduce((sum, arr) => sum + (Array.isArray(arr) ? arr.length : 0), 0);\n        return `${keys}-${count}`;\n    } catch {\n        return 'error-signature'; // Fallback signature on error\n    }\n}\n\n// --- Action Steps & Frameworks (Local Fallbacks - Ideally load with book data) ---\n// These provide placeholder content if the book data doesn't include structured actions/frameworks.\nfunction getActionSteps(book) { /* ... same as original ... */ return ['Define the outcome, then design the smallest repeatable action.']; }\nfunction getFrameworks(book) { /* ... same as original ... */ return [{ name: 'Core Principles', desc: 'Prioritize outcomes, feedback loops, and small, testable steps.' }]; }\n\n// --- Error HTML Generator (Used when pre-generated flyer HTML is missing) ---\nconst API_ERROR_HTML = (executive, book) => { /* ... same as original ... */\n    const errorTitle = executive ? \"EXECUTIVE BRIEFING UNAVAILABLE\" : \"FULL FLYER UNAVAILABLE\";\n    // Simplified error message focusing on missing pre-generated content\n    const baseContent = `\n       <p style=\"color:${COLORS.RED}; font-size: 16px; margin-top: 15px; line-height: 1.6;\">\n         <strong>Content Error:</strong> The pre-generated ${executive ? 'Executive Brief' : 'Full Flyer'} content for this book ('${book.title}') is missing from the catalog data.\n       </p>\n       <h3 style=\"color:${COLORS.NAVY}; font-weight:800; font-size: 18px; margin-top:20px;\">Static Summary (for Reference)</h3>\n       <p style=\"color:#374151; font-size: 14px; margin-top: 5px;\">\n         Theme: ${book.theme || 'N/A'}. Key Focus Areas: ${book.focus || 'N/A'}.\n       </p>\n       <p style=\"color:#374151; font-size: 14px; margin-top: 5px;\">\n         Est. Duration: ${book.duration || getDerivedDuration(book) || 'N/A'} min. Complexity: ${book.complexity || 'N/A'}.\n       </p>\n       <h3 style=\"color:${COLORS.NAVY}; font-weight:800; font-size: 18px; margin-top:20px;\">Next Steps</h3>\n       <ul style=\"list-style:disc;margin-left:20px;color:#374151;font-size:14px;\">\n          <li>Notify the administrator that content is missing for book ID: ${book.id || 'Unknown'}.</li>\n          <li>You can still add this reading as a Daily Practice Rep.</li>\n       </ul>`;\n    return `<div style=\"padding: 16px;\"><h2 style=\"color:${COLORS.NAVY}; font-weight:900; font-size: 22px; border-bottom: 2px solid ${COLORS.RED}; padding-bottom: 8px;\">${errorTitle}</h2>${baseContent}</div>`;\n};\n\n\n/* =========================================================\n   AI COACHING LOGIC (Using Context Services)\n========================================================= */\n\n/**\n * Calculates a simple quality score for the user's AI query.\n * @param {string} query - The user's input question.\n * @param {string} bookTitle - The title of the selected book.\n * @returns {object} - { score: 0-3, tip: string }.\n */\nconst getQuestionScore = (query, bookTitle) => { /* ... same logic as original ... */\n    const q = (query || '').toLowerCase().trim(); // Add safety check for query\n    if (q.length < 15) return { score: 0, tip: 'Question is too short. Be specific about your challenge.' };\n    let score = 1; // Default score if length > 15\n    let feedback = 'Try relating this book to a specific work challenge or asking \"How do I apply...?\"';\n    const applicationKeywords = ['how do i', 'apply', 'implement', 'first step', 'next step', 'my team', 'colleague', 'delegate', 'situation'];\n    const hasApplication = applicationKeywords.some(keyword => q.includes(keyword));\n    const hasContext = q.length > 50;\n    if (hasApplication && hasContext) { score = 3; feedback = `Excellent query! Applying ${bookTitle} insights.`; }\n    else if (hasApplication || hasContext) { score = 2; feedback = hasApplication ? 'Good start. Add more context about your situation.' : 'Great context. Now phrase it as an actionable \"how-to\" question.'; }\n    return { score, tip: feedback };\n};\n\n/**\n * Handles submitting the user's query to the AI Rep Coach via useAppServices.\n * @param {Event} e - Form submit event.\n * @param {object} services - The app services context object.\n * @param {object} selectedBook - The currently selected book.\n * @param {string} aiQuery - The user's input query.\n * @param {function} setIsSubmitting - State setter for loading state.\n * @param {function} setAiResponse - State setter for AI response text.\n */\nasync function handleAiSubmit(e, services, selectedBook, aiQuery, setIsSubmitting, setAiResponse) {\n  e.preventDefault();\n  const q = (aiQuery || '').trim();\n  if (!selectedBook || !q || !services || typeof services.callSecureGeminiAPI !== 'function') return;\n\n  console.log(\"[handleAiSubmit] Submitting query for book:\", selectedBook.title);\n  setIsSubmitting(true);\n  setAiResponse('The AI Rep Coach is analyzing the book and your question...'); // Updated name\n\n  // Check if API call is possible\n  const hasKeyOk = typeof services.hasGeminiKey === 'function' ? services.hasGeminiKey() : false; // cite: useAppServices.jsx\n  if (!hasKeyOk) {\n    console.warn(\"[handleAiSubmit] Gemini API key/config missing.\");\n    setAiResponse('**AI Rep Coach Offline:** API configuration is missing. Please contact support.');\n    setIsSubmitting(false);\n    return;\n  }\n\n  try {\n    // --- Prepare context for the AI ---\n    // Extract frameworks and action steps (use fallbacks if needed)\n    const frameworks = getFrameworks(selectedBook).map(f => f.name).join(', ') || 'Core principles';\n    const actions = getActionSteps(selectedBook).slice(0, 3).join(' | ') || 'Define outcome, take small steps'; // Take first 3 actions\n\n    // Construct the prompt with clear instructions and context\n    const systemPrompt = `You are the LeaderReps AI Rep Coach. Your goal is to help the user apply principles from a specific book to their leadership challenges.\n      Use ONLY the provided book context. Do not use external knowledge.\n      Keep responses concise (3-5 sentences), actionable, and directly answer the user's question.\n      Reference the book's frameworks or themes when relevant. Suggest ONE concrete next step.\n      Do not use markdown formatting other than **bold** for emphasis.\n\n      **Book Context:**\n      Title: ${selectedBook.title} by ${selectedBook.author}\n      Theme: ${selectedBook.theme || 'N/A'}\n      Key Focus Areas: ${selectedBook.focus || 'N/A'}\n      Key Frameworks: ${frameworks}\n      Example Actions: ${actions}\n\n      **User's Question:** ${q}`;\n\n    // --- Make the API Call ---\n    const payload = {\n        // Use user role for the direct question\n        contents: [{ role: 'user', parts: [{ text: `Regarding \"${selectedBook.title}\": ${q}` }] }],\n        systemInstruction: { parts: [{ text: systemPrompt }] },\n        // Use the model defined in services, potentially defaulting to flash\n        model: services.GEMINI_MODEL || 'gemini-1.5-flash', // cite: useAppServices.jsx\n        generationConfig: { temperature: 0.6, maxOutputTokens: 150 } // Adjust config as needed\n    };\n\n    const result = await services.callSecureGeminiAPI(payload); // cite: useAppServices.jsx\n    console.log(\"[handleAiSubmit] API Response:\", result);\n\n    // --- Process the Response ---\n    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text\n      || 'No response received from the AI Rep Coach. Please try rephrasing your question or check the connection.';\n\n    setAiResponse(text.trim()); // Set the cleaned response\n\n  } catch (err) {\n    console.error('[handleAiSubmit] AI coach call failed:', err);\n    setAiResponse(`**Error:** The AI Rep Coach encountered a problem. Please try again. (${err.message})`);\n  } finally {\n    setIsSubmitting(false); // Reset loading state\n  }\n}\n\n/* =========================================================\n   CHILD COMPONENTS (Refactored for Consistency)\n========================================================= */\n\n// --- Search Input Component (Memoized) ---\nconst SearchInput = React.memo(({ value, onChange }) => { // cite: Original File (Structure)\n    return (\n        <div>\n            <label className=\"block text-sm font-medium mb-1 flex items-center gap-1.5\" style={{ color: COLORS.MUTED }}>\n                <SearchIcon className=\"w-4 h-4\" style={{ color: COLORS.TEAL }}/> Search Library\n            </label>\n            <input\n                type=\"search\" // Use type=\"search\" for better semantics\n                value={value}\n                onChange={onChange}\n                placeholder=\"Find by title, author, or focus...\"\n                className=\"w-full p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[${COLORS.TEAL}] text-sm\" // Consistent input style\n                style={{ borderColor: COLORS.SUBTLE }}\n            />\n        </div>\n    );\n});\nSearchInput.displayName = 'SearchInput'; // For React DevTools\n\n// --- AI Coach Input Component (Memoized) ---\nconst AICoachInput = React.memo(({ aiQuery, handleAiQueryChange, submitHandler, isSubmitting, questionFeedback, selectedBookTitle }) => { // cite: Original File (Structure)\n\n    // Determine feedback style based on score\n    const score = questionFeedback?.score ?? 0;\n    const { bgColor, borderColor, textColor, Icon } = useMemo(() => {\n        if (score === 3) return { bgColor: '#D1FAE5', borderColor: '#34D399', textColor: '#065F46', Icon: Zap }; // Green\n        if (score === 2) return { bgColor: '#FEF3C7', borderColor: '#FBBF24', textColor: '#B45309', Icon: AlertTriangle }; // Yellow\n        return { bgColor: '#FEE2E2', borderColor: '#F87171', textColor: '#991B1B', Icon: Info }; // Red/Default\n    }, [score]);\n\n    return (\n        <form onSubmit={submitHandler} className=\"flex flex-col gap-3\"> {/* Use gap */}\n            {/* Live Query Quality Feedback Bar */}\n            {aiQuery.trim().length > 5 && ( // Show only if query has some content\n                <div className=\"p-2 rounded-lg text-xs flex items-center gap-2 transition-all duration-300 shadow-inner\" // Smaller text\n                        style={{ background: bgColor, border: `1px solid ${borderColor}`, color: textColor }}>\n                    <Icon className=\"w-4 h-4 flex-shrink-0\" />\n                    <span className=\"font-semibold\">Query Quality ({score}/3):</span>\n                    <span className=\"flex-1\">{questionFeedback?.tip || ''}</span>\n                </div>\n            )}\n\n            {/* Input and Submit Button */}\n            <div className=\"flex gap-2\">\n                <input\n                    type=\"text\" value={aiQuery} onChange={handleAiQueryChange}\n                    // Contextual placeholder using selected book title\n                    placeholder={`Ask AI Rep Coach how to apply \"${selectedBookTitle}\"...`} // cite: User Request\n                    className=\"flex-grow p-3 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[${COLORS.PURPLE}]\" // Use Purple focus\n                    style={{ borderColor: COLORS.SUBTLE, color: COLORS.TEXT }}\n                    required disabled={isSubmitting} // Disable input while submitting\n                />\n                <Button\n                    type=\"submit\" variant=\"primary\" size=\"md\" // Use standard Button\n                    style={{ background: COLORS.PURPLE, focusRingColor: `${COLORS.PURPLE}/50` }} // Custom purple\n                    disabled={!aiQuery.trim() || isSubmitting}\n                    aria-busy={isSubmitting} // Accessibility attribute\n                >\n                    <MessageSquare className=\"w-5 h-5\" />\n                    {isSubmitting ? 'Thinking…' : 'Ask Coach'}\n                </Button>\n            </div>\n        </form>\n    );\n});\nAICoachInput.displayName = 'AICoachInput'; // For React DevTools\n\n\n/**\n * BookListStable Component\n * Displays the filter controls and the categorized list of books.\n * Uses standardized Card component for filter section.\n */\nfunction BookListStable({\n  filters, filteredBooks, savedBooks, selectedBook,\n  onSelectBook, onToggleSave, handleSearchChange, handleFilterChange,\n}) {\n    // --- Determine Loading/Empty States ---\n    const totalBookCount = useMemo(() => {\n        // Safely count books, handling null/undefined filteredBooks\n        return Object.values(filteredBooks || {}).reduce((sum, arr) => sum + (Array.isArray(arr) ? arr.length : 0), 0);\n    }, [filteredBooks]);\n\n    // Check if filters are active and resulted in no books\n    const hasActiveFilters = filters.search || filters.complexity !== 'All' || filters.maxDuration !== 300;\n    const isFilteredEmpty = totalBookCount === 0 && hasActiveFilters;\n    // Check if the source data itself is empty (no filters applied, still zero books)\n    const isSourceDataEmpty = totalBookCount === 0 && !hasActiveFilters;\n\n  return (\n    <div className=\"space-y-8\"> {/* Increased spacing */}\n      {/* --- Filter Section --- */}\n      {/* Encapsulate filters within a Card for consistent styling */}\n      <Card title=\"Personalize Your Library\" icon={Filter} accent=\"TEAL\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* Search Input */}\n          <SearchInput value={filters.search} onChange={handleSearchChange} />\n          {/* Complexity Filter */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\" style={{ color: COLORS.MUTED }}>Complexity Level</label>\n            <select\n              value={filters.complexity}\n              onChange={(e) => handleFilterChange('complexity', e.target.value)}\n              className=\"w-full p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[${COLORS.TEAL}] text-sm\" // Consistent select style\n              style={{ borderColor: COLORS.SUBTLE }}\n            >\n              <option value=\"All\">All Levels</option>\n              {Object.keys(COMPLEXITY_MAP).map(k => (<option key={k} value={k}>{COMPLEXITY_MAP[k].label}</option>))}\n            </select>\n          </div>\n          {/* Duration Filter */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\" style={{ color: COLORS.MUTED }}>Max Est. Time ({filters.maxDuration} min)</label>\n            <input\n              type=\"range\" min=\"60\" max=\"300\" step=\"10\" // Adjusted min duration\n              value={filters.maxDuration}\n              onChange={(e) => handleFilterChange('maxDuration', parseInt(e.target.value, 10))}\n              className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-[#E04E1B]\" // Use ORANGE accent for slider\n            />\n            <div className=\"flex justify-between text-xs mt-1\" style={{ color: COLORS.MUTED }}><span>60 min</span><span>300 min</span></div>\n          </div>\n        </div>\n      </Card>\n\n      {/* --- Loading / Empty State Messages --- */}\n      {/* Case 1: Source data is completely empty */}\n      {isSourceDataEmpty && (\n           <div className=\"p-10 rounded-2xl border-2 shadow-xl bg-white text-center\" style={{ borderColor: COLORS.SUBTLE }}>\n                <AlertTriangle className='w-10 h-10 mx-auto mb-4' style={{ color: COLORS.ORANGE }}/>\n                <h3 className=\"text-xl font-bold\" style={{ color: COLORS.NAVY }}>Reading Library Empty</h3>\n                <p className=\"text-gray-600 mt-2 text-sm\">The reading catalog hasn't been loaded yet. Please contact an administrator or check the data source (<code>metadata/reading_catalog</code>).</p>\n           </div>\n      )}\n      {/* Case 2: Filters applied, but no results found */}\n      {isFilteredEmpty && (\n           <div className=\"p-8 rounded-2xl border-2 shadow-xl bg-white text-center\" style={{ borderColor: COLORS.SUBTLE }}>\n                <SearchIcon className='w-8 h-8 mx-auto mb-3' style={{ color: COLORS.TEAL }}/>\n                <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>No Results Found</h3>\n                <p className=\"text-gray-600 mt-1 text-sm\">Try adjusting your search query or filter settings.</p>\n           </div>\n      )}\n\n      {/* --- Book List Rendering --- */}\n      {/* Render categories and books only if data exists and is not filtered empty */}\n      {totalBookCount > 0 && !isFilteredEmpty && (\n        <div className=\"space-y-12\">\n          {/* Iterate over filtered book categories */}\n          {Object.entries(filteredBooks)\n                // Optional: Sort categories if needed\n                // .sort(([tierA], [tierB]) => tierA.localeCompare(tierB))\n                .map(([tier, booksInCategory]) => (\n                    // Ensure booksInCategory is an array before mapping\n                    Array.isArray(booksInCategory) && booksInCategory.length > 0 && (\n                        <div key={tier}\n                             className=\"rounded-2xl shadow-xl overflow-hidden border-2\"\n                             style={{ background: COLORS.OFF_WHITE, borderColor: COLORS.SUBTLE }}>\n                          {/* Category Header - MODIFIED FOR CONSISTENCY */}\n                          <div className=\"p-4 border-b\" style={{ background: COLORS.LIGHT_GRAY, borderColor: COLORS.SUBTLE }}>\n                            <h3 className=\"text-lg font-extrabold flex items-center gap-2\" style={{ color: COLORS.NAVY }}>\n                                <Target className=\"w-5 h-5\" style={{ color: COLORS.ORANGE }} />\n                                {tier}\n                            </h3>\n                            <p className=\"text-sm mt-1\" style={{ color: COLORS.MUTED }}>{booksInCategory.length} item{booksInCategory.length !== 1 ? 's' : ''} available</p>\n                          </div>\n\n                          {/* Book Grid within Category */}\n                          <div className=\"p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                            {booksInCategory.map((book) => {\n                              // Get complexity details\n                              const complexityMeta = COMPLEXITY_MAP[book.complexity] || COMPLEXITY_MAP.Medium; // Fallback\n                              const ComplexityIcon = complexityMeta.icon;\n                              const isSaved = !!savedBooks[book.id];\n                              const isSelected = selectedBook?.id === book.id;\n                              const estimatedDuration = book.duration || getDerivedDuration(book); // Get duration\n\n                              return (\n                                // --- Book Card ---\n                                <div key={book.id} className=\"relative h-full\"> {/* Ensure relative positioning for Save button, full height */}\n                                  <button\n                                    onClick={() => onSelectBook(book, tier)} // Pass book and tier\n                                    className=\"p-5 text-left w-full h-full block rounded-2xl border-2 transition-all duration-300 flex flex-col focus:outline-none focus:ring-2 focus:ring-offset-1\" // Added flex-col\n                                    style={{\n                                      background: 'linear-gradient(180deg,#FFFFFF,#F9FAFB)',\n                                      borderColor: isSelected ? COLORS.TEAL : COLORS.SUBTLE,\n                                      boxShadow: isSelected ? '0 8px 20px rgba(71,168,141,.2)' : '0 2px 8px rgba(0,0,0,.06)', // Refined shadow\n                                      color: COLORS.TEXT,\n                                      position: 'relative', // Needed for accent bar\n                                      focusRingColor: COLORS.TEAL,\n                                    }}\n                                  >\n                                    {/* Accent Bar */}\n                                    <span style={{ position:'absolute',top:0,left:0,right:0,height:6, background: isSelected ? COLORS.TEAL : COLORS.ORANGE, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n\n                                    {/* Book Info */}\n                                    <div className=\"flex-grow pt-2\"> {/* Added flex-grow */}\n                                        <div className=\"flex gap-3 items-start mb-3\">\n                                            {/* Icon */}\n                                            <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n                                                <BookOpen className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n                                            </div>\n                                            {/* Title & Author */}\n                                            <div className=\"min-w-0\">\n                                                <p className=\"font-extrabold text-md leading-tight\" style={{ color: COLORS.NAVY }}>{book.title}</p> {/* Slightly smaller */}\n                                                <p className=\"text-xs italic mt-0.5\" style={{ color: COLORS.MUTED }}>by {book.author}</p>\n                                            </div>\n                                        </div>\n\n                                        {/* Divider */}\n                                        <div className=\"my-3\" style={{ height: 1, background: COLORS.SUBTLE }} />\n\n                                        {/* Stats: Duration & Complexity */}\n                                        <div className=\"space-y-1.5 text-xs\"> {/* Smaller text */}\n                                            <div className=\"flex items-center gap-2\" style={{ color: COLORS.TEXT }}>\n                                                <Clock className=\"w-3.5 h-3.5 flex-shrink-0\" style={{ color: COLORS.ORANGE }}/>\n                                                <span className=\"font-semibold\">Est. Time:</span>\n                                                <span className=\"ml-auto font-bold\">{estimatedDuration ? `${estimatedDuration} min` : 'N/A'}</span>\n                                            </div>\n                                            <div className=\"flex items-center gap-2\" style={{ color: COLORS.TEXT }}>\n                                                <ComplexityIcon className=\"w-3.5 h-3.5 flex-shrink-0\" style={{ color: complexityMeta.hex }}/>\n                                                <span className=\"font-semibold\">Level:</span>\n                                                <span className=\"ml-auto font-bold\" style={{ color: complexityMeta.hex }}>{complexityMeta.label}</span>\n                                            </div>\n                                        </div>\n\n                                        {/* Key Focus Tags */}\n                                        <div className=\"mt-3 pt-3 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                                            <p className=\"text-[10px] font-semibold uppercase mb-1.5\" style={{ color: COLORS.TEAL }}>Key Focus</p>\n                                            <div className=\"flex flex-wrap gap-1\">\n                                                {(String(book.focus || '').split(',').slice(0, 3)).map((f, i) => ( // Safe split and slice\n                                                    f.trim() && <span key={i} className=\"px-2 py-0.5 text-[10px] font-medium rounded-full\" style={{ background: COLORS.SUBTLE, color: COLORS.MUTED }}>{f.trim()}</span>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    </div>\n                                  </button>\n\n                                  {/* Save Button (Overlay) */}\n                                  <button\n                                    onClick={(e) => { e.stopPropagation(); onToggleSave(book.id); }}\n                                    aria-label={isSaved ? 'Remove from Saved' : 'Save for Later'}\n                                    className=\"absolute top-2 right-2 p-1.5 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-amber-500\" // Adjusted focus ring\n                                    style={{ background: isSaved ? COLORS.AMBER : 'rgba(255,255,255,0.8)', color: isSaved ? COLORS.OFF_WHITE : COLORS.MUTED, boxShadow: '0 1px 3px rgba(0,0,0,.1)' }}\n                                  >\n                                    <Star className=\"w-4 h-4\" fill={isSaved ? 'currentColor' : 'none'} />\n                                  </button>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                    )\n                )\n            )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n\n/**\n * BookFlyerStable Component\n * Displays the detailed flyer content (HTML) for the selected book,\n * including the AI Coach interaction section and action buttons.\n */\nfunction BookFlyerStable({\n  selectedBook, htmlFlyer, isFlyerLoading, isExecutiveBrief, setIsExecutiveBrief,\n  questionFeedback, aiResponse, aiQuery, handleAiQueryChange, submitHandler,\n  savedBooks, onToggleSave, onCommit, isCommitted, isSubmitting,\n}) {\n  // --- Calculate Mock Progress (Replace with real data if available) ---\n  const progressMinutes = 45; // Placeholder\n  const totalDuration = selectedBook.duration || getDerivedDuration(selectedBook) || 180; // Estimate if missing\n  const progressPercent = Math.min(100, Math.round((progressMinutes / totalDuration) * 100));\n\n  // --- Executive Brief Toggle Switch ---\n  // Using a button-based switch for simpler styling alignment\n  const ExecSwitch = ({ checked, onChange }) => (\n    <div className=\"flex items-center gap-2\">\n      <button type=\"button\" role=\"switch\" aria-checked={checked} onClick={() => onChange(!checked)}\n        className={`relative inline-flex items-center h-6 w-11 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[${COLORS.ORANGE}]`}\n        style={{ background: checked ? COLORS.ORANGE : COLORS.MUTED }}\n      >\n        <span className={`inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ${checked ? 'translate-x-6' : 'translate-x-1'}`} />\n      </button>\n      <span className=\"text-sm font-semibold\" style={{ color: COLORS.NAVY }}>Executive Brief</span>\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-8\">\n      {/* --- Flyer Header --- */}\n      <div className=\"flex flex-col md:flex-row justify-between md:items-center gap-4 pb-4 border-b\" style={{ borderColor: COLORS.SUBTLE }}>\n        {/* Title */}\n        <h2 className=\"text-2xl md:text-3xl font-bold flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n          <BookOpen className=\"w-7 h-7 flex-shrink-0\" style={{ color: COLORS.TEAL }} />\n          Focus Flyer: {selectedBook.title}\n        </h2>\n        {/* Back Button */}\n        <Button\n          onClick={() => window.dispatchEvent(new CustomEvent('lr-close-flyer'))} // Use custom event to signal close\n          variant=\"nav-back\" size=\"sm\" // Use nav-back style\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to Library\n        </Button>\n      </div>\n\n      {/* --- Main Flyer Content Card --- */}\n      <Card accent=\"TEAL\" className=\"shadow-2xl\"> {/* Use standard Card */}\n        {/* Top Controls: Progress & Exec Brief Toggle */}\n        <div className=\"flex flex-col md:flex-row justify-between gap-4 mb-6\">\n          {/* Mock Progress Indicator */}\n          <div className=\"flex items-center gap-3 p-3 rounded-xl border\" style={{ background: COLORS.LIGHT_GRAY, borderColor: COLORS.SUBTLE }}>\n            <TrendingUp className=\"w-5 h-5 flex-shrink-0\" style={{ color: COLORS.TEAL }}/>\n            <div>\n              <p className=\"text-xs font-medium uppercase\" style={{ color: COLORS.MUTED }}>Your Progress (Mock)</p>\n              <div className=\"flex items-center gap-2 mt-1\">\n                {/* Progress Bar */}\n                <div className=\"w-32 h-2 rounded-full\" style={{ background: COLORS.SUBTLE }}>\n                  <div className=\"h-2 rounded-full\" style={{ width: `${progressPercent}%`, background: COLORS.TEAL }} />\n                </div>\n                <span className=\"text-sm font-bold\" style={{ color: COLORS.NAVY }}>{progressPercent}%</span>\n              </div>\n            </div>\n          </div>\n          {/* Executive Brief Toggle */}\n          <div className=\"flex items-center\">\n            <ExecSwitch checked={isExecutiveBrief} onChange={setIsExecutiveBrief} />\n          </div>\n        </div>\n\n        {/* --- HTML Flyer Content Area --- */}\n        <div className=\"p-4 rounded-xl border min-h-[200px]\" style={{ background: COLORS.OFF_WHITE, borderColor: COLORS.SUBTLE }}>\n            {/* Loading State */}\n            {isFlyerLoading && (\n                <div className=\"h-full flex items-center justify-center gap-2\" style={{ color: COLORS.PURPLE }}>\n                    <Loader className='w-5 h-5 animate-spin'/>\n                    <span className=\"font-semibold text-sm\">Loading Flyer Content...</span>\n                </div>\n            )}\n            {/* Error State (Content Missing) */}\n            {!isFlyerLoading && htmlFlyer.includes('Content Error:') && (\n                <div className=\"h-full flex flex-col items-center justify-center gap-2 p-4 rounded-lg bg-red-50 border border-red-200\">\n                    <AlertTriangle className='w-6 h-6 text-red-500 mb-2'/>\n                    <div className=\"text-sm text-center max-w-none space-y-2\" style={{ color: COLORS.TEXT }} dangerouslySetInnerHTML={{ __html: htmlFlyer }} />\n                </div>\n            )}\n            {/* Success State: Render HTML */}\n            {!isFlyerLoading && !htmlFlyer.includes('Content Error:') && (\n                <div className=\"prose prose-sm max-w-none\" dangerouslySetInnerHTML={{ __html: htmlFlyer }} />\n            )}\n        </div>\n\n        {/* --- AI Coach Section --- */}\n        <div className=\"mt-8 pt-6 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n          <h3 className=\"text-xl font-bold mb-4 flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n            <MessageSquare className=\"w-6 h-6\" style={{ color: COLORS.PURPLE }}/> AI Rep Coach: Apply It Now\n          </h3>\n          {/* AI Response Area */}\n          {aiResponse && (\n            <div className=\"p-4 mb-4 rounded-xl shadow-lg border-l-4\" style={{ background: '#F0F5FF', borderLeftColor: COLORS.PURPLE, color: COLORS.TEXT }}>\n              <p className=\"text-sm font-semibold flex items-center gap-2 mb-1\" style={{ color: COLORS.NAVY }}>\n                <Cpu className=\"w-4 h-4\"/> AI Rep Coach Response:\n              </p>\n              {/* Use pre-wrap to preserve line breaks from AI */}\n              <p className=\"text-sm whitespace-pre-wrap\">{aiResponse}</p>\n            </div>\n          )}\n          {/* AI Input Form */}\n          <AICoachInput\n            aiQuery={aiQuery}\n            handleAiQueryChange={handleAiQueryChange}\n            submitHandler={submitHandler} // FIX: Now correctly passed as a prop\n            isSubmitting={isSubmitting} // FIX: Now correctly passed as a prop\n            questionFeedback={questionFeedback}\n            selectedBookTitle={selectedBook.title} // Pass title for placeholder\n          />\n        </div>\n\n        {/* --- Action Buttons Footer --- */}\n        <div className=\"mt-10 pt-6 flex flex-col sm:flex-row justify-end items-center gap-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n          {/* Save for Later Button */}\n          <Button\n            onClick={() => onToggleSave(selectedBook.id)}\n            variant=\"outline\" size=\"sm\" // Use outline, small size\n            className=\"w-full sm:w-auto\"\n            style={{ borderColor: savedBooks[selectedBook.id] ? COLORS.AMBER : COLORS.SUBTLE, color: savedBooks[selectedBook.id] ? COLORS.AMBER : COLORS.MUTED }} // Dynamic style\n          >\n            <Star className=\"w-4 h-4\" fill={savedBooks[selectedBook.id] ? 'currentColor' : 'none'}/>\n            {savedBooks[selectedBook.id] ? 'Saved' : 'Save for Later'}\n          </Button>\n          {/* Add to Daily Practice Button */}\n          <Button\n            onClick={onCommit}\n            variant={isCommitted ? 'primary' : 'secondary'} // Use secondary (Orange) if not committed\n            size=\"md\" // Use medium size\n            className=\"w-full sm:w-auto\" // Full width on small screens\n            disabled={isCommitted} // Disable after committing\n            style={{ background: isCommitted ? COLORS.GREEN : COLORS.ORANGE, // Dynamic background\n                     boxShadow: `0 6px 18px ${isCommitted ? COLORS.GREEN : COLORS.ORANGE}40` }} // Dynamic shadow\n          >\n            {isCommitted ? <Check className=\"w-5 h-5\" /> : <TrendingUp className=\"w-5 h-5\" />}\n            {isCommitted ? 'Added to Practice!' : 'Add to Daily Practice'}\n          </Button>\n        </div>\n      </Card>\n    </div>\n  );\n}\n\n\n/* =========================================================\n   MAIN SCREEN COMPONENT: BusinessReadingsScreen\n========================================================= */\n\nexport default function BusinessReadingsScreen() {\n  // --- Consume Core Services ---\n  const {\n    // Data & State\n    isLoading: isAppLoading, error: appError, // Combined loading/error state\n    READING_CATALOG, // Catalog data { items: { Category: [books...] } } // cite: useAppServices.jsx\n    dailyPracticeData, // For adding commitments // cite: useAppServices.jsx\n    // Functions\n    navigate, updateDailyPracticeData, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL, // cite: useAppServices.jsx\n  } = useAppServices();\n\n  // --- Local State ---\n  const [selectedBook, setSelectedBook] = useState(null); // The book object currently viewed in the flyer\n  const [selectedTier, setSelectedTier] = useState(''); // The category/tier of the selected book\n  const [htmlFlyer, setHtmlFlyer] = useState(''); // Pre-generated HTML content for the flyer\n  const [isFlyerLoading, setIsFlyerLoading] = useState(false); // Brief loading state for flyer transition\n  const [savedBooks, setSavedBooks] = useState({}); // Local state for 'saved for later' status { bookId: true/false }\n  const [isExecutiveBrief, setIsExecutiveBrief] = useState(false); // Flyer view mode (full vs. brief)\n  const [isCommitted, setIsCommitted] = useState(false); // Has the current book been added to daily practice?\n  // Filters\n  const [filters, setFilters] = useState({ complexity: 'All', maxDuration: 300, search: '' });\n  // AI Coach State\n  const [aiQuery, setAiQuery, ] = useState(''); // User's input question\n  const [aiResponse, setAiResponse] = useState(''); // AI's response text\n  const [isSubmittingAi, setIsSubmittingAi] = useState(false); // Loading state for AI query\n\n  // --- Determine Book Data Source ---\n  // Use READING_CATALOG from services if valid, otherwise use local fallback\n  const allBooks = useMemo(() => {\n    const catalogItems = READING_CATALOG?.items;\n    // Validate structure: must be an object with at least one key/value pair where value is array\n    if (catalogItems && typeof catalogItems === 'object' && Object.keys(catalogItems).length > 0 && Object.values(catalogItems).some(Array.isArray)) {\n        console.log(\"[BusinessReadings] Using READING_CATALOG from services.\");\n        return catalogItems;\n    } else {\n        console.warn(\"[BusinessReadings] READING_CATALOG invalid or empty. Using fallback data.\", READING_CATALOG);\n        return MOCK_ALL_BOOKS_FALLBACK;\n    }\n  }, [READING_CATALOG]); // cite: useAppServices.jsx\n\n  // --- Deep Dependency Signature ---\n  // Used to ensure filtering memoization updates correctly when book data changes fundamentally\n  const deepDataSignature = useMemo(() => getDeepDataSignature(allBooks), [allBooks]);\n\n  /* ---------- Filtering Logic (Memoized) ---------- */\n  const filteredBooks = useMemo(() => {\n    console.log(\"[BusinessReadings] Re-calculating filtered books. Signature:\", deepDataSignature);\n    // Safety check for allBooks structure\n    if (!allBooks || typeof allBooks !== 'object') return {};\n\n    const searchTerm = (filters.search || '').toLowerCase();\n    const maxDuration = filters.maxDuration;\n    const complexityFilter = filters.complexity;\n\n    // Filter and group books\n    const result = {};\n    for (const tier in allBooks) {\n        if (Array.isArray(allBooks[tier])) { // Ensure the category contains an array\n            const booksInCategory = allBooks[tier].filter(book => {\n                // Duration Check (handles missing duration)\n                const duration = book.duration || getDerivedDuration(book);\n                const durationOK = duration === null || duration <= maxDuration;\n                // Complexity Check\n                const complexityOK = complexityFilter === 'All' || book.complexity === complexityFilter;\n                // Search Term Check (check title, author, focus)\n                const searchOK = !searchTerm ||\n                    (book.title || '').toLowerCase().includes(searchTerm) ||\n                    (book.author || '').toLowerCase().includes(searchTerm) ||\n                    (String(book.focus || '')).toLowerCase().includes(searchTerm); // Safe focus check\n                // Combine checks\n                return durationOK && complexityOK && searchOK;\n            });\n            // Only add tier to result if it has books after filtering\n            if (booksInCategory.length > 0) {\n                result[tier] = booksInCategory;\n            }\n        }\n    }\n    console.log(\"[BusinessReadings] Filtering complete. Result keys:\", Object.keys(result));\n    return result;\n  }, [allBooks, filters, deepDataSignature]); // Dependencies: Trigger re-filter on data, filters, or signature change\n\n\n  /* ---------- Flyer Content Loading ---------- */\n  // Loads the appropriate pre-generated HTML when a book is selected or brief mode changes\n  useEffect(() => {\n    if (!selectedBook) {\n      setHtmlFlyer(''); // Clear flyer if no book selected\n      return;\n    }\n    console.log(`[BusinessReadings] Loading flyer for: ${selectedBook.title}, Brief Mode: ${isExecutiveBrief}`);\n    // Determine which HTML content key to use\n    const contentKey = isExecutiveBrief ? 'executiveBriefHTML' : 'fullFlyerHTML';\n    // Retrieve HTML from the selected book object, use error fallback if missing\n    const newHtml = selectedBook[contentKey] || API_ERROR_HTML(isExecutiveBrief, selectedBook); // cite: Original File (Logic)\n\n    // Apply a brief loading state for smooth visual transition\n    setIsFlyerLoading(true);\n    const timer = setTimeout(() => {\n        setHtmlFlyer(newHtml);\n        setIsFlyerLoading(false);\n        console.log(`[BusinessReadings] Flyer content set.`);\n    }, 50); // Minimal delay\n\n    // Cleanup timer on unmount or if dependencies change\n    return () => clearTimeout(timer);\n  }, [selectedBook, isExecutiveBrief]); // Re-run when book or brief mode changes\n\n\n  /* ---------- State Resets on Book Change ---------- */\n  useEffect(() => {\n    // Reset secondary states when the selected book changes\n    if (selectedBook) {\n      console.log(`[BusinessReadings] Resetting state for new book: ${selectedBook.title}`);\n      setIsExecutiveBrief(false); // Default to full flyer view\n      setAiQuery('');             // Clear AI query\n      setAiResponse('');          // Clear AI response\n      setIsSubmittingAi(false);    // Reset AI loading state\n      // Check if this book is already an active commitment today\n      const isCurrentlyCommitted = (dailyPracticeData?.activeCommitments || []).some(\n          c => c.source === 'BusinessReadings' && c.id.includes(`read_${selectedBook.id}`) && c.status === 'Pending' // Check for the base ID and status\n      );\n      setIsCommitted(isCurrentlyCommitted);\n    }\n  }, [selectedBook, dailyPracticeData]); // Run only when selectedBook or dailyPracticeData changes\n\n\n  /* ---------- Event Listener for Closing Flyer ---------- */\n  useEffect(() => {\n    // Custom event listener to allow BookFlyerStable to signal closing itself\n    const handler = () => {\n        console.log(\"[BusinessReadings] Close flyer event received.\");\n        setSelectedBook(null);\n    };\n    window.addEventListener('lr-close-flyer', handler);\n    // Cleanup listener on unmount\n    return () => window.removeEventListener('lr-close-flyer', handler);\n  }, []); // Run only once on mount\n\n\n  /* ---------- Memoized Handlers for Inputs/Actions ---------- */\n  // Updates the filter state\n  const handleFilterChange = useCallback((key, value) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n  }, []);\n\n  // Updates the search filter state\n  const handleSearchChange = useCallback((e) => {\n    setFilters(prev => ({ ...prev, search: e.target.value }));\n  }, []);\n\n  // Updates the AI query input state\n  const handleAiQueryChange = useCallback((e) => {\n    setAiQuery(e.target.value);\n  }, []);\n\n  // Handler for selecting a book from the list\n  const handleSelectBook = useCallback((book, tier) => {\n      console.log(`[BusinessReadings] Book selected: ${book.title} from tier ${tier}`);\n      setSelectedBook(book);\n      setSelectedTier(tier || ''); // Store the tier/category name\n  }, []);\n\n  // Toggles the 'saved for later' status of a book\n  const handleToggleSave = useCallback((bookId) => {\n    setSavedBooks(prev => {\n        const isCurrentlySaved = !!prev[bookId];\n        console.log(`[BusinessReadings] Toggling save for book ${bookId}. New status: ${!isCurrentlySaved}`);\n        return { ...prev, [bookId]: !isCurrentlySaved };\n        // TODO: Persist savedBooks state (e.g., to localStorage or user profile in Firestore)\n    });\n  }, []);\n\n  // --- Adds the selected book reading task as a Daily Practice Rep ---\n  const handleCommitment = useCallback(async (book) => {\n    if (!book || isCommitted) return; // Prevent adding if already committed or no book\n    console.log(`[BusinessReadings] Adding commitment for book: ${book.title}`);\n\n    // --- Create the new Rep (Commitment) object ---\n    const estimatedDuration = book.duration || getDerivedDuration(book) || 0; // Get duration\n    const newCommitment = {\n      id: `read_${book.id}_${Date.now()}`, // Unique ID for the rep\n      text: `Read: ${book.title} (${book.author}) - Est. ${estimatedDuration} min`, // Descriptive text\n      status: 'Pending', // Start as pending\n      isCustom: false, // Indicate it's from a standard source\n      linkedGoal: selectedTier || 'Personal Development', // Link to the book category/tier\n      linkedTier: book.complexity ? (DIMENSION_TO_TIER_MAP[book.complexity] || 'T1') : 'T1', // Map complexity to Tier (heuristic)\n      source: 'BusinessReadings', // Identify the source\n      // Add optional fields if needed: targetColleague, progressMinutes, totalDuration\n    };\n\n    // --- Update dailyPracticeData using the context function ---\n    try {\n        const success = await updateDailyPracticeData(currentData => {\n            const existingCommitments = currentData?.activeCommitments || []; // cite: useAppServices.jsx\n            // Add the new commitment to the list\n            return {\n                ...currentData, // Preserve existing data\n                activeCommitments: [...existingCommitments, newCommitment]\n            };\n        }); // cite: useAppServices.jsx\n\n        if (success) {\n            console.log(\"[BusinessReadings] Commitment added successfully.\");\n            setIsCommitted(true); // Update local state to reflect commitment\n            // Optional: Navigate to daily practice after a brief delay\n            // setTimeout(() => navigate('daily-practice'), 1000);\n        } else {\n             throw new Error(\"updateDailyPracticeData returned false\");\n        }\n    } catch (error) {\n        console.error('[BusinessReadings] Failed to add commitment:', error);\n        alert('Failed to add reading commitment to your daily practice. Please try again.');\n        setIsCommitted(false); // Ensure state reflects failure\n    }\n  }, [isCommitted, selectedTier, updateDailyPracticeData]); // Dependencies\n\n\n  // --- Memoized Question Feedback ---\n  // Calculates the quality score of the AI query as the user types\n  const questionFeedback = useMemo(() => {\n    if (!selectedBook) return { score: 0, tip: '' }; // No score if no book selected\n    return getQuestionScore(aiQuery, selectedBook.title);\n  }, [aiQuery, selectedBook]);\n\n\n  // --- Memoized AI Submit Handler ---\n  // Wraps the handleAiSubmit logic with necessary state and context\n  const submitAiHandler = useCallback((e) => {\n      // Pass all required arguments to the standalone handler function\n      handleAiSubmit(e, { callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL }, selectedBook, aiQuery, setIsSubmittingAi, setAiResponse);\n  }, [aiQuery, selectedBook, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL]); // Include all dependencies\n\n\n  // --- RENDER LOGIC ---\n\n  // Show loading spinner if the app's core data is still loading\n  if (isAppLoading) {\n    return <LoadingSpinner message=\"Loading Reading Hub...\" />;\n  }\n  // Show error message if app loading failed\n  if (appError) {\n      return <ConfigError message={`Failed to load Reading Hub data: ${appError.message}`} />;\n  }\n\n  return (\n    // Main screen container with consistent padding and background\n    <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n      {/* Header */}\n      <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.PURPLE+'30'}}> {/* Use PURPLE accent */}\n          <BookOpen className='w-10 h-10 flex-shrink-0' style={{color: COLORS.PURPLE}}/>\n          <div>\n              <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Professional Reading Hub</h1>\n              <p className=\"text-md text-gray-600 mt-1\">(Content Pillar 1)</p>\n          </div>\n      </header>\n\n      {/* Conditional Rendering: Show Book List or Book Flyer */}\n      {!selectedBook ? (\n          // --- Render Book List View ---\n          <BookListStable\n              filters={filters}\n              filteredBooks={filteredBooks}\n              savedBooks={savedBooks}\n              selectedBook={selectedBook} // Pass null when list is visible\n              onSelectBook={handleSelectBook}\n              onToggleSave={handleToggleSave}\n              handleSearchChange={handleSearchChange}\n              handleFilterChange={handleFilterChange}\n          />\n      ) : (\n          // --- Render Book Flyer View ---\n          <BookFlyerStable\n              selectedBook={selectedBook}\n              htmlFlyer={htmlFlyer}\n              isFlyerLoading={isFlyerLoading}\n              isExecutiveBrief={isExecutiveBrief}\n              setIsExecutiveBrief={setIsExecutiveBrief}\n              questionFeedback={questionFeedback}\n              aiResponse={aiResponse}\n              aiQuery={aiQuery}\n              handleAiQueryChange={handleAiQueryChange}\n              submitHandler={submitAiHandler} // FIX: Pass the memoized handler\n              savedBooks={savedBooks}\n              onToggleSave={handleToggleSave}\n              onCommit={() => handleCommitment(selectedBook)} // Pass the selected book to handler\n              isCommitted={isCommitted}\n              isSubmitting={isSubmittingAi} // Pass AI loading state\n          />\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/CommunityFeed.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":61,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/CommunityFeed.jsx (Refactored for Consistency)\n\nimport React, { useState, useMemo, useEffect } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\nimport { Users, Send, MessageSquare, Heart, CornerRightUp, Award, Link, Settings, Loader } from 'lucide-react'; // Added Loader\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-screen flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/* =========================================================\n   MOCK DATA (Local Fallback - Replace with Service/API)\n========================================================= */\n// Mock data for the feed items\nconst MOCK_FEED = [ // cite: CommunityFeed.jsx (Original)\n    { id: 1, user: 'Alex H.', rep: 'Successfully used the CLEAR coaching framework in my 1:1 this morning.', tier: 'T4: People Dev', time: '5m ago', reactions: 8, comments: 2, isPod: true },\n    { id: 2, user: 'Team Admin', rep: 'New LeaderRep Streak Coin Unlocked! Check your profile for details.', tier: 'Gamification', time: '2h ago', reactions: 15, comments: 10, isPod: false },\n    { id: 3, user: 'Sarah K.', rep: 'Conducted a 10-minute mindful check before the quarterly review.', tier: 'T1: Self-Awareness', time: '3h ago', reactions: 4, comments: 0, isPod: true },\n    { id: 4, user: 'Justin M.', rep: 'Retired a rep (SOP creation). Shifting focus to T3: Strategic Alignment.', tier: 'Weekly Review', time: 'Yesterday', reactions: 7, comments: 1, isPod: true },\n];\n\n// Mock data for the leaderboard\nconst MOCK_LEADERBOARD = [ // cite: CommunityFeed.jsx (Original)\n    { rank: 1, name: 'Alex H.', streak: 12, reps: 68 },\n    { rank: 2, name: 'Sarah K.', streak: 9, reps: 55 },\n    { rank: 3, name: 'Justin M.', streak: 7, reps: 42 },\n];\n\n/* =========================================================\n   SUB-COMPONENT: RepFeedItem\n========================================================= */\n\n/**\n * RepFeedItem Component\n * Renders a single item in the community feed.\n * Includes user info, rep text, actions (react, comment), and tags.\n */\nconst RepFeedItem = ({ item }) => {\n    // --- Consume Services ---\n    const { navigate } = useAppServices(); // For handling navigation on comment click // cite: useAppServices.jsx\n\n    // --- Mock Handlers (Replace with actual interaction logic) ---\n    const handleComment = () => {\n        console.log(`[RepFeedItem] Navigating to comment thread for Rep ID: ${item.id}`);\n        // Example navigation (route needs to be defined in App.jsx)\n        // navigate('community-thread', { feedItemId: item.id });\n        alert(`Action: View comments for post ${item.id}`);\n    };\n    const handleReact = () => {\n        // Mock reaction logic (e.g., update local state or call API)\n        console.log(`[RepFeedItem] Reacted to Rep ID: ${item.id}`);\n        alert(`Action: Liked post ${item.id}`);\n        // TODO: Implement actual reaction update\n    };\n\n    return (\n        // Use consistent card styling from Card component (applied manually here for structure)\n        <div className=\"p-4 bg-white border border-gray-200 rounded-xl shadow-md transition-shadow duration-200 hover:shadow-lg\">\n            {/* Header: User Info & Tags */}\n            <div className=\"flex justify-between items-start mb-3 border-b pb-2\" style={{ borderColor: COLORS.SUBTLE }}>\n                {/* User Avatar (Placeholder) & Name/Time */}\n                <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center\"> {/* Placeholder Avatar */}\n                        <User className=\"w-4 h-4 text-gray-500\" />\n                    </div>\n                    <div>\n                        <p className=\"font-bold text-sm\" style={{ color: COLORS.NAVY }}>{item.user}</p>\n                        <p className=\"text-xs text-gray-500\">{item.time}</p>\n                    </div>\n                </div>\n                {/* Pod Tag */}\n                {item.isPod && (\n                    <span className={`text-[10px] font-semibold px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 flex items-center gap-1`}>\n                        <Users size={12}/> Pod\n                    </span>\n                )}\n            </div>\n\n            {/* Rep/Post Content */}\n            <p className=\"text-sm text-gray-800 mb-4 font-medium italic\">\"{item.rep}\"</p>\n\n            {/* Footer: Actions & Tier */}\n            <div className=\"flex justify-between items-center text-xs pt-3 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                {/* Actions: React & Comment */}\n                <div className=\"flex space-x-4\">\n                    <button onClick={handleReact} className=\"flex items-center text-red-500 hover:text-red-700 transition-colors group\" aria-label={`Like post by ${item.user}`}>\n                        <Heart className=\"w-3.5 h-3.5 mr-1 group-hover:fill-current\" /> {item.reactions}\n                    </button>\n                    <button onClick={handleComment} className=\"flex items-center text-gray-500 hover:text-blue-600 transition-colors group\" aria-label={`Comment on post by ${item.user}`}>\n                        <MessageSquare className=\"w-3.5 h-3.5 mr-1\" /> {item.comments}\n                    </button>\n                </div>\n                {/* Tier Tag */}\n                <span className={`text-[10px] font-semibold text-gray-500 bg-gray-100 px-2 py-0.5 rounded`}>{item.tier}</span>\n            </div>\n        </div>\n    );\n};\n\n/* =========================================================\n   MAIN COMPONENT: CommunityFeedScreen\n========================================================= */\n\n/**\n * CommunityFeedScreen Component (Placeholder/Mock)\n * Displays the main community activity feed, leaderboard, and quick share functionality.\n * Currently uses mock data. Should be updated to fetch/post real data.\n */\nconst CommunityFeedScreen = () => {\n    // --- Consume Services ---\n    const { navigate, user, featureFlags, isLoading: isAppLoading, error: appError } = useAppServices(); // cite: useAppServices.jsx\n    const safeUser = useMemo(() => user || { userId: null, name: 'Guest' }, [user]); // Safe user object\n\n    // --- Local State ---\n    const [feedFilter, setFeedFilter] = useState('pod'); // Filter state: 'pod' or 'all'\n    const [quickShareText, setQuickShareText] = useState(''); // Text for quick share input\n    const [isSharing, setIsSharing] = useState(false); // Loading state for quick share\n\n    // --- Effect for scrolling ---\n    useEffect(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, []);\n\n    // --- Filter Feed Data (Memoized) ---\n    // Uses local MOCK_FEED for now\n    const filteredFeed = useMemo(() => {\n        console.log(`[CommunityFeed] Filtering feed for: ${feedFilter}`);\n        if (feedFilter === 'pod') return MOCK_FEED.filter(item => item.isPod);\n        return MOCK_FEED; // 'all' filter shows everything (including non-pod)\n    }, [feedFilter]);\n\n    // --- Mock Quick Share Handler ---\n    const handleQuickShare = async () => {\n        const textToShare = quickShareText.trim();\n        if (!textToShare || isSharing) return;\n\n        setIsSharing(true);\n        console.log(`[CommunityFeed] Quick Sharing (Mock): \"${textToShare}\" by ${safeUser.name}`);\n        // --- MOCK API CALL ---\n        await new Promise(resolve => setTimeout(resolve, 800));\n        // --- END MOCK ---\n\n        // TODO: Replace with actual API call to post to the feed\n        // Example: addDoc(collection(db, 'community_feed'), { userId: safeUser.userId, userName: safeUser.name, text: textToShare, isPod: true, createdAt: serverTimestamp(), ... });\n\n        alert(`Mock Share Success: \"${textToShare}\"`);\n        setQuickShareText(''); // Clear input\n        setIsSharing(false);\n        // TODO: Optionally refresh the feed after posting\n    };\n\n    // --- Render Logic ---\n    // Feature Flag Check\n        if (!featureFlags?.enableCommunity) {\n      return (\n        <div className=\"p-8 text-center\">\n          <h2 className=\"text-2xl font-bold mb-4\">Community Feature Disabled</h2>\n          <p>This feature is currently not enabled. Please contact support for more information.</p>\n        </div>\n      );\n    }\n    // Loading/Error States\n    if (isAppLoading) return <LoadingSpinner message=\"Loading Community Feed...\" />;\n    if (appError) return <ConfigError message={`Failed to load Community Feed: ${appError.message}`} />;\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10 space-y-8 min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4 border-b pb-4\" style={{ borderColor: COLORS.SUBTLE }}>\n                <h1 className=\"text-3xl md:text-4xl font-extrabold flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n                    <Users size={32} style={{ color: COLORS.BLUE }} /> Accountability Pod Feed\n                </h1>\n                {/* Link to Community Settings */}\n                <Button onClick={() => navigate('app-settings', { section: 'community' })} variant=\"outline\" size=\"sm\">\n                   <Settings size={16} className='mr-2'/> Pod Settings\n                </Button>\n            </header>\n\n            {/* Main Layout Grid */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n\n                {/* Left Column: Leaderboard & Quick Share */}\n                <aside className=\"lg:col-span-1 space-y-6 lg:sticky lg:top-6 self-start\"> {/* Sticky sidebar */}\n                    {/* Leaderboard Card */}\n                    <div className=\"p-6 bg-white border border-gray-200 rounded-xl shadow-lg\">\n                        <h2 className=\"text-lg font-bold mb-4 flex items-center gap-2 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>\n                            <Award className=\"w-5 h-5 text-amber-500\" /> Rep Streak Leaderboard (Pod)\n                        </h2>\n                        {MOCK_LEADERBOARD.map((leader, index) => (\n                            <div key={leader.rank} className={`flex items-center py-2 border-b last:border-b-0 ${index < 3 ? '' : 'opacity-70'}`} style={{ borderColor: COLORS.SUBTLE }}>\n                                {/* Rank */}\n                                <span className={`font-extrabold w-6 text-center text-sm ${\n                                    index === 0 ? 'text-amber-500' : index === 1 ? 'text-gray-500' : index === 2 ? 'text-orange-700' : 'text-gray-400'\n                                }`}>{leader.rank}.</span>\n                                {/* Name */}\n                                <span className=\"flex-1 font-semibold text-sm ml-2 truncate\" style={{ color: COLORS.NAVY }}>{leader.name}</span>\n                                {/* Streak */}\n                                <span className=\"text-xs font-medium ml-2\" style={{ color: COLORS.TEAL }}>{leader.streak} Day Streak</span>\n                            </div>\n                        ))}\n                         {/* Optional: Link to full leaderboard */}\n                         {/* <Button variant=\"ghost\" size=\"sm\" className=\"w-full mt-3 !text-xs\">View Full Leaderboard</Button> */}\n                    </div>\n\n                    {/* Quick Share Card */}\n                    <div className=\"p-6 bg-white border border-gray-200 rounded-xl shadow-lg\">\n                        <h2 className=\"text-lg font-bold mb-4 flex items-center gap-2 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>\n                            <Link className=\"w-5 h-5 text-gray-500\" /> Quick Share\n                        </h2>\n                        {/* Input */}\n                        <textarea\n                            value={quickShareText}\n                            onChange={(e) => setQuickShareText(e.target.value)}\n                            placeholder=\"Share your latest rep or a quick win...\"\n                            className=\"w-full p-3 border border-gray-300 rounded-lg text-sm mb-3 focus:ring-2 focus:ring-[${COLORS.TEAL}]\"\n                            rows=\"3\" disabled={isSharing}\n                        />\n                        {/* Share Button */}\n                        <Button onClick={handleQuickShare} size=\"md\" className=\"w-full\" disabled={!quickShareText.trim() || isSharing}>\n                            {isSharing ? <Loader className=\"w-4 h-4 mr-2 animate-spin\" /> : <Send className=\"w-4 h-4 mr-2\" />}\n                            {isSharing ? 'Sharing...' : 'Share Rep to Pod'}\n                        </Button>\n                    </div>\n                </aside>\n\n                {/* Right Column: Activity Feed */}\n                <main className=\"lg:col-span-2 space-y-6\">\n                    {/* Feed Filter Buttons */}\n                    <div className=\"flex space-x-3\">\n                        <Button\n                            onClick={() => setFeedFilter('pod')}\n                            variant={feedFilter === 'pod' ? 'primary' : 'outline'}\n                            size=\"sm\" // Small filter buttons\n                        >\n                            My Pod Activity\n                        </Button>\n                        <Button\n                            onClick={() => setFeedFilter('all')}\n                            variant={feedFilter === 'all' ? 'primary' : 'outline'}\n                            size=\"sm\"\n                        >\n                            All Community (Global)\n                        </Button>\n                    </div>\n\n                    {/* Feed Items */}\n                    {filteredFeed.length === 0 ? (\n                         <div className=\"text-center text-gray-500 py-16 italic border-2 border-dashed border-gray-300 rounded-xl bg-white\">\n                            <MessageSquare className=\"w-10 h-10 mx-auto mb-3 text-gray-400\"/>\n                            The feed is quiet... Log a rep to share your progress!\n                         </div>\n                    ) : (\n                        filteredFeed.map(item => <RepFeedItem key={item.id} item={item} />)\n                    )}\n\n                    {/* Optional: Load More Button */}\n                    {/* {filteredFeed.length > 0 && <Button variant=\"outline\" size=\"sm\" className=\"w-full mt-4\">Load More Posts</Button>} */}\n                </main>\n\n            </div>\n        </div>\n    );\n};\n\n// Export the component\nexport default CommunityFeedScreen;\n\n// Note: This screen relies heavily on MOCK_FEED.\n// TODO: Replace MOCK_FEED with data fetched from Firestore (e.g., a 'community_feed' collection).\n// TODO: Implement real Quick Share functionality (posting to Firestore).\n// TODO: Implement real Reaction and Comment functionality.\n// TODO: Implement real Leaderboard data fetching/calculation.","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/CommunityScreen.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":302,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":302,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/CommunityScreen.jsx (Refactored for Consistency, Context)\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\nimport {\n    Users, MessageSquare, Briefcase, Bell, PlusCircle, User, ArrowLeft, Target, Settings, Filter, Clock,\n    Star, CheckCircle, Award, Link, Send, Loader, Heart // Added Award, Link, Send, Loader\n} from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-screen flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/* =========================================================\n   MOCK DATA & FALLBACKS\n========================================================= */\n\n// --- Mock Feed Data (Local Fallback - Replace with Service/API later) ---\n// Note: Added `ownerName` to align with `user.name` usage\nconst MOCK_FEED_FALLBACK = [ // cite: CommunityFeed.jsx (original)\n    { id: 't1', ownerName: 'Alex H.', ownerId: 'user-alex-h', rep: 'Used CLEAR framework in 1:1. Felt structured.', tier: 'T2', time: '15m ago', reactions: 8, comments: 2, isPodMember: true, impact: false },\n    { id: 't2', ownerName: 'System Admin', ownerId: 'system', rep: 'New Rep Streak Coins unlocked! Keep up the great work.', tier: 'System', time: '1h ago', reactions: 25, comments: 5, isPodMember: false, impact: false },\n    { id: 't3', ownerName: 'Sarah K.', ownerId: 'user-sarah-k', rep: 'Practiced mindful check-in before the QBR. Helped stay centered.', tier: 'T1', time: '3h ago', reactions: 12, comments: 1, isPodMember: true, impact: false },\n    { id: 't4', ownerName: 'Justin M.', ownerId: 'user-justin-m', rep: 'Retired a rep (Delegation SOP). Shifting focus to T5 Strategic Alignment.', tier: 'T5', time: 'Yesterday', reactions: 18, comments: 3, isPodMember: true, impact: true },\n    { id: 't5', ownerName: 'Coach Support', ownerId: 'system-coach', rep: 'Reminder: Office Hours today at 2 PM ET for T3 Coaching skills.', tier: 'System', time: 'Yesterday', reactions: 9, comments: 0, isPodMember: false, impact: false },\n];\n\n// --- Tier Metadata Fallback (If LEADERSHIP_TIERS fails to load) ---\nconst LEADERSHIP_TIERS_META_FALLBACK = { // cite: CommunityScreen.jsx (original)\n    'All': { name: 'All Tiers', hex: COLORS.TEAL, color: 'teal-500' }, // Added color class for potential use\n    'T1': { name: 'Lead Self', hex: COLORS.GREEN, color: 'green-500' },\n    'T2': { name: 'Lead Work', hex: COLORS.BLUE, color: 'blue-500' },\n    'T3': { name: 'Lead People', hex: COLORS.AMBER, color: 'amber-500' },\n    'T4': { name: 'Lead Teams', hex: COLORS.ORANGE, color: 'orange-500' },\n    'T5': { name: 'Lead Strategy', hex: COLORS.PURPLE, color: 'purple-500' },\n    'System': { name: 'System Info', hex: COLORS.MUTED, color: 'gray-500' },\n};\n\n\n/* =========================================================\n   SUB-COMPONENTS (Refactored for Consistency)\n========================================================= */\n\n/**\n * CommunityHomeView Component\n * Displays the main feed, filters, and the \"Start Discussion\" button.\n */\nconst CommunityHomeView = ({ setView, user, currentTierFilter, setCurrentTierFilter, filteredThreads, tierMeta }) => {\n    // Determine which tier metadata to use (context or fallback)\n    const safeTierMeta = useMemo(() => {\n        // Add 'All' option dynamically if not present in context Tiers\n        const tiers = tierMeta || LEADERSHIP_TIERS_META_FALLBACK; // cite: useAppServices.jsx, LEADERSHIP_TIERS_META_FALLBACK\n        return tiers.All ? tiers : { All: { name: 'All Tiers', hex: COLORS.TEAL, color: 'teal-500' }, ...tiers };\n    }, [tierMeta]);\n\n    // --- Mock Handlers (Replace with actual interaction logic) ---\n    const handleCommentClick = (threadId) => {\n        console.log(`[CommunityHome] Navigate to comment thread for ID: ${threadId}`);\n        // navigate('community-thread', { threadId }); // Example navigation\n        alert(`Action: View details/comments for thread ${threadId}`);\n    };\n    const handleReactClick = (threadId) => {\n        console.log(`[CommunityHome] Reacted to thread ID: ${threadId}`);\n        alert(`Action: Liked thread ${threadId}`);\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Header: Title & New Thread Button */}\n            <div className=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4 border-b pb-4\" style={{ borderColor: COLORS.SUBTLE }}>\n                <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>Community Feed ({safeTierMeta[currentTierFilter]?.name || 'All'})</h2>\n                <Button onClick={() => setView('new-thread')} size=\"sm\"> {/* Use standard Button */}\n                    <PlusCircle className=\"w-4 h-4 mr-2\" /> Start Discussion\n                </Button>\n            </div>\n\n            {/* Tier Filter Bar */}\n            <Card accent=\"TEAL\" className=\"!p-3\"> {/* Use Card for consistent container */}\n                <div className=\"flex flex-wrap items-center gap-2\">\n                    <Filter className=\"w-5 h-5 flex-shrink-0\" style={{ color: COLORS.NAVY }} />\n                    <span className=\"text-sm font-semibold mr-2\" style={{ color: COLORS.NAVY }}>Filter:</span>\n                    {/* Map through available tiers from safeTierMeta */}\n                    {Object.keys(safeTierMeta).map(tierId => {\n                        const meta = safeTierMeta[tierId];\n                        const isActive = currentTierFilter === tierId;\n                        return (\n                            <button\n                                key={tierId}\n                                onClick={() => setCurrentTierFilter(tierId)}\n                                // Consistent button styling for filters\n                                className={`px-3 py-1 text-[11px] font-bold rounded-full transition-all duration-200 border ${\n                                    isActive\n                                        ? 'text-white shadow-md scale-105' // Active style\n                                        : 'text-gray-700 bg-white hover:bg-gray-100 border-gray-300' // Inactive style\n                                }`}\n                                style={{ backgroundColor: isActive ? meta.hex : undefined, borderColor: isActive ? meta.hex : undefined }}\n                                aria-pressed={isActive} // Accessibility\n                            >\n                                {tierId === 'System' ? 'Admin' : tierId} {/* Shorten label */}\n                            </button>\n                        );\n                    })}\n                </div>\n            </Card>\n\n            {/* Thread List */}\n            <div className=\"space-y-4\">\n                {/* Empty State */}\n                {filteredThreads.length === 0 && (\n                    <Card className=\"text-center border-dashed\">\n                        <p className=\"text-gray-500 italic py-6\">\n                            No posts match the \"{safeTierMeta[currentTierFilter]?.name || currentTierFilter}\" filter. {currentTierFilter !== 'All' && 'Try selecting \"All\".'}\n                        </p>\n                    </Card>\n                )}\n                {/* Render Threads */}\n                {filteredThreads.map(thread => {\n                    // Determine if the current user owns this thread\n                    const isMyThread = user?.userId && thread.ownerId === user.userId; // Use userId // cite: useAppServices.jsx\n                    // Get tier metadata for color/styling\n                    const threadTierMeta = safeTierMeta[thread.tier] || { hex: COLORS.MUTED };\n\n                    return (\n                        // Use Card for each thread item\n                        <Card key={thread.id} accent={isMyThread ? 'TEAL' : (thread.impact ? 'ORANGE' : 'NAVY')} className=\"transition-shadow duration-200 hover:shadow-lg\">\n                            {/* Thread Header */}\n                            <div className=\"flex justify-between items-start mb-3 border-b pb-2\" style={{ borderColor: COLORS.SUBTLE }}>\n                                {/* User Info */}\n                                <div className=\"flex items-center space-x-3\">\n                                    <User className=\"w-5 h-5 text-gray-400 flex-shrink-0\" />\n                                    <div>\n                                        <p className=\"font-bold text-md leading-tight\" style={{ color: COLORS.NAVY }}>{thread.ownerName || 'User'}</p>\n                                        <p className=\"text-xs text-gray-500\">{thread.time}</p>\n                                    </div>\n                                </div>\n                                {/* Tags/Badges */}\n                                <div className='flex items-center gap-2 ml-2 flex-shrink-0'>\n                                    {/* Pod Member Tag (Example - adjust logic based on real data) */}\n                                    {thread.isPodMember && <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full bg-blue-100 text-blue-700`}>Pod</span>}\n                                    {/* Impact Tag */}\n                                    {thread.impact && <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full text-white bg-[${COLORS.ORANGE}] flex items-center gap-1`}><Star size={10} fill=\"currentColor\"/> Impact</span>}\n                                    {/* Tier Tag */}\n                                    <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full`} style={{ background: `${threadTierMeta.hex}1A`, color: threadTierMeta.hex }}>{thread.tier}</span>\n                                </div>\n                            </div>\n\n                            {/* Rep/Post Content */}\n                            <p className=\"text-sm text-gray-800 mb-4 font-medium italic\">\"{thread.rep}\"</p>\n\n                            {/* Actions Footer */}\n                            <div className=\"flex justify-between items-center text-xs pt-3 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                                {/* Reactions & Comments */}\n                                <div className=\"flex space-x-4\">\n                                    <button onClick={() => handleReactClick(thread.id)} className=\"flex items-center text-red-500 hover:text-red-700 transition-colors group\">\n                                        <Heart className=\"w-3.5 h-3.5 mr-1 group-hover:fill-current\" /> {thread.reactions || 0}\n                                    </button>\n                                    <button onClick={() => handleCommentClick(thread.id)} className=\"flex items-center text-gray-500 hover:text-blue-600 transition-colors group\">\n                                        <MessageSquare className=\"w-3.5 h-3.5 mr-1\" /> {thread.comments || 0}\n                                    </button>\n                                </div>\n                                {/* View Details Link */}\n                                <button onClick={() => handleCommentClick(thread.id)} className=\"font-semibold text-blue-600 hover:underline\">View</button>\n                            </div>\n                        </Card>\n                    );\n                })}\n            </div>\n        </div>\n    );\n};\n\n\n/**\n * MyThreadsView Component\n * Displays threads started by the current user.\n */\nconst MyThreadsView = ({ user, allThreads }) => { // Pass allThreads from parent\n    // Filter threads based on the current user's ID\n    const myThreads = useMemo(() => {\n        // Safety check for user and userId\n        const userId = user?.userId; // cite: useAppServices.jsx\n        if (!userId) return [];\n        return (allThreads || []).filter(thread => thread.ownerId === userId);\n    }, [user, allThreads]);\n\n    return (\n        // Use Card container\n        <Card title=\"My Active Discussions\" icon={Briefcase} accent=\"TEAL\">\n            {myThreads.length > 0 ? (\n                <div className=\"space-y-3\">\n                    {myThreads.map(thread => (\n                        // Simpler card for list view\n                        <div key={thread.id} className=\"p-4 rounded-lg border-l-4 shadow-sm transition-shadow hover:shadow-md cursor-pointer\" style={{ borderColor: COLORS.TEAL, backgroundColor: COLORS.OFF_WHITE }}\n                             onClick={() => alert(`Maps to details for thread ${thread.id}`)} // Placeholder action\n                        >\n                            <h3 className=\"font-semibold text-md mb-1\" style={{ color: COLORS.NAVY }}>{thread.title}</h3>\n                            <p className=\"text-xs text-gray-600\">\n                                Tier: {thread.tier} | {thread.replies} Replies | Last active: {thread.lastActive}\n                            </p>\n                        </div>\n                    ))}\n                </div>\n            ) : (\n                // Consistent empty state message\n                <p className=\"text-gray-500 italic text-sm text-center py-6\">You haven't started any discussions yet. Post in the Community Feed!</p>\n            )}\n        </Card>\n    );\n};\n\n/**\n * MentorshipView Component (Placeholder)\n * Provides information and actions related to mentorship.\n */\nconst MentorshipView = () => {\n    const { navigate } = useAppServices(); // cite: useAppServices.jsx\n\n    return (\n        // Use Card container\n        <Card title=\"Mentorship Network\" icon={Users} accent=\"ORANGE\">\n            <p className=\"text-gray-600 text-sm mb-4\">Connect with experienced leaders (T5 Visionaries) for personalized guidance and support.</p>\n            {/* Placeholder content - Needs real implementation */}\n            <div className=\"p-4 bg-orange-50 border border-orange-200 rounded-lg text-center text-orange-700 font-medium italic mb-4\">\n                Mentorship matching feature coming soon...\n            </div>\n            {/* Button linking to another relevant section (e.g., Development Plan) */}\n            <Button\n                onClick={() => navigate('development-plan')} // Example navigation // cite: useAppServices.jsx\n                variant=\"secondary\" size=\"sm\" className=\"w-full\"\n            >\n                <User className=\"w-4 h-4 mr-2\" /> Review Your Development Plan\n            </Button>\n        </Card>\n    );\n};\n\n/**\n * NotificationsView Component (Placeholder)\n * Displays recent notifications for the user.\n */\nconst NotificationsView = () => (\n    // Use Card container\n    <Card title=\"Notifications\" icon={Bell} accent=\"RED\">\n        <div className=\"space-y-3 max-h-96 overflow-y-auto custom-scrollbar pr-2\">\n            {/* Placeholder Notifications */}\n            {[\n                {id: 1, text: \"A **T5 Leader** replied to your thread on 'Delegation Challenges'.\"},\n                {id: 2, text: \"Your **Weekly Progress Summary** is ready for review.\"},\n                {id: 3, text: \"Sarah K. liked your post about 'Mindful Check-ins'.\"},\n                {id: 4, text: \"Reminder: **Office Hours** with Coach Support at 2 PM today.\"},\n                {id: 5, text: \"You earned the **'Consistent Contributor'** badge!\"},\n            ].map(notif => (\n                <div key={notif.id} className=\"text-sm text-gray-700 border-b pb-2 last:border-b-0\" style={{ borderColor: COLORS.SUBTLE }}>\n                     <p dangerouslySetInnerHTML={{ __html: notif.text.replace(/\\*\\*(.*?)\\*\\*/g, '<strong class=\"font-semibold\">$1</strong>') }} />\n                     <span className=\"text-xs text-gray-400\"> (Mock time)</span>\n                </div>\n            ))}\n             {/* Empty State */}\n             {/* <p className=\"text-gray-500 italic text-sm text-center py-6\">No new notifications.</p> */}\n        </div>\n    </Card>\n);\n\n\n/**\n * NewThreadView Component\n * Form for creating a new discussion thread.\n */\nconst NewThreadView = ({ setView }) => {\n    const { user } = useAppServices(); // Get user info for potential future use // cite: useAppServices.jsx\n    const [title, setTitle] = useState('');\n    const [context, setContext] = useState('');\n    const [question, setQuestion] = useState('');\n    const [tier, setTier] = useState('T2'); // Default tier\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [isSuccess, setIsSuccess] = useState(false);\n\n    // Mock Submission Handler (Replace with API call)\n    const handleSubmit = useCallback(async (e) => {\n        e.preventDefault();\n        if (!title || !context || !question || isSubmitting) return; // Basic validation\n\n        setIsSubmitting(true);\n        setIsSuccess(false);\n        console.log(\"[NewThread] Submitting thread:\", { title, context, question, tier });\n\n        // --- MOCK API CALL ---\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        // --- END MOCK ---\n\n        // In a real app, you would send this data to your backend/Firestore\n        // Example: addDoc(collection(db, 'community_threads'), { title, context, question, tier, ownerId: user.userId, ownerName: user.name, createdAt: serverTimestamp(), ... });\n\n        setIsSubmitting(false);\n        setIsSuccess(true);\n        // Navigate back to home after success message\n        setTimeout(() => setView('home'), 2000);\n\n    }, [title, context, question, tier, isSubmitting, setView]); // Dependencies // Removed user dependency for now\n\n    return (\n        // Use Card container\n        <Card title=\"Start a New Discussion\" icon={PlusCircle} accent=\"TEAL\">\n            {/* Back Button */}\n            <button onClick={() => setView('home')} className=\"absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors\">\n                <X className=\"w-5 h-5\" />\n            </button>\n            <p className=\"text-sm text-gray-700 mb-4 border-l-4 pl-3 italic\" style={{ borderColor: COLORS.TEAL }}>\n                Use the structure below for high-quality discussions and faster responses from peers and coaches.\n            </p>\n\n            {/* New Thread Form */}\n            <form className=\"space-y-4\" onSubmit={handleSubmit}>\n                {/* Title */}\n                <div>\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-1\">1. Thread Title / Topic <span className=\"text-red-500\">*</span></label>\n                    <input type=\"text\" value={title} onChange={(e) => setTitle(e.target.value)} placeholder=\"e.g., Applying SBI to high performers\" className=\"w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[${COLORS.TEAL}]\" required />\n                </div>\n                {/* Context */}\n                <div>\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-1\">2. Situation & Context (1-2 sentences) <span className=\"text-red-500\">*</span></label>\n                    <textarea value={context} onChange={(e) => setContext(e.target.value)} placeholder=\"e.g., Giving feedback to a senior engineer who is technically strong but dismissive in code reviews.\" className=\"w-full p-3 border border-gray-300 rounded-lg h-20 text-sm focus:ring-2 focus:ring-[${COLORS.TEAL}]\" required />\n                </div>\n                {/* Question */}\n                <div>\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-1\">3. Specific Question / Challenge <span className=\"text-red-500\">*</span></label>\n                    <textarea value={question} onChange={(e) => setQuestion(e.target.value)} placeholder=\"e.g., How can I deliver this feedback using SBI without demotivating them, focusing on the impact on team collaboration?\" className=\"w-full p-3 border border-gray-300 rounded-lg h-24 text-sm focus:ring-2 focus:ring-[${COLORS.TEAL}]\" required />\n                </div>\n                {/* Tier Selection */}\n                <div>\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-1\">4. Primary Leadership Tier Focus</label>\n                    {/* TODO: Populate options from LEADERSHIP_TIERS context */}\n                    <select value={tier} onChange={(e) => setTier(e.target.value)} className=\"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[${COLORS.TEAL}]\">\n                        <option value=\"T1\">T1: Lead Self</option>\n                        <option value=\"T2\">T2: Lead Work</option>\n                        <option value=\"T3\">T3: Lead People</option>\n                        <option value=\"T4\">T4: Lead Teams</option>\n                        <option value=\"T5\">T5: Lead Strategy</option>\n                    </select>\n                </div>\n\n                {/* Success Message */}\n                {isSuccess && (\n                    <div className=\"flex items-center p-3 text-sm font-semibold text-white rounded-lg bg-[${COLORS.GREEN}] animate-pulse\">\n                        <CheckCircle className='w-4 h-4 mr-2'/> Thread Posted! Redirecting...\n                    </div>\n                )}\n\n                {/* Submit Button */}\n                <Button type=\"submit\" disabled={isSubmitting || isSuccess} size=\"md\" className=\"w-full\">\n                    {isSubmitting ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Send className=\"w-4 h-4 mr-2\" />}\n                    {isSubmitting ? 'Posting Thread...' : 'Post Discussion'}\n                </Button>\n            </form>\n        </Card>\n    );\n};\n\n\n/* =========================================================\n   MAIN COMPONENT: CommunityScreen (Router)\n========================================================= */\n\nconst CommunityScreen = () => {\n    // --- Consume Services ---\n    const { user, navigate, LEADERSHIP_TIERS, featureFlags, isAdmin, isLoading: isAppLoading, error: appError } = useAppServices(); // cite: useAppServices.jsx\n    // Use safeUser structure even if user context is briefly null during auth changes\n    const safeUser = useMemo(() => user || { userId: null, name: 'Guest' }, [user]); // cite: useAppServices.jsx (provides user)\n\n    // --- Local State ---\n    const [view, setView] = useState('home'); // Controls which sub-view is displayed\n    const [currentTierFilter, setCurrentTierFilter] = useState('All'); // Filter for the home feed\n\n    // --- Determine Data Sources ---\n    // Use LEADERSHIP_TIERS from context if available, otherwise use fallback\n    const tierMeta = useMemo(() => LEADERSHIP_TIERS || LEADERSHIP_TIERS_META_FALLBACK, [LEADERSHIP_TIERS]); // cite: useAppServices.jsx, LEADERSHIP_TIERS_META_FALLBACK\n    // Use mock feed data for now. Replace with fetched data later.\n    // TODO: Fetch real thread data, potentially filter based on user's pod\n    const allThreads = useMemo(() => MOCK_FEED_FALLBACK, []); // cite: MOCK_FEED_FALLBACK\n\n    // --- Effect to scroll to top when view changes ---\n    useEffect(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, [view]);\n\n    // --- Filter Threads for Home View ---\n    const filteredThreads = useMemo(() => {\n        console.log(`[CommunityScreen] Filtering threads for: ${currentTierFilter}`);\n        // Filter based on selected tier, or show all non-system if 'All'\n        return allThreads.filter(thread =>\n            thread.tier !== 'System' && // Always exclude system messages from main feed\n            (currentTierFilter === 'All' || thread.tier === currentTierFilter)\n        );\n    }, [currentTierFilter, allThreads]);\n\n    // --- Sidebar Navigation Items ---\n    const navItems = useMemo(() => [\n        { screen: 'home', label: 'Community Feed', icon: MessageSquare },\n        { screen: 'my-threads', label: 'My Discussions', icon: Briefcase },\n        // Conditionally include Mentorship based on flag\n        ...(featureFlags?.enableMentorship ? [{ screen: 'mentorship', label: 'Mentorship Network', icon: Users }] : []), // Example flag // cite: useAppServices.jsx\n        { screen: 'notifications', label: 'Notifications', icon: Bell, notify: true }, // Mock notification indicator\n    ], [featureFlags]); // Rebuild if flags change\n\n    // --- Render Logic ---\n    const renderContent = () => {\n        switch(view) {\n            case 'my-threads':\n                return <MyThreadsView user={safeUser} allThreads={allThreads} />; // Pass safeUser and allThreads\n            case 'mentorship':\n                 // Only render if feature is enabled (redundant check if nav item is hidden, but safe)\n                return featureFlags?.enableMentorship ? <MentorshipView /> : <CommunityHomeView /* Fallback or redirect */ />;\n            case 'notifications':\n                return <NotificationsView />; // Placeholder\n            case 'new-thread':\n                return <NewThreadView setView={setView} />; // Pass setter\n            case 'home':\n            default:\n                return <CommunityHomeView\n                    setView={setView}\n                    user={safeUser} // Pass safeUser\n                    currentTierFilter={currentTierFilter}\n                    setCurrentTierFilter={setCurrentTierFilter}\n                    filteredThreads={filteredThreads} // Pass filtered data\n                    tierMeta={tierMeta} // Pass tier metadata\n                />;\n        }\n    };\n\n    // --- Main Render ---\n    // Feature Flag Check for entire screen (bypass for admins)\n    if (!isAdmin && !featureFlags?.enableCommunity) { // cite: useAppServices.jsx\n         return (\n             <div className=\"p-8 text-center text-gray-500\">\n                 <Users className=\"w-12 h-12 mx-auto mb-4 text-gray-400\"/>\n                 <h1 className=\"text-2xl font-bold mb-2\">Community Hub Unavailable</h1>\n                 <p>This feature is currently disabled.</p>\n                 <Button onClick={() => navigate('dashboard')} variant=\"outline\" size=\"sm\" className=\"mt-4\">Back to Arena</Button>\n             </div>\n         );\n    }\n    // Loading/Error States\n    if (isAppLoading) return <LoadingSpinner message=\"Loading Community Hub...\" />;\n    // Note: appError check might be redundant if handled globally, but included for robustness\n    if (appError) return <ConfigError message={`Failed to load Community Hub: ${appError.message}`} />;\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.NAVY+'30'}}>\n                <Users className='w-10 h-10 flex-shrink-0' style={{color: COLORS.TEAL}}/>\n                <div>\n                     <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Leadership Community</h1>\n                     <p className=\"text-md text-gray-600 mt-1\">(Community Pillar 3)</p>\n                </div>\n            </header>\n\n            {/* Main Layout Grid (Sidebar + Content) */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\n                {/* Sidebar Navigation */}\n                <aside className=\"lg:col-span-1 space-y-4 lg:sticky lg:top-6 self-start\"> {/* Make sidebar sticky */}\n                    <h3 className=\"text-xs font-extrabold uppercase tracking-wider px-3 py-1 rounded text-gray-500 bg-gray-100 border border-gray-200\">\n                        Community Channels\n                    </h3>\n                    {navItems.map((item) => {\n                        const Icon = item.icon;\n                        const isActive = view === item.screen;\n                        // Use Purple for Notifications icon, Navy otherwise\n                        const iconColor = item.screen === 'notifications' ? COLORS.ORANGE : COLORS.NAVY;\n\n                        return (\n                            <button\n                                key={item.screen}\n                                onClick={() => setView(item.screen)}\n                                // Consistent button styling for sidebar nav\n                                className={`flex items-center w-full p-3 rounded-xl font-semibold text-sm relative transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[${COLORS.TEAL}] ${\n                                    isActive\n                                        ? `bg-white text-[${COLORS.NAVY}] ring-1 ring-[${COLORS.TEAL}] shadow-md` // Active style\n                                        : `text-gray-700 bg-white hover:bg-gray-50 hover:shadow-md border border-gray-200` // Inactive style\n                                }`}\n                            >\n                                <Icon className=\"w-5 h-5 mr-3 flex-shrink-0\" style={{ color: isActive ? COLORS.TEAL : iconColor }} />\n                                <span className=\"flex-1 text-left truncate\">{item.label}</span>\n                                {/* Notification Indicator */}\n                                {item.notify && <div className={`h-2 w-2 rounded-full ml-auto`} style={{ background: COLORS.ORANGE }} />}\n                            </button>\n                        );\n                    })}\n                     {/* Settings Link (Optional) */}\n                     <Button onClick={() => navigate('app-settings')} variant=\"ghost\" size=\"sm\" className=\"w-full justify-start text-gray-500 hover:text-gray-700\">\n                        <Settings className=\"w-4 h-4 mr-2\"/> Community Settings\n                     </Button>\n                </aside>\n\n                {/* Main Content Area */}\n                <main className=\"lg:col-span-3\">\n                    {renderContent()}\n                </main>\n            </div>\n        </div>\n    );\n};\n\nexport default CommunityScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/DailyPractice.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/Dashboard.jsx","messages":[{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":59,"column":15,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":59,"endColumn":29,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[2022,2041],"text":"Object.prototype.hasOwnProperty.call(obj, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isAdmin' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":202,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":202,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'handleSaveIdentity' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":223,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":223,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'handleSaveHabit' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":224,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":224,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getArrayFromMetadata'. Either include it or remove the dependency array.","line":336,"column":6,"nodeType":"ArrayExpression","endLine":336,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [globalMetadata, targetRep, getArrayFromMetadata]","fix":{"range":[11757,11784],"text":"[globalMetadata, targetRep, getArrayFromMetadata]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getArrayFromMetadata'. Either include it or remove the dependency array.","line":342,"column":6,"nodeType":"ArrayExpression","endLine":342,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [getArrayFromMetadata]","fix":{"range":[12065,12081],"text":"[getArrayFromMetadata]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getArrayFromMetadata'. Either include it or remove the dependency array.","line":347,"column":6,"nodeType":"ArrayExpression","endLine":347,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [getArrayFromMetadata]","fix":{"range":[12302,12318],"text":"[getArrayFromMetadata]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getArrayFromMetadata'. Either include it or remove the dependency array.","line":352,"column":6,"nodeType":"ArrayExpression","endLine":352,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [getArrayFromMetadata]","fix":{"range":[12528,12544],"text":"[getArrayFromMetadata]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getArrayFromMetadata'. Either include it or remove the dependency array.","line":357,"column":6,"nodeType":"ArrayExpression","endLine":357,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [getArrayFromMetadata]","fix":{"range":[12696,12712],"text":"[getArrayFromMetadata]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'handleFindPod' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":454,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":454,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'handleOpenAnchorEditor' function makes the dependencies of useMemo Hook (at line 568) change on every render. To fix this, wrap the definition of 'handleOpenAnchorEditor' in its own useCallback() Hook.","line":539,"column":9,"nodeType":"VariableDeclarator","endLine":539,"endColumn":65,"suggestions":[{"desc":"Wrap the definition of 'handleOpenAnchorEditor' in its own useCallback() Hook.","fix":{"range":[18976,19007],"text":"useCallback(() => setShowAnchorEditor(true))"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/Dashboard.jsx\n// FINAL VERSION - Updated 10/30/25\n// FIX: Anchor deletion logic implemented in handleDeletePlanAndReset (Issue 1).\n// FIX: Added defensive checks for arrays after deletion to prevent React error #31.\n// UX: Implemented floating/blinking Anchor FAB and Test Utilities.\n// UX: REMOVED LeadershipAnchorsCard for prominence of FAB.\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport { ArrowRight, Edit3, Loader, X, Users, Send, Target, Clock, Zap, Shield, Trash2, Anchor } from 'lucide-react'; \nimport { deleteField } from 'firebase/firestore'; // Used for reminder dismissals\nimport { MembershipGate } from '../ui/MembershipGate.jsx';\n\n// Import modular components from the file you provided\nimport {\n  COLORS,\n  Button,\n  Card,\n  ModeSwitch,\n  StreakTracker,\n  DynamicBookendContainer,\n  DevPlanProgressLink,\n  AICoachNudge,\n  ReminderBanner,\n  SaveIndicator,\n  BonusExerciseModal,\n  SocialPodCard,\n  // === UNIFIED IMPORTS ===\n  UnifiedAnchorEditorModal,\nAdditionalRepsCard // <--- ADD THIS LINE \n  // LeadershipAnchorsCard REMOVED per user request\n  // ===========================\n} from './dashboard/DashboardComponents.jsx';\n\n// Arena v1.0 Scope: Import Daily Tasks component to replace Social Pod\nimport DailyTasksCard from './dashboard/DailyTasksCard.jsx';\n\n// Import hooks from the file you provided\nimport { useDashboard } from './dashboard/DashboardHooks.jsx';\n\n// --- Helper function to sanitize Firestore Timestamps ---\nconst sanitizeTimestamps = (obj) => {\n  if (!obj) return obj;\n  \n  // Handle arrays\n  if (Array.isArray(obj)) {\n    return obj.map(item => sanitizeTimestamps(item));\n  }\n  \n  // Handle Firestore Timestamp objects\n  if (obj && typeof obj === 'object' && typeof obj.toDate === 'function') {\n    return obj.toDate();\n  }\n  \n  // Handle plain objects\n  if (obj && typeof obj === 'object') {\n    const sanitized = {};\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        sanitized[key] = sanitizeTimestamps(obj[key]);\n      }\n    }\n    return sanitized;\n  }\n  \n  return obj;\n};\n\n\n// --- Helper Components (Membership-Aware Start Card per Arena v1.0 Scope) ---\nconst GetStartedCard = ({ onNavigate, membershipData, developmentPlanData }) => {\n  const currentTier = membershipData?.currentTier || 'basic';\n  const hasCompletedPlan = developmentPlanData?.currentPlan && \n    developmentPlanData.currentPlan.focusAreas && \n    developmentPlanData.currentPlan.focusAreas.length > 0;\n\n  // Base members -> Show upgrade page\n  if (currentTier === 'basic') {\n    return (\n      <Card accent=\"ORANGE\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n              Unlock Your Leadership Potential\n            </h2>\n            <p className=\"text-base mt-1\" style={{ color: COLORS.MUTED }}>\n              Upgrade to Arena Professional to access assessments, development plans, and accountability pods.\n            </p>\n          </div>\n          <Button\n            onClick={() => onNavigate('membership-upgrade')}\n            variant=\"primary\"\n            size=\"md\"\n            className=\"flex-shrink-0 w-full sm:w-auto\"\n            style={{ background: `linear-gradient(135deg, ${COLORS.ORANGE}, ${COLORS.TEAL})` }}\n          >\n            View Plans <ArrowRight className=\"w-4 h-4 ml-2\" />\n          </Button>\n        </div>\n      </Card>\n    );\n  }\n\n  // Pro/Premium members without plan -> Assessment & Plan flow\n  if ((currentTier === 'professional' || currentTier === 'elite') && !hasCompletedPlan) {\n    return (\n      <Card accent=\"BLUE\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n              Create Your Development Plan\n            </h2>\n            <p className=\"text-base mt-1\" style={{ color: COLORS.MUTED }}>\n              Take your leadership assessment and create your personalized development plan.\n            </p>\n          </div>\n          <Button\n            onClick={() => onNavigate('development-plan')}\n            variant=\"primary\"\n            size=\"md\"\n            className=\"flex-shrink-0 w-full sm:w-auto\"\n          >\n            Take Assessment <ArrowRight className=\"w-4 h-4 ml-2\" />\n          </Button>\n        </div>\n      </Card>\n    );\n  }\n\n  // Pro/Premium members with plan -> This Week's Focus\n  if ((currentTier === 'professional' || currentTier === 'elite') && hasCompletedPlan) {\n    const currentWeekFocus = developmentPlanData?.currentPlan?.focusAreas?.[0]?.name || 'Leadership Development';\n    \n    return (\n      <Card accent=\"TEAL\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n              This Week's Focus\n            </h2>\n            <p className=\"text-lg font-semibold mt-1\" style={{ color: COLORS.TEAL }}>\n              {currentWeekFocus}\n            </p>\n            <p className=\"text-sm mt-1\" style={{ color: COLORS.MUTED }}>\n              Continue building your skills in this key area\n            </p>\n          </div>\n          <Button\n            onClick={() => onNavigate('development-plan')}\n            variant=\"outline\"\n            size=\"md\"\n            className=\"flex-shrink-0 w-full sm:w-auto\"\n          >\n            View Your Plan <ArrowRight className=\"w-4 h-4 ml-2\" />\n          </Button>\n        </div>\n      </Card>\n    );\n  }\n\n  // Fallback to original behavior\n  return (\n    <Card accent=\"TEAL\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n            Start Your Leadership Journey\n          </h2>\n          <p className=\"text-base mt-1\" style={{ color: COLORS.MUTED }}>\n            Create your personalized Development Plan to unlock your daily reps.\n          </p>\n        </div>\n        <Button\n          onClick={() => onNavigate('development-plan')}\n          variant=\"primary\"\n          size=\"md\"\n          className=\"flex-shrink-0 w-full sm:w-auto\"\n        >\n          Get Started <ArrowRight className=\"w-4 h-4 ml-2\" />\n        </Button>\n      </div>\n    </Card>\n  );\n};\n\nconst Dashboard = ({ navigate }) => {\n  \n  const {\n    user, \n    dailyPracticeData,\n    // CRITICAL FIX: Ensure update functions are explicitly destructured here\n    updateDailyPracticeData, \n    updateDevelopmentPlanData, \n  updateMembershipData,\n    // END CRITICAL FIX\n    featureFlags,\n    db,\n    userEmail,\n    developmentPlanData,\n    metadata: globalMetadata,\n    isLoading,\n    isAdmin,\n    membershipData\n  } = useAppServices();\n\n  // Developer Mode Toggle - Arena v1.0 Enhancement\n  const [isDeveloperMode, setIsDeveloperMode] = useState(() => {\n    return localStorage.getItem('arena-developer-mode') === 'true';\n  });\n\n  const toggleDeveloperMode = () => {\n    const newMode = !isDeveloperMode;\n    setIsDeveloperMode(newMode);\n    localStorage.setItem('arena-developer-mode', newMode.toString());\n  };\n\n  const {\n    isArenaMode, isTogglingMode, handleToggleMode,\n    targetRep, targetRepStatus, canCompleteTargetRep, isSavingRep, handleCompleteTargetRep,\n    identityStatement, setIdentityStatement,\n    habitAnchor, setHabitAnchor,\n    whyStatement, setWhyStatement,\n    handleSaveIdentity, \n    handleSaveHabit,    \n    morningWIN, setMorningWIN,\n    otherTasks: originalOtherTasks,\n    showLIS, setShowLIS,\n    reflectionGood, setReflectionGood,\n    reflectionBetter, setReflectionBetter,\n    reflectionBest, setReflectionBest,\n    habitsCompleted,\n    isSavingBookend,\n    handleSaveMorningBookend, handleSaveEveningBookend,\n    handleAddTask, handleToggleTask, handleRemoveTask,\n    handleToggleWIN, handleSaveWIN,\n    handleHabitToggle,\n    streakCount, streakCoins,\n    additionalCommitments\n  } = useDashboard({\n    dailyPracticeData,\n    updateDailyPracticeData,\n    featureFlags,\n    db,\n    userEmail\n  });\n\n  // Local UI state\n  const [showSaveConfirmation, setShowSaveConfirmation] = useState(false);\n  const [saveMessage, setSaveMessage] = useState('');\n  const [showBestReminder, setShowBestReminder] = useState(false);\n  const [showImprovementReminder, setShowImprovementReminder] = useState(false);\n  const [celebrationShown, setCelebrationShown] = useState(false);\n  const [showBonusExercise, setShowBonusExercise] = useState(false);\n  const [bonusExerciseData, setBonusExerciseData] = useState(null);\n  \n  // --- UNIFIED ANCHOR EDITOR STATE ---\n  const [showAnchorEditor, setShowAnchorEditor] = useState(false);\n  const [showTestUtils, setShowTestUtils] = useState(false); // NEW STATE for Test Utils\n  \n  // --- POD STATE ---\n  const [showFindPodModal, setShowFindPodModal] = useState(false);\n  const [availablePods, setAvailablePods] = useState([]);\n  const [isLoadingPods, setIsLoadingPods] = useState(false);\n\n\n  // --- Data Lookups (Unchanged logic) ---\n\n  const focusAreasArray = useMemo(() => {\n    if (!developmentPlanData) return [];\n    const areas = developmentPlanData.currentPlan?.focusAreas || developmentPlanData.focusAreas;\n    // Ensure we always return an array, even if the data is corrupted\n    return Array.isArray(areas) ? areas : [];\n  }, [developmentPlanData]);\n\n  const primaryFocusAreaName = useMemo(() => {\n    if (focusAreasArray.length > 0) {\n      // NOTE: This logic is why you see \"Unnamed Focus\" if the plan data is incomplete.\n      return focusAreasArray[0].name || focusAreasArray[0].category || 'Unnamed Focus';\n    }\n    return null;\n  }, [focusAreasArray]);\n\n  const focusArea = primaryFocusAreaName || 'Not Set';\n  \n  const devPlanProgress = (focusArea === 'Not Set') \n    ? 0 \n    : (developmentPlanData?.currentPlan?.progress || 0);\n\n  const getArrayFromMetadata = (key) => {\n    if (!globalMetadata || !globalMetadata[key]) return [];\n    const data = globalMetadata[key];\n    \n    // Handle null or undefined\n    if (!data) return [];\n    \n    // Handle Firebase deleteField placeholder objects\n    if (typeof data === 'object' && data._methodName === 'FieldValue.delete') {\n      return [];\n    }\n    \n    if (data && data.items && Array.isArray(data.items)) {\n      return data.items;\n    }\n    \n    if (Array.isArray(data)) {\n      return data;\n    }\n    \n    console.warn(`[getArrayFromMetadata] Metadata for key '${key}' is not in the expected { items: [...] } format or a simple array. Got:`, typeof data);\n    return [];\n  };\n\n  const targetRepDetails = useMemo(() => {\n    if (!globalMetadata || !targetRep) return null;\n    const repLibrary = getArrayFromMetadata('REP_LIBRARY');\n    if (!repLibrary || repLibrary.length === 0) return null;\n    \n    const repItem = repLibrary.find(rep => rep.id === targetRep);\n    \n    if (!repItem) {\n      return {\n        name: targetRep,\n        whatGreatLooksLike: 'Rep not found in catalog. Please check your Development Plan.',\n        whyItMatters: \"This rep couldn't be found. Please select a new rep from your Development Plan to get back on track.\"\n      };\n    }\n    \n    return {\n      id: repItem.id,\n      name: repItem.text || repItem.name,\n      whyItMatters: repItem.whyItMatters || \"This is your anchor rep. It converts reflection into forward motion and builds the awareness that is the heart of leadership learning.\",\n      whatGreatLooksLike: repItem.definition || 'Practice this rep consistently',\n      category: repItem.category,\n      tier: repItem.tier_id\n    };\n  }, [targetRep, globalMetadata]);\n\n  // Load suggestions for Anchors with defensive checks\n  const identitySuggestions = useMemo(() => {\n    const arr = getArrayFromMetadata('IDENTITY_ANCHOR_CATALOG');\n    return Array.isArray(arr) ? arr.map(s => ({ text: typeof s === 'string' ? s : s.text || '' })) : [];\n  }, [globalMetadata]);\n  \n  const habitSuggestions = useMemo(() => {\n    const arr = getArrayFromMetadata('HABIT_ANCHOR_CATALOG');\n    return Array.isArray(arr) ? arr.map(s => ({ text: typeof s === 'string' ? s : s.text || '' })) : [];\n  }, [globalMetadata]);\n  \n  const whySuggestions = useMemo(() => {\n    const arr = getArrayFromMetadata('WHY_CATALOG');\n    return Array.isArray(arr) ? arr.map(s => ({ text: typeof s === 'string' ? s : s.text || '' })) : [];\n  }, [globalMetadata]);\n  \n  const bonusExercises = useMemo(() => {\n    const arr = getArrayFromMetadata('EXERCISE_LIBRARY');\n    return Array.isArray(arr) ? arr : [];\n  }, [globalMetadata]);\n\n  // --- UI Handlers ---\n\n  const showSaveSuccess = (message = \"Saved!\") => {\n    setSaveMessage(message);\n    setShowSaveConfirmation(true);\n    setTimeout(() => setShowSaveConfirmation(false), 3000);\n  };\n\n  // --- FIX: Memoized Reminder Dismissal Handlers to prevent re-render crashes ---\n  const handleDismissBestReminder = useCallback(() => {\n      setShowBestReminder(false);\n      // Data mutation safely wrapped in a callback\n      updateDailyPracticeData({ tomorrowsReminder: deleteField() });\n  }, [updateDailyPracticeData]);\n  \n  const handleDismissImprovementReminder = useCallback(() => {\n      setShowImprovementReminder(false);\n      // Data mutation safely wrapped in a callback\n      updateDailyPracticeData({ improvementReminder: deleteField() });\n  }, [updateDailyPracticeData]);\n  // --- END FIX ---\n\n  // --- UNIFIED SAVE HANDLER ---\n  const handleSaveAllAnchors = async ({ identity, habit, why }) => {\n    // Collect all updates\n    const updates = {};\n    let saveMessage = 'Anchors saved!';\n\n    if (identity !== identityStatement) {\n      updates.identityAnchor = identity;\n      setIdentityStatement(identity);\n    }\n    if (habit !== habitAnchor) {\n      updates.habitAnchor = habit;\n      setHabitAnchor(habit);\n    }\n    if (why !== whyStatement) {\n      updates.whyStatement = why;\n      setWhyStatement(why);\n      console.log('Saving whyStatement:', why); // Debug log\n    }\n\n    if (Object.keys(updates).length > 0) {\n      await updateDailyPracticeData(updates);\n    } else {\n      saveMessage = 'No changes detected.';\n    }\n    showSaveSuccess(saveMessage);\n    setShowAnchorEditor(false);\n  };\n  // --- END UNIFIED SAVE HANDLER ---\n\n  const handleSaveMorningWithConfirmation = async () => {\n    await handleSaveMorningBookend();\n    showSaveSuccess('Morning plan locked in!');\n    triggerCelebration(\"Way to go, Leader!\");\n  };\n  \n  const handleSaveWINWithConfirmation = async () => {\n    await handleSaveWIN();\n    showSaveSuccess(\"Today's WIN saved!\");\n    setMorningWIN(''); \n  };\n\n  const handleSaveEveningWithConfirmation = async () => {\n    await handleSaveEveningBookend();\n    showSaveSuccess('Evening reflection saved!');\n    setReflectionGood('');\n    setReflectionBetter('');\n    setReflectionBest('');\n  };\n  \n  const triggerCelebration = (message) => {\n    setSaveMessage(message);\n    setShowSaveConfirmation(true);\n    setTimeout(() => setShowSaveConfirmation(false), 3500);\n  };\n\n  const handleCompleteBonusExercise = () => {\n      setShowBonusExercise(false);\n      triggerCelebration('+50 Coins earned! Great work!');\n  };\n\n  const handleCompleteTargetRepWithBonus = async () => {\n    await handleCompleteTargetRep();\n    triggerCelebration('🎯 Target rep completed!');\n    \n    if (bonusExercises.length > 0 && !celebrationShown) {\n      const randomBonus = bonusExercises[Math.floor(Math.random() * bonusExercises.length)];\n      setBonusExerciseData(randomBonus);\n      setShowBonusExercise(true);\n      setCelebrationShown(true);\n    }\n  };\n\n  const handleFindPod = () => {\n    setShowFindPodModal(true);\n    setIsLoadingPods(true);\n    setTimeout(() => {\n      setAvailablePods([\n        { id: 'pod1', name: 'West Coast Leaders', members: 8, activity: 'High' },\n        { id: 'pod2', name: 'East Coast Go-Getters', members: 12, activity: 'Medium' },\n        { id: 'pod3', name: 'Global Leadership Forum', members: 4, activity: 'High' },\n      ]);\n      setIsLoadingPods(false);\n    }, 1500);\n  };\n  \n  // --- FIX (Issue 1): Reset Plan ---\n  // 🛑 CRITICAL FIX: Direct implementation using update functions with complete overwrite\n  // This ensures ALL residual data is properly removed with a forced overwrite (merge: false)\n  const handleDeletePlanAndReset = useCallback(async () => {\n    console.log('[Dashboard] Executing Delete Plan and Reset with direct overwrite...');\n    \n    try {\n      // 1. CLEAR DEVELOPMENT PLAN to default state with OVERWRITE (merge: false)\n      const defaultPlanPayload = {\n        currentPlan: null, // CRITICAL: Set to null to trigger Baseline view\n        currentCycle: 1,\n        lastAssessmentDate: null,\n        assessmentHistory: [], \n        planHistory: [],\n      };\n      \n      // Use merge: false to completely overwrite the document (removes ALL fields)\n      const planCleared = await updateDevelopmentPlanData(defaultPlanPayload, { merge: false });\n      \n      // 2. CLEAR DAILY PRACTICE to default state  \n      const todayStr = new Date().toISOString().split('T')[0];\n      const defaultDailyPracticePayload = {\n        activeCommitments: [], \n        identityAnchor: '', \n        habitAnchor: '', \n        whyStatement: '',\n        dailyTargetRepId: null, \n        dailyTargetRepDate: null, \n        dailyTargetRepStatus: 'Pending', \n        streakCount: 0,\n        streakCoins: 0,\n        lastUpdated: todayStr,\n        completedRepsToday: [],\n        morningBookend: {},\n        eveningBookend: {},\n      };\n      \n      // Daily practice update\n      await updateDailyPracticeData(defaultDailyPracticePayload);\n      \n      if (planCleared) {\n        console.log('[Dashboard] Plan and anchors successfully cleared');\n        setShowTestUtils(false);\n        // Navigate to the Development Plan screen to show the Baseline\n        navigate('development-plan'); \n        triggerCelebration('Plan and progress reset. Start fresh!');\n      } else {\n        console.error('[Dashboard] Failed to clear plan');\n        triggerCelebration('Error resetting plan. Please try again.');\n      }\n    } catch (error) {\n      console.error('[Dashboard] Error during delete:', error);\n      triggerCelebration('Error resetting plan. Please try again.');\n    }\n  }, [updateDevelopmentPlanData, updateDailyPracticeData, navigate]);\n\n  // --- Reminder Banners (Cool Ideas) ---\n  useEffect(() => {\n    const yesterdayBest = dailyPracticeData?.tomorrowsReminder;\n    if (yesterdayBest) {\n      setShowBestReminder(true);\n    }\n    \n    const yesterdayBetter = dailyPracticeData?.improvementReminder;\n    if (yesterdayBetter) {\n      setShowImprovementReminder(true);\n    }\n  }, [dailyPracticeData]);\n  \n  // --- UX ENHANCEMENT: Anchor FAB Logic ---\n  const isFullyDefined = !!identityStatement && !!habitAnchor && !!whyStatement;\n  \n  const handleOpenAnchorEditor = () => setShowAnchorEditor(true);\n  \n  // --- Augmented Task List (Uses UNIFIED Anchor Editor) ---\n  const augmentedOtherTasks = useMemo(() => {\n    const newTasks = [];\n    \n    if (focusArea === 'Not Set') {\n      newTasks.push({\n        id: 'system-dev-plan',\n        text: 'Start your Development Plan',\n        completed: false,\n        isSystem: true,\n        onClick: () => navigate('development-plan') \n      });\n    }\n    \n    if (!isFullyDefined) {\n      const definedCount = [identityStatement, habitAnchor, whyStatement].filter(Boolean).length;\n      newTasks.push({\n        id: 'system-anchors',\n        text: `Define your Leadership Anchors (${definedCount}/3 Set) - Click to Edit`,\n        completed: false,\n        isSystem: true,\n        onClick: handleOpenAnchorEditor // Directs to the unified editor\n      });\n    }\n\n    // Sanitize originalOtherTasks in case they contain Firestore Timestamps\n    return [...newTasks, ...sanitizeTimestamps(originalOtherTasks)];\n  }, [\n    originalOtherTasks, \n    focusArea, \n    identityStatement, \n    habitAnchor, \n    whyStatement, \n    navigate,\n    isFullyDefined,\n    handleOpenAnchorEditor\n  ]);\n\n\n  // --- Computed Values for PM Bookend (Cool Idea 3) ---\n  const amWinCompleted = dailyPracticeData?.morningBookend?.winCompleted || false;\n  const amTasksCompleted = originalOtherTasks.length > 0 && originalOtherTasks.every(t => t.completed);\n\n  // --- Loading Guard ---\n  if (isLoading || !dailyPracticeData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\" style={{ background: COLORS.BG }}>\n        <Loader className=\"animate-spin h-10 w-10\" style={{ color: COLORS.TEAL }} />\n      </div>\n    );\n  }\n\n  // --- RENDER ---\n  return (\n    <div className=\"min-h-screen gradient-corporate-hero\">\n      <div className=\"container mx-auto max-w-7xl\" style={{ padding: 'var(--spacing-xl)' }}>\n        \n        {/* Corporate Header */}\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\" style={{ marginBottom: 'var(--spacing-2xl)' }}>\n          <div>\n            <h1 className=\"corporate-heading-xl\" style={{ color: COLORS.NAVY }}>\n              The Arena\n              {isDeveloperMode && (\n                <span className=\"ml-3 px-3 py-1 bg-orange-100 text-orange-800 text-sm font-semibold rounded-full\">\n                  🔧 Developer View\n                </span>\n              )}\n            </h1>\n            <p className=\"corporate-text-body\" style={{ color: COLORS.TEXT }}>\n              Welcome to the Arena, {user?.name || 'Leader'}! We're glad you're here.\n              {isDeveloperMode && (\n                <span className=\"block text-sm text-orange-600 font-medium mt-1\">\n                  You're viewing the full developer experience - toggle to \"User Mode\" to see what regular users see.\n                </span>\n              )}\n            </p>\n          </div>\n          {/* Developer Mode Toggle & Arena Features */}\n          <div className=\"flex gap-3 items-center\">\n            {/* Developer/User Mode Toggle */}\n            <button\n              onClick={toggleDeveloperMode}\n              className={`px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-200 ${\n                isDeveloperMode \n                  ? 'bg-orange-600 text-white shadow-lg' \n                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n              }`}\n            >\n              {isDeveloperMode ? '🔧 Developer Mode' : '👤 User Mode'}\n            </button>\n\n            {/* Arena Mode and Coins - Developer Mode Only */}\n            {isDeveloperMode && (\n              <>\n                <ModeSwitch \n                  isArenaMode={isArenaMode} \n                  onToggle={handleToggleMode} \n                  isLoading={isTogglingMode}\n                />\n                <StreakTracker streakCount={streakCount} streakCoins={streakCoins} />\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Reminders (Cool Ideas) */}\n        {showBestReminder && (\n          <div className=\"mb-4\">\n            <ReminderBanner\n              message={dailyPracticeData.tomorrowsReminder}\n              onDismiss={handleDismissBestReminder} // <-- FIX APPLIED HERE\n              type=\"best\"\n            />\n          </div>\n        )}\n        {showImprovementReminder && (\n          <div className=\"mb-4\">\n            <ReminderBanner\n              message={dailyPracticeData.improvementReminder}\n              onDismiss={handleDismissImprovementReminder} // <-- FIX APPLIED HERE\n              type=\"improvement\"\n            />\n          </div>\n        )}\n\n        {/* --- NEW 60/40 LAYOUT GRID --- */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          \n          {/* === 60% \"FOCUS\" COLUMN (LEFT) === */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            \n            {/* 1. Dev Plan Progress / Get Started */}\n            {focusArea === 'Not Set' ? (\n              <GetStartedCard \n                onNavigate={navigate} \n                membershipData={membershipData}\n                developmentPlanData={developmentPlanData}\n              />\n            ) : (\n              <MembershipGate requiredTier=\"basic\" featureName=\"Development Plan\">\n                <DevPlanProgressLink\n                  progress={devPlanProgress}\n                  focusArea={focusArea}\n                  onNavigate={() => navigate('development-plan')}\n                />\n              </MembershipGate>\n            )}\n\n            {/* 2. Today's Focus Rep */}\n            {focusArea !== 'Not Set' && (\n              <Card title=\"🎯 Today's Focus Rep\" accent='ORANGE'>\n                \n                <div className=\"mb-4 p-3 rounded-lg\" style={{ backgroundColor: `${COLORS.BLUE}05`, border: `1px solid ${COLORS.BLUE}20` }}>\n                  <div className=\"flex justify-between items-center mb-1\">\n                    <p className=\"text-xs font-semibold\" style={{ color: COLORS.BLUE }}>\n                      💡 WHY IT MATTERS:\n                    </p>\n                  </div>\n                  <p className=\"text-xs\" style={{ color: COLORS.TEXT }}>\n                    {targetRepDetails?.whyItMatters}\n                  </p>\n                </div>\n                \n                <p className=\"text-sm font-semibold mb-1\" style={{ color: COLORS.TEXT }}>\n                  Target Rep:\n                </p>\n                <p className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                  {targetRepDetails ? targetRepDetails.name : (targetRep || 'No target rep set')}\n                </p>\n                \n                <div className=\"mt-4 p-4 rounded-lg border-2\" \n                    style={{ backgroundColor: `${COLORS.TEAL}10`, borderColor: `${COLORS.TEAL}30` }}>\n                  <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.TEAL }}>\n                    ✨ WHAT GREAT LOOKS LIKE:\n                  </p>\n                  <p className=\"text-sm italic\" style={{ color: COLORS.TEXT }}>\n                    {targetRepDetails?.whatGreatLooksLike}\n                  </p>\n                </div>\n                \n                {targetRepStatus === 'Pending' && (\n                  <Button \n                    onClick={handleCompleteTargetRepWithBonus} \n                    disabled={!canCompleteTargetRep}\n                    variant=\"primary\" \n                    size=\"md\" \n                    className=\"w-full mt-4\"\n                  >\n                    {isSavingRep ? 'Completing...' : '⚡ Complete Focus Rep'}\n                  </Button>\n                )}\n                {targetRepStatus === 'Committed' && (\n                  <div className=\"mt-4 p-3 rounded-lg text-center\" \n                      style={{ backgroundColor: `${COLORS.GREEN}20`, color: COLORS.GREEN }}>\n                    <strong>✓ Completed Today!</strong>\n                  </div>\n                )}\n                \n                {identityStatement && (\n                  <div className=\"mt-4 pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                    <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n                      🎯 TODAY'S FOCUS:\n                    </p>\n                    <p className=\"text-sm italic font-medium\" style={{ color: COLORS.TEXT }}>\n                      \"I am the kind of leader who {identityStatement}\"\n                    </p>\n                  </div>\n                )}\n              </Card>\n            )}\n\n            {/* 3. Daily Tasks - Replaces Social Pod per Arena v1.0 Scope */}\n            <DailyTasksCard\n              otherTasks={augmentedOtherTasks}\n              morningWIN={morningWIN}\n              winCompleted={dailyPracticeData?.morningBookend?.winCompleted || false}\n              onToggleTask={handleToggleTask}\n              onRemoveTask={handleRemoveTask}\n              onAddTask={handleAddTask}\n              onToggleWIN={handleToggleWIN}\n              onSaveWIN={handleSaveWINWithConfirmation}\n            />\n\n            {/* ===== BOSS V1 SCOPE: AI COACH DISABLED ===== */}\n            {/* AI Coach feature moved to future scope per boss requirements */}\n            {/* {featureFlags?.enableLabs && (\n              <MembershipGate requiredTier=\"elite\" featureName=\"AI Coaching Lab\">\n                <AICoachNudge \n                  onOpenLab={() => navigate('labs')} \n                  disabled={!(featureFlags?.enableLabs)}\n                />\n              </MembershipGate>\n            )} */}\n            \n            {/* 5. Additional Reps Card (if any) */}\n            {Array.isArray(additionalCommitments) && additionalCommitments.length > 0 && (\n              <AdditionalRepsCard\n                commitments={additionalCommitments}\n                onToggle={(id) => console.log('Toggle additional rep:', id)}\n                repLibrary={getArrayFromMetadata('REP_LIBRARY')}\n              />\n            )}\n\n          </div>\n\n          {/* === 40% \"ACTION\" COLUMN (RIGHT) === */}\n          <div className=\"space-y-6\">\n\n            {/* 1. AM/PM Bookends */}\n            <DynamicBookendContainer\n              morningProps={{\n                dailyWIN: morningWIN,\n                setDailyWIN: setMorningWIN,\n                otherTasks: augmentedOtherTasks,\n                onAddTask: handleAddTask,\n                onToggleTask: handleToggleTask,\n                onRemoveTask: handleRemoveTask,\n                showLIS: showLIS,\n                setShowLIS: setShowLIS,\n                identityStatement: identityStatement,\n                onSave: handleSaveMorningWithConfirmation,\n                onSaveWIN: handleSaveWINWithConfirmation,\n                onToggleWIN: handleToggleWIN,\n                isSaving: isSavingBookend,\n                completedAt: dailyPracticeData?.morningBookend?.completedAt?.toDate?.() || null,\n                winCompleted: dailyPracticeData?.morningBookend?.winCompleted\n              }}\n              eveningProps={{\n                reflectionGood: reflectionGood,\n                setReflectionGood: setReflectionGood,\n                reflectionBetter: reflectionBetter,\n                setReflectionBetter: setReflectionBetter,\n                reflectionBest: reflectionBest,\n                setReflectionBest: setReflectionBest,\n                habitsCompleted: habitsCompleted,\n                onHabitToggle: handleHabitToggle,\n                onSave: handleSaveEveningWithConfirmation,\n                onNavigate: navigate,\n                amWinCompleted: amWinCompleted,\n                amTasksCompleted: amTasksCompleted,\n              }}\n              dailyPracticeData={sanitizeTimestamps(dailyPracticeData)}\n            />\n\n            {/* 2. Developer Mode: Test Utilities Button */}\n            {isDeveloperMode && (\n              <div className=\"text-center\">\n                  <Button onClick={() => setShowTestUtils(true)} variant=\"nav-back\" size=\"sm\" className=\"w-full\">\n                      <Shield className=\"w-4 h-4 mr-2 text-red-500\" /> Test Utilities (Developer)\n                  </Button>\n              </div>\n            )}\n\n          </div>\n        </div>\n      </div>\n\n      {/* --- MODALS --- */}\n      \n      {/* NEW: Floating Anchor Button (FAB) - MORE VISIBLE - CORPORATE COLORS */}\n      <button \n        onClick={handleOpenAnchorEditor}\n        className={`fixed bottom-6 right-6 z-50 flex items-center px-6 py-3 rounded-full font-bold text-white shadow-xl transition-all duration-300 hover:scale-[1.05] \n            ${!isFullyDefined ? 'animate-bounce' : 'opacity-90'}`}\n        style={{ \n            backgroundColor: !isFullyDefined ? COLORS.ORANGE : COLORS.TEAL,\n            boxShadow: `0 8px 20px ${!isFullyDefined ? COLORS.ORANGE : COLORS.TEAL}80` \n        }}\n      >\n        <Anchor className={`w-5 h-5 mr-3 ${!isFullyDefined ? 'animate-pulse' : ''}`} />\n        {isFullyDefined ? 'Edit Your Anchors' : 'DEFINE YOUR ANCHORS!'}\n      </button>\n\n      {/* UNIFIED Anchor Editor Modal */}\n      {showAnchorEditor && (\n        <UnifiedAnchorEditorModal\n          initialIdentity={identityStatement}\n          initialHabit={habitAnchor}\n          initialWhy={whyStatement}\n          identitySuggestions={identitySuggestions}\n          habitSuggestions={habitSuggestions}\n          whySuggestions={whySuggestions}\n          onSave={handleSaveAllAnchors}\n          onClose={() => setShowAnchorEditor(false)}\n        />\n      )}\n      \n      {/* NEW: Test Utilities Modal */}\n      {showTestUtils && (\n        <TestUtilsModal\n      onDeletePlan={handleDeletePlanAndReset}\n      onClose={() => setShowTestUtils(false)}\n      membershipData={membershipData}\n      updateMembershipData={updateMembershipData}\n        />\n      )}\n      \n      {/* Pod Modal */}\n      {showFindPodModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl p-6 max-w-lg w-full max-h-[80vh] overflow-hidden flex flex-col\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                Find an Accountability Pod\n              </h2>\n              <button onClick={() => setShowFindPodModal(false)} className=\"p-1 rounded-full hover:bg-gray-100\">\n                <X className=\"w-5 h-5\" style={{ color: COLORS.MUTED }} />\n              </button>\n            </div>\n            \n            {isLoadingPods ? (\n              <div className=\"flex flex-col items-center justify-center h-64\">\n                <Loader className=\"animate-spin h-10 w-10\" style={{ color: COLORS.TEAL }} />\n                <p className=\"mt-3 font-semibold\" style={{ color: COLORS.MUTED }}>\n                  Searching for available pods...\n                </p>\n              </div>\n            ) : (\n              <div className=\"overflow-y-auto flex-1 space-y-3\">\n                <p className=\"text-sm mb-3\" style={{ color: COLORS.TEXT }}>\n                  Found {availablePods.length} pods. Request to join a group to stay accountable.\n                </p>\n                {availablePods.map((pod) => (\n                  <div \n                    key={pod.id} \n                    className=\"flex justify-between items-center p-4 rounded-lg border\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                  >\n                    <div>\n                      <p className=\"font-bold\" style={{ color: COLORS.NAVY }}>{pod.name}</p>\n                      <p className=\"text-xs\" style={{ color: COLORS.MUTED }}>\n                        <Users className=\"w-3 h-3 inline-block mr-1\" /> {pod.members} members\n                        <Send className=\"w-3 h-3 inline-block ml-3 mr-1\" /> {pod.activity} activity\n                      </p>\n                    </div>\n                    <Button variant=\"outline\" size=\"sm\">\n                      Request to Join\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Bonus Exercise Modal */}\n      {showBonusExercise && bonusExerciseData && (\n        <BonusExerciseModal\n          exercise={bonusExerciseData}\n          onComplete={handleCompleteBonusExercise}\n          onSkip={() => setShowBonusExercise(false)}\n        />\n      )}\n      \n      <SaveIndicator show={showSaveConfirmation} message={saveMessage} />\n    </div>\n  );\n};\n\n// --- NEW TEST UTILS MODAL (Defined locally for Dashboard) ---\nconst TestUtilsModal = ({ onDeletePlan, onClose, membershipData, updateMembershipData }) => {\n  const [confirmDelete, setConfirmDelete] = useState(false);\n  const [statusMessage, setStatusMessage] = useState('');\n  const [isSettingTier, setIsSettingTier] = useState(false);\n\n  const safeMembership = membershipData || {};\n\n  const handleSetTier = async (tier) => {\n    if (!updateMembershipData) {\n      setStatusMessage('updateMembershipData not available');\n      return;\n    }\n    setIsSettingTier(true);\n    setStatusMessage('Setting tier...');\n    try {\n      const ok = await updateMembershipData({ currentTier: tier, lastUpdated: new Date().toISOString() });\n      if (ok) {\n        setStatusMessage(`membership.currentTier set to '${tier}'`);\n      } else {\n        setStatusMessage('Failed to update membership (false returned)');\n      }\n    } catch (err) {\n      console.error('[TestUtils] Error setting tier:', err);\n      setStatusMessage('Error updating membershipData');\n    } finally {\n      setIsSettingTier(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl p-6 max-w-md w-full\">\n        <h2 className=\"text-2xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n          ⚙️ Test Utilities (Danger Zone)\n        </h2>\n        <p className=\"text-sm text-red-600 mb-4\">\n          WARNING: These actions are for debugging and QA only.\n        </p>\n\n        <div className=\"mb-4\">\n          <p className=\"text-sm font-semibold\">Membership Snapshot</p>\n          <pre className=\"text-xs p-3 mt-2 bg-gray-50 rounded\" style={{ maxHeight: 160, overflow: 'auto' }}>{JSON.stringify(safeMembership, null, 2)}</pre>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-2 mb-3\">\n          <Button onClick={() => handleSetTier('professional')} variant=\"primary\" size=\"sm\" className=\"w-full\" disabled={isSettingTier}>\n            Set Tier: Professional\n          </Button>\n          <Button onClick={() => handleSetTier('basic')} variant=\"outline\" size=\"sm\" className=\"w-full\" disabled={isSettingTier}>\n            Set Tier: Basic\n          </Button>\n        </div>\n\n        {statusMessage && (\n          <div className=\"mb-3 text-sm text-gray-700\">Status: {statusMessage}</div>\n        )}\n\n        {confirmDelete ? (\n          <>\n            <p className=\"text-base font-semibold mb-3\">\n              Are you sure? This will delete all plan and daily rep progress.\n            </p>\n            <Button onClick={onDeletePlan} variant=\"danger\" size=\"md\" className=\"w-full mb-2\">\n              <Trash2 className=\"w-4 h-4 mr-2\" /> Yes, Delete Plan & Reset\n            </Button>\n            <Button onClick={() => setConfirmDelete(false)} variant=\"outline\" size=\"sm\" className=\"w-full\">\n              Cancel\n            </Button>\n          </>\n        ) : (\n          <Button onClick={() => setConfirmDelete(true)} variant=\"secondary\" size=\"md\" className=\"w-full\">\n            Delete Plan and Start Over\n          </Button>\n        )}\n\n        <div className=\"pt-4 mt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n          <Button onClick={onClose} variant=\"ghost\" size=\"sm\" className=\"w-full\">Close</Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Dashboard;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/DebugDataViewer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/DevelopmentPlan.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":101,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/DevelopmentPlan.jsx\n// Parent container for the Development Plan flow (no-regression, single-CTA per screen)\n// Wires: BaselineAssessment → PlanTracker → ProgressScan (+ optional Detail/Timeline/Quick Edit inside children)\n// FIXED: Added adapter layer to transform Firebase focusAreas ↔ component coreReps\n// FIXED (10/30/25): Removed manual setView('tracker') to fix race condition (Req #16)\n// FINAL FIX (10/30/25): Added robust logic to auto-set first target rep on new plan creation (Issue 4).\n// SENTINEL FIX (10/30/25): Sentinels are stripped in useAppServices.jsx listeners, NOT in write operations\n// 🛑 CRITICAL FIX (10/30/25): Refactored writeDevPlan to only adapt the currentPlan sub-object.\n\nimport React, { useMemo, useState, useEffect } from 'react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport BaselineAssessment from './developmentplan/BaselineAssessment';\nimport PlanTracker from './developmentplan/PlanTracker';\nimport ProgressScan from './developmentplan/ProgressScan';\nimport DetailedPlanView from './developmentplan/DetailedPlanView';\nimport MilestoneTimeline from './developmentplan/MilestoneTimeline';\nimport { Button, Card, EmptyState } from './developmentplan/DevPlanComponents';\nimport { generatePlanFromAssessment, normalizeSkillCatalog } from './developmentplan/devPlanUtils';\n\n// FIXED: Import adapter utilities\nimport { \n  adaptDevelopmentPlanData,\n  adaptComponentPlanToFirebase,\n  buildVirtualSkillCatalog\n} from '../../utils/devPlanAdapter';\nimport { doc, getDoc } from 'firebase/firestore';\n\n// Simple guard wrapper\nconst LoadingBlock = ({ title = 'Loading…', description = 'Preparing your development plan...' }) => (\n  <div className=\"max-w-3xl mx-auto p-6\">\n    <Card accent=\"TEAL\">\n      <h2 className=\"text-xl font-extrabold mb-2\"> {title} </h2>\n      <p className=\"text-gray-600\">{description}</p>\n    </Card>\n  </div>\n);\n\n// --- NEW HELPER (10/30/25) ---\n// Finds the first rep matching the plan's first focus area and saves it\nconst findAndSetTargetRep = async (newPlan, metadata, writer) => {\n  if (!newPlan || !newPlan.focusAreas || newPlan.focusAreas.length === 0) {\n    console.log('[DevPlan] No focus areas in new plan, cannot set target rep.');\n    return;\n  }\n  // Use REP_LIBRARY (from image_b9f3bd.png)\n  if (!metadata || !metadata.REP_LIBRARY || !metadata.REP_LIBRARY.items) {\n    console.warn('[DevPlan] REP_LIBRARY not found in metadata, cannot set target rep.');\n    return;\n  }\n  if (typeof writer !== 'function') {\n    console.warn('[DevPlan] Daily practice writer function not available.');\n    return;\n  }\n\n  try {\n    // 1. Get the category from the first focus area\n    // NOTE: This assumes the focusAreas array contains objects with a 'category' key.\n    // The simplified format from generatePlanFromAssessment returns an array of strings (e.g., ['People Development'])\n    const firstFocusAreaCategory = newPlan.focusAreas[0];\n    \n    // DEBUG LOGGING ADDED FOR ISSUE 4\n    console.log(`[DevPlan Target Rep] Searching for category: ${firstFocusAreaCategory}`);\n    console.log(`[DevPlan Target Rep] REP_LIBRARY size: ${metadata.REP_LIBRARY.items.length}`);\n    \n    if (!firstFocusAreaCategory) {\n      console.warn('[DevPlan] First focus area has no category. Cannot find rep. Check skill_catalog data.');\n      return;\n    }\n\n    // 2. Find a rep in the library that matches that category\n    const repLibrary = metadata.REP_LIBRARY.items;\n    const matchingRep = repLibrary.find(rep => rep.category === firstFocusAreaCategory);\n\n    // 3. Save that rep's ID to dailyPracticeData\n    if (matchingRep) {\n      const newRepId = matchingRep.id || matchingRep.repId; // 'id' is seen in image_b9f3bd.png\n      if (newRepId) {\n        console.log(`[DevPlan] Setting new dailyTargetRepId: ${newRepId}`);\n        // Reset status to pending when a new rep is assigned\n        await writer({ \n          dailyTargetRepId: newRepId,\n          dailyTargetRepStatus: 'Pending',\n          dailyTargetRepDate: null,\n        });\n        console.log('[DevPlan] Target rep set successfully.');\n      } else {\n        console.warn('[DevPlan] Matching rep found but has no ID.');\n      }\n    } else {\n      console.warn(`[DevPlan] No rep found in REP_LIBRARY with category: ${firstFocusAreaCategory}`);\n    }\n  } catch (e) {\n    console.error('[DevPlan] Error setting target rep:', e);\n  }\n};\n\n\nexport default function DevelopmentPlan() {\n  const services = useAppServices();\n  const {\n    db, userId, isAuthReady, isLoading: isServicesLoading, navigate,\n    developmentPlanData, updateDevelopmentPlanData, \n    // FIXED: Add writer for dailyPracticeData\n    updateDailyPracticeData: updateDailyPracticeWriter,\n    metadata: globalMetadata\n  } = services || {};\n\n  // Helpers\n  const skillCatalog = useMemo(() => normalizeSkillCatalog(globalMetadata), [globalMetadata]);\n\n  // FIXED: Adapt Firebase data to component format\n  const adaptedDevelopmentPlanData = useMemo(() => {\n    if (!developmentPlanData) return null;\n    \n    console.log('[DevelopmentPlan] Adapting Firebase data:', {\n      hasCurrentPlan: !!developmentPlanData.currentPlan,\n      hasFocusAreas: !!developmentPlanData.currentPlan?.focusAreas,\n      assessmentCount: developmentPlanData.assessmentHistory?.length || 0\n    });\n    \n    const adapted = adaptDevelopmentPlanData(developmentPlanData);\n    \n    console.log('[DevelopmentPlan] Adapted data:', {\n      hasCurrentPlan: !!adapted?.currentPlan,\n      hasCoreReps: !!adapted?.currentPlan?.coreReps,\n      coreRepsCount: adapted?.currentPlan?.coreReps?.length || 0\n    });\n    \n    return adapted;\n  }, [developmentPlanData]);\n\n  // Build virtual skill catalog from current plan\n  const virtualSkillCatalog = useMemo(() => {\n    if (!adaptedDevelopmentPlanData?.currentPlan) return [];\n    const focusAreas = adaptedDevelopmentPlanData.currentPlan._originalFocusAreas \n      || adaptedDevelopmentPlanData.currentPlan.focusAreas;\n    return focusAreas ? buildVirtualSkillCatalog({ focusAreas }) : [];\n  }, [adaptedDevelopmentPlanData?.currentPlan]);\n\n  // Combine actual and virtual skill catalogs\n  const combinedSkillCatalog = useMemo(() => {\n    if (skillCatalog.length > 0 && virtualSkillCatalog.length > 0) {\n      console.log('[DevelopmentPlan] Merging skill catalogs:', {\n        actual: skillCatalog.length,\n        virtual: virtualSkillCatalog.length\n      });\n      // Prefer virtual (from plan) since it's current\n      return virtualSkillCatalog;\n    }\n    return virtualSkillCatalog.length > 0 ? virtualSkillCatalog : skillCatalog;\n  }, [skillCatalog, virtualSkillCatalog]);\n\n  // Local view-state (router-in-component)\n  // tracker | baseline | scan | detail | timeline\n  const hasCurrentPlan = !!(adaptedDevelopmentPlanData && adaptedDevelopmentPlanData.currentPlan);\n  const [view, setView] = useState(hasCurrentPlan ? 'tracker' : 'baseline');\n  const [isSaving, setIsSaving] = useState(false); // Used to detect in-progress save\n  const [error, setError] = useState(null);\n\n  // Sync view with live snapshots as they arrive\n  useEffect(() => {\n    // This effect now correctly handles the navigation *after* data is received\n    if (adaptedDevelopmentPlanData?.currentPlan && view === 'baseline') {\n      console.log('[DevelopmentPlan] Data updated, switching view to tracker.');\n      setView('tracker');\n      return;\n    }\n    \n    // FIX: Add !isSaving condition to prevent race condition reversion.\n    if (!adaptedDevelopmentPlanData?.currentPlan && view === 'tracker' && !isSaving) {\n      console.log('[DevelopmentPlan] No current plan, switching view to baseline.');\n      setView('baseline');\n    }\n  }, [adaptedDevelopmentPlanData?.currentPlan, view, isSaving]); // ADDED 'isSaving' to dependencies\n\n  const writeDevPlan = async (payload, { merge = true } = {}) => {\n    setIsSaving(true);\n    setError(null);\n    try {\n      // 🛑 CRITICAL FIX: Ensure only the currentPlan sub-object is adapted if needed.\n      // We start with the payload and modify currentPlan if it is an existing/edited plan.\n      let firebasePayload = { ...payload }; \n      \n      if (firebasePayload.currentPlan) {\n        if (firebasePayload.currentPlan._source === 'generation') {\n          // New plan: It's already in the Firebase focusAreas format. We use it as-is.\n          console.log('[DevelopmentPlan] Skipping adapter for new plan, using direct format.');\n          // We must remove the temporary flag before saving.\n          delete firebasePayload.currentPlan._source;\n        } else if (firebasePayload.currentPlan.coreReps) {\n          // Edited plan: It's in component (coreReps) format and needs conversion back.\n          console.log('[DevelopmentPlan] Converting existing plan (coreReps) to Firebase format.');\n          // The adapter is now correctly applied to the sub-object only.\n          firebasePayload.currentPlan = adaptComponentPlanToFirebase(firebasePayload.currentPlan);\n        }\n      }\n      \n      // NOTE: Do NOT strip sentinels here! Firebase needs them to process server-side operations.\n      // Sentinels are stripped in the listeners (useAppServices.jsx) when data comes back.\n      \n      if (typeof updateDevelopmentPlanData === 'function') {\n        // Now updateDevelopmentPlanData receives the correctly structured top-level object\n        const ok = await updateDevelopmentPlanData(firebasePayload, { merge });\n        if (ok === false) {\n          console.warn('[DevelopmentPlan] updateDevelopmentPlanData returned false; continuing as best-effort.');\n        }\n      } else {\n        console.error('[DevelopmentPlan] updateDevelopmentPlanData is not available.');\n        setError(new Error('Writer unavailable.'));\n        setIsSaving(false);\n        return false;\n      }\n    } catch (e) {\n      console.error('[DevelopmentPlan] Write failed:', e);\n      setError(e);\n      setIsSaving(false);\n      return false;\n    }\n    // IMPORTANT: Set isSaving to false AFTER the write is complete (success or fail)\n    // This allows the useEffect to run and re-check the data.\n    setIsSaving(false); \n    return true;\n  };\n\n\n// Read-after-write confirmation: check Firestore a few times for 'currentPlan'\nasync function confirmPlanPersisted(db, userId, retries = 4, delayMs = 250) {\n  try {\n    if (!db || !userId) return false;\n    // NOTE: This uses the direct path to the document\n    const ref = doc(db, `modules/${userId}/development_plan/current`); \n    for (let i = 0; i < retries; i++) {\n      const snap = await getDoc(ref);\n      // Check for document existence AND the currentPlan field inside it\n      if (snap.exists() && !!snap.data()?.currentPlan) return true; \n      await new Promise(r => setTimeout(r, delayMs));\n    }\n  } catch (e) {\n    console.warn('[DevelopmentPlan] confirmPlanPersisted error:', e);\n  }\n  return false;\n}\n\n  // ===== FLOW ACTIONS =====\n\n  // Baseline → Generate new plan then route to tracker\n  const handleCompleteBaseline = async (assessment) => {\n    const date = new Date().toISOString();\n    const newAssessment = { ...assessment, date };\n    \n    // Assumes generatePlanFromAssessment uses the *corrected* skill catalog\n    const newPlanRaw = generatePlanFromAssessment(newAssessment, combinedSkillCatalog);\n\n    // If an existing plan exists, bump cycle for the new plan & archive the old\n    const prevPlan = adaptedDevelopmentPlanData?.currentPlan;\n    const prevCycle = prevPlan?.cycle || adaptedDevelopmentPlanData?.cycle || 0;\n    \n    // 🛑 FIX: Flag the new plan so we can bypass the faulty adapter during save.\n    const newPlan = { \n        ...newPlanRaw, \n        cycle: (prevCycle || 0) + 1,\n        _source: 'generation' // <-- CRITICAL FLAG\n    };\n\n    // Build history arrays\n    const prevPlans = Array.isArray(adaptedDevelopmentPlanData?.previousPlans) ? adaptedDevelopmentPlanData.previousPlans.slice() : [];\n    if (prevPlan) {\n      prevPlans.push({\n        ...prevPlan,\n        endDate: new Date().toISOString(),\n        archivedAt: new Date().toISOString(),\n        status: 'archived'\n      });\n    }\n\n    const assessmentHistory = Array.isArray(adaptedDevelopmentPlanData?.assessmentHistory)\n      ? adaptedDevelopmentPlanData.assessmentHistory.slice()\n      : [];\n    assessmentHistory.push(newAssessment);\n\n    const payload = {\n      currentPlan: newPlan,\n      cycle: newPlan.cycle,\n      previousPlans: prevPlans,\n      assessmentHistory,\n      updatedAt: date\n    };\n\n    // The writeDevPlan sets isSaving=true, then to false after Firestore ACK.\n    const ok = await writeDevPlan(payload, { merge: true });\n    \n    if (ok) {\n      // FINAL FIX (Issue 4): Set the target rep\n      console.log('[DevelopmentPlan] Baseline saved. Setting target rep...');\n      await findAndSetTargetRep(newPlan, globalMetadata, updateDailyPracticeWriter);\n      \n      // REQ #16: FIX - Do not manually set view. Let the useEffect handle it.\n      setIsSaving(true);\n      const okPersisted = await confirmPlanPersisted(db, userId);\n      if (okPersisted) {\n        console.log('[DevelopmentPlan] Confirmed currentPlan via read-after-write. Switching to tracker.');\n        setView('tracker');\n      } else {\n        // NOTE: This optimistic switch is dangerous but necessary if the listener is slow.\n        console.warn('[DevelopmentPlan] Listener/read didn’t show currentPlan in time; switching to tracker optimistically.');\n        setView('tracker');\n      }\n      setIsSaving(false);\n    }\n  };\n\n  // ProgressScan → same pattern as baseline, but we show comparisons\n  const handleCompleteScan = async (newPlan, newAssessment) => {\n    const date = new Date().toISOString();\n    const withDate = { ...newAssessment, date };\n\n    const prevPlan = adaptedDevelopmentPlanData?.currentPlan;\n    const prevCycle = prevPlan?.cycle || adaptedDevelopmentPlanData?.cycle || 0;\n    \n    // 🛑 FLAG the new plan here as well\n    const withCycle = { \n        ...newPlan, \n        cycle: prevCycle + 1, \n        _source: 'generation' // <-- CRITICAL FLAG\n    }; // This is the new plan\n\n    const prevPlans = Array.isArray(adaptedDevelopmentPlanData?.previousPlans) ? adaptedDevelopmentPlanData.previousPlans.slice() : [];\n    if (prevPlan) {\n      prevPlans.push({\n        ...prevPlan,\n        endDate: date,\n        archivedAt: date,\n        status: 'archived'\n      });\n    }\n\n    const assessmentHistory = Array.isArray(adaptedDevelopmentPlanData?.assessmentHistory) ? adaptedDevelopmentPlanData.assessmentHistory.slice() : [];\n    assessmentHistory.push(withDate);\n\n    const payload = {\n      currentPlan: withCycle,\n      cycle: withCycle.cycle,\n      previousPlans: prevPlans,\n      assessmentHistory,\n      updatedAt: date\n    };\n\n    const ok = await writeDevPlan(payload, { merge: true });\n    \n    if (ok) {\n      // FINAL FIX (Issue 4): Set the target rep\n      console.log('[DevelopmentPlan] Scan saved. Setting target rep...');\n      await findAndSetTargetRep(withCycle, globalMetadata, updateDailyPracticeWriter);\n      \n      // REQ #16: FIX - Do not manually set view. Let the useEffect handle it.\n      console.log('[DevelopmentPlan] Waiting for data listener to switch view.');\n    }\n  };\n\n  const handleEditPlan = async (updatedPlan) => {\n    // NOTE: This plan is assumed to be in the component's 'coreReps' format,\n    // so it will hit the 'else if (coreReps)' conversion logic in writeDevPlan.\n    const payload = { currentPlan: updatedPlan, updatedAt: new Date().toISOString() };\n    const ok = await writeDevPlan(payload, { merge: true });\n    return ok;\n  };\n\n  // ===== GUARDS =====\n  if (!isAuthReady) return <LoadingBlock title=\"Authenticating…\" description=\"Connecting securely...\" />;\n  if (isServicesLoading) return <LoadingBlock title=\"Loading...\" />;\n  if (!services || !userId) return <LoadingBlock title=\"Services unavailable\" description=\"Please refresh or contact support.\" />;\n\n  // ===== RENDER =====\n  return (\n    <div className=\"min-h-screen\" style={{ background: 'linear-gradient(to bottom, #F9FAFB 0%, #EEF2F6 100%)' }}>\n      {error && (\n        <div className=\"max-w-3xl mx-auto p-4 pt-6\">\n          <div className=\"bg-red-50 border-2 border-red-200 rounded-xl p-4 text-red-800 shadow-lg\">\n            <strong className=\"font-bold\">Error:</strong> {error.message || String(error)}\n          </div>\n        </div>\n      )}\n\n      {view === 'baseline' && (\n        <BaselineAssessment\n          onComplete={handleCompleteBaseline}\n          isLoading={isSaving}\n        />\n      )}\n\n      {view === 'scan' && (\n        <ProgressScan\n          developmentPlanData={adaptedDevelopmentPlanData}\n          globalMetadata={globalMetadata}\n          skillCatalog={combinedSkillCatalog}\n          onCompleteScan={handleCompleteScan}\n          onBack={() => setView('tracker')}\n          isLoading={isSaving}\n        />\n      )}\n\n      {/* REQ #4 (BUG FIX): Updated props passed to DetailedPlanView */}\n      {view === 'detail' && (\n        <DetailedPlanView\n          developmentPlanData={adaptedDevelopmentPlanData}\n          globalMetadata={globalMetadata}\n          onUpdatePlan={handleEditPlan}\n          onNavigateToTracker={() => setView('tracker')}\n          onStartProgressScan={() => setView('scan')}\n        />\n      )}\n\n      {view === 'timeline' && (\n        <MilestoneTimeline\n          plan={adaptedDevelopmentPlanData?.currentPlan}\n          globalMetadata={globalMetadata}\n          onBack={() => setView('tracker')}\n        />\n      )}\n\n      {view === 'tracker' && (\n        <PlanTracker\n          plan={adaptedDevelopmentPlanData?.currentPlan}\n          cycle={adaptedDevelopmentPlanData?.cycle || 1}\n          globalMetadata={globalMetadata}\n          skillCatalog={combinedSkillCatalog}\n          onEditPlan={handleEditPlan}\n          onScan={() => setView('scan')}\n          onDetail={() => setView('detail')}\n          onTimeline={() => setView('timeline')}\n        />\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/ExecutiveReflection.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useState' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":246,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":246,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/ExecutiveReflection.jsx (Refactored for Consistency, Context)\n\nimport React, { useMemo, useState, useCallback, useEffect } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\nimport { DIMENSION_TO_TIER_MAP, CORPORATE_COLORS } from '../../data/Constants.js';\n\n// --- Icons ---\nimport {\n  BarChart3, TrendingUp, Target, ShieldCheck, Zap, TrendingDown, Cpu, Star, MessageSquare,\n  HeartPulse, Users, Lightbulb, X, CornerRightUp, Activity, Briefcase, Trello, Clock,\n  ChevronsRight, CheckCircle, Mic, Archive, Sparkles, Loader // Added Loader\n} from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = CORPORATE_COLORS;\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-screen flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/**\n * StatCard Component (Local Definition, Styled Consistently)\n * Displays a single key metric with an optional trend indicator.\n */\nconst StatCard = ({ icon: Icon, label, value, onClick, trend = 0, accent = 'NAVY', size = 'full', className = '', ...rest }) => {\n  const TrendIcon = trend > 0 ? TrendingUp : TrendingDown; // Determine trend icon\n  const showTrend = trend !== 0; // Only show if trend is non-zero\n  // Determine trend color based on value\n  const trendColor = trend > 0 ? COLORS.GREEN : trend < 0 ? COLORS.ORANGE : COLORS.MUTED;\n  // Determine card width class (simplified for this layout)\n  const widthClass = size === 'half' ? 'md:col-span-1' : (size === 'third' ? 'lg:col-span-1 md:col-span-2' : 'col-span-1'); // Adjust grid span\n\n  return (\n    // Use standard Card component as the base\n    <Card {...rest} icon={Icon} title={value} onClick={onClick} className={`${widthClass} ${className} ${onClick ? 'cursor-pointer' : ''}`} accent={accent}>\n      <div className=\"flex justify-between items-center -mt-1\">\n        {/* Label */}\n        <div className=\"flex-1 mr-2\">\n          <div className=\"text-xs font-medium text-gray-500 truncate\">{label}</div> {/* Smaller label, truncate */}\n        </div>\n        {/* Trend Indicator (Conditional) */}\n        {showTrend && (\n          <div className={`text-xs font-semibold flex items-center gap-1 flex-shrink-0`} style={{ color: trendColor }}>\n            {/* Trend Icon with Background */}\n            <span className={`p-0.5 rounded-full`} style={{ background: trend > 0 ? `${COLORS.GREEN}1A` : `${COLORS.ORANGE}1A` }}>\n              <TrendIcon size={12} strokeWidth={3} /> {/* Smaller icon */}\n            </span>\n            {/* Trend Value */}\n            <span className='font-bold'>{Math.abs(trend)}{label.includes(\"Reps Completed Today\") ? '' : '%'}</span> {/* Adjust unit based on label */}\n          </div>\n        )}\n      </div>\n      {/* Navigation Arrow (if clickable) */}\n      {onClick && <CornerRightUp className=\"absolute top-4 right-4 text-gray-300 group-hover:text-gray-500 transition-colors\" size={16} />}\n    </Card>\n  );\n};\n\n/* =========================================================\n   UTILITIES (Streak Calculation)\n========================================================= */\n\n/**\n * Calculates the current streak of consecutive days where all assigned reps were completed.\n * Looks back up to 7 days.\n * @param {Array} history - Array of daily practice history objects, typically from `dailyPracticeData.practiceHistory`.\n * Each object should have a `date` (YYYY-MM-DD) and `score` ('X/Y').\n * @returns {number} The current streak length (0-7).\n */\nfunction calculateStreak(history) { // cite: Original Dashboard Logic\n    let streak = 0;\n    const validHistory = Array.isArray(history) ? history : []; // Ensure it's an array\n    // Sort history descending by date to easily check previous days\n    const sortedHistory = [...validHistory].sort((a, b) => new Date(b.date) - new Date(a.date));\n\n    // Get today's date (at midnight UTC for consistent comparison)\n    const today = new Date();\n    today.setUTCHours(0, 0, 0, 0);\n\n    // Check completion for today and the previous 6 days\n    for (let i = 0; i < 7; i++) {\n        const checkDate = new Date(today);\n        checkDate.setUTCDate(today.getUTCDate() - i); // Go back i days\n        const dateString = checkDate.toISOString().split('T')[0]; // YYYY-MM-DD format\n\n        // Find the history entry for that date\n        const historyEntry = sortedHistory.find(h => h.date === dateString);\n\n        if (historyEntry) {\n            // Check if score indicates completion (e.g., '3/3', '1/1')\n            const scoreParts = (historyEntry.score || '0/1').split('/'); // Default to non-complete score\n            if (scoreParts.length === 2) {\n                const [committed, total] = scoreParts.map(Number);\n                // Check if all were committed AND there was at least one rep\n                if (committed === total && total > 0) {\n                    streak++; // Increment streak if complete\n                } else {\n                    break; // Streak broken if not complete\n                }\n            } else {\n                break; // Streak broken if score format is invalid\n            }\n        } else {\n            // Streak broken if no entry found for a past day (within the 7-day window)\n            // Allow streak to start today even if yesterday is missing\n            if (i > 0) break;\n        }\n    }\n    return streak;\n}\n\n/* =========================================================\n   LONGITUDINAL IMPACT DATA HOOK (UPDATED FOR NEW CONTEXT)\n========================================================= */\n\n/**\n * Custom Hook: useLongitudinalData\n * Calculates key long-term metrics based on user's practice history, assessments, and planning data.\n * @param {object} dailyPracticeData - Data from `useDailyPracticeData`.\n * @param {object} developmentPlanData - Data from `useDevelopmentPlanData`.\n * @param {object} strategicContentData - Data from `useStrategicContentData`.\n * @returns {object} An object containing calculated longitudinal metrics.\n */\nconst useLongitudinalData = (dailyPracticeData, developmentPlanData, strategicContentData) => { // cite: Original Logic, useAppServices.jsx for data sources\n  return useMemo(() => {\n    console.log(\"[useLongitudinalData] Recalculating...\");\n    // --- Safely Extract Input Data ---\n    // Practice History (Array of { date, score: 'X/Y', ... })\n    const history = dailyPracticeData?.practiceHistory || []; // cite: useAppServices.jsx (assumes practiceHistory field)\n    // Resilience Log (Object { date: { energy, focus, ... } }) - Placeholder structure\n    const resilienceLog = dailyPracticeData?.resilienceLog || {}; // cite: useAppServices.jsx (assumes resilienceLog field)\n    // Latest Assessment Scores (Object { dimension: { name, score, status }, ... })\n    const latestAssessment = developmentPlanData?.assessmentHistory?.[developmentPlanData.assessmentHistory.length - 1]; // cite: useAppServices.jsx\n    const selfRatings = latestAssessment?.scores || {}; // cite: useAppServices.jsx\n    // Planning Data (Mock values for now, replace with real fields if available)\n    // E.g., Number of pre-mortem audits conducted this quarter\n    const riskAudits = strategicContentData?.quarterlyRiskAudits || 5; // Placeholder // cite: useAppServices.jsx\n    // E.g., Number of OKRs significantly missed this quarter\n    const okrFailures = strategicContentData?.quarterlyOkrFailures || 1; // Placeholder // cite: useAppServices.jsx\n\n    // --- Calculate Metrics ---\n    // 1. Weakest Tier & Confidence (Self-Rating for that tier)\n    let weakestTierId = 'T1';\n    let selfRating = 3.0; // Default confidence score (out of 5)\n    if (Object.keys(selfRatings).length > 0) {\n        try {\n            const sorted = Object.values(selfRatings).sort((a,b) => a.score - b.score);\n            const weakestEntry = sorted[0];\n            if (weakestEntry) {\n                 selfRating = weakestEntry.score;\n                 // Attempt to find Tier ID (requires mapping or tierId on score object)\n                 // Assuming DIMENSION_TO_TIER_MAP is available or Tiers are in context\n                 weakestTierId = DIMENSION_TO_TIER_MAP[weakestEntry.name] || 'T1'; // Fallback\n            }\n        } catch (e) { console.error(\"Error processing selfRatings:\", e, selfRatings); }\n    }\n\n    // 2. Competence (Daily Execution Success Rate - last 90 days or available data)\n    const totalLoggedDays = history.length;\n    const windowSize = Math.min(totalLoggedDays, 90); // Look back max 90 days\n    let completedDays = 0;\n    if (windowSize > 0) {\n        completedDays = history.slice(-windowSize).filter(h => {\n            const parts = (h.score || '0/1').split('/');\n            return parts.length === 2 && Number(parts[0]) === Number(parts[1]) && Number(parts[1]) > 0;\n        }).length;\n    }\n    const competence = (completedDays / Math.max(1, windowSize)) * 100 || 0; // Avoid division by zero, default 0\n\n    // 3. Risk Reduction Score (Based on Pre-Mortems vs. Failures - Placeholder Logic)\n    const effectiveRiskAudits = Math.max(1, riskAudits);\n    const riskReduction = Math.max(0, Math.min(100, 100 - (okrFailures / effectiveRiskAudits) * 50)); // Scaled impact\n\n    // 4. Tier Mastery Projection (Days - Placeholder Logic)\n    // Simple heuristic: Faster mastery with higher competence\n    const tierMasteryProjection = Math.round(Math.max(30, 180 - competence * 1.5)) || 90; // Estimate days, min 30\n\n    // 5. Well-being vs. Performance (Placeholder Logic)\n    const lowEnergyDays = Object.values(resilienceLog).filter(log => log.energy < 5).length;\n    const totalResilienceEntries = Math.max(1, Object.keys(resilienceLog).length);\n    // Calculate average score across all history\n    const avgDailyScore = history.reduce((sum, h) => {\n        const parts = (h.score || '0/1').split('/');\n        const denominator = Number(parts[1]) || 1; // Avoid division by zero\n        return sum + (Number(parts[0]) / denominator);\n    }, 0) / Math.max(1, history.length);\n    // Estimate score drop based on frequency of low energy days (heuristic)\n    const avgScoreLowEnergyImpactFactor = 1 - (lowEnergyDays / totalResilienceEntries) * 0.3; // Max 30% drop estimate\n    const avgScoreLowEnergy = avgDailyScore * avgScoreLowEnergyImpactFactor;\n\n    // 6. Mentee Feedback (Placeholder - Assumes structure in developmentPlanData)\n    // This needs a real data source; using mock structure for now\n    const menteeFeedback = developmentPlanData?.menteeFeedback?.T4 || { score: 75, comment: \"Needs more consistent follow-up.\" }; // Example for T4\n\n    const result = {\n        weakestTierId,\n        confidence: selfRating, // Self-rating score (1-5)\n        competence: competence.toFixed(0), // Daily success rate % (0-100)\n        riskReduction: riskReduction.toFixed(0), // Risk mitigation effectiveness % (0-100)\n        tierMasteryProjection, // Estimated days to next tier\n        lowEnergyDays, // Count of low energy days logged\n        avgScoreLowEnergy: (avgScoreLowEnergy * 100).toFixed(0), // Avg score % adjusted for low energy\n        avgDailyScore: (avgDailyScore * 100).toFixed(0), // Overall avg score %\n        menteeFeedback, // Placeholder feedback object\n    };\n    console.log(\"[useLongitudinalData] Calculated metrics:\", result);\n    return result;\n\n  }, [dailyPracticeData, developmentPlanData, strategicContentData]); // Dependencies: Recalculate if source data changes\n};\n\n\n/* =========================================================\n   MAIN SCREEN COMPONENT: ExecutiveReflection (ROI Report)\n========================================================= */\nexport default function ExecutiveReflection() {\n    // --- Consume Services ---\n    const {\n        navigate, user, // Core context\n        isLoading: isAppLoading, error: appError, // App loading/error state\n        dailyPracticeData, developmentPlanData, strategicContentData, // Renamed user data // cite: useAppServices.jsx\n        LEADERSHIP_TIERS, // Global metadata // cite: useAppServices.jsx\n        // Mock data source for stats - replace later\n        // MOCK_ACTIVITY_DATA (Removed - Define stats locally or fetch properly)\n    } = useAppServices();\n\n    // --- Effect for scrolling to top ---\n    useEffect(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, []);\n\n    // --- Calculate Longitudinal Data ---\n    // This hook processes data from the context hooks\n    const longitudinalData = useLongitudinalData(dailyPracticeData, developmentPlanData, strategicContentData); // cite: useLongitudinalData (above)\n\n    // --- Calculate Scorecard Stats (Using Context Data) ---\n    // Reps Completed Today (Target + Additional)\n    const todayStr = useMemo(() => new Date().toISOString().split('T')[0], []);\n    const targetRepCompletedToday = dailyPracticeData?.dailyTargetRepStatus === 'Committed' && dailyPracticeData?.dailyTargetRepDate === todayStr; // cite: useAppServices.jsx\n    const additionalCompletedToday = useMemo(() => (dailyPracticeData?.activeCommitments || []).filter(c => c.status === 'Committed').length, [dailyPracticeData]); // cite: useAppServices.jsx\n    const commitsCompletedToday = (targetRepCompletedToday ? 1 : 0) + additionalCompletedToday; // cite: Dashboard.jsx (logic)\n    // Total Reps Assigned Today\n    const targetRepAssignedToday = !!dailyPracticeData?.dailyTargetRepId && dailyPracticeData?.dailyTargetRepDate === todayStr; // cite: useAppServices.jsx\n    const additionalAssignedToday = useMemo(() => (dailyPracticeData?.activeCommitments || []).length, [dailyPracticeData]); // cite: useAppServices.jsx\n    const commitsTotalToday = (targetRepAssignedToday ? 1 : 0) + additionalAssignedToday; // cite: Dashboard.jsx (logic)\n\n    // Current Streak (Calculated from practice history)\n    const perfectStreak = useMemo(() => calculateStreak(dailyPracticeData?.practiceHistory || []), [dailyPracticeData?.practiceHistory]); // cite: calculateStreak (above), useAppServices.jsx\n\n    // --- Placeholder Stats (Replace with real data sources) ---\n    // These need to be sourced from aggregated data (e.g., Firestore aggregation, separate stats doc)\n    const totalRepsCompletedAllTime = dailyPracticeData?.stats?.totalRepsCompleted || 128; // Example: Read from stats field\n    const totalCoachingLabsCompleted = dailyPracticeData?.practiceHistory?.length || 5; // Count lab history entries // cite: useAppServices.jsx\n\n    // Development Plan Progress\n    const currentDevPlanCycle = developmentPlanData?.currentCycle || 1; // cite: useAppServices.jsx\n    const totalCycles = 6; // Based on JOURNEY_MAP in Dev Plan // cite: DevelopmentPlan.jsx (constant)\n    const roadmapProgressPercent = Math.round((currentDevPlanCycle / totalCycles) * 100);\n\n    // Strategic Content (OKRs) - Placeholder\n    const okrsDefined = strategicContentData?.okrs?.length || 3; // cite: useAppServices.jsx\n    const okrsAtRisk = (strategicContentData?.okrs || []).filter(o => (o.progress || 0) < 0.5).length; // Mock progress check // cite: PlanningHub.jsx (mock logic)\n\n    // Weakest Tier Meta\n    const weakestTierMeta = useMemo(() => LEADERSHIP_TIERS?.[longitudinalData.weakestTierId] || { name: 'N/A', hex: COLORS.MUTED }, [longitudinalData.weakestTierId, LEADERSHIP_TIERS]); // cite: useAppServices.jsx\n\n    // --- Navigation Handler ---\n    const handleNavigation = useCallback((screen, params = {}) => {\n        console.log(`[ExecutiveReflection] Navigating to ${screen} with params:`, params);\n        navigate(screen, params); // Use navigate from context // cite: useAppServices.jsx\n    }, [navigate]); // Dependency: navigate function\n\n\n    // --- Render Logic ---\n    if (isAppLoading) return <LoadingSpinner message=\"Loading Executive ROI Report...\" />;\n    if (appError) return <ConfigError message={`Failed to load report data: ${appError.message}`} />;\n\n    return (\n        // Consistent page structure and padding\n        <div className={`p-6 md:p-8 lg:p-10 min-h-screen space-y-8`} style={{ background: COLORS.BG }}> {/* Use BG color */}\n\n            {/* --- Section 1: Header --- */}\n            <header>\n                 <h1 className={`text-3xl md:text-4xl font-extrabold mb-2`} style={{ color: COLORS.NAVY }}>Executive ROI Report</h1>\n                 <p className=\"text-lg text-gray-700 max-w-3xl\">Data-driven insights into your leadership development progress and impact (Last 90 Days).</p>\n            </header>\n\n            {/* --- Section 2: Performance Scorecard --- */}\n             <Card title=\"Performance Scorecard\" icon={Activity} accent='PURPLE'>\n                 <p className='text-sm text-gray-700 mb-6'>Key metrics summarizing recent activity and progress.</p>\n                 {/* Grid for Stat Cards */}\n                 <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    {/* Reps Today */}\n                    <StatCard icon={CheckCircle} label=\"Reps Completed Today\" value={`${commitsCompletedToday} / ${commitsTotalToday}`} onClick={() => handleNavigation('daily-practice')} accent='ORANGE' trend={commitsCompletedToday > 0 ? 5 : 0} />\n                    {/* Streak */}\n                    <StatCard icon={Star} label=\"Current Streak\" value={`${perfectStreak} Days`} onClick={() => handleNavigation('daily-practice')} accent='AMBER' trend={perfectStreak * 2} />\n                    {/* Total Reps */}\n                    <StatCard icon={ChevronsRight} label=\"Total Reps Logged\" value={`${totalRepsCompletedAllTime}`} onClick={() => handleNavigation('daily-practice')} accent='TEAL' trend={totalRepsCompletedAllTime > 100 ? 10 : 0} />\n                    {/* Weakest Tier */}\n                     <StatCard icon={Target} label=\"Current Focus Tier\" value={`${weakestTierMeta?.name || 'N/A'}`} onClick={() => handleNavigation('development-plan')} accent='RED' />\n                    {/* Coaching Labs */}\n                     <StatCard icon={Mic} label=\"Coaching Labs Done\" value={`${totalCoachingLabsCompleted}`} onClick={() => handleNavigation('coaching-lab')} accent='PURPLE' trend={totalCoachingLabsCompleted * 5} />\n                    {/* Roadmap Progress */}\n                     <StatCard icon={Briefcase} label=\"Dev Plan Progress\" value={`${roadmapProgressPercent}%`} onClick={() => handleNavigation('development-plan')} accent='NAVY' trend={roadmapProgressPercent / 10} />\n                    {/* OKRs At Risk */}\n                    <StatCard icon={Archive} label=\"OKRs At Risk\" value={`${okrsAtRisk} / ${okrsDefined}`} onClick={() => handleNavigation('planning-hub')} accent='BLUE' trend={okrsAtRisk > 0 ? -okrsAtRisk * 10 : 0} />\n                     {/* AI Reflection Summary (Placeholder Link) */}\n                    <StatCard icon={Lightbulb} label=\"AI Reflection Insights\" value={`View`} onClick={() => handleNavigation('coaching-lab', { view: 'reflection-summary' })} accent='NAVY' />\n                 </div>\n             </Card>\n\n            {/* --- Section 3: Longitudinal Impact Grid --- */}\n            <h2 className='text-2xl font-extrabold pt-4 border-t mt-10' style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>Longitudinal Impact (90-Day View)</h2>\n            <div className='grid grid-cols-1 lg:grid-cols-3 gap-8'>\n                {/* 1. Confidence vs. Competence */}\n                <Card title=\"Confidence vs. Competence\" icon={Target} accent='TEAL' className='lg:col-span-2'>\n                    <p className='text-sm text-gray-700 mb-4'>Self-perception (Assessment Score) vs. Proven capability (Daily Rep Execution %).</p>\n                    <div className='grid grid-cols-2 gap-4 text-center'>\n                        {/* Confidence */}\n                        <div className={`p-4 rounded-xl border-2 bg-white shadow-inner`} style={{ borderColor: COLORS.NAVY }}>\n                            <p className='text-xs font-semibold uppercase text-gray-500'>Confidence</p>\n                            <p className={`text-4xl font-extrabold mt-1`} style={{ color: COLORS.NAVY }}>{longitudinalData.confidence.toFixed(1)}<span className=\"text-2xl text-gray-400\">/5</span></p>\n                            <p className='text-[10px] text-gray-500'>(Latest Self-Assessment)</p>\n                        </div>\n                        {/* Competence */}\n                        <div className={`p-4 rounded-xl border-2 bg-white shadow-inner`} style={{ borderColor: COLORS.TEAL }}>\n                            <p className='text-xs font-semibold uppercase text-gray-500'>Competence</p>\n                            <p className={`text-4xl font-extrabold mt-1`} style={{ color: COLORS.TEAL }}>{longitudinalData.competence}%</p>\n                             <p className='text-[10px] text-gray-500'>(Daily Rep Success Rate)</p>\n                        </div>\n                    </div>\n                    {/* AI Insight */}\n                    <div className={`mt-6 p-3 rounded-lg border`} style={{ background: COLORS.TEAL + '10', borderColor: COLORS.TEAL + '30', color: COLORS.NAVY }}>\n                        <p className='font-semibold text-sm flex items-center gap-1.5'><Cpu className='w-4 h-4 text-[#47A88D]'/> AI Rep Coach Insight:</p>\n                        <p className='text-xs mt-1 italic'>\n                            {longitudinalData.confidence >= 4 && Number(longitudinalData.competence) < 75 ? // Adjusted threshold\n                                `High confidence, moderate execution. Focus daily reps on bridging the gap in ${weakestTierMeta.name}. Consistency is key.` :\n                            longitudinalData.confidence < 3.5 && Number(longitudinalData.competence) >= 75 ?\n                                `Strong execution, lower self-rating. Recognize your progress in ${weakestTierMeta.name}! What evidence supports higher confidence?` :\n                                `Good alignment between perception and practice. Continue disciplined execution to master ${weakestTierMeta.name}.`\n                            }\n                        </p>\n                    </div>\n                </Card>\n\n                {/* 2. Risk Reduction */}\n                <Card title=\"Risk Reduction Scorecard\" icon={ShieldCheck} accent='ORANGE'>\n                    <p className='text-sm text-gray-700 mb-4'>Impact of Pre-Mortem Audits on mitigating strategic failures (Placeholder calculation).</p>\n                    <div className='text-center mb-4'>\n                        <p className='text-xs font-semibold uppercase text-gray-500'>Risk Mitigation Impact</p>\n                        <p className={`text-5xl font-extrabold mt-1`} style={{ color: Number(longitudinalData.riskReduction) < 80 ? COLORS.ORANGE : COLORS.GREEN }}>\n                            {longitudinalData.riskReduction}%\n                        </p>\n                    </div>\n                    <div className='mt-4 pt-4 border-t border-gray-200'>\n                        <p className='text-sm font-semibold' style={{ color: COLORS.NAVY }}>Tier Mastery Projection:</p>\n                        <p className='text-sm text-gray-700'>\n                            Est. <strong className='text-lg'>{longitudinalData.tierMasteryProjection}</strong> days to master <strong style={{ color: weakestTierMeta.hex }}>{weakestTierMeta.name}</strong> based on current execution rate.\n                        </p>\n                         <Button onClick={() => handleNavigation('planning-hub', { view: 'pre-mortem' })} variant=\"outline\" size=\"sm\" className=\"w-full mt-3 !border-orange-300 !text-orange-600 hover:!bg-orange-50\">\n                             Go to Pre-Mortem Tool\n                         </Button>\n                    </div>\n                </Card>\n\n                {/* 3. Performance vs. Well-being */}\n                <Card title=\"Performance vs. Well-being\" icon={HeartPulse} accent='RED'>\n                     <p className='text-sm text-gray-700 mb-4'>Correlation between daily energy/focus (if logged) and rep completion rate.</p>\n                     {/* Score Comparison */}\n                     <div className=\"grid grid-cols-2 gap-4 text-center mb-4\">\n                         <div className=\"p-3 bg-gray-50 border rounded-lg\">\n                             <p className=\"text-xs text-gray-500 uppercase font-semibold\">Overall Avg Score</p>\n                             <p className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>{longitudinalData.avgDailyScore}%</p>\n                         </div>\n                         <div className=\"p-3 bg-gray-50 border rounded-lg\">\n                             <p className=\"text-xs text-gray-500 uppercase font-semibold\">Avg on Low Energy Days</p>\n                             <p className={`text-2xl font-bold ${Number(longitudinalData.avgScoreLowEnergy) < Number(longitudinalData.avgDailyScore) ? 'text-red-600' : 'text-green-600'}`}>{longitudinalData.avgScoreLowEnergy}%</p>\n                         </div>\n                     </div>\n                     {/* AI Insight */}\n                     <div className={`mt-4 p-3 rounded-lg border`} style={{ background: COLORS.RED + '10', borderColor: COLORS.RED + '30', color: COLORS.NAVY }}>\n                         <p className='font-semibold text-sm flex items-center gap-1.5'><MessageSquare className='w-4 h-4 text-[#E04E1B]'/> AI Rep Coach Insight:</p>\n                         <p className='text-xs mt-1 italic'>\n                            { (longitudinalData.lowEnergyDays / Math.max(1, Object.keys(dailyPracticeData?.resilienceLog || {}).length)) > 0.3 ? // Check if >30% days are low energy\n                                `Significant drop (${Number(longitudinalData.avgDailyScore) - Number(longitudinalData.avgScoreLowEnergy)} pts) on low energy days (${longitudinalData.lowEnergyDays} logged). Prioritize recovery reps.` :\n                                `Execution rate remains relatively stable despite energy fluctuations. Strong resilience practices evident.`\n                             }\n                         </p>\n                         {/* TODO: Add link to log resilience if not available */}\n                         {/* <Button variant=\"outline\" size=\"sm\" className=\"mt-2 w-full !text-xs\">Log Daily Resilience</Button> */}\n                     </div>\n                </Card>\n\n                {/* 4. Mentorship Alignment (Placeholder Data) */}\n                <Card title=\"Mentorship & Coaching Alliance\" icon={Users} accent='BLUE'>\n                     <p className='text-sm text-gray-700 mb-4'>Opportunities to mentor peers (strengths) vs. areas to seek guidance (weaknesses).</p>\n                     {/* Strength Area */}\n                     <div className={`p-3 rounded-lg border border-blue-200 bg-blue-50 shadow-sm mb-3`}>\n                         <p className='font-semibold text-sm flex items-center gap-1.5' style={{ color: COLORS.BLUE }}><TrendingUp className='w-4 h-4'/> Mentor Opportunity (Example):</p>\n                         <p className='text-xs mt-1 text-gray-700'>Your strength in <strong>{weakestTierMeta.name}</strong> suggests you could mentor others. Action: Coach a peer on a related task this week.</p>\n                     </div>\n                     {/* Weakness Area (Placeholder) */}\n                     <div className={`p-3 rounded-lg border border-red-200 bg-red-50 shadow-sm`}>\n                         <p className='font-semibold text-sm flex items-center gap-1.5' style={{ color: COLORS.RED }}><TrendingDown className='w-4 h-4'/> Mentee Feedback (Example T4):</p>\n                         <p className='text-xs mt-1 text-gray-700'>Score: <strong>{longitudinalData.menteeFeedback.score}/100</strong>. Comment: \"{longitudinalData.menteeFeedback.comment}\"</p>\n                     </div>\n                     {/* Button to Feedback Area */}\n                     <Button onClick={() => handleNavigation('coaching-lab', { view: 'feedback-review', tier: 'T4' })} size=\"sm\" variant=\"primary\" className='mt-4 w-full bg-[#2563EB] hover:bg-blue-700'> {/* Blue Button */}\n                         Review Full Mentee Feedback\n                     </Button>\n                </Card>\n\n                {/* 5. Organizational Impact (Placeholder Data) */}\n                <Card title=\"Organizational Impact Score\" icon={BarChart3} accent='PURPLE'>\n                     <p className='text-sm text-gray-700 mb-4'>Aggregated view of how development efforts correlate with team/org outcomes (Placeholder data).</p>\n                     <div className='space-y-2 text-sm'>\n                         <p className='flex justify-between font-semibold text-gray-700'>Psych Safety Index: <span className='font-extrabold text-green-600'>+12%</span></p>\n                         <p className='flex justify-between font-semibold text-gray-700'>Team Turnover Rate: <span className='font-extrabold text-green-600'>-6%</span></p>\n                         <p className='flex justify-between font-semibold text-gray-700'>Project On-Time Rate: <span className='font-extrabold text-amber-600'>+5%</span></p>\n                     </div>\n                     {/* Button to Generate Detailed Report */}\n                     <Button onClick={() => handleNavigation('planning-hub', { view: 'roi-report' })} size=\"sm\" variant=\"secondary\" className='mt-6 w-full bg-[#7C3AED] hover:bg-purple-700'> {/* Purple Button */}\n                         Generate Full Management ROI Report\n                     </Button>\n                </Card>\n            </div>\n\n            {/* Mock Modal removed */}\n        </div>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/Labs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":8,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'setView' is defined but never used.","line":159,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":159,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'preparedSBI' is defined but never used.","line":261,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":261,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'commitmentData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":264,"column":94,"nodeType":"Identifier","messageId":"unusedVar","endLine":264,"endColumn":108},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\Z.","line":284,"column":67,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":284,"endColumn":68,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12581,12582],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12581,12581],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":611,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":611,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1571,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1571,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'baseScenarios'. Either include it or remove the dependency array.","line":1618,"column":110,"nodeType":"ArrayExpression","endLine":1618,"endColumn":126,"suggestions":[{"desc":"Update the dependencies array to be: [baseScenarios, selectedBaseId]","fix":{"range":[86238,86254],"text":"[baseScenarios, selectedBaseId]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1760,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1760,"endColumn":21}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'difficultyLevel', 'keyTakeaway', 'scenario.title', and 'updateCommitmentData'. Either include them or remove the dependency array.","line":312,"column":8,"nodeType":"ArrayExpression","endLine":312,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [difficultyLevel, keyTakeaway, scenario.title, scoreBreakdown.overall, updateCommitmentData]","fix":{"range":[13879,13904],"text":"[difficultyLevel, keyTakeaway, scenario.title, scoreBreakdown.overall, updateCommitmentData]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'GEMINI_MODEL', 'callSecureGeminiAPI', and 'hasGeminiKey'. Either include them or remove the dependency array.","line":378,"column":8,"nodeType":"ArrayExpression","endLine":378,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [GEMINI_MODEL, callSecureGeminiAPI, hasGeminiKey, history, setView]","fix":{"range":[17497,17515],"text":"[GEMINI_MODEL, callSecureGeminiAPI, hasGeminiKey, history, setView]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/Labs.jsx\n\n/* =========================================================\n   PRODUCTION READY FILE: Labs.jsx \n   CLEANUP: Local mock datasets removed. Now relies entirely on useAppServices.\n========================================================= */\n/* eslint-disable no-console */\nimport React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';\n// FIX: Import the real useAppServices from the standard path.\nimport { useAppServices } from '../../services/useAppServices.jsx'; \nimport { AlertTriangle, ArrowLeft, BarChart3, Briefcase, CheckCircle, Clock, CornerRightUp, Cpu, Eye, HeartPulse, Info, Lightbulb, Mic, Play, PlusCircle, Send, ShieldCheck, Star, Target, TrendingUp, Users, X, Zap, TrendingDown, Loader, BookOpen , Clipboard} from 'lucide-react'; \n\n/* =========================================================\n   MOCK DATA (Only non-API data remains)\n========================================================= */\n// Global array to store completed practice sessions (for PracticeLogView)\n// **CLEANUP: THIS DATASET IS REMOVED. PracticeLogView MUST PULL HISTORY FROM useAppServices.**\n// const MOCK_PRACTICE_SESSIONS = [...] - REMOVED\n\n/* =========================================================\n   HIGH-CONTRAST PALETTE (Unchanged)\n========================================================= */\nconst COLORS = {\n  BG: '#FFFFFF',\n  SURFACE: '#FFFFFF',\n  BORDER: '#1F2937',\n  SUBTLE: '#E5E7EB',\n  TEXT: '#0F172A',\n  MUTED: '#4B5563',\n  NAVY: '#0B3B5B',\n  TEAL: '#219E8B',\n  BLUE: '#2563EB',\n  ORANGE: '#E04E1B',\n  GREEN: '#10B981',\n  AMBER: '#F59E0B',\n  RED: '#EF4444',\n  LIGHT_GRAY: '#F9FAFB'\n};\n\nconst COMPLEXITY_MAP = {\n  Low:    { label: 'Novice',       hex: COLORS.GREEN, icon: CheckCircle },\n  Medium: { label: 'Intermediate', hex: COLORS.AMBER, icon: AlertTriangle },\n  High:   { label: 'Expert',       hex: COLORS.RED,   icon: Target },\n};\n\n/* =========================================================\n   UI Components (Unchanged)\n========================================================= */\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', ...rest }) => {\n    let baseStyle = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-xl focus:outline-none focus:ring-4 text-white flex items-center justify-center\";\n\n    if (variant === 'primary') { baseStyle += ` bg-[${COLORS.TEAL}] hover:bg-[#349881] focus:ring-[#47A88D]/50`; } \n    else if (variant === 'secondary') { baseStyle += ` bg-[${COLORS.ORANGE}] hover:bg-red-700 focus:ring-[#E04E1B]/50`; } \n    else if (variant === 'outline') { baseStyle = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[#47A88D]/10 focus:ring-4 focus:ring-[#47A88D]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-center`; }\n\n    if (disabled) { baseStyle = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\"; }\n\n    return (\n        <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>\n            {children}\n        </button>\n    );\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'ORANGE' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.ORANGE;\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-2xl transition-all duration-300 text-left ${className}`}\n      style={{\n        background: 'linear-gradient(180deg,#FFFFFF,#F9FAFB)',\n        borderColor: COLORS.SUBTLE,\n        color: COLORS.TEXT\n      }}\n      onClick={onClick}\n    >\n      <span style={{\n        position:'absolute', top:0, left:0, right:0, height:6,\n        background: accentColor,\n        borderTopLeftRadius:14, borderTopRightRadius:14\n      }} />\n\n      {Icon && (\n        <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\"\n             style={{ borderColor: COLORS.SUBTLE, background: '#F3F4F6' }}>\n          <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n        </div>\n      )}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\n\nconst Tooltip = ({ content, children }) => {\n    const [isVisible, setIsVisible] = useState(false);\n    \n    return (\n        <div \n            className=\"relative inline-block\"\n            onMouseEnter={() => setIsVisible(true)}\n            onMouseLeave={() => setIsVisible(false)}\n        >\n            {children}\n            {isVisible && (\n                <div className=\"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#0B3B5B] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2\">\n                    {content}\n                    <div className=\"absolute left-1/2 transform -translate-x-1/2 bottom-[-4px] w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#0B3B5B]\"></div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nconst mdToHtml = async (markdown) => {\n  let html = markdown;\n  \n  html = html.replace(/^### (.*$)/gim, '<h3 class=\"text-lg font-extrabold text-[#47A88D] mt-4 mb-2\">$1</h3>');\n  html = html.replace(/^## (.*$)/gim, '<h2 class=\"text-2xl font-bold text-[#0B3B5B] border-b pb-1 mb-3 mt-6\">$1</h2>');\n  html = html.replace(/^# (.*$)/gim, '<h1 class=\"text-3xl font-extrabold text-[#E04E1B] mb-4\">$1</h1>');\n\n  html = html.replace(/\\*\\*(.*)\\*\\*/gim, '<strong>$1</strong>');\n  \n  html = html.replace(/^\\* (.*$)/gim, '<li class=\"text-sm text-gray-700\">$1</li>');\n  html = html.replace(/(\\n<li.*<\\/li>)+/gim, '<ul class=\"list-disc list-inside space-y-1 mb-4\">$1</ul>');\n\n  html = html.replace(/([^<]+)/gim, (match) => {\n      if (match.trim() === '' || /<|>/g.test(match)) return match;\n      return `<p class=\"text-gray-700 text-sm mb-4\">${match.trim()}</p>`;\n  });\n  \n  return html;\n};\n\n\nconst Message = ({ sender, text, isAI }) => (\n  <div className={`flex mb-4 ${isAI ? 'justify-start' : 'justify-end'}`}>\n    <div\n      className={`p-4 max-w-lg rounded-xl shadow-md ${\n        isAI\n          ? 'bg-[#0B3B5B]/10 text-[#0B3B5B] rounded-tl-none border border-[#0B3B5B]/20'\n          : 'bg-[#219E8B] text-white rounded-tr-none'\n      }`}\n    >\n      <strong className=\"font-bold text-sm\">{sender}:</strong>\n      <p className=\"text-sm mt-1\">{text}</p>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   COACHING LAB VIEWS (UPDATED FOR PRODUCTION API CALLS)\n========================================================= */\n\nconst FollowUpCoach = ({ history, setView }) => {\n    // FIX: Use real hook\n    const services = useAppServices(); \n    const { callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = services;\n\n    const [followUpHistory, setFollowUpHistory] = useState([]);\n    const [inputText, setInputText] = useState('');\n    const [isGenerating, setIsGenerating] = useState(false);\n    const followUpRef = useRef(null);\n\n    const fullConversation = history.map(msg => `${msg.sender}: ${msg.text}`).join('\\n');\n\n    useEffect(() => {\n        if (followUpRef.current) {\n            followUpRef.current.scrollTop = followUpRef.current.scrollHeight;\n        }\n    }, [followUpHistory]);\n\n    const sendFollowUpQuery = async () => {\n        if (!inputText.trim() || isGenerating) return;\n\n        const userQuery = inputText.trim();\n        const newUserMessage = { sender: 'You', text: userQuery, isAI: false };\n        const newHistory = [...followUpHistory, newUserMessage];\n        setFollowUpHistory(newHistory);\n        setInputText('');\n        setIsGenerating(true);\n\n        const systemInstruction = `You are a post-session AI Executive Coach. Your focus is analyzing the provided conversation history and answering the user's specific follow-up questions about their performance. Do not role-play. Keep responses brief, direct, and actionable, referencing the provided history.\n\nConversation History:\n---\n${fullConversation}\n---\n`;\n        const currentChat = newHistory.map(msg => ({ \n            role: msg.isAI ? \"model\" : \"user\", \n            parts: [{ text: msg.text }] \n        }));\n\n        try {\n            const payload = {\n                contents: currentChat,\n                systemInstruction: { parts: [{ text: systemInstruction }] },\n                model: GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Coach unavailable. Please try your question again.\";\n\n            setFollowUpHistory(prev => [...prev, { sender: 'Coach AI', text: aiText, isAI: true }]);\n        } catch (error) {\n            console.error(\"Follow-up AI Error:\", error);\n            setFollowUpHistory(prev => [...prev, { sender: 'Coach AI', text: \"A connection error occurred. Try again.\", isAI: true }]);\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n\n    return (\n        <Card title=\"AI Follow-Up Coaching (Deep Reflection)\" icon={Lightbulb} className='mt-8 bg-[#0B3B5B]/10 border-2 border-[#0B3B5B]/20'>\n            <p className='text-sm text-gray-700 mb-4'>Ask the AI Coach for specific alternatives, missed opportunities, or clarification on your score.</p>\n            \n            <div ref={followUpRef} className='h-64 overflow-y-auto p-3 bg-white rounded-xl border border-gray-300 mb-3'>\n                 {followUpHistory.length === 0 ? (\n                    <div className='text-gray-500 text-sm italic'>\n                        <p className='mb-2'>**Example Questions:**</p>\n                        <p> - \"What was the most empathetic thing I said?\"</p>\n                        <p> - \"How should I have responded to Alex's defensive statement in turn 3?\"</p>\n                    </div>\n                ) : (\n                    followUpHistory.map((msg, index) => (\n                        <Message key={index} sender={msg.sender} text={msg.text} isAI={msg.isAI} />\n                    ))\n                )}\n                {isGenerating && (\n                    <div className='flex justify-start mb-4'>\n                        <div className='p-4 max-w-lg rounded-xl bg-[#0B3B5B]/10 text-gray-500 rounded-tl-none'>\n                            <div className=\"animate-pulse text-sm\">Coach is analyzing...</div>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            <div className='flex space-x-3'>\n                <input\n                    type=\"text\"\n                    value={inputText}\n                    onChange={(e) => setInputText(e.target.value)}\n                    onKeyDown={(e) => e.key === 'Enter' && sendFollowUpQuery()}\n                    placeholder=\"Ask your coach for feedback...\"\n                    className=\"flex-1 p-3 border border-gray-300 rounded-xl focus:ring-[#219E8B] focus:border-[#219E8B]\"\n                    disabled={isGenerating || !hasGeminiKey()}\n                />\n                <Button onClick={sendFollowUpQuery} disabled={!inputText.trim() || isGenerating || !hasGeminiKey()} className='px-4 py-3'>\n                    <Send className='w-5 h-5'/>\n                </Button>\n            </div>\n        </Card>\n    );\n};\n\nconst RolePlayCritique = ({ history, setView, preparedSBI, scenario, difficultyLevel }) => {\n    // FIX: Use real hook\n    const services = useAppServices(); \n    const { callSecureGeminiAPI, hasGeminiKey, navigate, updateCommitmentData, GEMINI_MODEL, commitmentData } = services; \n\n    const [critique, setCritique] = useState('');\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n    const [isGenerating, setIsGenerating] = useState(true);\n    const [scoreBreakdown, setScoreBreakdown] = useState(null);\n    const [keyTakeaway, setKeyTakeaway] = useState(null);\n\n    const [userReflection, setUserReflection] = useState('');\n    const [auditResult, setAuditResult] = useState(null);\n    const [isAuditing, setIsAuditing] = useState(false);\n\n\n    const extractScore = (critiqueText, auditName) => {\n        const regex = new RegExp(`${auditName}.*?\\\\(Score:\\\\s*(\\\\d+)/100\\\\)`, 'i');\n        const match = critiqueText.match(regex);\n        return match ? parseInt(match[1], 10) : null;\n    };\n\n    const extractKeyTakeaway = (critiqueText) => {\n        const regex = /### Next Practice Point\\s*\\n\\n(.*?)(?:\\n\\n|\\Z)/si;\n        const match = critiqueText.match(regex);\n        if (match && match[1]) {\n            return match[1].trim().replace(/\\*\\*/g, '').replace(/(\\r\\n|\\n|\\r)/gm, \" \");\n        }\n        return \"Refine empathy and focus on measurable outcomes in your next practice session.\";\n    };\n\n    // FIX: Save session data to commitmentData.practice_history upon successful critique\n    useEffect(() => {\n        if (scoreBreakdown?.overall) {\n            const sessionData = {\n                id: String(Date.now()),\n                title: scenario.title,\n                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),\n                score: scoreBreakdown.overall,\n                takeaway: keyTakeaway,\n                difficulty: difficultyLevel < 25 ? 'Low' : difficultyLevel < 75 ? 'Medium' : 'High',\n            };\n            \n            // PRODUCTION FIX: Update the centralized commitmentData service\n            updateCommitmentData(data => ({\n                ...data,\n                practice_history: [...(data?.practice_history || []), sessionData]\n            }));\n            console.log(\"Practice session logged to commitmentData.practice_history.\");\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [scoreBreakdown?.overall]); \n\n\n    useEffect(() => {\n        if (history.length < 5) {\n            setCritique(\"## Insufficient Data\\n\\nTo provide a meaningful score and critique, please complete at least 5 turns (your messages + Alex's responses) in the role-play simulator.\");\n            setIsGenerating(false);\n            return;\n        }\n        \n        if (!hasGeminiKey()) {\n            setCritique(\"## AI Critique Unavailable\\n\\n**ERROR**: The Gemini API Key is missing. AI Role-Play is unavailable.\");\n            setIsGenerating(false);\n            return;\n        }\n\n        const conversationText = history\n            .filter(msg => !msg.system)\n            .map(msg => `${msg.sender}: ${msg.text}`)\n            .join('\\n');\n\n        const systemInstruction = `You are a Senior Executive Coaching Auditor. Analyze the following conversation between a Manager ('You') and their report ('Alex'). Provide a clear score (out of 100) and structured feedback in Markdown, focusing on professional leadership skills.\n            \n            **Critique Structure:**\n            1.  **Overall Score (## Overall Score: X/100):** Provide a score out of 100 based on the manager's performance.\n            2.  **SBI Effectiveness (### SBI Effectiveness (Score: X/100)):** Did the manager effectively stick to objective facts (Situation/Behavior) and articulate the impact (Impact)? Provide a score.\n            3.  **Active Listening & Empathy (### Active Listening & Empathy (Score: Y/100)):** Did the manager use paraphrasing, open-ended questions, or validate Alex's emotions? Provide a score.\n            4.  **Resolution Drive (### Resolution Drive (Score: Z/100)):** Did the manager guide the conversation toward a measurable commitment or next step? Provide a score.\n            5.  **Key Takeaway (### Next Practice Point):** Provide one specific, actionable habit for the manager to work on.`;\n\n        const userQuery = `Analyze the following role-play dialogue. The manager's goal was to address performance/behavior issues with Alex:\\n\\n${conversationText}`;\n\n        (async () => {\n            try {\n                const payload = {\n                    contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                    systemInstruction: { parts: [{ text: systemInstruction }] },\n                    model: GEMINI_MODEL,\n                };\n\n                const result = await callSecureGeminiAPI(payload);\n                const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Critique generation failed. Check API connection.\";\n                \n                const overallScore = extractScore(aiText, 'Overall Score');\n                const sbiScore = extractScore(aiText, 'SBI Effectiveness');\n                const empathyScore = extractScore(aiText, 'Active Listening & Empathy');\n                const resolutionScore = extractScore(aiText, 'Resolution Drive');\n                const takeaway = extractKeyTakeaway(aiText);\n\n                setScoreBreakdown({\n                    overall: overallScore,\n                    sbi: sbiScore,\n                    empathy: empathyScore,\n                    resolution: resolutionScore,\n                });\n                setKeyTakeaway(takeaway);\n                setCritique(aiText);\n\n            } catch (error) {\n                console.error(\"Critique API Error:\", error);\n                setCritique(\"An error occurred during AI critique generation.\");\n            } finally {\n                setIsGenerating(false);\n            }\n        })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [history, setView]);\n\n    useEffect(() => {\n        if (critique) {\n            (async () => setCritiqueHtml(await mdToHtml(critique)))();\n        }\n    }, [critique]);\n\n    const handleCreateCommitment = async () => {\n        if (!keyTakeaway || !updateCommitmentData) return;\n        \n        const commitmentText = `Practice the skill: \"${keyTakeaway}\" (From ${scenario.title} Role-Play).`;\n        \n        const newCommitment = { \n            id: String(Date.now()),\n            text: commitmentText, \n            status: 'Pending', \n            isCustom: true, \n            linkedGoal: 'Improve Feedback & Coaching Skills',\n            linkedTier: 'T4',\n            targetColleague: 'Self-Directed Practice',\n        };\n\n        try {\n            // PRODUCTION: Update commitment data\n            await updateCommitmentData(data => ({\n                ...data,\n                active_commitments: [...(data?.active_commitments || []), newCommitment]\n            }));\n            console.info(\"Commitment created successfully!\");\n            navigate('daily-practice', { \n                initialGoal: newCommitment.linkedGoal, \n                initialTier: newCommitment.linkedTier \n            }); \n        } catch (e) {\n            console.error(\"Failed to save new commitment:\", e);\n            console.warn(\"Commitment saving failed. Check if updateCommitmentData is available.\");\n        }\n    };\n\n    const handleReflectionAudit = async () => {\n        if (!userReflection.trim() || !critique || isAuditing) return;\n\n        setIsAuditing(true);\n        setAuditResult(null);\n\n        const systemInstruction = `You are a world-class Executive Coach assessing a user's capacity for self-correction. Analyze the user's reflection against the provided AI critique. Determine if the user's reflection correctly identifies the root cause of their low score (if applicable) and if their proposed next steps align with the 'Next Practice Point' from the critique. The output MUST be a clear Markdown response.`;\n\n        const userQuery = `Perform a Reflective Analysis.\n        \n        ---\n        **AI Critique (The Ground Truth):**\n        ${critique}\n        ---\n        \n        **User's Reflection on Critique:**\n        ${userReflection.trim()}\n        \n        Provide your analysis focusing on:\n        1. Analysis: Did the user identify the correct problem?\n        2. Alignment: Does the user's plan match the critique's 'Next Practice Point'?\n        3. Confidence Rating: Give a final rating (e.g., Excellent (95%), Fair (65%)).\n        `;\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemInstruction }] },\n                model: GEMINI_MODEL,\n            };\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Reflection audit failed.\";\n            setAuditResult(aiText);\n        } catch (e) {\n            console.error(\"Reflection Audit Error:\", e);\n            setAuditResult(\"Reflection audit failed due to API error.\");\n        } finally {\n            setIsAuditing(false);\n        }\n    };\n\n    const ScoreBar = ({ title, score }) => {\n        const barColor = score > 85 ? COLORS.GREEN : score > 70 ? COLORS.AMBER : COLORS.RED;\n        const barColorClass = score > 85 ? 'text-green-500' : score > 70 ? 'text-yellow-500' : 'text-red-500';\n        return (\n            <div className='mb-3'>\n                <div className='flex justify-between items-center text-sm font-semibold text-[#0B3B5B]'>\n                    <span>{title}</span>\n                    <span className={`text-lg font-extrabold ${barColorClass}`}>{score}%</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                    <div \n                        className={`h-2 rounded-full transition-all duration-700`} \n                        style={{ width: `${score}%`, backgroundColor: barColor }}\n                    ></div>\n                </div>\n            </div>\n        );\n    };\n\n    if (isGenerating) {\n        return (\n            <Card title=\"Generating Session Critique...\" icon={Zap} className=\"mt-8 bg-[#219E8B]/10 border-2 border-[#219E8B]\">\n                <div className=\"flex flex-col items-center justify-center h-40\">\n                    <div className=\"animate-spin rounded-full h-10 w-10 border-b-4 border-[#219E8B] mb-4\"></div>\n                    <p className=\"text-[#219E8B] font-medium\">Analyzing dialogue history and scoring performance...</p>\n                </div>\n            </Card>\n        );\n    }\n\n    const difficultyText = difficultyLevel < 25 ? 'Low (Collaborative)' : difficultyLevel < 75 ? 'Medium (Defensive)' : 'High (Resistant)';\n    const difficultyMultiplier = difficultyLevel / 100 + 1;\n    const globalAverage = Math.round(75 + (difficultyMultiplier * 5)); \n    const benchmarkDifference = (scoreBreakdown?.overall || 0) - globalAverage;\n\n\n    return (\n        <div className='space-y-6'>\n            <div className='grid lg:grid-cols-4 gap-6'>\n                {/* Overall Score Card */}\n                <Card title=\"Overall Performance\" icon={Star} className='lg:col-span-2' accent=\"NAVY\">\n                    <p className='text-sm text-gray-300 mb-2'>Final Audit Score</p>\n                    <div className={`text-6xl font-extrabold ${scoreBreakdown?.overall > 85 ? 'text-green-500' : 'text-yellow-500'}`}>\n                        {scoreBreakdown?.overall || '--'} / 100\n                    </div>\n                    <div className='mt-4 pt-4 border-t border-gray-200'>\n                        <p className='text-sm font-semibold text-[#0B3B5B]'>Key Takeaway:</p>\n                        <p className='text-sm text-gray-700'>{keyTakeaway || 'Review the full critique.'}</p>\n                    </div>\n                </Card>\n\n                {/* Adaptive Scenario Tracker */}\n                <Card title=\"Adaptive Session Metrics\" icon={Target} className='lg:col-span-2' accent=\"ORANGE\">\n                    <p className='text-sm font-semibold text-[#0B3B5B] mb-2'>Tension Multiplier:</p>\n                    <div className='flex justify-between items-center'>\n                        <span className='text-3xl font-extrabold text-[#E04E1B]'>{difficultyMultiplier.toFixed(1)}X</span>\n                        <span className='text-sm text-gray-600 font-medium'>({difficultyText})</span>\n                    </div>\n                    <div className='mt-4 pt-4 border-t border-gray-200'>\n                        <p className='text-sm font-semibold text-[#0B3B5B]'>Difficulty Grade:</p>\n                        <span className='text-xl font-extrabold text-[#219E8B]'>\n                            {difficultyLevel < 25 ? 'C - Standard' : difficultyLevel < 75 ? 'B - Challenging' : 'A - Executive Level'}\n                        </span>\n                    </div>\n                </Card>\n            </div>\n\n            {/* Skill Breakdown Heatmap & Benchmarking */}\n            <Card title=\"Skill Breakdown Heatmap & Benchmarking\" icon={BarChart3} className=''>\n                {scoreBreakdown?.sbi !== null ? (\n                    <>\n<div className={`p-3 mb-4 rounded-xl shadow-inner text-center font-semibold border-l-4 ${benchmarkDifference >= 0 ? 'bg-green-100 border-green-500 text-green-700' : 'bg-red-100 border-red-500 text-[#E04E1B]'}`}>\n                            <span className='text-lg'>\n                                Global Benchmark: {globalAverage}%\n                            </span>\n                            <p className='text-sm mt-1'>\n                                You scored **{Math.abs(benchmarkDifference)} points {benchmarkDifference >= 0 ? 'ABOVE' : 'BELOW'}** the average for this difficulty level.\n                            </p>\n                        </div>\n\n                        <div className='space-y-4'>\n                            <ScoreBar title=\"SBI Effectiveness (Clarity & Focus)\" score={scoreBreakdown.sbi} />\n                            <ScoreBar title=\"Active Listening & Empathy\" score={scoreBreakdown.empathy} />\n                            <ScoreBar title=\"Resolution Drive (Bias for Action)\" score={scoreBreakdown.resolution} />\n                        </div>\n                    </>\n                ) : (\n                    <p className='text-sm text-gray-500'>Score breakdown is not available for this session.</p>\n                )}\n            </Card>\n            \n            {/* Full Critique and Accountability Actions */}\n            <Card title=\"AI Coach Full Audit\" icon={CheckCircle} className=\"bg-[#FCFCFA] border-4 border-[#219E8B]\">\n                <div className=\"prose max-w-none prose-h2:text-4xl prose-h2:text-[#E04E1B] prose-h2:font-extrabold prose-h3:text-[#219E8B] prose-p:text-gray-700 prose-ul:space-y-2\">\n                    <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                </div>\n                \n                {/* Reflective Analysis Section */}\n                <div className='mt-8 pt-6 border-t border-gray-200'>\n                    <h3 className='text-xl font-bold text-[#0B3B5B] mb-3 flex items-center'><BookOpen className='w-5 h-5 mr-2 text-[#E04E1B]'/> Post-Critique Reflective Analysis</h3>\n                    <p className='text-sm text-gray-700 mb-3'>Write a brief reflection on the critique: **What was your core mistake, and how will you correct it in your next session?**</p>\n                    \n                    <textarea \n                        value={userReflection}\n                        onChange={(e) => {setUserReflection(e.target.value); setAuditResult(null);}}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#E04E1B] focus:border-[#E04E1B] h-32 mb-3\" \n                        placeholder=\"My reflection: I realize I got defensive when Alex deflected, and I failed to pause and paraphrase. Next time, I will start with a validation phrase, 'I hear that you feel unfairness,' before redirecting to the facts.\"\n                        disabled={isAuditing}\n                    />\n                    \n                    {auditResult && (\n                        <Card title=\"Your Reflection Audit\" icon={Eye} className='bg-white shadow-lg border-l-4 border-dashed border-[#219E8B]'>\n                            <div className=\"prose max-w-none prose-h2:text-[#0B3B5B] prose-h3:text-[#219E8B]\">\n                                <div dangerouslySetInnerHTML={{ __html: auditResult }} />\n                            </div>\n                        </Card>\n                    )}\n\n                    <Button onClick={handleReflectionAudit} disabled={isAuditing || !userReflection.trim()} className='mt-3 w-full bg-[#E04E1B] hover:bg-red-700'>\n                        {isAuditing ? \n                            <span className=\"flex items-center justify-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div> Auditing Self-Correction...</span>\n                            : <><Cpu className='w-4 h-4 mr-2'/> Get AI Reflection Audit</>\n                        }\n                    </Button>\n                </div>\n                \n                {keyTakeaway && (\n                    <div className='mt-8 pt-6 border-t border-gray-200'>\n                        <h3 className='text-xl font-bold text-[#0B3B5B] mb-3 flex items-center'><TrendingUp className='w-5 h-5 mr-2 text-[#219E8B]'/> Practice Commitment Planner</h3>\n                        <p className='text-sm text-gray-700 mb-4'>Convert your key takeaway into a daily practice habit to reinforce learning immediately.</p>\n                        <Button onClick={handleCreateCommitment} className='w-full bg-[#349881] hover:bg-[#219E8B]'>\n                            <PlusCircle className='w-5 h-5 mr-2'/> Commit to Daily Practice: \"{keyTakeaway.substring(0, 40)}...\"\n                        </Button>\n                    </div>\n                )}\n                \n                <Button onClick={() => setView('coaching-lab-home')} variant='outline' className='mt-8 w-full'>\n                    Return to Coaching Lab Home\n                </Button>\n            </Card>\n            \n            <FollowUpCoach history={history} setView={setView} />\n        </div>\n    );\n\n\n};\n\n// --- ROLE PLAY SIMULATOR VIEW ---\nconst RolePlayView = ({ scenario, setCoachingLabView, preparedSBI, difficultyLevel }) => {\n    // FIX: Use real hook\n    const services = useAppServices(); \n    const { navigate, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = services; \n\n    const [chatHistory, setChatHistory] = useState([]);\n    const [inputText, setInputText] = useState('');\n    const [isGenerating, setIsGenerating] = useState(false);\n    const [conversationStarted, setConversationStarted] = useState(false);\n    const [sessionEnded, setSessionEnded] = useState(false);\n    const [sbiDelivered, setSbiDelivered] = useState(false);\n    const [confidenceTip, setConfidenceTip] = useState(null);\n    const [isPrimingModalVisible, setIsPrimingModalVisible] = useState(true);\n    \n    // Priming Modal State\n    const [stressLevel, setStressLevel] = useState(50);\n    const [intentionalMindset, setIntentionalMindset] = useState('Non-Judgmental');\n    const [mindsetNudge, setMindsetNudge] = useState(null);\n    const [isPrimingLoading, setIsPrimingLoading] = useState(false);\n    \n    const chatRef = useRef(null);\n    \n    const resistanceFactor = Math.floor(difficultyLevel / 25); \n\n    useEffect(() => {\n        if (chatRef.current) {\n            chatRef.current.scrollTop = chatRef.current.scrollHeight;\n        }\n    }, [chatHistory]);\n    \n    useEffect(() => {\n        if (hasGeminiKey() && scenario && !isPrimingModalVisible) {\n            const fetchTip = async () => {\n                const tension = difficultyLevel < 25 ? 'Low' : difficultyLevel < 75 ? 'Medium' : 'High';\n                const userQuery = `Generate a Scenario-Specific Confidence Builder Tip (1 sentence max) for this situation: Scenario: ${scenario.title}. Persona: ${scenario.persona}. Tension: ${tension}. Focus the tip on the manager's opening mindset or first reply. Confidence Builder Tip:`;\n                \n                try {\n                    const payload = {\n                        contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                        systemInstruction: { parts: [{ text: \"You are an AI coach. Provide only the concise, actionable tip in plain text.\" }] },\n                        model: GEMINI_MODEL,\n                    };\n                    const result = await callSecureGeminiAPI(payload);\n                    const tipText = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n                    setConfidenceTip(tipText);\n                } catch (e) {\n                    setConfidenceTip(\"Focus on empathy and objective facts for a strong start.\");\n                }\n            };\n            fetchTip();\n        }\n    }, [scenario, difficultyLevel, hasGeminiKey, isPrimingModalVisible, callSecureGeminiAPI, GEMINI_MODEL]);\n\n    const AI_PERSONA = scenario.persona.split(' ').slice(1).join(' ');\n\n    const handleSaveSessionAndCritique = async () => {\n        // Correctly set view to 'session ended' which triggers the critique component render\n        setSessionEnded(true); \n    }\n\n    const generateResponse = async (history) => {\n        setIsGenerating(true);\n\n        const sbiPrompt = preparedSBI ? `\\nThe manager prepared the following SBI statement to use as a basis for feedback: ${preparedSBI}\\n` : '';\n        \n        let difficultyInstruction;\n        if (resistanceFactor >= 3) {\n             difficultyInstruction = \"Be highly resistant, skeptical, and emotionally charged (High Tension).\";\n        } else if (resistanceFactor === 2) {\n             difficultyInstruction = \"Be defensive and slightly stressed, often deflecting blame (Medium Tension).\";\n        } else if (resistanceFactor === 1) {\n             difficultyInstruction = \"Be open but cautious, requiring strong empathy to open up (Low Tension).\";\n        } else {\n             difficultyInstruction = \"Be collaborative and receptive to feedback.\";\n        }\n\n        const systemInstruction = `You are a direct report named 'Alex'. You embody the persona: ${scenario.persona}. Your current situation is: \"${scenario.description}\". The user is your manager. ${sbiPrompt}\n        \n        **Difficulty Instruction:** ${difficultyInstruction}\n\n        Your task is to respond to the user's input, maintaining your ${AI_PERSONA} persona and tone. Be realistic—don't resolve the conflict immediately. After 4-5 turns, you may begin to soften only if the manager demonstrates effective listening and SBI feedback. Keep your responses concise (2-3 sentences max).\n        Use the history below to guide your response. Do not break character or mention your persona.`;\n\n        const currentChat = history.map(msg => ({ \n            role: msg.isAI ? \"model\" : \"user\", \n            parts: [{ text: msg.text }] \n        }));\n\n        if (!hasGeminiKey()) {\n            setChatHistory(prev => [...prev, { \n                sender: 'System', \n                text: \"**ERROR**: The Gemini API Key is missing. AI Role-Play is unavailable. Please check App Settings.\", \n                isAI: true, \n                system: true \n            }]);\n            setIsGenerating(false);\n            return;\n        }\n\n        try {\n            const payload = {\n                contents: currentChat,\n                systemInstruction: { parts: [{ text: systemInstruction }] },\n                model: GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"I seem to be having trouble processing that right now. Can you rephrase?\";\n\n            setChatHistory(prev => [...prev, { sender: 'Alex', text: aiText, isAI: true }]);\n        } catch (error) {\n            console.error(\"AI Role-Play Error:\", error);\n            setChatHistory(prev => [...prev, { sender: 'Alex', text: \"A communication error occurred. Please try again.\", isAI: true }]);\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n\n    const handleSendMessage = async () => {\n        if (!inputText.trim() || isGenerating) return;\n\n        const newUserMessage = { sender: 'You', text: inputText.trim(), isAI: false };\n        const newHistory = [...chatHistory, newUserMessage];\n        setChatHistory(newHistory);\n        setInputText('');\n        \n        if (!conversationStarted) {\n            setConversationStarted(true);\n        }\n        \n        if (preparedSBI && !sbiDelivered) {\n             const sbiMatch = preparedSBI.split('.').some(part => newUserMessage.text.includes(part.trim().substring(0, 10)));\n             if (sbiMatch) {\n                 setSbiDelivered(true);\n             }\n        }\n\n        await generateResponse(newHistory);\n    };\n\n    useEffect(() => {\n        if (!conversationStarted && !sessionEnded && !isPrimingModalVisible) {\n            setChatHistory([\n                { sender: 'System', text: `You are meeting with Alex (The ${AI_PERSONA}). Alex looks visibly annoyed/distracted. Start the conversation with your opening statement.`, isAI: true, system: true }\n            ]);\n            setConversationStarted(true);\n        }\n    }, [conversationStarted, sessionEnded, AI_PERSONA, isPrimingModalVisible]);\n\n    const handlePrimingCheckIn = async () => {\n        setIsPrimingLoading(true);\n        // FIX: Access GEMINI_MODEL directly from services\n        const { GEMINI_MODEL } = services; \n        \n        const userQuery = `Generate a 1-sentence Priming Nudge based on this self-assessment: Stress: ${stressLevel}%. Mindset: ${intentionalMindset}. The scenario is ${scenario.title} where Alex is ${scenario.persona}. Priming Nudge:`;\n        \n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: \"You are an AI coach. Provide only the concise, actionable nudge in plain text.\" }] },\n                model: GEMINI_MODEL,\n            };\n            const result = await callSecureGeminiAPI(payload);\n            const nudgeText = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n            setMindsetNudge(nudgeText);\n        } catch (e) {\n            setMindsetNudge(\"Error: Check API connection. Defaulting to Mindset focus.\");\n        } finally {\n            setIsPrimingLoading(false);\n            setIsPrimingModalVisible(false);\n        }\n    };\n    \n    if (isPrimingModalVisible) {\n        return (\n            <div className=\"fixed inset-0 bg-[#0B3B5B]/90 z-50 flex items-center justify-center p-4\">\n                <div className=\"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-lg p-8\">\n                    <h2 className=\"text-2xl font-extrabold text-[#E04E1B] mb-4 flex items-center\">\n                        <HeartPulse className=\"w-6 h-6 mr-3\" /> Psychological Priming Check\n                    </h2>\n                    <p className='text-gray-700 mb-6'>Manage your internal state before engaging. This minimizes emotional hijacking and maximizes skill transfer.</p>\n\n                    <div className='mb-6'>\n                        <label className=\"block text-sm font-medium text-[#0B3B5B] mb-1\">1. Current Stress/Anxiety Level ({stressLevel}%)</label>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\"\n                            value={stressLevel} \n                            onChange={(e) => setStressLevel(parseInt(e.target.value))}\n                            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-[#E04E1B]\"\n                        />\n                        <p className='text-xs text-gray-500 mt-1 flex justify-between'><span>Low/Calm</span><span>High/Anxious</span></p>\n                    </div>\n\n                    <div className='mb-6'>\n                        <label className=\"block text-sm font-medium text-[#0B3B5B] mb-1\">2. Intentional Mindset</label>\n                        <select \n                            value={intentionalMindset} \n                            onChange={(e) => setIntentionalMindset(e.target.value)}\n                            className=\"w-full p-3 border border-gray-300 rounded-xl\"\n                        >\n                            <option>Non-Judgmental</option>\n                            <option>Curious Investigator</option>\n                            <option>Calm Anchor</option>\n                            <option>Fact-Driven</option>\n                        </select>\n                    </div>\n                    \n                    {mindsetNudge && (\n                         <div className='p-3 my-4 bg-[#219E8B]/10 rounded-xl text-sm font-medium border border-[#219E8B]'>\n                            <Lightbulb className='w-4 h-4 inline mr-2 text-[#219E8B]'/> **Mindset Nudge:** {mindsetNudge}\n                        </div>\n                    )}\n\n\n                    <Button onClick={handlePrimingCheckIn} disabled={isPrimingLoading} className='mt-6 w-full'>\n                        {isPrimingLoading ? 'Analyzing State...' : 'Confirm Mindset & Launch Session'}\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n    \n\n    if (sessionEnded) {\n        return (\n            <div className='p-8'>\n                <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Session Complete: Audit Results</h1>\n                <RolePlayCritique \n                    history={chatHistory} \n                    setView={setCoachingLabView} \n                    preparedSBI={preparedSBI} \n                    scenario={scenario} \n                    difficultyLevel={difficultyLevel} \n                />\n            </div>\n        );\n    }\n\n\n    return (\n        <div className=\"p-8\">\n            <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Role-Play Simulator: {scenario.title}</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Practice your conversation with Alex, who is simulating **{scenario.persona}** behavior. Focus on using empathy and clear SBI feedback.</p>\n            <Button onClick={handleSaveSessionAndCritique} variant=\"secondary\" className=\"mb-8 bg-[#E04E1B] border-red-500 hover:bg-red-700\">\n                <AlertTriangle className=\"w-5 h-5 mr-2\" /> End Session & Get Critique\n            </Button>\n            \n            <div className='flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6'>\n                <div className='flex-1 bg-[#FCFCFA] border border-gray-300 rounded-2xl shadow-lg flex flex-col h-[500px]'>\n                    \n                    {confidenceTip && !isGenerating && chatHistory.length < 2 && (\n                        <div className=\"p-3 bg-[#219E8B]/10 text-sm text-[#0B3B5B] border-b border-[#219E8B]/30 font-medium\">\n                            <Lightbulb className='w-4 h-4 inline mr-2 text-[#219E8B]'/> **Pre-Session Nudge:** {confidenceTip}\n                        </div>\n                    )}\n                    \n                    <div ref={chatRef} className='flex-1 overflow-y-auto p-4'>\n                        {chatHistory.map((msg, index) => (\n                            !msg.system && <Message key={index} sender={msg.sender} text={msg.text} isAI={msg.isAI} />\n                        ))}\n                         {chatHistory.find(msg => msg.system) && (\n                            <div className=\"text-sm text-[#0B3B5B] bg-[#219E8B]/10 p-3 rounded-lg border border-[#219E8B]/20 mb-4\">\n                                {chatHistory.find(msg => msg.system)?.text}\n                            </div>\n                        )}\n                        {isGenerating && (\n                            <div className='flex justify-start mb-4'>\n                                <div className='p-4 max-w-lg rounded-xl bg-[#0B3B5B]/10 text-gray-500 rounded-tl-none'>\n                                    <div className=\"animate-pulse text-sm\">Alex is typing...</div>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    <div className='p-4 border-t border-gray-200 flex space-x-3'>\n                        <input\n                            type=\"text\"\n                            value={inputText}\n                            onChange={(e) => setInputText(e.target.value)}\n                            onKeyDown={(e) => e.key === 'Enter' && handleSendMessage()}\n                            placeholder=\"Type your response to Alex...\"\n                            className=\"flex-1 p-3 border border-gray-300 rounded-xl focus:ring-[#219E8B] focus:border-[#219E8B]\"\n                            disabled={isGenerating || !hasGeminiKey()}\n                        />\n                        <Button onClick={handleSendMessage} disabled={!inputText.trim() || isGenerating || !hasGeminiKey()} className='px-4 py-3'>\n                            {isGenerating ? '...' : <Send className='w-5 h-5' />}\n                        </Button>\n                    </div>\n                </div>\n\n                <div className='lg:w-1/3'>\n                    <Card title={`Alex: The ${AI_PERSONA}`} icon={Users} className='h-full bg-[#0B3B5B]/10 border-2 border-[#0B3B5B]/20'>\n                        <div className='p-3 bg-white rounded-lg shadow-inner mb-4 border border-gray-200'>\n                            <h4 className='font-bold text-[#0B3B5B] mb-2 flex items-center'><Clock className='w-4 h-4 mr-1'/> Conversation Tracker</h4>\n                            <div className='flex justify-between text-sm font-medium'>\n                                <span>Turn Count:</span>\n                                <span className='font-extrabold text-[#E04E1B]'>{Math.floor(chatHistory.filter(m => !m.system).length / 2)}</span>\n                            </div>\n                             <div className='flex justify-between text-sm font-medium mt-1'>\n                                <span>SBI Delivered:</span>\n                                <span className={`font-extrabold ${sbiDelivered ? 'text-green-600' : 'text-gray-500'}`}>{sbiDelivered ? 'YES' : 'PENDING'}</span>\n                            </div>\n                        </div>\n\n                        <p className='text-sm text-gray-700 font-semibold mb-2'>Scenario Description:</p>\n                        <p className=\"text-sm text-gray-600\">{scenario.description}</p>\n                        \n                        {preparedSBI && (\n                             <div className='mt-4 pt-2 border-t border-gray-300'>\n                                <h4 className='font-bold text-[#219E8B] mb-2 flex items-center'><ShieldCheck className='w-4 h-4 mr-1'/> Prepared SBI Focus:</h4>\n                                <p className='text-xs text-gray-700 italic border border-[#219E8B]/20 p-2 rounded-lg bg-white'>{preparedSBI}</p>\n                            </div>\n                        )}\n\n                        <h4 className='font-bold text-[#E04E1B] mt-4 mb-2 border-t pt-2'>Tension Level:</h4>\n                        <div className='text-sm text-gray-700 font-semibold'>\n                            {difficultyLevel < 25 ? 'Low (Collaborative)' : difficultyLevel < 75 ? 'Medium (Defensive)' : 'High (Resistant)'}\n                        </div>\n                    </Card>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// --- LEAN FEEDBACK PREP VIEW (Unchanged) ---\nconst LeanFeedbackPrepView = ({ setCoachingLabView, setPreparedSBI }) => {\n    // FIX: Use real hook\n    const services = useAppServices(); \n    const { callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = services; \n\n    const [situation, setSituation] = useState('');\n    const [behavior, setBehavior] = useState('');\n    const [impact, setImpact] = useState('');\n\n    const [isGenerating, setIsGenerating] = useState(false);\n    const [critique, setCritique] = useState(null);\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n    const [refinedFeedback, setRefinedFeedback] = useState(null); \n    \n    const canAnalyze = !!situation && !!behavior && !!impact && hasGeminiKey();\n\n    useEffect(() => {\n        if (!critique) { setCritiqueHtml(''); setRefinedFeedback(null); return; }\n        (async () => setCritiqueHtml(await mdToHtml(critique)))();\n        \n        const match = critique.match(/\\*\\*(Refined Feedback|Refined SBI)\\*\\*:?\\s*([^*]+)/i);\n        if (match && match[2]) {\n            const finalRefined = match[2].trim().replace(/\\.$/, '');\n            setRefinedFeedback(finalRefined);\n            setPreparedSBI(finalRefined);\n        } else {\n            setRefinedFeedback(null);\n            setPreparedSBI(null);\n        }\n    }, [critique, setPreparedSBI]);\n\n    const generateCritique = async () => {\n        setIsGenerating(true);\n        setCritique('');\n        setRefinedFeedback(null);\n\n        if (!canAnalyze) return;\n\n        const userFeedback = `S: ${situation}\\nB: ${behavior}\\nI: ${impact}`;\n        const systemInstruction = \"You are an AI Coach specializing in the SBI (Situation, Behavior, Impact) feedback model. Analyze the user's provided feedback draft. First, point out one strength. Second, point out one area for improvement, specifically focusing on ensuring the Behavior is objective and the Impact is linked to business results or team culture. Then, provide the final refined version of the feedback, strictly adhering to the S-B-I format, labeling the final version with **Refined Feedback**.\";\n        const userQuery = `Critique and refine this SBI feedback draft for a real-world scenario:\\n\\n${userFeedback}`;\n\n        try {\n            const payload = {\n            contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n            systemInstruction: { parts: [{ text: systemInstruction }] },\n            model: GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const candidate = result?.candidates?.[0];\n\n            if (candidate && candidate.content?.parts?.[0]?.text) {\n                setCritique(candidate.content.parts[0].text);\n            } else {\n                setCritique(\"Could not generate critique. The model may have blocked the request.\");\n            }\n        } catch (error) {\n            console.error(\"Gemini API Error:\", error);\n            setCritique(\"An error occurred while connecting to the AI coach.\");\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n    \n\n    return (\n        <div className=\"p-8\">\n            <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Lean Feedback Prep: Instant SBI Audit</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Get immediate AI critique and refinement for your real-world feedback drafts. This tool prioritizes speed and clarity for crucial conversations.</p>\n            \n            <Button onClick={() => setCoachingLabView('coaching-lab-home')} variant=\"outline\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Coaching Lab\n            </Button>\n            \n            <div className='flex flex-col lg:flex-row space-y-8 lg:space-y-0 lg:space-x-8'>\n                \n                {/* LEFT COLUMN: Input */}\n                <div className='lg:w-1/2 space-y-6'>\n                    <Card title=\"Draft Your SBI Feedback\" icon={Briefcase} accent=\"TEAL\">\n                        <p className=\"text-gray-700 text-sm mb-4\">Input the specific, objective details of the situation you need to address.</p>\n                        \n                        <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Situation (S): When/Where did it happen?</label>\n                        <textarea value={situation} onChange={(e) => setSituation(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., 'During the team stand-up last Tuesday...'\"></textarea>\n                        \n                        <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Behavior (B): What observable action did they take?</label>\n                        <textarea value={behavior} onChange={(e) => setBehavior(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., '...you presented the data without checking your sources.'\"></textarea>\n                        \n                        <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Impact (I): What was the consequence?</label>\n                        <textarea value={impact} onChange={(e) => setImpact(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., '...which led to incorrect projections being shared with the client.'\"></textarea>\n\n                        <Button \n                            onClick={generateCritique} \n                            disabled={!canAnalyze || isGenerating} \n                            className=\"w-full mt-4 bg-[#219E8B] hover:bg-[#349881]\"\n                        >\n                            {isGenerating ? (\n                                <span className=\"flex items-center justify-center\">\n                                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                                    Running AI Audit...\n                                </span>\n                            ) : (\n                                <span className=\"flex items-center justify-center\">\n                                    <Cpu className='w-4 h-4 mr-2' /> Get Instant Critique\n                                </span>\n                            )}\n                        </Button>\n                    </Card>\n                    \n                    {refinedFeedback && (\n                        <Card title=\"Final Refined Feedback\" icon={ShieldCheck} accent=\"ORANGE\">\n                            <h4 className='font-bold text-[#0B3B5B] mb-2'>Ready for Use:</h4>\n                            <p className='text-sm text-gray-700 font-medium italic p-3 border border-[#E04E1B] rounded-lg bg-[#FBF6F0]'>\n                                {refinedFeedback}\n                            </p>\n                            <Button \n                                onClick={() => navigator.clipboard.writeText(refinedFeedback)} \n                                className=\"mt-4 w-full bg-[#E04E1B] hover:bg-red-700\"\n                            >\n                                <CornerRightUp className='w-4 h-4 mr-2' /> Copy Refined SBI to Clipboard\n                            </Button>\n                        </Card>\n                    )}\n                </div>\n\n                {/* RIGHT COLUMN: AI Feedback Panel */}\n                <div className='lg:w-1/2'>\n                    {critiqueHtml && (\n                        <Card title=\"AI Critique (SBI Audit)\" icon={Eye} className=\"mt-0 border-4 border-[#0B3B5B]\">\n                            <div className=\"prose max-w-none prose-h2:text-[#0B3B5B] prose-h2:text-xl prose-h2:font-extrabold prose-h3:text-[#219E8B] prose-p:text-gray-700 prose-ul:space-y-2\">\n                                <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                            </div>\n                        </Card>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n// --- SCENARIO PREP VIEW (Unchanged) ---\nconst ScenarioPreparationView = ({ scenario, setCoachingLabView, setPreparedSBI }) => {\n    // FIX: Use real hook\n    const services = useAppServices();\n    const { callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = services;\n\n    const [situation, setSituation] = useState('');\n    const [behavior, setBehavior] = useState('');\n    const [impact, setImpact] = useState('');\n    const [objective, setObjective] = useState('');\n    const [difficultyLevel, setDifficultyLevel] = useState(50);\n\n    const [isGenerating, setIsGenerating] = useState(false);\n    const [critique, setCritique] = useState(null);\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n    const [refinedFeedback, setRefinedFeedback] = useState(null); \n    const [currentStep, setCurrentStep] = useState(1);\n    \n    const canAnalyze = !!situation && !!behavior && !!impact && hasGeminiKey();\n    // Prep complete when objective is set AND SBI is refined\n    const isPrepComplete = !!objective && !!refinedFeedback; \n\n    useEffect(() => {\n        if (!critique) { setCritiqueHtml(''); setRefinedFeedback(null); return; }\n        (async () => setCritiqueHtml(await mdToHtml(critique)))();\n        \n        const match = critique.match(/\\*\\*(Refined Feedback|Refined SBI)\\*\\*:?\\s*([^*]+)/i);\n        if (match && match[2]) {\n            const finalRefined = match[2].trim().replace(/\\.$/, '');\n            setRefinedFeedback(finalRefined);\n            setPreparedSBI(finalRefined);\n        } else {\n            setRefinedFeedback(null);\n            setPreparedSBI(null);\n        }\n\n    }, [critique, setPreparedSBI]);\n\n    const generateCritique = async () => {\n        setIsGenerating(true);\n        setCritique('');\n        setRefinedFeedback(null);\n\n        if (!canAnalyze) return;\n\n        const userFeedback = `S: ${situation}\\nB: ${behavior}\\nI: ${impact}`;\n        const systemInstruction = \"You are an AI Coach specializing in the SBI (Situation, Behavior, Impact) feedback model. Analyze the user's provided feedback draft. First, point out one strength. Second, point out one area for improvement, specifically focusing on ensuring the Behavior is objective and the Impact is linked to business results or team culture. Then, provide the final refined version of the feedback, strictly adhering to the S-B-I format, labeling the final version with **Refined Feedback**.\";\n        const userQuery = `Critique and refine this SBI feedback draft for the scenario: ${scenario.title} - ${scenario.description}:\\n\\n${userFeedback}`;\n\n        try {\n            const payload = {\n            contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n            systemInstruction: { parts: [{ text: systemInstruction }] },\n            model: GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const candidate = result?.candidates?.[0];\n\n            if (candidate && candidate.content?.parts?.[0]?.text) {\n                setCritique(candidate.content.parts[0].text);\n                // FIX: Explicitly set the step to 3 upon successful critique generation.\n                setCurrentStep(3); \n            } else {\n                setCritique(\"Could not generate critique. The model may have blocked the request.\");\n            }\n        } catch (error) {\n            console.error(\"Gemini API Error:\", error);\n            setCritique(\"An error occurred while connecting to the AI coach.\");\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n    \n    // CRITICAL FIX: Launch Handler\n    const handleLaunchRolePlay = () => {\n        if (isPrepComplete) {\n            // FIX: Use setCoachingLabView to change the local component state\n            setCoachingLabView('role-play'); \n            // The RolePlayView will automatically pick up the props from the parent's state\n        }\n    };\n\n    if (!scenario) {\n        return (\n        <div className=\"p-8\">\n        <Button onClick={() => setCoachingLabView('scenario-library')} variant=\"outline\" className=\"mb-8\">\n        <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Scenarios\n        </Button>\n        <p className=\"text-gray-700\">No scenario selected.</p>\n        </div>\n        );\n    }\n\n    return (\n    <div className=\"p-8\">\n        <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Prepare for: {scenario.title}</h1>\n        <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Target: Alex, **{scenario.persona}** | Focus: {scenario.description}</p>\n        \n        <Button onClick={() => setCoachingLabView('scenario-library')} variant=\"outline\" className=\"mb-8\">\n            <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Scenarios\n        </Button>\n\n        <div className='flex flex-col lg:flex-row space-y-8 lg:space-y-0 lg:space-x-8'>\n            {/* LEFT COLUMN: Preparation Pipeline */}\n            <div className='lg:w-2/3 space-y-6'>\n                {/* Difficulty Slider */}\n                <Card title=\"Set Tension Level (Optional)\" icon={HeartPulse} className='bg-[#E04E1B]/10 border-4 border-dashed border-[#E04E1B]'>\n                    <p className=\"text-gray-700 text-sm mb-4\">Control the emotional resistance of the AI persona in the simulator. Higher tension requires more empathy and validation skill.</p>\n                    <div className='flex justify-between text-xs font-bold text-[#0B3B5B] mb-1'>\n                        <span>Low Tension</span>\n                        <span>High Tension</span>\n                    </div>\n                    <input \n                        type=\"range\" \n                        min=\"0\" \n                        max=\"100\" \n                        step=\"1\"\n                        value={difficultyLevel} \n                        onChange={(e) => setDifficultyLevel(parseInt(e.target.value))}\n                        className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-[#E04E1B]\"\n                    />\n                    <div className='text-sm font-semibold text-[#0B3B5B] mt-3'>\n                        Current Difficulty: {difficultyLevel < 25 ? 'Low (Collaborative)' : difficultyLevel < 75 ? 'Medium (Defensive)' : 'High (Resistant)'}\n                    </div>\n                </Card>\n                \n                <Card title=\"Step 1: Define Your Objective\" icon={Target} className={currentStep === 1 ? 'border-4 border-dashed border-[#219E8B]' : 'opacity-70'}>\n                    <p className=\"text-gray-700 text-sm\">What is the **one critical outcome** you want? What measurable commitment, change, or decision will constitute success?</p>\n                    <textarea \n                        value={objective}\n                        // FIX: Ensure the current step advances to 2 immediately upon setting the objective\n                        onChange={(e) => { setObjective(e.target.value); setCurrentStep(2); }}\n                        className=\"w-full p-3 mt-4 border border-gray-300 rounded-xl focus:ring-[#219E8B] focus:border-[#219E8B] h-20\" \n                        placeholder=\"e.g., 'Ensure Alex commits to a weekly check-in process to prevent missed deadlines.'\"\n                    />\n                    <div className='text-xs font-semibold text-[#E04E1B] mt-2'>Status: {objective.length > 5 ? 'Objective Set' : 'Pending...'}</div>\n                </Card>\n\n                <Card title=\"Step 2: Draft SBI Feedback\" icon={Briefcase} className={currentStep === 2 ? 'border-4 border-dashed border-[#219E8B]' : 'opacity-70'}>\n                    <p className=\"text-gray-700 text-sm mb-4\">Draft the specific, objective feedback using the **SBI** model.</p>\n                    \n                    <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Situation (S): When/Where did it happen?</label>\n                    {/* CRITICAL FIX: The missing closing quote was here! Added 'rounded-lg\"' */}\n                    <textarea value={situation} onChange={(e) => { setSituation(e.target.value); setCurrentStep(2); }} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., 'During the team stand-up last Tuesday...'\"></textarea>\n                    \n                    <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Behavior (B): What observable action did they take?</label>\n                    <textarea value={behavior} onChange={(e) => { setBehavior(e.target.value); setCurrentStep(2); }} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., '...you presented the data without checking your sources.'\"></textarea>\n                    \n                    <label className=\"block text-sm font-medium text-[#0B3B5B] mt-3 mb-1\">Impact (I): What was the consequence?</label>\n                    <textarea value={impact} onChange={(e) => { setImpact(e.target.value); setCurrentStep(2); }} className=\"w-full p-2 border border-gray-300 rounded-lg h-14 text-sm\" placeholder=\"e.g., '...which led to incorrect projections being shared with the client.'\"></textarea>\n\n                    <Button \n                        onClick={generateCritique} \n                        disabled={!canAnalyze || isGenerating} \n                        className=\"w-full mt-4 bg-[#219E8B] hover:bg-[#349881]\"\n                    >\n                        {isGenerating ? (\n                            <span className=\"flex items-center justify-center\">\n                                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                                Running AI Critique...\n                            </span>\n                        ) : (\n                            <span className=\"flex items-center justify-center\">\n                                <Cpu className='w-4 h-4 mr-2' /> Get AI Critique & Refinement\n                            </span>\n                        )}\n                    </Button>\n                </Card>\n\n                <Card title=\"Step 3: Review & Launch\" icon={CheckCircle} className={currentStep === 3 ? 'border-4 border-dashed border-green-500 bg-green-50' : 'opacity-70'}>\n                    <p className=\"text-gray-700 text-sm mb-4\">Final preparation check. Are you ready to enter the simulation?</p>\n                    \n                    <div className='p-3 bg-white rounded-lg border border-gray-200'>\n                        <h4 className='font-bold text-[#0B3B5B] mb-1'>Objective:</h4>\n                        <p className='text-sm text-gray-700 italic'>{objective || 'Objective not yet set.'}</p>\n                    </div>\n\n                    <div className={`p-3 mt-3 rounded-lg border ${refinedFeedback ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`}>\n                        <h4 className='font-bold text-[#0B3B5B] mb-1'>Refined SBI:</h4>\n                        <p className='text-sm text-gray-700 italic'>{refinedFeedback || 'AI critique must be run before starting.'}</p>\n                    </div>\n\n                    <Button \n                        onClick={handleLaunchRolePlay} // FIX: Use corrected local handler\n                        disabled={!isPrepComplete} \n                        className=\"mt-6 w-full\"\n                    >\n                        <Play className=\"w-5 h-5 mr-2\" /> Launch Role-Play Simulation\n                    </Button>\n                </Card>\n            </div>\n\n\n            {/* RIGHT COLUMN: AI Feedback Panel */}\n            <div className='lg:w-1/3'>\n                {critiqueHtml && (\n                    <Card title=\"AI Critique (SBI Audit)\" icon={Eye} className=\"mt-0 border-4 border-[#0B3B5B]\">\n                        <div className=\"prose max-w-none prose-h2:text-[#0B3B5B] prose-h2:text-xl prose-h2:font-extrabold prose-h3:text-[#219E8B] prose-p:text-gray-700 prose-ul:space-y-2\">\n                            <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                        </div>\n                         {refinedFeedback && (\n                            <div className='mt-4 pt-4 border-t border-gray-200'>\n                                <h4 className='font-bold text-[#219E8B] flex items-center mb-2'><ShieldCheck className='w-4 h-4 mr-1'/> Confirmed Refined Feedback:</h4>\n                                <p className='text-sm text-gray-700 font-medium italic'>{refinedFeedback}</p>\n                            </div>\n                         )}\n                    </Card>\n                )}\n\n                 <Card title=\"Scenario Context\" icon={Info} className={`mt-6 ${!critiqueHtml ? '' : 'lg:mt-8'} bg-[#219E8B]/10 border-2 border-[#219E8B]/20`}>\n                    <h4 className='font-bold text-[#0B3B5B] mb-2'>Persona: {scenario.persona}</h4>\n                    <p className=\"text-sm text-gray-700\">{scenario.description}</p>\n                    <p className='text-xs text-[#E04E1B] mt-4'>**AI Tip:** {scenario.persona} will likely resist the Impact statement. Lead with empathy before delivering the SBI.</p>\n                </Card>\n\n            </div>\n        </div>\n    </div>\n    );\n};\n\n\n// --- SCENARIO LIBRARY VIEW (Unchanged) ---\nconst ScenarioLibraryView = ({ setCoachingLabView, setSelectedScenario }) => {\n    const [isDynamicGeneratorVisible, setIsDynamicGeneratorVisible] = useState(false);\n    \n    // Load scenarios from database via useAppServices\n    const { SCENARIO_CATALOG } = useAppServices();\n    const scenarios = useMemo(() => SCENARIO_CATALOG?.items || [], [SCENARIO_CATALOG]);\n    \n    \n    return (\n    <div className=\"p-8\">\n    <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Scenario Library: Practice Conversations</h1>\n    <p className=\"text-lg text-gray-600 mb-6\">Select a high-stakes scenario to practice your preparation process. Each scenario includes a unique persona for the AI simulator.</p>\n    <Button onClick={() => setCoachingLabView('coaching-lab-home')} variant=\"outline\" className=\"mb-8\">\n    <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Coaching Lab\n    </Button>\n    \n      <Card title=\"Dynamic Scenario Generator\" icon={Zap} className=\"mb-6 bg-[#0B3B5B]/10 border-l-4 border-[#E04E1B] rounded-3xl\" onClick={() => setIsDynamicGeneratorVisible(true)}>\n            <p className=\"text-gray-700 text-sm\">Create a custom, adaptive scenario by choosing a core conflict and adding a unique **modifier** (e.g., personality, circumstance, or context).</p>\n            <div className=\"mt-4 text-[#E04E1B] font-semibold flex items-center\">\n                Launch Generator <CornerRightUp className='w-4 h-4 ml-1'/>\n            </div>\n      </Card>\n      \n      <h2 className='text-xl font-bold text-[#0B3B5B] mb-4 border-b pb-1'>Pre-Seeded Scenarios</h2>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {scenarios.map(scenario => (\n          <Card key={scenario.id} title={scenario.title} className=\"border-l-4 border-[#219E8B] rounded-3xl\" onClick={() => {\n            setSelectedScenario(scenario);\n            setCoachingLabView('scenario-prep');\n          }}>\n            <p className=\"text-sm text-gray-700 mb-3\">{scenario.description}</p>\n            <div className=\"text-xs font-semibold text-[#0B3B5B] bg-[#0B3B5B]/10 px-3 py-1 rounded-full inline-block\">Persona: {scenario.persona}</div>\n            <div className=\"mt-4 text-[#219E8B] font-semibold flex items-center\">\n              Start Preparation &rarr;\n            </div>\n          </Card>\n        ))}\n      </div>\n      \n      {/* FIX: Pass setIsDynamicGeneratorVisible setter function */}\n      {isDynamicGeneratorVisible && <DynamicScenarioGenerator setCoachingLabView={setCoachingLabView} setSelectedScenario={setSelectedScenario} setIsDynamicGeneratorVisible={setIsDynamicGeneratorVisible} />}\n    </div>\n    \n    \n    );\n};\n\n\n// --- ACTIVE LISTENING VIEW (Unchanged) ---\nconst ActiveListeningView = ({ setCoachingLabView }) => {\n    // ... (ActiveListeningView implementation remains unchanged) ...\n    const services = useAppServices();\n    const { callSecureGeminiAPI, hasGeminiKey } = services;\n\n    const [responses, setResponses] = useState({ q1: '', q2: '' });\n    const [critique, setCritique] = useState(null);\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n    const [isGenerating, setIsGenerating] = useState(false);\n    \n    const [rewrite, setRewrite] = useState('');\n    const [rewriteAudit, setRewriteAudit] = useState(null);\n    const [isRewriting, setIsRewriting] = useState(false);\n    \n    const handleChange = (e) => {\n        setResponses({ ...responses, [e.target.name]: e.target.value });\n        setCritique(null);\n        setCritiqueHtml('');\n        setRewriteAudit(null);\n    };\n    \n    useEffect(() => {\n        if (!critique) { setCritiqueHtml(''); return; }\n        (async () => setCritiqueHtml(await mdToHtml(critique)))();\n    }, [critique]);\n    \n    const getScore = (critiqueText, auditName) => {\n        const regex = new RegExp(`${auditName}.*?\\\\(Score:\\\\s*(\\\\d+)/100\\\\)`, 'i');\n        const match = critiqueText.match(regex);\n        return match ? parseInt(match[1], 10) : null;\n    };\n    \n    const handleSubmit = async () => {\n        if (!responses.q1.trim() || !responses.q2.trim()) {\n            console.warn(\"Please provide a response for both prompts before submitting for coach feedback.\");\n            return;\n        }\n\n        setIsGenerating(true);\n        setCritique(null);\n        setRewriteAudit(null);\n\n        if (!hasGeminiKey()) {\n            setCritique(\"## AI Critique Unavailable\\n\\n**ERROR**: The Gemini API Key is missing. AI Role-Play is unavailable.\");\n            setIsGenerating(false);\n            return;\n        }\n\n        const userQuery = `Critique the following active listening responses from a manager:\n\n**Prompt 1 (The Paraphrase):** The employee said, \"I feel overwhelmed by the deadlines and the number of meetings this week.\" The manager's draft paraphrase is: \"${responses.q1.trim()}\"\n\n**Prompt 2 (Open-Ended Inquiry):** The situation is a team setback and defeat. The manager's draft open-ended question is: \"${responses.q2.trim()}\"\n\nCritique Guidelines (Use Markdown):\n1.  **Paraphrase Critique (## The Paraphrase Audit (Score: X/100)):** Assess if the manager successfully confirmed understanding without adding judgment or offering a solution. Provide a confidence score (0-100) in the header. Suggest a better, more concise option if needed.\n2.  **Question Critique (## The Inquiry Audit (Score: Y/100)):** Assess if the question is truly open-ended (not answerable with Yes/No) and if it successfully invites vulnerability and insight in a safe way. Provide a confidence score (0-100) in the header. Provide a refined, more empathetic alternative.\n3.  **Overall Takeaway (### Core Skill Focus):** Give one final, actionable coaching point.\n`;\n\n        const systemPrompt = \"You are an executive coach specializing in developing empathetic and effective active listening skills. Your critique must be objective, use clear Markdown formatting, and provide concrete, actionable alternatives for improvement. Crucially, you MUST include a score out of 100 in parentheses in the header of each audit section (e.g., '## The Paraphrase Audit (Score: 85/100)').\";\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: services.GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Could not generate critique. Please try again.\";\n            setCritique(aiText);\n\n        } catch (error) {\n            console.error(\"Gemini API Error:\", error);\n            setCritique(\"An error occurred while connecting to the AI coach. Please check your network connection.\");\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n    \n    // NEW: Handle Rewrite Challenge Submission\n    const handleRewriteAudit = async () => {\n        if (!rewrite.trim() || !critique || isRewriting) return;\n\n        setIsRewriting(true);\n        setRewriteAudit(null);\n\n        const systemPrompt = \"You are an AI auditor. The user has rewritten their response to a paraphrase prompt after receiving feedback. Judge the rewritten response against the core principles of empathy and non-judgemental confirmation. Score the final result out of 100 and provide concise analysis.\";\n\n        const userQuery = `Audit the Rewritten Response. The original prompt was the employee saying: \"I feel overwhelmed by the deadlines and the number of meetings this week.\" \n        \n        The user's Rewritten Response is: \"${rewrite.trim()}\" \n        \n        The original AI Critique stated: [${critique.substring(0, 100)}...].\n        \n        Score the rewritten response out of 100 and provide analysis.`;\n        \n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: services.GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Rewrite audit failed.\";\n            setRewriteAudit(aiText);\n\n        } catch (e) {\n            console.error(\"Rewrite Audit Error:\", e);\n            setRewriteAudit(\"Rewrite audit failed due to API error.\");\n        } finally {\n            setIsRewriting(false);\n        }\n    };\n\n\n    const paraphraseScore = critique ? getScore(critique, 'The Paraphrase Audit') : null;\n    const inquiryScore = critique ? getScore(critique, 'The Inquiry Audit') : null;\n    const totalScore = (paraphraseScore !== null && inquiryScore !== null) ? Math.round((paraphraseScore + inquiryScore) / 2) : null;\n    \n    return (\n    <div className=\"p-8\">\n    <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Active Listening & Reflection Prompts</h1>\n    <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Active listening means validating emotion and confirming understanding before attempting to solve the problem. Practice the two pillars below to build empathy and psychological safety in high-stakes conversations.</p>\n    <Button onClick={() => setCoachingLabView('coaching-lab-home')} variant=\"outline\" className=\"mb-8\">\n    <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Coaching Lab\n    </Button>\n    \n      <div className=\"space-y-8\">\n        <Card title=\"Reflection 1: The Paraphrase (Confirming Understanding)\" icon={Mic}>\n          <p className=\"text-gray-700 mb-3\">**Scenario:** A direct report just told you, \"I feel overwhelmed by the deadlines and the number of meetings this week.\" How would you **paraphrase** their statement back to them? <span className='font-semibold text-[#219E8B]'>(Rule: Must not offer a solution or advice.)</span></p>\n          <textarea name=\"q1\" value={responses.q1} onChange={handleChange} className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#219E8B] focus:border-[#219E8B] h-24\" placeholder=\"Draft your paraphrased response here...\"></textarea>\n          {paraphraseScore !== null && (\n               <div className={`mt-3 p-3 rounded-lg font-bold text-lg ${paraphraseScore > 80 ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>\n                Confidence Score: {paraphraseScore}%\n               </div>\n          )}\n        </Card>\n    \n        <Card title=\"Reflection 2: Open-Ended Inquiry (Inviting Depth)\" icon={Mic}>\n          <p className=\"text-gray-700 mb-3\">**Scenario:** Your team has just experienced a major setback on a flagship project. They are visibly defeated. What **open-ended question** would you use to invite them to share their feelings and insights, showing empathy and psychological safety?</p>\n          <textarea name=\"q2\" value={responses.q2} onChange={handleChange} className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#219E8B] focus:border-[#219E8B] h-24\" placeholder=\"Draft your open-ended question here...\"></textarea>\n           {inquiryScore !== null && (\n               <div className={`mt-3 p-3 rounded-lg font-bold text-lg ${inquiryScore > 80 ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>\n                Confidence Score: {inquiryScore}%\n               </div>\n          )}\n        </Card>\n      </div>\n    \n        <Tooltip\n            content={hasGeminiKey() \n                ? \"Submits your responses to the AI Coach for structured critique.\" \n                : \"Requires Gemini API Key to run. Check App Settings.\"\n            }\n        >\n            <Button onClick={handleSubmit} disabled={isGenerating || !responses.q1.trim() || !responses.q2.trim()} className=\"mt-10 w-full md:w-auto\">\n                {isGenerating ? (\n                    <div className=\"flex items-center\">\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                        Auditing Listening Skills...\n                    </div>\n                ) : 'Submit for Coach Feedback'}\n            </Button>\n        </Tooltip>\n      \n      {critiqueHtml && (\n        <Card accent=\"TEAL\" title=\"Active Listening Auditor Feedback\" icon={CheckCircle} className=\"mt-8 bg-[#0B3B5B]/10 border border-[#0B3B5B]/20 rounded-3xl\">\n           {totalScore !== null && (\n                <div className={`text-4xl font-extrabold mb-4 p-3 rounded-xl border-l-8 ${totalScore > 80 ? 'text-green-700 border-green-500 bg-green-50' : 'text-[#E04E1B] border-[#E04E1B] bg-red-50'}`}>\n                    Overall Score: {totalScore}%\n                </div>\n            )}\n          <div className=\"prose max-w-none prose-h2:text-[#0B3B5B] prose-h2:border-b prose-h2:pb-2 prose-h3:text-[#219E8B] prose-p:text-gray-700 prose-ul:space-y-2\">\n            <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n          </div>\n          \n          {/* NEW FEATURE: Rewrite Challenge */}\n          <div className='mt-8 pt-6 border-t border-gray-200'>\n                <h3 className='text-xl font-bold text-[#0B3B5B] mb-3 flex items-center'><CornerRightUp className='w-5 h-5 mr-2 text-[#E04E1B]'/> Rewrite Challenge (Self-Correction)</h3>\n                <p className='text-sm text-gray-700 mb-3'>Based on the AI's critique, rewrite your **Paraphrase** (Reflection 1) to correct your mistake. Focus on non-judgmental confirmation.</p>\n                \n                <textarea \n                    value={rewrite}\n                    onChange={(e) => {setRewrite(e.target.value); setRewriteAudit(null);}}\n                    className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-[#E04E1B] focus:border-[#E04E1B] h-24 mb-3\" \n                    placeholder=\"Rewrite your perfect paraphrase here...\"\n                    disabled={isRewriting}\n                />\n                \n                {rewriteAudit && (\n                    <Card title=\"Final Audit Result\" icon={Eye} className='bg-white shadow-lg border-l-4 border-dashed border-[#219E8B]'>\n                        <div className=\"prose max-w-none prose-h2:text-[#0B3B5B] prose-h3:text-[#219E8B]\">\n                            <div dangerouslySetInnerHTML={{ __html: rewriteAudit }} />\n                        </div>\n                    </Card>\n                )}\n\n                <Button onClick={handleRewriteAudit} disabled={isRewriting || !rewrite.trim()} className='mt-3 w-full bg-[#2563EB] hover:bg-[#1E40AF]'>\n                     {isRewriting ? \n                        <span className=\"flex items-center justify-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div> Auditing Rewrite...</span>\n                        : <><Cpu className='w-4 h-4 mr-2'/> Audit Corrected Response</>\n                    }\n                </Button>\n            </div>\n        </Card>\n      )}\n    </div>\n    \n    \n    );\n};\n\n\n// --- PRACTICE LOG VIEW (Unchanged) ---\nconst PracticeLogView = ({ setCoachingLabView }) => {\n    // FIX: Use real hook\n    const { navigate, commitmentData } = useAppServices();\n    \n    // PRODUCTION FIX: Get practice sessions from the commitmentData service\n    const practiceSessions = commitmentData?.practice_history || [];\n\n    return (\n        <div className=\"p-8\">\n            <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Practice Log: History & Growth</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Review your past Role-Play sessions, see your scores, and track your progress against key takeaways.</p>\n            \n            <Button onClick={() => setCoachingLabView('coaching-lab-home')} variant=\"outline\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Coaching Lab\n            </Button>\n            \n            <div className=\"space-y-4\">\n                {practiceSessions.map(session => (\n                    <Card key={session.id} title={`${session.title} (${session.score}%)`} icon={BarChart3} className=\"border-l-4 border-[#2563EB] flex justify-between items-center\" onClick={() => console.log(\"Navigate to detailed critique for session\", session.id)}>\n                        <div>\n                            <p className=\"text-sm text-gray-700 mb-1\">**Date:** {session.date} | **Difficulty:** {session.difficulty}</p>\n                            <p className=\"text-sm font-semibold text-[#E04E1B] mt-1\">Key Insight: {session.takeaway}</p>\n                        </div>\n                        <div className=\"text-sm text-[#2563EB] font-bold\">View Critique &rarr;</div>\n                    </Card>\n                ))}\n                {practiceSessions.length === 0 && <p className=\"text-gray-500 italic\">No completed practice sessions found. Launch a scenario to get started!</p>}\n            </div>\n        </div>\n    );\n};\n\n\n// --- Dynamic Generator View (Unchanged) ---\nconst DynamicScenarioGenerator = ({ setCoachingLabView, setSelectedScenario, setIsDynamicGeneratorVisible }) => {\n    const services = useAppServices();\n    const { callSecureGeminiAPI, GEMINI_MODEL } = services;\n\n    const baseScenarios = [\n        { id: 1, title: 'The Missing Deadline', description: 'Consistently missing reports.', persona: 'The Deflector' },\n        { id: 2, title: 'The Client Conflict', description: 'Overstepped authority with a client.', persona: 'The Defender' },\n        { id: 3, title: 'The Quiet Worker', description: 'Disengaged and silent in meetings.', persona: 'The Silent Stonewall' },\n    ];\n\n    const [selectedBaseId, setSelectedBaseId] = useState(1);\n    const [modifier, setModifier] = useState('');\n    const [modifiedScenario, setModifiedScenario] = useState(baseScenarios[0]);\n    const [isGenerating, setIsGenerating] = useState(false);\n    \n    const selectedBase = useMemo(() => baseScenarios.find(s => s.id === selectedBaseId) || baseScenarios[0], [selectedBaseId]);\n\n    const handleGenerate = async () => {\n        setIsGenerating(true);\n        setModifiedScenario(null);\n\n        const systemPrompt = \"You are an expert scenario designer for executive coaching. Given a base scenario and a modifier, generate a single, highly realistic and challenging scenario in Markdown format. The persona must be a variation of the base persona, adapted to the modifier. Strictly provide the output using the structure below. Do not add any extra text or conversation.\";\n        \n        const userQuery = `Base Scenario: ${selectedBase.title} - ${selectedBase.description} (Persona: ${selectedBase.persona}).\n        Modifier: ${modifier}.\n        Generate the new scenario, incorporating the modifier into the description and title. Use this exact Markdown structure:\n        \n        ## Generated Scenario\n        \n        ### Title: The [Modified Title]\n        \n        ### Description: [Full, compelling description incorporating the modifier's challenge]\n        \n        ### Persona: The [Modified Persona]`;\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: GEMINI_MODEL,\n            };\n\n            const result = await callSecureGeminiAPI(payload);\n            const aiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || \"Generation failed.\";\n            \n            const titleMatch = aiText.match(/### Title: (.*)/);\n            const descMatch = aiText.match(/### Description: (.*)/);\n            const personaMatch = aiText.match(/### Persona: (.*)/);\n\n            if (titleMatch && descMatch && personaMatch) {\n                setModifiedScenario({\n                    id: `DYN-${Date.now()}`,\n                    title: titleMatch[1].trim(),\n                    description: descMatch[1].trim(),\n                    persona: personaMatch[1].trim(),\n                });\n            } else {\n                console.error(\"AI parse failed, falling back to local mock.\");\n                setModifiedScenario({\n                    id: `DYN-${Date.now()}`,\n                    title: `${selectedBase.title} (Customized)`,\n                    description: `${selectedBase.description} (Modified by: ${modifier})`,\n                    persona: selectedBase.persona,\n                });\n            }\n\n        } catch (error) {\n            console.error(\"Dynamic Scenario Generation Error:\", error);\n            setModifiedScenario({\n                id: `DYN-${Date.now()}`,\n                title: `${selectedBase.title} (Customized)`,\n                description: `${selectedBase.description} (Modified by: ${modifier})`,\n                persona: selectedBase.persona,\n            });\n        } finally {\n            setIsGenerating(false);\n        }\n    };\n\n    useEffect(() => {\n        if (selectedBase) {\n            setModifiedScenario(selectedBase);\n        }\n    }, [selectedBase]);\n\n    const handleLaunch = () => {\n        if (modifiedScenario) {\n            setSelectedScenario(modifiedScenario);\n            setCoachingLabView('scenario-prep');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-[#0B3B5B]/90 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-[#FCFCFA] rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8\">\n                <div className=\"flex justify-between items-center border-b pb-4 mb-6\">\n                    <h2 className=\"text-2xl font-extrabold text-[#0B3B5B] flex items-center\">\n                        <Zap className=\"w-6 h-6 mr-3 text-[#E04E1B]\" />\n                        Dynamic Scenario Generator\n                    </h2>\n                    {/* FIX: Use setIsDynamicGeneratorVisible to set state to false */}\n                    <button onClick={() => setIsDynamicGeneratorVisible(false)} className=\"p-2 text-gray-500 hover:text-[#E04E1B] transition-colors\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                <div className='space-y-4'>\n                    <label className=\"block text-sm font-medium text-gray-700\">1. Select Base Conflict</label>\n                    <select\n                        value={selectedBaseId}\n                        onChange={(e) => setSelectedBaseId(parseInt(e.target.value))}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl\"\n                        disabled={isGenerating}\n                    >\n                        {baseScenarios.map(s => (\n                            <option key={s.id} value={s.id}>{s.title} (Persona: {s.persona})</option>\n                        ))}\n                    </select>\n\n                    <label className=\"block text-sm font-medium text-gray-700 pt-4\">2. Add Scenario Modifier (Optional)</label>\n                    <input\n                        type=\"text\"\n                        value={modifier}\n                        onChange={(e) => setModifier(e.target.value)}\n                        placeholder=\"e.g., 'They are an intern' or 'Conflict is over budget cuts'\"\n                        className=\"w-full p-3 border border-gray-300 rounded-xl\"\n                        disabled={isGenerating}\n                    />\n\n                    <Button onClick={handleGenerate} disabled={!selectedBase || isGenerating} className=\"w-full bg-[#E04E1B] hover:bg-red-700\">\n                        {isGenerating ? \n                            <span className=\"flex items-center justify-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div> Generating...</span> \n                            : 'Generate Adaptive Scenario'\n                        }\n                    </Button>\n                </div>\n                \n                {modifiedScenario && (\n                    <Card title=\"Generated Scenario Preview\" icon={Info} className='mt-6 bg-[#219E8B]/10 border-2 border-[#219E8B]/20'>\n                        <h4 className='text-lg font-bold text-[#0B3B5B]'>{modifiedScenario.title}</h4>\n                        <p className='text-sm text-gray-700 mt-2'>{modifiedScenario.description}</p>\n                        <p className='text-xs text-[#0B3B5B] mt-3 font-semibold'>AI Role: {modifiedScenario.persona}</p>\n                    </Card>\n                )}\n\n                <Button onClick={handleLaunch} disabled={!modifiedScenario} className='mt-8 w-full'>\n                    Launch Prep with Dynamic Scenario\n                </Button>\n            </div>\n        </div>\n    );\n};\n\n\n// --- MAIN COACHING LAB ROUTER ---\nexport default function CoachingLabScreen() {\n    // FIX: Use real hook\n    const { navigate } = useAppServices();\n\n    const [view, setView] = useState('coaching-lab-home');\n    const [selectedScenario, setSelectedScenario] = useState(null);\n    const [preparedSBI, setPreparedSBI] = useState(null);\n\n    // CRITICAL FIX: Scroll to the top whenever the view state changes\n    useEffect(() => {\n        if (typeof window !== 'undefined') {\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n        }\n    }, [view]);\n\n    const renderView = () => {\n        const viewProps = { setCoachingLabView: setView, setSelectedScenario };\n\n        switch (view) {\n            case 'scenario-library':\n                return <ScenarioLibraryView {...viewProps} />;\n            case 'scenario-prep':\n                return <ScenarioPreparationView \n                    scenario={selectedScenario} \n                    setCoachingLabView={setView} \n                    setPreparedSBI={setPreparedSBI} \n                />;\n            case 'role-play':\n                // Check if session ended and needs to go to critique\n                // PRODUCTION FIX: The sessionEnded state is now managed within the RolePlayView\n                // This state check logic is simplified since RolePlayView handles its own critique display\n                if (selectedScenario) {\n                    return <RolePlayView \n                        scenario={selectedScenario} \n                        setCoachingLabView={setView}\n                        preparedSBI={preparedSBI}\n                        difficultyLevel={selectedScenario.difficultyLevel || 50}\n                    />;\n                }\n                // Fallback if role-play state is invalid\n                return <ScenarioLibraryView {...viewProps} />;\n\n            case 'feedback-prep':\n                return <LeanFeedbackPrepView setCoachingLabView={setView} setPreparedSBI={setPreparedSBI} />;\n            case 'active-listening':\n                return <ActiveListeningView setCoachingLabView={setView} />;\n            case 'practice-log':\n                return <PracticeLogView setCoachingLabView={setView} />;\n            case 'coaching-lab-home':\n            default:\n                return (\n                    <div className=\"p-8\">\n                        <h1 className=\"text-3xl font-extrabold text-[#0B3B5B] mb-4\">Coaching & Crucial Conversations Lab</h1>\n                        <p className=\"text-lg text-gray-600 mb-8 max-w-3xl\">Practice key leadership interactions using guided tools and receive real-time AI critique to sharpen your skills.</p>\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                            <Card title=\"Scenario Library & Prep Pipeline\" icon={Users} onClick={() => setView('scenario-library')} className=\"border-l-4 border-[#219E8B] rounded-3xl\">\n                                <p className=\"text-gray-700 text-sm\">Select a scenario or **dynamically generate one** to start a fully interactive AI role-play session.</p>\n                                <div className=\"mt-4 text-[#219E8B] font-semibold flex items-center\">\n                                    Launch Library &rarr;\n                                </div>\n                            </Card>\n                            <Card title=\"Feedback Prep Tool (SBI Audit)\" icon={Briefcase} onClick={() => setView('feedback-prep')} className=\"border-l-4 border-[#0B3B5B] rounded-3xl\">\n                                <p className=\"text-gray-700 text-sm\">Draft difficult feedback using the SBI model and get instant, professional critique and refinement for **real-world use**.</p>\n                                <div className=\"mt-4 text-[#0B3B5B] font-semibold flex items-center\">\n                                    Launch Prep Tool &rarr;\n                                </div>\n                            </Card>\n                            <Card accent=\"TEAL\" title=\"Active Listening Auditor\" icon={Mic} onClick={() => setView('active-listening')} className=\"border-l-4 border-[#219E8B] rounded-3xl\">\n                                <p className=\"text-gray-700 text-sm\">Exercises to develop empathy, using paraphrasing and open-ended questions. Get a **quantifiable score** on your response quality.</p>\n                                <div className=\"mt-4 text-[#219E8B] font-semibold flex items-center\">\n                                    Launch Exercises &rarr;\n                                </div>\n                            </Card>\n                            <Card accent=\"BLUE\" title=\"Practice History Log\" icon={BarChart3} onClick={() => setView('practice-log')} className=\"border-l-4 border-[#2563EB] rounded-3xl\">\n                                <p className=\"text-gray-700 text-sm\">Review your past session scores, track your skill growth over time, and revisit key takeaways.</p>\n                                <div className=\"mt-4 text-[#2563EB] font-semibold flex items-center\">\n                                    View Log &rarr;\n                                </div>\n                            </Card>\n                        </div>\n                    </div>\n                );\n        }\n    };\n\n    return (\n      <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG, color: COLORS.TEXT }}>\n        <h1 className=\"text-4xl font-extrabold mb-10\" style={{ color: COLORS.NAVY }}>Professional Coaching Lab</h1>\n        {renderView()}\n      </div>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/LeadershipVideos.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":365,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":365,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/LeadershipVideos.jsx (Refactored for Consistency)\n\nimport React, { useEffect, useMemo, useState } from 'react';\n// --- Icons ---\nimport { Film, User, Clock, ArrowRight, Zap, Briefcase, ArrowLeft, Search, Filter, Play, BookOpen, Users, Target, Lightbulb, TrendingUp, Star } from 'lucide-react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- CORPORATE COLORS (STRICT COMPLIANCE) ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#002E47', ORANGE: '#E04E1B', GREEN: '#47A88D', AMBER: '#E04E1B', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#47A88D', TEXT: '#002E47', MUTED: '#349881', PURPLE: '#47A88D', BG: '#FCFCFA' }; // CORPORATE COLORS ONLY!\n\n// --- Standardized Button Component (Local Definition, Styled Consistently) ---\n// Note: Ideally, this would be imported from a shared UI library.\n// Kept local as per original file structure, but styles updated to match standard.\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => {\n  let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n  if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n  if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n  else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n  if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n  return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n\n/**\n * Enhanced VideoCard Component\n * Corporate-styled video card with thumbnails, ratings, and enhanced metadata\n */\nconst VideoCard = ({ title, speaker, duration, url, description, accent, category, rating, views, tags = [] }) => {\n    const accentColor = COLORS[accent] || COLORS.NAVY;\n    \n    // Generate YouTube thumbnail URL from video URL\n    const getThumbnail = (videoUrl) => {\n        const videoId = videoUrl.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&\\n?#]+)/)?.[1];\n        return videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : '/api/placeholder/320/180';\n    };\n\n    return (\n        <div className=\"card-corporate group cursor-pointer transition-all duration-300 hover:scale-105\">\n            {/* Corporate accent border */}\n            <div className=\"absolute top-0 left-0 right-0 h-1 rounded-t-xl\" style={{ background: accentColor }}></div>\n            \n            {/* Thumbnail Section */}\n            <div className=\"relative overflow-hidden rounded-t-lg mb-4\">\n                <img \n                    src={getThumbnail(url)} \n                    alt={`${title} thumbnail`}\n                    className=\"w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300\"\n                    loading=\"lazy\"\n                />\n                <div className=\"absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors duration-300 flex items-center justify-center\">\n                    <div className=\"w-16 h-16 bg-white/90 rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\n                        <Play className=\"w-6 h-6 ml-1\" style={{ color: accentColor }} />\n                    </div>\n                </div>\n                {/* Duration badge */}\n                <div className=\"absolute bottom-2 right-2 bg-black/80 text-white px-2 py-1 rounded text-xs font-medium\">\n                    {duration}\n                </div>\n                {/* Rating badge */}\n                {rating && (\n                    <div className=\"absolute top-2 right-2 bg-white/90 px-2 py-1 rounded flex items-center text-xs font-medium\">\n                        <Star className=\"w-3 h-3 mr-1\" style={{ color: COLORS.ORANGE, fill: COLORS.ORANGE }} />\n                        {rating}\n                    </div>\n                )}\n            </div>\n\n            {/* Content Section */}\n            <div className=\"flex-grow\">\n                {/* Category badge */}\n                {category && (\n                    <div className=\"inline-block px-3 py-1 rounded-full text-xs font-medium mb-2\" \n                         style={{ backgroundColor: `${accentColor}20`, color: accentColor }}>\n                        {category}\n                    </div>\n                )}\n                \n                {/* Title */}\n                <h3 className=\"corporate-heading-md mb-2 line-clamp-2 group-hover:text-current transition-colors\">\n                    {title}\n                </h3>\n                \n                {/* Speaker & Metadata */}\n                <div className=\"flex items-center gap-4 mb-3 text-sm\" style={{ color: COLORS.MUTED }}>\n                    <div className=\"flex items-center\">\n                        <User className=\"w-4 h-4 mr-1\" />\n                        {speaker}\n                    </div>\n                    {views && (\n                        <div className=\"flex items-center\">\n                            <TrendingUp className=\"w-4 h-4 mr-1\" />\n                            {views}\n                        </div>\n                    )}\n                </div>\n                \n                {/* Description */}\n                <p className=\"corporate-text-body text-sm mb-4 line-clamp-3\">\n                    {description}\n                </p>\n                \n                {/* Tags */}\n                {tags.length > 0 && (\n                    <div className=\"flex flex-wrap gap-1 mb-4\">\n                        {tags.slice(0, 3).map((tag, index) => (\n                            <span \n                                key={index}\n                                className=\"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md\"\n                            >\n                                #{tag}\n                            </span>\n                        ))}\n                    </div>\n                )}\n            </div>\n\n            {/* Action Button */}\n            <a \n                href={url} \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"btn-corporate-primary w-full mt-4\"\n            >\n                <Play className=\"w-4 h-4 mr-2\" />\n                Watch Video\n            </a>\n        </div>\n    );\n};\n\n// --- ENHANCED VIDEO CATALOG (COMPREHENSIVE LEADERSHIP CONTENT) ---\nconst ENHANCED_VIDEO_CATALOG = {\n    \"INSPIRATIONAL\": [\n        { \n            id: \"sinek-why\", \n            title: \"How great leaders inspire action\", \n            speaker: \"Simon Sinek\", \n            duration: \"18 min\", \n            url: \"https://www.youtube.com/watch?v=u4ZoJKF_VuA\", \n            description: \"The foundational concept of starting with 'Why' (The Golden Circle) to build loyalty and inspire action. A must-watch for defining purpose.\",\n            category: \"Vision & Purpose\",\n            rating: 4.9,\n            views: \"60M+ views\",\n            tags: [\"vision\", \"purpose\", \"inspiration\", \"golden-circle\"]\n        },\n        { \n            id: \"sinek-infinite\", \n            title: \"The Infinite Game: The Trap Leaders Must Avoid\", \n            speaker: \"Simon Sinek\", \n            duration: \"11 min\", \n            url: \"https://www.youtube.com/watch?v=RyTQ5-SQYTo\", \n            description: \"How to shift your mindset from playing to win (finite) to playing to advance your cause (infinite), focusing on resilience and long-term vision.\",\n            category: \"Mindset\",\n            rating: 4.7,\n            views: \"2.5M+ views\",\n            tags: [\"mindset\", \"strategy\", \"long-term\", \"resilience\"]\n        },\n        { \n            id: \"cuddy-presence\", \n            title: \"Your Body Language May Shape Who You Are\", \n            speaker: \"Amy Cuddy\", \n            duration: \"21 min\", \n            url: \"https://www.youtube.com/watch?v=Ks-_Mh1QhMc\", \n            description: \"Examines how 'power posing'—changing your body language—can change the chemicals in your brain and impact your leadership confidence.\",\n            category: \"Executive Presence\",\n            rating: 4.8,\n            views: \"70M+ views\",\n            tags: [\"confidence\", \"presence\", \"body-language\", \"psychology\"]\n        },\n        { \n            id: \"brown-vulnerability\", \n            title: \"The power of vulnerability\", \n            speaker: \"Brené Brown\", \n            duration: \"20 min\", \n            url: \"https://www.youtube.com/watch?v=iCvmsMYoE_A\", \n            description: \"A powerful talk on how vulnerability is not weakness, but the birthplace of innovation, creativity, and deeper trust.\",\n            category: \"Authentic Leadership\",\n            rating: 4.9,\n            views: \"50M+ views\",\n            tags: [\"vulnerability\", \"trust\", \"authenticity\", \"courage\"]\n        },\n        { \n            id: \"duckworth-grit\", \n            title: \"The Key to Success? Grit\", \n            speaker: \"Angela Lee Duckworth\", \n            duration: \"6 min\", \n            url: \"https://www.youtube.com/watch?v=H14bBuluwB8\", \n            description: \"Explains that the secret to outstanding achievement is not genius, but a special blend of passion and persistence called 'grit'.\",\n            category: \"Resilience\",\n            rating: 4.6,\n            views: \"30M+ views\",\n            tags: [\"grit\", \"persistence\", \"success\", \"psychology\"]\n        },\n        { \n            id: \"dalio-principles\", \n            title: \"How to Build a Company Where the Best Ideas Win\", \n            speaker: \"Ray Dalio\", \n            duration: \"5 min\", \n            url: \"https://www.youtube.com/watch?v=M95m2EFb7IQ\", \n            description: \"The founder of the world's largest hedge fund discusses creating an 'idea meritocracy' where people can speak up and say what they really think.\",\n            category: \"Culture Building\",\n            rating: 4.5,\n            views: \"5M+ views\",\n            tags: [\"culture\", \"meritocracy\", \"feedback\", \"transparency\"]\n        }\n    ],\n    \"ACTIONABLE\": [\n        { \n            id: \"sinek-micro\", \n            title: \"The Key to Effective Leadership: Micro-Behaviors\", \n            speaker: \"Simon Sinek\", \n            duration: \"3 min\", \n            url: \"https://www.youtube.com/watch?v=ReRcHdeUG9Y\", \n            description: \"Practical demonstration of small actions (eye contact, putting the phone away) that leaders must perform consistently to build trust.\",\n            category: \"Daily Practices\",\n            rating: 4.7,\n            views: \"8M+ views\",\n            tags: [\"micro-behaviors\", \"trust\", \"daily-habits\", \"practical\"]\n        },\n        { \n            id: \"sinek-positive\", \n            title: \"Transform Your Team: The Power of Positive Leadership\", \n            speaker: \"Simon Sinek\", \n            duration: \"6 min\", \n            url: \"https://www.youtube.com/watch?v=uNtOiqp1Tzs\", \n            description: \"Actionable advice on using positive reinforcement ('catching people doing things right') to build confidence in underperformers.\",\n            category: \"Team Development\",\n            rating: 4.6,\n            views: \"3M+ views\",\n            tags: [\"positive-leadership\", \"reinforcement\", \"team-building\", \"motivation\"]\n        },\n        { \n            id: \"delegation-levels\", \n            title: \"5 Levels of Delegation and How to Use Them\", \n            speaker: \"ProjectManager\", \n            duration: \"7 min\", \n            url: \"https://www.youtube.com/watch?v=wX-jO8g047A\", \n            description: \"A practical guide to the 5 key levels of delegation (Tell, Sell, Consult, Agree, Empower) and choosing the right level for the right task.\",\n            category: \"Delegation\",\n            rating: 4.4,\n            views: \"1.5M+ views\",\n            tags: [\"delegation\", \"empowerment\", \"management\", \"frameworks\"]\n        },\n        { \n            id: \"sbi-feedback\", \n            title: \"Giving Feedback: The SBI Method\", \n            speaker: \"Training Industry\", \n            duration: \"3 min\", \n            url: \"https://www.youtube.com/watch?v=1rA5-n7a0wE\", \n            description: \"A clear, concise breakdown of the Situation, Behavior, Impact (SBI) feedback model for structured, non-judgmental performance discussions.\",\n            category: \"Feedback & Coaching\",\n            rating: 4.5,\n            views: \"2M+ views\",\n            tags: [\"feedback\", \"coaching\", \"sbi-method\", \"communication\"]\n        },\n        { \n            id: \"conflict-management\", \n            title: \"Mastering the Art of Conflict Management\", \n            speaker: \"Harvard Business Review\", \n            duration: \"4 min\", \n            url: \"https://www.youtube.com/watch?v=Q-dO0rE-4oQ\", \n            description: \"A quick, actionable overview of the Thomas-Kilmann Conflict Mode Instrument (TKI) and choosing between competing, collaborating, and compromising.\",\n            category: \"Conflict Resolution\",\n            rating: 4.3,\n            views: \"1.8M+ views\",\n            tags: [\"conflict\", \"resolution\", \"tki\", \"negotiation\"]\n        },\n        { \n            id: \"ceo-communication\", \n            title: \"How to Speak Like a CEO in Meetings\", \n            speaker: \"Executive Impressions\", \n            duration: \"10 min\", \n            url: \"https://www.youtube.com/watch?v=wh5rLnsc8LU\", \n            description: \"Tactical communication tips on speaking with clarity, enthusiasm, and confidence to ensure your message is heard by senior leaders.\",\n            category: \"Executive Communication\",\n            rating: 4.4,\n            views: \"900K+ views\",\n            tags: [\"communication\", \"executive-presence\", \"meetings\", \"influence\"]\n        }\n    ],\n    \"TEAM_BUILDING\": [\n        { \n            id: \"lencioni-dysfunction\", \n            title: \"The Five Dysfunctions of a Team\", \n            speaker: \"Patrick Lencioni\", \n            duration: \"12 min\", \n            url: \"https://www.youtube.com/watch?v=GCxct4CR-To\", \n            description: \"Learn about the five common dysfunctions that prevent teams from working together effectively and how to address each one.\",\n            category: \"Team Dynamics\",\n            rating: 4.6,\n            views: \"2.5M+ views\",\n            tags: [\"teamwork\", \"dysfunction\", \"trust\", \"collaboration\"]\n        },\n        { \n            id: \"google-aristotle\", \n            title: \"What Google Learned About High-Performing Teams\", \n            speaker: \"Google re:Work\", \n            duration: \"8 min\", \n            url: \"https://www.youtube.com/watch?v=LhoLuui9gX8\", \n            description: \"Google's Project Aristotle findings on what makes teams effective: psychological safety, dependability, structure, meaning, and impact.\",\n            category: \"Team Performance\",\n            rating: 4.7,\n            views: \"1.2M+ views\",\n            tags: [\"psychological-safety\", \"performance\", \"google\", \"research\"]\n        }\n    ],\n    \"STRATEGIC_THINKING\": [\n        { \n            id: \"porter-strategy\", \n            title: \"What is Strategy?\", \n            speaker: \"Michael Porter\", \n            duration: \"15 min\", \n            url: \"https://www.youtube.com/watch?v=mYF2_FBCvXw\", \n            description: \"Harvard Business School's Michael Porter explains what strategy really is and why it's about being different, not just being the best.\",\n            category: \"Strategy Fundamentals\",\n            rating: 4.8,\n            views: \"800K+ views\",\n            tags: [\"strategy\", \"competitive-advantage\", \"positioning\", \"harvard\"]\n        }\n    ]\n};\n\n/**\n * LeadershipVideosScreen Component\n * Displays curated lists of leadership videos categorized as Inspirational/Philosophical and Actionable/Practical.\n * Pulls video data from the VIDEO_CATALOG in useAppServices, with a local fallback.\n */\nconst LeadershipVideosScreen = () => {\n    // --- Consume services ---\n    // Get navigate function and VIDEO_CATALOG data\n    const { navigate, VIDEO_CATALOG } = useAppServices(); // cite: useAppServices.jsx\n\n    // --- Effect to scroll to top on mount ---\n    useEffect(() => {\n        // Ensure this runs only client-side\n        if (typeof window !== 'undefined') {\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n        }\n    }, []); // Empty dependency array ensures it runs only once on mount\n\n    // --- Determine Video Data Source ---\n    // Use VIDEO_CATALOG from services if available and valid, otherwise use local fallback\n    // Assumes VIDEO_CATALOG structure is { items: { INSPIRATIONAL: [...], ACTIONABLE: [...] } }\n    const VIDEO_LISTS = useMemo(() => {\n        const catalogItems = VIDEO_CATALOG?.items;\n        // Basic validation: Check if catalogItems is an object with the expected keys\n        if (catalogItems && typeof catalogItems === 'object' && catalogItems.INSPIRATIONAL && catalogItems.ACTIONABLE) {\n             console.log(\"[LeadershipVideos] Using VIDEO_CATALOG from services.\"); // Log source\n            return catalogItems;\n        } else {\n            console.warn(\"[LeadershipVideos] VIDEO_CATALOG from services is missing or invalid. Using enhanced catalog.\"); // Log warning\n            return ENHANCED_VIDEO_CATALOG;\n        }\n    }, [VIDEO_CATALOG]); // Dependency: VIDEO_CATALOG\n\n    // --- Enhanced State Management ---\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedCategory, setSelectedCategory] = useState('ALL');\n    const [selectedTag, setSelectedTag] = useState('');\n    const [viewMode, setViewMode] = useState('grid'); // 'grid' or 'list'\n\n    // --- Get Enhanced Video Data ---\n    const allVideos = useMemo(() => {\n        const videos = [];\n        // Use enhanced catalog first, fallback to service data\n        const dataSource = ENHANCED_VIDEO_CATALOG;\n        Object.keys(dataSource).forEach(category => {\n            dataSource[category].forEach(video => {\n                videos.push({ ...video, categoryKey: category });\n            });\n        });\n        return videos;\n    }, []);\n    \n    // Get all unique tags for filter dropdown\n    const allTags = useMemo(() => {\n        const tags = new Set();\n        allVideos.forEach(video => {\n            video.tags?.forEach(tag => tags.add(tag));\n        });\n        return Array.from(tags).sort();\n    }, [allVideos]);\n    \n    // Get unique categories\n    const categories = useMemo(() => {\n        return ['ALL', ...Object.keys(ENHANCED_VIDEO_CATALOG)];\n    }, []);\n    \n    // --- Enhanced Filtering Logic ---\n    const filteredVideos = useMemo(() => {\n        let videos = selectedCategory === 'ALL' ? allVideos \n                   : allVideos.filter(video => video.categoryKey === selectedCategory);\n        \n        // Apply search filter\n        if (searchTerm) {\n            const term = searchTerm.toLowerCase();\n            videos = videos.filter(video => \n                video.title.toLowerCase().includes(term) ||\n                video.speaker.toLowerCase().includes(term) ||\n                video.description.toLowerCase().includes(term) ||\n                video.category?.toLowerCase().includes(term) ||\n                video.tags?.some(tag => tag.toLowerCase().includes(term))\n            );\n        }\n        \n        // Apply tag filter\n        if (selectedTag) {\n            videos = videos.filter(video => \n                video.tags?.includes(selectedTag)\n            );\n        }\n        \n        return videos;\n    }, [selectedCategory, searchTerm, selectedTag, allVideos]);\n\n    // --- Legacy video arrays for backward compatibility ---\n    const inspirationalVideos = useMemo(() => VIDEO_LISTS?.INSPIRATIONAL || [], [VIDEO_LISTS]);\n    const actionableVideos = useMemo(() => VIDEO_LISTS?.ACTIONABLE || [], [VIDEO_LISTS]);\n\n    return (\n        <div className=\"p-6 md:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.NAVY+'30'}}>\n                <Film className='w-10 h-10 flex-shrink-0' style={{color: COLORS.NAVY}}/>\n                <div>\n                    <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>\n                        Leadership Video Library\n                    </h1>\n                    <p className=\"text-md\" style={{ color: COLORS.NAVY + '80' }}>\n                        Curated content for leaders at every level\n                    </p>\n                </div>\n            </header>\n\n            {/* Search and Filter Controls */}\n            <div className=\"mb-8 space-y-4\">\n                <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center\">\n                    {/* Search Input */}\n                    <div className=\"flex-1 relative\">\n                        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4\" style={{ color: COLORS.NAVY + '60' }} />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search videos, speakers, topics...\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                            className=\"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:border-transparent\"\n                            style={{ \n                                borderColor: COLORS.NAVY + '30',\n                                focusRingColor: COLORS.TEAL + '50'\n                            }}\n                        />\n                    </div>\n                    \n                    {/* Category Filter */}\n                    <select\n                        value={selectedCategory}\n                        onChange={(e) => setSelectedCategory(e.target.value)}\n                        className=\"px-3 py-2 border rounded-lg\"\n                        style={{ borderColor: COLORS.NAVY + '30' }}\n                    >\n                        {categories.map(cat => (\n                            <option key={cat} value={cat}>\n                                {cat === 'ALL' ? 'All Categories' : cat.replace('_', ' ')}\n                            </option>\n                        ))}\n                    </select>\n                    \n                    {/* Tag Filter */}\n                    <select\n                        value={selectedTag}\n                        onChange={(e) => setSelectedTag(e.target.value)}\n                        className=\"px-3 py-2 border rounded-lg\"\n                        style={{ borderColor: COLORS.NAVY + '30' }}\n                    >\n                        <option value=\"\">All Tags</option>\n                        {allTags.map(tag => (\n                            <option key={tag} value={tag}>\n                                {tag.replace('-', ' ')}\n                            </option>\n                        ))}\n                    </select>\n                </div>\n                \n                {/* Results Summary */}\n                <div className=\"flex items-center justify-between text-sm\" style={{ color: COLORS.NAVY + '80' }}>\n                    <span>\n                        {filteredVideos.length} video{filteredVideos.length !== 1 ? 's' : ''} found\n                    </span>\n                    {(searchTerm || selectedTag || selectedCategory !== 'ALL') && (\n                        <button\n                            onClick={() => {\n                                setSearchTerm('');\n                                setSelectedTag('');\n                                setSelectedCategory('ALL');\n                            }}\n                            className=\"text-sm underline hover:no-underline\"\n                            style={{ color: COLORS.TEAL }}\n                        >\n                            Clear filters\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            {/* Enhanced Video Grid */}\n            {filteredVideos.length > 0 ? (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12\">\n                    {filteredVideos.map((video) => (\n                        <VideoCard\n                            key={video.id}\n                            title={video.title}\n                            speaker={video.speaker}\n                            duration={video.duration}\n                            url={video.url}\n                            description={video.description}\n                            category={video.category}\n                            rating={video.rating}\n                            views={video.views}\n                            tags={video.tags}\n                            accent=\"TEAL\"\n                        />\n                    ))}\n                </div>\n            ) : (\n                <div className=\"text-center py-12\">\n                    <p className=\"text-lg mb-2\" style={{ color: COLORS.NAVY + '60' }}>\n                        No videos found matching your criteria\n                    </p>\n                    <p className=\"text-sm\" style={{ color: COLORS.NAVY + '40' }}>\n                        Try adjusting your search terms or filters\n                    </p>\n                </div>\n            )}\n\n            {/* --- SECTION 1: INSPIRATIONAL & PHILOSOPHY --- */}\n            <section className=\"mb-12\">\n                {/* Section Header with Accent */}\n                <h2 className=\"text-2xl md:text-3xl font-bold mb-6 border-l-4 pl-3 flex items-center gap-3\"\n                    style={{ color: COLORS.NAVY, borderColor: COLORS.ORANGE }}>\n                    <Zap className='w-6 h-6' style={{color: COLORS.ORANGE}}/> Philosophical Insights & Mindset\n                </h2>\n                {/* Video Grid */}\n                {inspirationalVideos.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                        {inspirationalVideos.map((video, index) => (\n                            <VideoCard\n                                key={video.id || index} // Prefer unique ID if available\n                                title={video.title}\n                                speaker={video.speaker}\n                                duration={video.duration}\n                                url={video.url}\n                                description={video.description}\n                                accent=\"ORANGE\" // Use ORANGE accent for this section\n                            />\n                        ))}\n                    </div>\n                ) : (\n                    <p className=\"text-gray-500 italic\">No inspirational videos found.</p> // Empty state\n                )}\n            </section>\n\n            {/* --- SECTION 2: ACTIONABLE & PRACTICAL --- */}\n            <section>\n                {/* Section Header with Accent */}\n                <h2 className=\"text-2xl md:text-3xl font-bold mb-6 border-l-4 pl-3 flex items-center gap-3\"\n                    style={{ color: COLORS.NAVY, borderColor: COLORS.TEAL }}>\n                    <Briefcase className='w-6 h-6' style={{color: COLORS.TEAL}}/> Actionable Leadership Techniques\n                </h2>\n                {/* Video Grid */}\n                {actionableVideos.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                        {actionableVideos.map((video, index) => (\n                            <VideoCard\n                                key={video.id || index} // Prefer unique ID\n                                title={video.title}\n                                speaker={video.speaker}\n                                duration={video.duration}\n                                url={video.url}\n                                description={video.description}\n                                accent=\"TEAL\" // Use TEAL accent for this section\n                            />\n                        ))}\n                    </div>\n                 ) : (\n                    <p className=\"text-gray-500 italic\">No actionable technique videos found.</p> // Empty state\n                )}\n            </section>\n\n            {/* --- Footer Navigation --- */}\n            <footer className='mt-12 pt-8 border-t border-gray-200'> {/* Use consistent footer style */}\n                <Button onClick={() => navigate('dashboard')} variant='outline' size=\"sm\"> {/* Use standard Button */}\n                    <ArrowLeft className='w-4 h-4 mr-2' /> {/* Use ArrowLeft for \"Back\" */}\n                    Back to The Arena\n                </Button>\n            </footer>\n        </div>\n    );\n};\n\nexport default LeadershipVideosScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/MembershipModule.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is defined but never used.","line":85,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useCallback } from 'react';\nimport { useAppServices } from '../../services/useAppServices.jsx'; // Canonical path used by other screen components\nimport { MEMBERSHIP_TIERS } from '../../services/membershipService.js';\nimport { DollarSign, Zap, Clock, CheckCircle, CreditCard, AlertTriangle, X, ShieldCheck, CornerRightUp, RefreshCw, Trash2, Mail, Bell } from 'lucide-react';\nimport { CORPORATE_COLORS } from '../../data/Constants.js';\n\n// Reusing colors from App.jsx's global constants\nconst COLORS = CORPORATE_COLORS;\n\n// --- Local Components for Modularity and Style ---\n\nconst Card = ({ title, children, accent = 'TEAL', icon: Icon, className = '' }) => {\n    const accentColor = COLORS[accent] || COLORS.TEAL;\n    return (\n        <div \n            className={`bg-white rounded-xl shadow-lg p-6 border-t-4 ${className}`}\n            style={{ borderColor: accentColor }}\n        >\n            <div className=\"flex items-center mb-4\">\n                {Icon && <Icon className=\"w-6 h-6 mr-3\" style={{ color: accentColor }} />}\n                <h2 className=\"text-xl font-bold\" style={{ color: COLORS.NAVY }}>{title}</h2>\n            </div>\n            {children}\n        </div>\n    );\n};\n\nconst Button = ({ children, onClick, variant = 'primary', size = 'md', className = '', disabled = false }) => {\n    let style = { background: COLORS.TEAL, color: 'white' };\n    let padding = size === 'sm' ? 'px-3 py-1.5 text-sm' : 'px-4 py-2 text-base';\n\n    if (variant === 'secondary') {\n        style = { background: COLORS.NAVY, color: 'white' };\n    } else if (variant === 'outline') {\n        style = { border: `1px solid ${COLORS.TEAL}`, color: COLORS.TEAL, background: 'white' };\n    } else if (variant === 'danger') {\n        style = { background: COLORS.RED, color: 'white' };\n    }\n\n    return (\n        <button\n            onClick={onClick}\n            disabled={disabled}\n            className={`${padding} rounded-lg font-semibold transition-all duration-200 hover:opacity-85 disabled:opacity-50 disabled:cursor-not-allowed ${className}`}\n            style={style}\n        >\n            {children}\n        </button>\n    );\n};\n\nconst NotificationBanner = ({ notification, onDismiss }) => {\n    let baseStyle = 'bg-blue-50 border-blue-200 text-blue-700';\n    let Icon = Bell;\n    if (notification.type === 'warning' || notification.type === 'expiration') {\n        baseStyle = 'bg-yellow-50 border-yellow-200 text-yellow-700';\n        Icon = AlertTriangle;\n    } else if (notification.type === 'error') {\n        baseStyle = 'bg-red-50 border-red-200 text-red-700';\n        Icon = X;\n    } else if (notification.type === 'success') {\n        baseStyle = 'bg-green-50 border-green-200 text-green-700';\n        Icon = CheckCircle;\n    }\n\n    return (\n        <div className={`flex justify-between items-start p-4 rounded-lg border shadow-sm ${baseStyle}`}>\n            <div className=\"flex items-start\">\n                <Icon className=\"w-5 h-5 flex-shrink-0 mt-0.5 mr-3\" />\n                <p className=\"text-sm font-medium\">{notification.message}</p>\n            </div>\n            <button \n                onClick={() => onDismiss(notification.id)}\n                className={`ml-4 p-1 rounded-full opacity-70 hover:opacity-100 transition-opacity`}\n                style={{ color: COLORS.MUTED }}\n                title=\"Dismiss\"\n            >\n                <X className=\"w-4 h-4\" />\n            </button>\n        </div>\n    );\n};\n\n// --- Main Membership Module Component ---\nconst MembershipModule = ({ navigate }) => {\n    const { \n        membershipData, \n        updateMembershipData, \n        isLoading,\n        user\n    } = useAppServices(); // cite: useAppServices.jsx\n\n    const [modalOpen, setModalOpen] = useState(false);\n    const [selectedPlan, setSelectedPlan] = useState(null);\n    const [paymentMethod, setPaymentMethod] = useState('card');\n    const [paymentStatus, setPaymentStatus] = useState(null); // 'processing', 'success', 'failure'\n    \n    // Convert to Date object for easier handling\n    const nextBillingDate = useMemo(() => {\n        if (!membershipData?.nextBillingDate) return null;\n        try {\n            return new Date(membershipData.nextBillingDate);\n        } catch (e) {\n            return null;\n        }\n    }, [membershipData?.nextBillingDate]);\n\n    // Current Plan Details - Updated to use new MEMBERSHIP_TIERS\n    const currentPlanDetails = useMemo(() => {\n        const currentTier = membershipData?.currentTier || 'basic';\n        return MEMBERSHIP_TIERS[currentTier] || MEMBERSHIP_TIERS.basic;\n    }, [membershipData?.currentTier]);\n    \n    // Available upgrade plans - Updated to use new MEMBERSHIP_TIERS\n    const upgradePlans = useMemo(() => {\n        const currentTier = membershipData?.currentTier || 'basic';\n        const availableTiers = ['basic', 'professional', 'elite'];\n        \n        return availableTiers\n            .filter(tier => tier !== currentTier)\n            .map(tier => MEMBERSHIP_TIERS[tier]);\n    }, [membershipData?.currentTier]);\n\n\n    // --- Handlers ---\n    \n    const handlePlanSelection = (plan) => {\n        setSelectedPlan(plan);\n        setModalOpen(true);\n        setPaymentStatus(null);\n    };\n    \n    const handleDismissNotification = useCallback(async (id) => {\n        if (!membershipData || !updateMembershipData) return;\n        \n        const updatedNotifications = membershipData.notifications.filter(n => n.id !== id);\n        await updateMembershipData({ notifications: updatedNotifications });\n    }, [membershipData, updateMembershipData]);\n\n    const handleMockPayment = useCallback(async () => {\n        if (!selectedPlan) return;\n\n        setPaymentStatus('processing');\n        \n        // Mock payment delay\n        await new Promise(resolve => setTimeout(resolve, 1500));\n        \n        const success = Math.random() > 0.1; // 90% chance of success\n\n        if (success) {\n            // Calculate next billing date (e.g., 30 days from now for monthly, 365 for annual)\n            const today = new Date();\n            let nextDate = new Date(today);\n            if (selectedPlan.recurrence === 'Monthly') {\n                nextDate.setDate(today.getDate() + 30);\n            } else if (selectedPlan.recurrence === 'Annually') {\n                nextDate.setDate(today.getDate() + 365);\n            }\n            \n            const newPaymentRecord = {\n                date: new Date().toISOString(),\n                amount: selectedPlan.price,\n                method: paymentMethod,\n                status: 'Success',\n                planId: selectedPlan.id,\n                recurrence: selectedPlan.recurrence,\n            };\n\n            // Remove all warning/expiration notifications upon successful payment\n            const newNotifications = membershipData.notifications.filter(n => n.type !== 'warning' && n.type !== 'expiration');\n            newNotifications.push({ \n                id: `upgrade-${Date.now()}`, \n                message: `Upgrade to ${selectedPlan.name} successful!`, \n                type: 'success', \n                isRead: false \n            });\n\n            await updateMembershipData({\n                status: 'Active',\n                currentPlanId: selectedPlan.id,\n                nextBillingDate: nextDate.toISOString().split('T')[0],\n                paymentHistory: [...membershipData.paymentHistory, newPaymentRecord],\n                notifications: newNotifications\n            });\n\n            setPaymentStatus('success');\n            setTimeout(() => setModalOpen(false), 2000);\n\n        } else {\n            setPaymentStatus('failure');\n            // Log failure to history as well\n            const failedRecord = {\n                date: new Date().toISOString(),\n                amount: selectedPlan.price,\n                method: paymentMethod,\n                status: 'Failed',\n                planId: selectedPlan.id,\n                recurrence: selectedPlan.recurrence,\n                error: 'Payment declined by mock gateway.'\n            };\n            await updateMembershipData({\n                paymentHistory: [...membershipData.paymentHistory, failedRecord]\n            });\n            // Show error message\n            setTimeout(() => setPaymentStatus(null), 3000);\n        }\n    }, [selectedPlan, paymentMethod, membershipData, updateMembershipData]);\n\n\n    if (isLoading || !membershipData) {\n        return (\n            <div className=\"flex items-center justify-center h-full min-h-screen\">\n                <Zap className=\"w-8 h-8 animate-spin\" style={{ color: COLORS.TEAL }} />\n            </div>\n        );\n    }\n    \n    const statusColor = membershipData.status === 'Active' ? 'GREEN' : (membershipData.status.includes('Trial') ? 'BLUE' : 'RED');\n\n    // --- RENDER ---\n    return (\n        <div className=\"min-h-screen\" style={{ background: COLORS.BG }}>\n            <div className=\"container mx-auto px-4 py-6 max-w-7xl\">\n                \n                {/* Header */}\n                <h1 className=\"text-3xl md:text-4xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>\n                    Membership & Billing\n                </h1>\n                <p className=\"text-base mb-6\" style={{ color: COLORS.MUTED }}>\n                    Manage your plan, payments, and account status here.\n                </p>\n\n                {/* Notifications Panel */}\n                {membershipData.notifications.length > 0 && (\n                    <div className=\"mb-6 space-y-3\">\n                        <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                            <Mail className=\"inline-block w-5 h-5 mr-2\" style={{ color: COLORS.ORANGE }} /> Notifications\n                        </h3>\n                        {membershipData.notifications.map(n => (\n                            <NotificationBanner \n                                key={n.id} \n                                notification={n} \n                                onDismiss={handleDismissNotification} \n                            />\n                        ))}\n                    </div>\n                )}\n                \n                {/* Current Plan and Upgrade Plans */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n                    \n                    {/* Current Plan Card (Span 1) */}\n                    <Card title=\"Current Plan\" accent={statusColor} icon={ShieldCheck} className=\"lg:col-span-1\">\n                        <p className=\"text-sm font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n                            STATUS: <span className={`font-extrabold uppercase`} style={{ color: COLORS[statusColor] }}>\n                                {membershipData.status}\n                            </span>\n                        </p>\n                        <h3 className=\"text-2xl font-extrabold mb-4\" style={{ color: COLORS.NAVY }}>\n                            {currentPlanDetails.name}\n                        </h3>\n                        \n                        {nextBillingDate && (\n                            <div className=\"flex items-center text-sm font-medium mb-4 p-3 rounded-lg bg-gray-50 border\">\n                                <Clock className=\"w-4 h-4 mr-2\" style={{ color: COLORS.TEAL }} />\n                                <p>Next Billing Date: <strong>{nextBillingDate.toDateString()}</strong></p>\n                            </div>\n                        )}\n                        \n                        <p className=\"font-semibold text-base mb-2\" style={{ color: COLORS.NAVY }}>Your Features:</p>\n                        <ul className=\"space-y-1 text-sm\">\n                            {currentPlanDetails.features && Object.entries(currentPlanDetails.features).map(([key, value], index) => (\n                                <li key={index} className=\"flex items-center text-gray-700\">\n                                    <CheckCircle className=\"w-4 h-4 mr-2 flex-shrink-0\" style={{ color: COLORS.GREEN }} />\n                                    {key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: {typeof value === 'boolean' ? (value ? 'Yes' : 'No') : value}\n                                </li>\n                            ))}\n                        </ul>\n\n                        {membershipData.status !== 'Active' && (\n                             <Button \n                                onClick={() => handlePlanSelection(upgradePlans.find(p => p.id === 'pro') || currentPlanDetails)} // Fallback to current plan if pro isn't in upgrade list\n                                variant=\"primary\" \n                                size=\"md\" \n                                className=\"w-full mt-6\"\n                             >\n                                Unlock Full Access\n                            </Button>\n                        )}\n                    </Card>\n\n                    {/* Available Plans (Span 2) */}\n                    <div className=\"lg:col-span-2 space-y-4\">\n                        <h3 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>Upgrade Options</h3>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {upgradePlans.map(plan => (\n                                <div \n                                    key={plan.id} \n                                    className=\"bg-white rounded-xl shadow-md p-6 border-t-4 hover:shadow-xl transition-shadow duration-300\"\n                                    style={{ borderColor: plan.id === 'pro' ? COLORS.PURPLE : COLORS.BLUE }}\n                                >\n                                    <h4 className=\"text-xl font-extrabold mb-1\" style={{ color: COLORS.NAVY }}>{plan.name}</h4>\n                                    <p className=\"text-sm font-semibold mb-3\" style={{ color: COLORS.MUTED }}>{plan.recurrence}</p>\n                                    \n                                    <p className=\"text-3xl font-extrabold mb-4\" style={{ color: COLORS.NAVY }}>\n                                        <DollarSign className=\"inline-block w-6 h-6\" />{plan.price}\n                                        <span className=\"text-base font-medium text-gray-500\">/{plan.recurrence ? plan.recurrence.toLowerCase().replace('ly', '').replace('ally', '') : 'period'}</span>\n                                    </p>\n                                    \n                                    <ul className=\"space-y-2 text-sm mb-6\">\n                                        {plan.features && Object.entries(plan.features).map(([key, value], index) => (\n                                            <li key={index} className=\"flex items-center text-gray-700\">\n                                                <CornerRightUp className=\"w-4 h-4 mr-2 flex-shrink-0\" style={{ color: COLORS.ORANGE }} />\n                                                {key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: {typeof value === 'boolean' ? (value ? 'Yes' : 'No') : value}\n                                            </li>\n                                        ))}\n                                    </ul>\n\n                                    <Button \n                                        onClick={() => handlePlanSelection(plan)}\n                                        variant={plan.id === 'pro' ? 'secondary' : 'outline'}\n                                        size=\"md\" \n                                        className=\"w-full\"\n                                    >\n                                        Select {plan.name}\n                                    </Button>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Payment History */}\n                <Card title=\"Payment History\" accent='NAVY' icon={DollarSign}>\n                    <div className=\"overflow-x-auto\">\n                        {membershipData.paymentHistory.length === 0 ? (\n                            <p className=\"text-sm text-center py-4\" style={{ color: COLORS.MUTED }}>No payment history found.</p>\n                        ) : (\n                            <table className=\"min-w-full divide-y divide-gray-200\">\n                                <thead style={{ backgroundColor: COLORS.LIGHT_GRAY }}>\n                                    <tr>\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider\" style={{ color: COLORS.MUTED }}>Plan</th>\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider\" style={{ color: COLORS.MUTED }}>Amount</th>\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider\" style={{ color: COLORS.MUTED }}>Date</th>\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider\" style={{ color: COLORS.MUTED }}>Method</th>\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider\" style={{ color: COLORS.MUTED }}>Status</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"bg-white divide-y divide-gray-200\">\n                                    {membershipData.paymentHistory.map((item, index) => (\n                                        <tr key={index}>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\" style={{ color: COLORS.NAVY }}>{item.planId}</td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">${item.amount.toFixed(2)}</td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">{new Date(item.date).toLocaleDateString()}</td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">{item.method}</td>\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm font-semibold\" style={{ color: item.status === 'Success' ? COLORS.GREEN : COLORS.RED }}>{item.status}</td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        )}\n                    </div>\n                </Card>\n            </div>\n\n            {/* --- Payment Modal --- */}\n            {modalOpen && selectedPlan && (\n                <div className=\"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4\">\n                    <div className=\"bg-white rounded-2xl p-8 max-w-lg w-full shadow-2xl\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                            <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                                Secure Checkout: {selectedPlan.name}\n                            </h2>\n                            <button onClick={() => setModalOpen(false)} className=\"p-2 rounded-full hover:bg-gray-100\">\n                                <X className=\"w-6 h-6\" style={{ color: COLORS.MUTED }} />\n                            </button>\n                        </div>\n                        \n                        {/* Summary */}\n                        <div className=\"border-b pb-4 mb-4\">\n                            <p className=\"text-lg font-semibold\" style={{ color: COLORS.TEXT }}>\n                                Total Due Today: \n                                <span className=\"ml-2 text-2xl font-extrabold\" style={{ color: COLORS.TEAL }}>\n                                    ${selectedPlan.price.toFixed(2)}\n                                </span>\n                                <span className=\"text-sm text-gray-500\"> / {selectedPlan.recurrence}</span>\n                            </p>\n                            <p className=\"text-sm text-gray-500 mt-1\">\n                                Renews automatically. Cancel anytime.\n                            </p>\n                        </div>\n\n                        {/* Payment Method Selection */}\n                        <h3 className=\"text-lg font-bold mb-3\" style={{ color: COLORS.NAVY }}>\n                            1. Select Payment Method\n                        </h3>\n                        <div className=\"flex space-x-4 mb-6\">\n                            {['card', 'paypal', 'invoice'].map(method => (\n                                <button \n                                    key={method}\n                                    onClick={() => setPaymentMethod(method)}\n                                    className={`flex-1 p-3 rounded-lg border-2 transition-all duration-200 ${\n                                        paymentMethod === method \n                                            ? 'border-purple-600 shadow-lg' \n                                            : 'border-gray-200 hover:border-gray-400'\n                                    }`}\n                                >\n                                    <CreditCard className=\"w-5 h-5 mx-auto mb-1\" style={{ color: paymentMethod === method ? COLORS.PURPLE : COLORS.MUTED }} />\n                                    <span className=\"text-xs font-semibold uppercase\">{method}</span>\n                                </button>\n                            ))}\n                        </div>\n\n                        {/* Mock Payment Details */}\n                        <h3 className=\"text-lg font-bold mb-3\" style={{ color: COLORS.NAVY }}>\n                            2. Payment Details ({paymentMethod.toUpperCase()})\n                        </h3>\n                        {paymentMethod === 'card' && (\n                            <div className=\"space-y-3 mb-6\">\n                                <input type=\"text\" placeholder=\"Card Number (Mock: 1111 ****)\" className=\"w-full p-3 border border-gray-300 rounded-lg\" disabled={paymentStatus === 'processing'} />\n                                <div className=\"flex space-x-3\">\n                                    <input type=\"text\" placeholder=\"MM/YY\" className=\"w-1/2 p-3 border border-gray-300 rounded-lg\" disabled={paymentStatus === 'processing'} />\n                                    <input type=\"text\" placeholder=\"CVC\" className=\"w-1/2 p-3 border border-gray-300 rounded-lg\" disabled={paymentStatus === 'processing'} />\n                                </div>\n                            </div>\n                        )}\n                        {paymentMethod === 'paypal' && (\n                            <p className=\"p-3 bg-blue-100 border border-blue-300 rounded-lg mb-6 text-sm text-blue-800\">\n                                This would redirect you to the PayPal gateway for a one-time payment authorization.\n                            </p>\n                        )}\n                        {paymentMethod === 'invoice' && (\n                            <p className=\"p-3 bg-amber-100 border border-amber-300 rounded-lg mb-6 text-sm text-amber-800\">\n                                A yearly invoice of ${selectedPlan.price.toFixed(2)} will be sent to {user?.email || 'your email address'}. Service begins upon payment.\n                            </p>\n                        )}\n\n                        {/* Action Button */}\n                        <Button \n                            onClick={handleMockPayment}\n                            variant=\"primary\" \n                            size=\"md\" \n                            className=\"w-full\"\n                            disabled={paymentStatus === 'processing' || paymentStatus === 'success'}\n                        >\n                            {paymentStatus === 'processing' && <RefreshCw className=\"w-5 h-5 mr-2 animate-spin\" />}\n                            {paymentStatus === 'processing' ? 'Processing Payment...' : \n                             paymentStatus === 'success' ? <><CheckCircle className=\"w-5 h-5 mr-2\" /> Successful!</> :\n                             paymentStatus === 'failure' ? 'Payment Failed (Retry)' :\n                             `Confirm & Pay $${selectedPlan.price.toFixed(2)}`}\n                        </Button>\n                        \n                        {paymentStatus === 'failure' && (\n                             <p className=\"text-sm text-center mt-3 font-semibold\" style={{ color: COLORS.RED }}>\n                                Transaction declined. Please try a different method.\n                             </p>\n                        )}\n                        \n                        <p className=\"text-xs text-center text-gray-400 mt-4\">\n                            All payments are handled securely by a mock PCI-compliant gateway.\n                        </p>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default MembershipModule;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/MembershipUpgrade.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":237,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":237,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/MembershipUpgrade.jsx\n// Arena v1.0 Scope: Membership upgrade page showing tier comparison\nimport React from 'react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport { MEMBERSHIP_TIERS } from '../../services/membershipService.js';\nimport { ArrowLeft, Check, Crown, Zap, Target, Users, Calendar, BookOpen, MessageSquare, Bot } from 'lucide-react';\n\n// LEADERREPS.COM OFFICIAL CORPORATE COLORS - VERIFIED 11/12/25\nconst COLORS = { \n  // === PRIMARY BRAND COLORS (from leaderreps.com) ===\n  NAVY: '#002E47',        // Primary text, headers, navigation\n  ORANGE: '#E04E1B',      // Call-to-action buttons, highlights, alerts  \n  TEAL: '#47A88D',        // Secondary buttons, success states, accents\n  LIGHT_GRAY: '#FCFCFA',  // Page backgrounds, subtle surfaces\n  \n  // === SEMANTIC MAPPINGS (using ONLY corporate colors) ===\n  BLUE: '#002E47',        // Map to NAVY\n  GREEN: '#47A88D',       // Map to TEAL  \n  AMBER: '#E04E1B',       // Map to ORANGE\n  RED: '#E04E1B',         // Map to ORANGE\n  PURPLE: '#47A88D',      // Map to TEAL\n  \n  // === TEXT & BACKGROUNDS (corporate colors only) ===\n  TEXT: '#002E47',        // NAVY for all text\n  MUTED: '#47A88D',       // TEAL for muted text\n  BG: '#FCFCFA',          // LIGHT_GRAY for backgrounds\n  OFF_WHITE: '#FCFCFA',   // Same as BG\n  SUBTLE: '#47A88D'       // TEAL for subtle elements\n};\n\nconst Button = ({ children, onClick, variant = 'primary', size = 'md', className = '', disabled = false }) => {\n  const baseStyles = 'inline-flex items-center justify-center rounded-lg font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';\n  \n  const variants = {\n    primary: `text-white hover:shadow-lg focus:ring-teal-500`,\n    secondary: `text-white hover:opacity-90 focus:ring-navy-500`,\n    outline: `border-2 text-teal-600 hover:text-white focus:ring-teal-500`,\n    ghost: `text-gray-600 hover:bg-gray-100 focus:ring-gray-500`,\n    danger: `text-white hover:opacity-90 focus:ring-red-500`,\n    upgrade: `text-white hover:shadow-lg focus:ring-orange-500`\n  };\n  \n  const sizes = {\n    sm: 'px-3 py-1.5 text-sm',\n    md: 'px-4 py-2 text-base',\n    lg: 'px-6 py-3 text-lg'\n  };\n  \n  return (\n    <button\n      onClick={onClick}\n      disabled={disabled}\n      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}\n      style={{\n        background: variant === 'primary' ? `linear-gradient(135deg, ${COLORS.TEAL}, ${COLORS.BLUE})` :\n                   variant === 'upgrade' ? `linear-gradient(135deg, ${COLORS.ORANGE}, ${COLORS.AMBER})` :\n                   variant === 'secondary' ? COLORS.NAVY :\n                   variant === 'danger' ? COLORS.RED :\n                   variant === 'outline' ? 'transparent' :\n                   undefined,\n        borderColor: variant === 'outline' ? COLORS.TEAL : undefined\n      }}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst Card = ({ children, className = '', accent }) => {\n  const accentColors = {\n    TEAL: COLORS.TEAL,\n    NAVY: COLORS.NAVY,\n    ORANGE: COLORS.ORANGE,\n    BLUE: COLORS.BLUE,\n    PURPLE: COLORS.PURPLE\n  };\n  \n  const accentColor = accent ? accentColors[accent] : COLORS.TEAL;\n  \n  return (\n    <div \n      className={`bg-white rounded-xl shadow-sm border-l-4 p-6 ${className}`}\n      style={{ borderLeftColor: accentColor }}\n    >\n      {children}\n    </div>\n  );\n};\n\nconst FeatureList = ({ features, included = true }) => {\n  // Extensive defensive checking for features array\n  console.log('FeatureList received features:', features, 'Type:', typeof features);\n  \n  if (!features) {\n    console.error('FeatureList: features is null or undefined');\n    return <div className=\"text-red-500 text-sm\">Error: No features provided</div>;\n  }\n  \n  if (!Array.isArray(features)) {\n    console.error('FeatureList: features is not an array:', features, 'Type:', typeof features);\n    return <div className=\"text-red-500 text-sm\">Error: Features must be an array, got: {typeof features}</div>;\n  }\n  \n  if (features.length === 0) {\n    return <div className=\"text-gray-500 text-sm\">No features available</div>;\n  }\n  \n  return (\n    <ul className=\"space-y-3\">\n      {features.map((feature, index) => (\n        <li key={index} className=\"flex items-start gap-3\">\n          {included ? (\n            <Check className=\"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5\" />\n          ) : (\n            <div className=\"w-5 h-5 rounded-full border-2 border-gray-300 flex-shrink-0 mt-0.5\" />\n          )}\n          <span className={`text-sm ${included ? 'text-gray-700' : 'text-gray-400'}`}>\n            {feature}\n          </span>\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nconst TierCard = ({ tier, isCurrentTier = false, onUpgrade, isPopular = false }) => {\n  const tierData = MEMBERSHIP_TIERS[tier];\n  \n  // Early return if tierData is undefined\n  if (!tierData) {\n    console.error('TierCard: tierData is undefined for tier:', tier);\n    return (\n      <Card className=\"text-center p-6\">\n        <div className=\"text-red-500\">\n          <h3 className=\"text-xl font-bold mb-2\">Error Loading Tier</h3>\n          <p>Unable to load data for tier: {tier}</p>\n        </div>\n      </Card>\n    );\n  }\n  \n  const getFeatures = () => {\n    // Defensive check to ensure tier is defined\n    if (!tier) {\n      console.warn('TierCard: tier prop is undefined');\n      return [];\n    }\n    \n    switch(tier) {\n      case 'basic':\n        return [\n          'Daily & Weekly Leadership Content',\n          'Basic Development Plan Access',\n          'View Community Posts',\n          'Limited AI Coaching (5/month)',\n          'Basic Target Reps Library',\n          'Mobile & Desktop Access'\n        ];\n      case 'professional':\n        return [\n          'Everything in Arena Basic',\n          'Full Development Plan & Assessment',\n          'Accountability Pod Matching',\n          'Complete Business Readings Library',\n          'Unlimited AI Coaching Support',\n          'Document Downloads & Calendar Sync',\n          'Community Posting & Discussions',\n          'Advanced Target Reps Catalog'\n        ];\n      case 'elite':\n        return [\n          'Everything in Arena Professional',\n          'Priority AI Coaching Lab Access',\n          'Advanced Analytics & Insights',\n          'Leadership Coaching Call Library',\n          'Executive Peer Network Access',\n          'Custom Development Pathways',\n          'Premium Content & Masterclasses',\n          'Direct Leadership Mentor Access'\n        ];\n      default:\n        console.warn('TierCard: Unknown tier:', tier);\n        return [];\n    }\n  };\n\n  return (\n    <div className={`relative ${isPopular ? 'transform scale-105' : ''}`}>\n      {isPopular && (\n        <div className=\"absolute -top-4 left-1/2 transform -translate-x-1/2\">\n          <div className=\"bg-gradient-to-r from-orange-500 to-amber-500 text-white px-4 py-1 rounded-full text-sm font-bold\">\n            Most Popular\n          </div>\n        </div>\n      )}\n      \n      <Card accent={isPopular ? 'ORANGE' : tier === 'elite' ? 'PURPLE' : 'TEAL'} className={isPopular ? 'ring-2 ring-orange-200' : ''}>\n        <div className=\"text-center mb-6\">\n          <div className=\"flex items-center justify-center gap-2 mb-2\">\n            {tier === 'elite' && <Crown className=\"w-6 h-6 text-purple-600\" />}\n            {tier === 'professional' && <Zap className=\"w-6 h-6 text-blue-600\" />}\n            {tier === 'basic' && <Target className=\"w-6 h-6 text-teal-600\" />}\n            <h3 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n              {tierData.name}\n            </h3>\n          </div>\n          \n          <div className=\"mb-4\">\n            <span className=\"text-4xl font-bold\" style={{ color: COLORS.NAVY }}>\n              ${tierData.price}\n            </span>\n            <span className=\"text-gray-500\">/month</span>\n          </div>\n          \n          {isCurrentTier ? (\n            <Button variant=\"ghost\" disabled className=\"w-full mb-6\">\n              Current Plan\n            </Button>\n          ) : (\n            <Button \n              variant={isPopular ? 'upgrade' : 'primary'} \n              onClick={() => onUpgrade(tier)}\n              className=\"w-full mb-6\"\n            >\n              {tier === 'basic' ? 'Get Started' : `Upgrade to ${tierData.name}`}\n            </Button>\n          )}\n        </div>\n        \n        <FeatureList features={getFeatures()} />\n      </Card>\n    </div>\n  );\n};\n\nconst MembershipUpgrade = ({ navigate }) => {\n  const { membershipData, user } = useAppServices();\n  const currentTier = membershipData?.currentTier || 'basic';\n\n  const handleUpgrade = (tier) => {\n    // In a real app, this would integrate with Stripe/payment processor\n    console.log(`Upgrading to ${tier}`);\n    // For now, just show an alert\n    alert(`Upgrade to ${MEMBERSHIP_TIERS[tier].name} - Payment integration coming soon!`);\n  };\n\n  return (\n    <div className=\"min-h-screen\" style={{ backgroundColor: COLORS.BG }}>\n      <div className=\"container mx-auto max-w-7xl px-6 py-8\">\n        \n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => navigate('dashboard')}\n            className=\"flex items-center gap-2\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl font-bold mb-4\" style={{ color: COLORS.NAVY }}>\n            Choose Your Leadership Journey\n          </h1>\n          <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n            Unlock your full potential with the right membership tier. \n            Start with the basics or accelerate your growth with advanced features.\n          </p>\n        </div>\n\n        {/* Pricing Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12\">\n          <TierCard \n            tier=\"basic\" \n            isCurrentTier={currentTier === 'basic'}\n            onUpgrade={handleUpgrade}\n          />\n          <TierCard \n            tier=\"professional\" \n            isCurrentTier={currentTier === 'professional'}\n            onUpgrade={handleUpgrade}\n            isPopular={true}\n          />\n          <TierCard \n            tier=\"elite\" \n            isCurrentTier={currentTier === 'elite'}\n            onUpgrade={handleUpgrade}\n          />\n        </div>\n\n        {/* Feature Comparison */}\n        <Card className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold mb-6 text-center\" style={{ color: COLORS.NAVY }}>\n            Feature Comparison\n          </h2>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b\">\n                  <th className=\"text-left py-4 px-4\">Features</th>\n                  <th className=\"text-center py-4 px-4\">Arena Basic</th>\n                  <th className=\"text-center py-4 px-4\">Arena Professional</th>\n                  <th className=\"text-center py-4 px-4\">Arena Elite</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y\">\n                <tr>\n                  <td className=\"py-4 px-4 font-medium\">Development Plan Access</td>\n                  <td className=\"text-center py-4 px-4\">Basic</td>\n                  <td className=\"text-center py-4 px-4\"><Check className=\"w-5 h-5 text-green-500 mx-auto\" /></td>\n                  <td className=\"text-center py-4 px-4\"><Check className=\"w-5 h-5 text-green-500 mx-auto\" /></td>\n                </tr>\n                <tr>\n                  <td className=\"py-4 px-4 font-medium\">AI Coaching Sessions</td>\n                  <td className=\"text-center py-4 px-4\">5/month</td>\n                  <td className=\"text-center py-4 px-4\">Unlimited</td>\n                  <td className=\"text-center py-4 px-4\">Priority Access</td>\n                </tr>\n                <tr>\n                  <td className=\"py-4 px-4 font-medium\">Accountability Pods</td>\n                  <td className=\"text-center py-4 px-4\">View Only</td>\n                  <td className=\"text-center py-4 px-4\"><Check className=\"w-5 h-5 text-green-500 mx-auto\" /></td>\n                  <td className=\"text-center py-4 px-4\"><Check className=\"w-5 h-5 text-green-500 mx-auto\" /></td>\n                </tr>\n                <tr>\n                  <td className=\"py-4 px-4 font-medium\">Business Readings Library</td>\n                  <td className=\"text-center py-4 px-4\">Daily/Weekly Only</td>\n                  <td className=\"text-center py-4 px-4\">Full Library</td>\n                  <td className=\"text-center py-4 px-4\">Full + Exclusive</td>\n                </tr>\n                <tr>\n                  <td className=\"py-4 px-4 font-medium\">Leadership Coaching Calls</td>\n                  <td className=\"text-center py-4 px-4\">View Only</td>\n                  <td className=\"text-center py-4 px-4\">Full Access</td>\n                  <td className=\"text-center py-4 px-4\">Live Participation</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </Card>\n\n        {/* FAQ Section */}\n        <Card>\n          <h2 className=\"text-2xl font-bold mb-6\" style={{ color: COLORS.NAVY }}>\n            Frequently Asked Questions\n          </h2>\n          \n          <div className=\"space-y-6\">\n            <div>\n              <h3 className=\"font-semibold mb-2\">Can I upgrade or downgrade anytime?</h3>\n              <p className=\"text-gray-600\">Yes, you can change your membership tier at any time. Upgrades take effect immediately, while downgrades take effect at the next billing cycle.</p>\n            </div>\n            \n            <div>\n              <h3 className=\"font-semibold mb-2\">What's included in the AI Coaching?</h3>\n              <p className=\"text-gray-600\">Our AI coaching provides personalized leadership development insights, scenario practice, and guidance tailored to your specific challenges and goals.</p>\n            </div>\n            \n            <div>\n              <h3 className=\"font-semibold mb-2\">How do Accountability Pods work?</h3>\n              <p className=\"text-gray-600\">Pods are small groups (4-8 members) of leaders who support each other's growth through regular check-ins, shared goals, and peer accountability.</p>\n            </div>\n          </div>\n        </Card>\n\n      </div>\n    </div>\n  );\n};\n\nexport default MembershipUpgrade;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/PlanningHub.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'dailyPracticeData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":79,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":26},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":104,"column":90,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":104,"endColumn":91,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9028,9029],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9028,9028],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":104,"column":96,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":104,"endColumn":97,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9034,9035],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9034,9034],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":110,"column":87,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":110,"endColumn":88,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9449,9450],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9449,9449],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":110,"column":93,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":110,"endColumn":94,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9455,9456],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9455,9455],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsSaving' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":311,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":311,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsSavedConfirmation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":312,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":312,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsCritiquing' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":313,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":313,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'setCritiqueResult' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":314,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":314,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'setCritiqueHtml' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":315,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":315,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'mission', 'updateStrategicContentData', and 'vision'. Either exclude them or remove the dependency array.","line":322,"column":99,"nodeType":"ArrayExpression","endLine":322,"endColumn":144,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[22766,22811],"text":"[]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'GEMINI_MODEL', 'callSecureGeminiAPI', 'hasGeminiKey', 'mission', and 'vision'. Either exclude them or remove the dependency array.","line":325,"column":96,"nodeType":"ArrayExpression","endLine":325,"endColumn":162,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[22999,23065],"text":"[]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setCritiqueHtml' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":395,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":395,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsCritiquing' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":396,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":396,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":404,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":404,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":404,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":404,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'objId' is defined but never used.","line":405,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":405,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'krId' is defined but never used.","line":405,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":405,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":405,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":405,"endColumn":53},{"ruleId":"no-unused-vars","severity":1,"message":"'objId' is defined but never used.","line":406,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":406,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'objId' is defined but never used.","line":407,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":407,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'krId' is defined but never used.","line":407,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":407,"endColumn":46},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'okrs'. Either exclude it or remove the dependency array.","line":409,"column":59,"nodeType":"ArrayExpression","endLine":409,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[28759,28765],"text":"[]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'GEMINI_MODEL', 'callSecureGeminiAPI', 'hasGeminiKey', and 'okrs'. Either exclude them or remove the dependency array.","line":423,"column":94,"nodeType":"ArrayExpression","endLine":423,"endColumn":149,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[29675,29730],"text":"[]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":449,"column":112,"nodeType":"Identifier","messageId":"unusedVar","endLine":449,"endColumn":113},{"ruleId":"no-unused-vars","severity":1,"message":"'dailyPracticeData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":505,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":505,"endColumn":80},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsSaving' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":508,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":508,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsSavedConfirmation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":509,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":509,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'o' is defined but never used.","line":519,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":519,"endColumn":79},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":519,"column":81,"nodeType":"Identifier","messageId":"unusedVar","endLine":519,"endColumn":86},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'misalignmentNotes' and 'updateStrategicContentData'. Either exclude them or remove the dependency array.","line":522,"column":109,"nodeType":"ArrayExpression","endLine":522,"endColumn":156,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[37226,37273],"text":"[]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'navigate', 'suggestionCommitment', and 'updateDailyPracticeData'. Either exclude them or remove the dependency array.","line":584,"column":116,"nodeType":"ArrayExpression","endLine":584,"endColumn":173,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[40952,41009],"text":"[]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/PlanningHub.jsx (Refactored for Consistency, Context, AI Fixes)\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\nimport {\n    ArrowLeft, CheckCircle, PlusCircle, X, TrendingUp, Target, AlertTriangle, Lightbulb,\n    ShieldCheck, Cpu, Trash2, Zap, MessageSquare, BookOpen, Clock, CornerRightUp, Award, Activity,\n    Link, CornerDownRight, Dumbbell, Trello, Loader // Added Trello, Loader\n} from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-[200px] flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\nconst Tooltip = ({ content, children }) => { /* ... Re-use definition from Labs.jsx ... */\n    const [isVisible, setIsVisible] = useState(false);\n    return ( <div className=\"relative inline-block\" onMouseEnter={() => setIsVisible(true)} onMouseLeave={() => setIsVisible(false)}> {children} {isVisible && ( <div className=\"absolute z-10 w-64 p-3 -mt-2 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform -translate-x-1/2\"> {content} <div className=\"absolute left-1/2 transform -translate-x-1/2 -bottom-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-[#002E47]\"></div> </div> )} </div> );\n};\n\n/* =========================================================\n   UTILITIES (Local or Shared)\n========================================================= */\n// Markdown to HTML converter (Simplified version, ensure consistency if used elsewhere)\nconst mdToHtml = async (md) => { /* ... Re-use definition from Labs.jsx ... */\n    if (!md) return ''; let html = md;\n    html = html.replace(/^## (.*$)/gim, '<h2 class=\"text-xl font-extrabold text-[#002E47] border-b border-gray-200 pb-2 mb-3 mt-5\">$1</h2>');\n    html = html.replace(/^### (.*$)/gim, '<h3 class=\"text-lg font-bold text-[#47A88D] mt-4 mb-2\">$1</h3>');\n    html = html.replace(/\\*\\*(.*?)\\*\\*/gim, '<strong class=\"font-semibold\">$1</strong>');\n    html = html.replace(/^\\* (.*$)/gim, '<li>$1</li>');\n    html = html.replace(/(<li>.*<\\/li>\\s*)+/g, (match) => `<ul class=\"list-disc list-inside space-y-1 mb-4 pl-4\">${match.trim()}</ul>`);\n    html = html.split('\\n').map(line => { line = line.trim(); if (!line || line.startsWith('<h') || line.startsWith('<ul') || line.startsWith('<li') || line === '</ul>') return line; return `<p class=\"text-sm text-gray-700 mb-2\">${line}</p>`; }).join('');\n    html = html.replace(/<p><\\/p>/g, '');\n    return `<div class=\"prose prose-sm max-w-none\">${html}</div>`;\n};\n\n/* =========================================================\n   PLANNING HUB VIEWS (Refactored Components)\n========================================================= */\n\n/**\n * PreMortemView Component\n * Guides users through identifying risks for a major decision using AI audit.\n */\nconst PreMortemView = ({ setPlanningView }) => {\n    // --- Consume Services ---\n    const {\n        strategicContentData, updateStrategicContentData, // Data for this hub // cite: useAppServices.jsx\n        dailyPracticeData, updateDailyPracticeData, // For adding commitments // cite: useAppServices.jsx\n        navigate, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL // AI & Nav // cite: useAppServices.jsx\n    } = useAppServices();\n\n    // --- Local State ---\n    // Initialize from context, provide robust defaults\n    const [decision, setDecision] = useState(strategicContentData?.lastPreMortemDecision || 'Enter a high-stakes decision (e.g., Launch new product line?)');\n    const [outcome, setOutcome] = useState(strategicContentData?.desiredOutcome || 'Define the specific, measurable success state.'); // Assumed field name\n    const [risks, setRisks] = useState(strategicContentData?.risks || ['', '']); // Default with two empty risks\n    // AI State\n    const [isGenerating, setIsGenerating] = useState(false);\n    const [auditResult, setAuditResult] = useState(''); // Raw AI response\n    const [auditHtml, setAuditHtml] = useState(''); // Rendered HTML\n    // Parsed outputs for actions\n    const [mitigationText, setMitigationText] = useState(''); // Parsed mitigation step\n    const [riskScenario, setRiskScenario] = useState(''); // Parsed highest risk for coaching lab\n\n    // --- Effect to Parse AI Audit Result ---\n    useEffect(() => {\n        if (!auditResult) { setAuditHtml(''); setMitigationText(''); setRiskScenario(''); return; }\n        // Render HTML\n        (async () => setAuditHtml(await mdToHtml(auditResult)))();\n        // Parse Mitigation Strategy (improved robustness)\n        const mitigationMatch = auditResult.match(/### Mitigation Strategy\\s*([\\s\\S]*?)(?:##|$)/i);\n        if (mitigationMatch?.[1]) {\n            const strategy = mitigationMatch[1].trim().split('\\n').map(s => s.replace(/^[\\*\\-\\d\\.\\s]+/, '').trim()).filter(Boolean)[0] || ''; // Get first non-empty line\n            setMitigationText(strategy.substring(0, 100)); // Limit length\n        }\n        // Parse Amplified Risk for Scenario\n        const riskMatch = auditResult.match(/### Risk Amplification\\s*([\\s\\S]*?)(?:##|$)/i);\n         if (riskMatch?.[1]) {\n            const primaryRisk = riskMatch[1].trim().split('\\n').map(s => s.replace(/^[\\*\\-\\d\\.\\s]+/, '').trim()).filter(Boolean)[0] || 'Unforeseen consequences'; // Get first non-empty line\n            setRiskScenario(primaryRisk.substring(0, 100)); // Limit length\n        }\n    }, [auditResult]);\n\n    // --- Handlers for Risk Input Array ---\n    const handleRiskChange = useCallback((index, value) => {\n        setRisks(prev => prev.map((r, i) => (i === index ? value : r)));\n        setAuditResult(''); // Clear audit when risks change\n    }, []);\n    const handleAddRisk = useCallback(() => setRisks(prev => [...prev, '']), []);\n    const handleRemoveRisk = useCallback((index) => setRisks(prev => prev.filter((_, i) => i !== index)), []);\n\n    // --- Handler to Run AI Pre-Mortem Audit ---\n    const runPreMortemAudit = useCallback(async () => {\n        const validRisks = risks.map(r => r.trim()).filter(Boolean); // Get non-empty risks\n        // Validation\n        if (!decision.trim() || !outcome.trim() || validRisks.length < 2) {\n            alert(\"Please define the Decision, Desired Outcome, and at least two potential Risks.\"); return;\n        }\n        if (!hasGeminiKey()) {\n            setAuditResult(\"## AI Audit Unavailable\\n\\n**ERROR**: API Key missing. Please check App Settings.\"); return;\n        }\n\n        setIsGenerating(true);\n        setAuditResult(''); // Clear previous result\n        console.log(\"[PreMortem] Running AI audit...\");\n\n        // Prepare context and prompt\n        const userContext = `**Decision:** ${decision.trim()}\\n**Desired Outcome:** ${outcome.trim()}\\n**Identified Risks:**\\n${validRisks.map(r => `- ${r}`).join('\\n')}`;\n        const systemPrompt = `You are the Devil's Advocate AI Auditor for strategic decisions. Perform a pre-mortem analysis based on the user's input.\n            **Required Output Structure (Use EXACT Markdown headings):**\n            ## Pre-Mortem Audit Results\n            ### Unforeseen Blind Spots\n            (List 2-3 NEW potential risks the user likely missed, relevant to the decision.)\n            ### Risk Amplification\n            (Select the user's MOST critical identified risk. Explain how it could escalate or be worse than anticipated.)\n            ### Mitigation Strategy\n            (Suggest 1-2 concrete, actionable steps to mitigate the HIGHEST combined risk (yours or theirs). Focus on prevention or contingency.)`;\n\n        try {\n            // Call AI\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userContext }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: GEMINI_MODEL || 'gemini-1.5-flash', // Use model from context // cite: useAppServices.jsx\n            };\n            const result = await callSecureGeminiAPI(payload); // cite: useAppServices.jsx\n            const text = result?.candidates?.[0]?.content?.parts?.[0]?.text\n                         || \"Audit failed: No response from AI. Check connection or try rephrasing.\";\n            setAuditResult(text);\n\n            // Save inputs to context on successful audit\n            await updateStrategicContentData({ // cite: useAppServices.jsx\n                lastPreMortemDecision: decision.trim(),\n                desiredOutcome: outcome.trim(), // Save outcome as well\n                risks: validRisks // Save the validated risks\n            });\n            console.log(\"[PreMortem] Audit successful, inputs saved.\");\n\n        } catch (error) {\n            console.error(\"[PreMortem] AI Audit Error:\", error);\n            setAuditResult(`## AI Audit Failed\\n\\n**ERROR**: ${error.message}. Please check console logs.`);\n        } finally {\n            setIsGenerating(false); // Reset loading state\n        }\n    }, [decision, outcome, risks, hasGeminiKey, GEMINI_MODEL, callSecureGeminiAPI, updateStrategicContentData]); // Dependencies\n\n    // --- Handler to Create Daily Rep from Mitigation ---\n    const handleCommitmentCreation = useCallback(async () => {\n        if (!mitigationText || !updateDailyPracticeData) return; // Validation // cite: useAppServices.jsx\n        console.log(\"[PreMortem] Creating commitment for mitigation:\", mitigationText);\n\n        const commitmentText = `(Pre-Mortem Mit.) ${mitigationText}`;\n        const newCommitment = {\n            id: `premortem_${Date.now()}`, text: commitmentText, status: 'Pending', isCustom: true,\n            linkedGoal: 'Risk Mitigation', linkedTier: 'T5', // Strategic decisions are T5 // cite: LEADERSHIP_TIERS_FALLBACK\n            source: 'PlanningHub',\n        };\n\n        try {\n            // Update daily practice data\n            const success = await updateDailyPracticeData(data => ({ // cite: useAppServices.jsx\n                ...data, activeCommitments: [...(data?.activeCommitments || []), newCommitment] // cite: useAppServices.jsx\n            }));\n            if (!success) throw new Error(\"Update failed\");\n            alert(\"Mitigation Rep added to your Daily Practice!\");\n            navigate('daily-practice'); // Navigate to practice screen // cite: useAppServices.jsx\n        } catch (e) {\n            console.error(\"[PreMortem] Failed to create commitment:\", e);\n            alert(\"Failed to add Rep to Daily Practice.\");\n        }\n    }, [mitigationText, updateDailyPracticeData, navigate]); // Dependencies\n\n    // --- Handler to Create Coaching Lab Scenario from Risk ---\n    const handleCreateScenario = useCallback(() => {\n        if (!riskScenario) return;\n        console.log(\"[PreMortem] Creating coaching lab scenario for risk:\", riskScenario);\n        // --- TODO: Implement actual scenario saving ---\n        // This would involve updating a global list of scenarios, potentially\n        // in `metadata/config/catalog/SCENARIO_CATALOG` via `updateGlobalMetadata`.\n        // For now, show a confirmation alert.\n        alert(`Coaching Lab Scenario Created (Mock):\\n\\nTitle: Handling Escalated Risk - ${decision.substring(0, 30)}...\\nPersona: Stakeholder concerned about \"${riskScenario.substring(0, 50)}...\"\\nTier: T5`);\n        // Optionally navigate to the lab: navigate('coaching-lab');\n    }, [riskScenario, decision]); // Dependencies\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10\">\n            {/* Header */}\n            <h1 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>Tool: Decision Pre-Mortem Audit</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Identify critical risks *before* committing to a high-stakes decision using the AI Devil's Advocate.</p>\n            {/* Back Button */}\n            <Button onClick={() => setPlanningView('planning-home')} variant=\"nav-back\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Strategic Tools\n            </Button>\n\n            {/* Main Content Sections */}\n            <div className=\"space-y-6\">\n                {/* Step 1: Decision & Outcome */}\n                <Card title=\"1. Define Decision & Desired Outcome\" icon={TrendingUp} accent='TEAL'>\n                    {/* Decision Input */}\n                    <div className=\"mb-4\">\n                        <label className=\"block text-sm font-semibold mb-1\" style={{ color: COLORS.NAVY }}>Critical Decision:</label>\n                        <textarea value={decision} onChange={(e) => setDecision(e.target.value)}\n                            className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#47A88D] h-20 text-sm\" placeholder=\"e.g., Should we acquire competitor X?\" />\n                    </div>\n                    {/* Outcome Input */}\n                    <div>\n                        <label className=\"block text-sm font-semibold mb-1\" style={{ color: COLORS.NAVY }}>Desired Outcome (Success State):</label>\n                        <input type=\"text\" value={outcome} onChange={(e) => setOutcome(e.target.value)}\n                            className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#47A88D] text-sm\" placeholder=\"e.g., Integrate acquisition smoothly, retain 90% key staff, increase market share by 5% in 12 months.\"/>\n                    </div>\n                </Card>\n\n                {/* Step 2: Identify Initial Risks */}\n                <Card title=\"2. Identify Known Risks / Failure Modes\" icon={AlertTriangle} accent='ORANGE'>\n                    <p className=\"text-gray-700 text-sm mb-3\">List the main ways this decision could fail (Min. 2 required).</p>\n                    <div className=\"space-y-3\">\n                        {risks.map((risk, index) => (\n                            <div key={index} className=\"flex items-center gap-2\">\n                                <span className=\"text-gray-400 font-mono text-sm\">{index + 1}.</span>\n                                <input type=\"text\" value={risk} onChange={(e) => handleRiskChange(index, e.target.value)}\n                                    className=\"flex-1 p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#E04E1B] text-sm\" placeholder={`Potential failure mode ${index + 1}`} />\n                                <Button onClick={() => handleRemoveRisk(index)} variant=\"ghost\" size=\"sm\" className=\"!p-1 text-red-500 hover:bg-red-100\"> <X className='w-4 h-4'/> </Button>\n                            </div>\n                        ))}\n                    </div>\n                    {/* Add Risk Button */}\n                    <Button onClick={handleAddRisk} variant=\"outline\" size=\"sm\" className=\"mt-4 border-dashed border-gray-400 text-gray-600 hover:bg-gray-100\">\n                        <PlusCircle className='w-4 h-4 mr-2'/> Add Risk\n                    </Button>\n                </Card>\n            </div >\n\n            {/* Run Audit Button */}\n            <Button onClick={runPreMortemAudit}\n                    disabled={isGenerating || !decision.trim() || !outcome.trim() || risks.filter(r => r.trim()).length < 2 || !hasGeminiKey()}\n                    size=\"lg\" className=\"mt-8 w-full\">\n                {isGenerating ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Cpu className='w-5 h-5 mr-2'/>}\n                {isGenerating ? \"Running Devil's Advocate Audit...\" : \"Run Pre-Mortem Audit\"}\n            </Button>\n             {!hasGeminiKey() && <p className=\"text-xs text-red-500 mt-2 text-center\">API Key missing. Audit disabled.</p>}\n\n            {/* Audit Results Section (Conditional) */}\n            {auditHtml && (\n                <Card title=\"AI Audit Results & Mitigation Plan\" icon={ShieldCheck} accent='NAVY' className=\"mt-8\">\n                    {/* Render Audit HTML */}\n                    <div dangerouslySetInnerHTML={{ __html: auditHtml }} />\n\n                    {/* Actionable Next Steps (Conditional) */}\n                    {(mitigationText || riskScenario) && hasGeminiKey() && (\n                        <div className='mt-6 pt-4 border-t border-gray-300 space-y-3'>\n                            <p className='text-sm font-semibold flex items-center gap-1'><Award className=\"w-4 h-4 text-[#47A88D]\" /> Actionable Next Steps:</p>\n                            {/* Create Commitment Button */}\n                            {mitigationText && (\n                                <Button onClick={handleCommitmentCreation} size=\"sm\" className=\"w-full bg-[#47A88D] hover:bg-[#349881]\">\n                                    <PlusCircle className='w-4 h-4 mr-2' /> Add Mitigation Rep to Daily Practice (T5)\n                                </Button>\n                            )}\n                            {/* Create Scenario Button */}\n                            {riskScenario && (\n                                <Button onClick={handleCreateScenario} variant=\"outline\" size=\"sm\" className=\"w-full text-[#E04E1B] border-[#E04E1B] hover:bg-[#E04E1B]/10\">\n                                    <Cpu className='w-4 h-4 mr-2' /> Capture Amplified Risk as Coaching Lab Scenario (T5)\n                                </Button>\n                            )}\n                        </div>\n                    )}\n                </Card>\n            )}\n        </div>\n    );\n};\n\n\n// --- VisionBuilderView (Refactored for Consistency) ---\nconst VisionBuilderView = ({ setPlanningView }) => {\n    // --- Services & State ---\n    const { strategicContentData, updateStrategicContentData, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = useAppServices(); // cite: useAppServices.jsx\n    const [vision, setVision] = useState(strategicContentData?.vision || ''); // cite: useAppServices.jsx\n    const [mission, setMission] = useState(strategicContentData?.mission || ''); // cite: useAppServices.jsx\n    const [isSaving, setIsSaving] = useState(false);\n    const [isSavedConfirmation, setIsSavedConfirmation] = useState(false);\n    const [isCritiquing, setIsCritiquing] = useState(false);\n    const [critiqueResult, setCritiqueResult] = useState('');\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n\n    // Effects for syncing state and parsing critique (unchanged logic)\n    useEffect(() => { /* ... sync vision/mission from context ... */ }, [strategicContentData]);\n    useEffect(() => { /* ... parse critique markdown to html ... */ }, [critiqueResult]);\n\n    // Save handler (unchanged logic, ensure correct update function)\n    const handleSave = useCallback(async () => { /* ... uses updateStrategicContentData ... */ }, [vision, mission, updateStrategicContentData]); // cite: useAppServices.jsx\n\n    // AI Critique handler (unchanged logic, ensure payload)\n    const critiqueVision = useCallback(async () => { /* ... uses callSecureGeminiAPI ... */ }, [vision, mission, hasGeminiKey, GEMINI_MODEL, callSecureGeminiAPI]); // cite: useAppServices.jsx\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10\">\n            {/* Header */}\n            <h1 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>Tool: Vision & Mission Builder</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Define your aspirational 3-5 year Vision (Future State) and Mission (Core Purpose).</p>\n            {/* Back Button */}\n            <Button onClick={() => setPlanningView('planning-home')} variant=\"nav-back\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Strategic Tools\n            </Button>\n\n            {/* Main Content Sections */}\n            <div className=\"space-y-6\">\n                {/* Vision Card */}\n                <Card title=\"1. Define Your Vision (3-5 Year Future State)\" icon={TrendingUp} accent='ORANGE'>\n                    <p className=\"text-gray-700 text-sm mb-3\">Inspiring, memorable, concise (max ~20 words).</p>\n                    <textarea value={vision} onChange={(e) => setVision(e.target.value)}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#E04E1B] h-24 text-sm\" placeholder=\"e.g., 'Become the undisputed leader in sustainable tech solutions...'\" />\n                </Card>\n                {/* Mission Card */}\n                <Card title=\"2. Define Your Mission (Core Purpose)\" icon={Target} accent='TEAL'>\n                    <p className=\"text-gray-700 text-sm mb-3\">Why your team exists, primary value delivered.</p>\n                    <textarea value={mission} onChange={(e) => setMission(e.target.value)}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#47A88D] h-20 text-sm\" placeholder=\"e.g., 'To empower businesses with data-driven insights...'\" />\n                </Card>\n                {/* Quality Check Card */}\n                <Card title=\"Quality Check\" icon={CheckCircle} accent='NAVY' className='bg-[#002E47]/5 text-sm'>\n                     {/* ... unchanged checklist ... */}\n                </Card>\n            </div>\n\n            {/* Save Button Area */}\n            <div className='flex items-center gap-4 mt-8'>\n                <Button onClick={handleSave} disabled={isSaving || !vision.trim() || !mission.trim()} size=\"lg\">\n                    {isSaving ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Save className=\"w-5 h-5 mr-2\" />} {isSaving ? 'Saving...' : 'Save Vision & Mission'}\n                </Button>\n                {isSavedConfirmation && <span className='text-sm font-bold text-green-600 flex items-center'><CheckCircle className='w-4 h-4 mr-1'/> Saved!</span>}\n            </div>\n\n            {/* AI Critique Section */}\n            <Card title=\"AI Vision Auditor\" icon={Cpu} accent='PURPLE' className='mt-8'> {/* Use Purple Accent */}\n                <p className='text-gray-700 text-sm mb-4'>Use the AI Rep Coach to critique your statements for clarity, alignment, and actionability (T5 focus).</p>\n                {/* Critique Button */}\n                <Button onClick={critiqueVision} disabled={isCritiquing || !vision.trim() || !mission.trim() || !hasGeminiKey()} size=\"md\" className=\"w-full bg-[#7C3AED] hover:bg-purple-700\"> {/* Purple Button */}\n                    {isCritiquing ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <MessageSquare className='w-5 h-5 mr-2'/>} {isCritiquing ? 'Auditing Vision...' : 'Run Vision Critique'}\n                </Button>\n                 {!hasGeminiKey() && <p className=\"text-xs text-red-500 mt-2 text-center\">API Key missing. Critique disabled.</p>}\n                {/* Critique Result */}\n                {critiqueHtml && (\n                    <div className=\"mt-6 pt-4 border-t border-gray-200\">\n                        <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                    </div>\n                )}\n            </Card>\n        </div>\n    );\n};\n\n\n// --- OKRDraftingView (Refactored for Consistency) ---\nconst OKRDraftingView = ({ setPlanningView }) => {\n    // --- Services & State ---\n    const { strategicContentData, updateStrategicContentData, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = useAppServices(); // cite: useAppServices.jsx\n    // Initialize OKRs safely from context, ensuring keyResults is always an array\n    const [okrs, setOkrs] = useState(() => (strategicContentData?.okrs || []).map(o => ({ ...o, keyResults: o.keyResults || [] })) ); // cite: useAppServices.jsx\n    const [isSaving, setIsSaving] = useState(false);\n    const [isSavedConfirmation, setIsSavedConfirmation] = useState(false); // Added\n    const [okrCritique, setOkrCritique] = useState('');\n    const [critiqueHtml, setCritiqueHtml] = useState('');\n    const [isCritiquing, setIsCritiquing] = useState(false);\n\n    // Sync local state if context data loads/changes after initial render\n    useEffect(() => { /* ... same sync logic as original ... */ }, [strategicContentData?.okrs]);\n    // Parse critique markdown (unchanged)\n    useEffect(() => { /* ... same markdown parsing ... */ }, [okrCritique]);\n\n    // Handlers for modifying OKRs (unchanged logic)\n    const updateObjective = useCallback((id, value) => { /* ... */ setOkrCritique(''); }, []);\n    const updateKR = useCallback((objId, krId, value) => { /* ... */ setOkrCritique(''); }, []);\n    const addKR = useCallback((objId) => { /* ... */ }, []);\n    const removeKR = useCallback((objId, krId) => { /* ... */ }, []);\n    const removeObjective = useCallback((id) => setOkrs(prev => prev.filter(o => o.id !== id)), []);\n    const addObjective = useCallback(() => { /* ... */ }, [okrs]); // Dependency needed if logic uses okrs.length\n\n    // Save handler (unchanged logic, ensure correct update function)\n    const handleSave = useCallback(async () => { /* ... uses updateStrategicContentData ... */\n        setIsSaving(true); setIsSavedConfirmation(false);\n        const validOkrs = okrs.filter(/* ... */); // Filter empty\n        try {\n            await updateStrategicContentData({ okrs: validOkrs }); // cite: useAppServices.jsx\n            setIsSavedConfirmation(true); setTimeout(() => setIsSavedConfirmation(false), 3000);\n        } catch (e) { console.error('Failed to save OKRs:', e); alert('Failed to save OKRs.'); }\n        finally { setIsSaving(false); }\n    }, [okrs, updateStrategicContentData]); // cite: useAppServices.jsx\n\n    // AI Critique handler (unchanged logic, ensure payload)\n    const critiqueOKRs = useCallback(async () => { /* ... uses callSecureGeminiAPI ... */ }, [okrs, hasGeminiKey, GEMINI_MODEL, callSecureGeminiAPI]); // cite: useAppServices.jsx\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10\">\n            {/* Header */}\n            <h1 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>Tool: OKR Drafting & Audit</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Set ambitious Objectives (What) and measurable Key Results (How) for the quarter, aligned with your Vision.</p>\n            {/* Back Button */}\n            <Button onClick={() => setPlanningView('planning-home')} variant=\"nav-back\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Strategic Tools\n            </Button>\n\n            {/* OKR Cards */}\n            <div className=\"space-y-8\">\n                {okrs.map((obj, objIndex) => (\n                    <Card key={obj.id} title={`Objective ${objIndex + 1}`} icon={Target} accent='NAVY'>\n                        {/* Objective Input & Remove Button */}\n                        <div className='flex justify-between items-start mb-4'>\n                            <input type=\"text\" value={obj.objective} onChange={(e) => updateObjective(obj.id, e.target.value)}\n                                className=\"flex-1 p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#47A88D] text-md font-semibold\" placeholder=\"Ambitious, inspiring objective...\" />\n                            <Button onClick={() => removeObjective(obj.id)} variant=\"ghost\" size=\"sm\" className=\"!p-1 text-red-500 hover:bg-red-100 ml-2\"> <Trash2 className='w-4 h-4'/> </Button>\n                        </div>\n                        {/* Succession Dependency (unchanged UI) */}\n                        <div className='flex items-center gap-2 mb-6 p-2 rounded-lg bg-gray-100 border border-gray-200'>\n                            <label htmlFor={`dep-${obj.id}`} className='text-xs font-semibold flex items-center text-gray-600'><CornerRightUp className='w-3 h-3 mr-1'/> Succession:</label>\n                            <select id={`dep-${obj.id}`} value={obj.successionDependency || 'None'} onChange={(e) => setOkrs(/* */)} className=\"p-1 border border-gray-300 rounded text-xs bg-white\"> /* ... options ... */ </select>\n                        </div>\n                        {/* Key Results Section */}\n                        <h3 className=\"text-md font-bold mb-3 border-b border-dashed pb-1\" style={{ color: COLORS.TEAL }}>Key Results (Measurable 'from X to Y')</h3>\n                        <div className=\"space-y-3\">\n                            {(obj.keyResults || []).map((kr, krIndex) => (\n                                <div key={kr.id} className='flex items-center gap-2'>\n                                    <span className='font-mono text-sm text-[#E04E1B] w-4'>{krIndex + 1}.</span>\n                                    <input type=\"text\" value={kr.kr} onChange={(e) => updateKR(obj.id, kr.id, e.target.value)}\n                                        className=\"flex-1 p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#E04E1B] text-sm\" placeholder=\"e.g., Reduce bugs from 45 to 15 by EOM.\" />\n                                    <Button onClick={() => removeKR(obj.id, kr.id)} variant=\"ghost\" size=\"sm\" className=\"!p-1 text-gray-400 hover:text-red-500\"> <X className='w-4 h-4'/> </Button>\n                                </div>\n                            ))}\n                        </div>\n                        {/* Add KR Button */}\n                        <Button onClick={() => addKR(obj.id)} variant=\"outline\" size=\"sm\" className=\"mt-4 border-dashed border-gray-400 text-gray-600 hover:bg-gray-100\">\n                            <PlusCircle className='w-4 h-4 mr-2'/> Add Key Result\n                        </Button>\n                    </Card>\n                ))}\n            </div>\n\n            {/* Add Objective & Save Buttons */}\n            <div className='flex flex-col sm:flex-row items-center gap-4 mt-8'>\n                <Button onClick={addObjective} variant=\"outline\" size=\"md\" className=\"w-full sm:w-auto border-[#002E47] text-[#002E47] hover:bg-[#002E47]/10\">\n                    <PlusCircle className='w-5 h-5 mr-2'/> Add New Objective\n                </Button>\n                <Button onClick={handleSave} disabled={isSaving || okrs.length === 0} size=\"lg\" className=\"w-full sm:w-auto flex-grow\">\n                    {isSaving ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Save className=\"w-5 h-5 mr-2\" />} {isSaving ? 'Saving OKRs...' : 'Save Quarterly OKRs'}\n                </Button>\n                {isSavedConfirmation && <span className='text-sm font-bold text-green-600 flex items-center'><CheckCircle className='w-4 h-4 mr-1'/> Saved!</span>}\n            </div>\n\n            {/* AI Critique Section */}\n            <Card title=\"AI OKR Auditor\" icon={Cpu} accent='TEAL' className='mt-8'>\n                <p className='text-gray-700 text-sm mb-4'>Use the AI Rep Coach to review drafted OKRs for measurability, ambition, and alignment.</p>\n                {/* Critique Button */}\n                <Button onClick={critiqueOKRs} disabled={isCritiquing || okrs.length === 0 || !okrs.every(o=>o.objective.trim() && o.keyResults?.every(kr=>kr.kr.trim())) || !hasGeminiKey()} size=\"md\" className=\"w-full bg-[#002E47] hover:bg-gray-700\"> {/* Navy Button */}\n                    {isCritiquing ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <MessageSquare className='w-5 h-5 mr-2'/>} {isCritiquing ? 'Auditing OKRs...' : 'Run OKR Audit'}\n                </Button>\n                 {!hasGeminiKey() && <p className=\"text-xs text-red-500 mt-2 text-center\">API Key missing. Audit disabled.</p>}\n                {/* Critique Result */}\n                {critiqueHtml && (\n                    <div className=\"mt-6 pt-4 border-t border-gray-200\">\n                        <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                    </div>\n                )}\n            </Card>\n        </div>\n    );\n};\n\n\n// --- AlignmentTrackerView (Refactored for Consistency & AI Fix) ---\nconst AlignmentTrackerView = ({ setPlanningView }) => {\n    // --- Services & State ---\n    const { strategicContentData, updateStrategicContentData, dailyPracticeData, updateDailyPracticeData, navigate, callSecureGeminiAPI, hasGeminiKey, GEMINI_MODEL } = useAppServices(); // cite: useAppServices.jsx\n    // Safely initialize state from context\n    const [misalignmentNotes, setMisalignmentNotes] = useState(strategicContentData?.misalignmentNotes || ''); // cite: useAppServices.jsx\n    const [isSaving, setIsSaving] = useState(false);\n    const [isSavedConfirmation, setIsSavedConfirmation] = useState(false);\n    const [isSuggesting, setIsSuggesting] = useState(false);\n    const [suggestionText, setSuggestionText] = useState(''); // Just the commitment text\n    const [suggestionCommitment, setSuggestionCommitment] = useState(null); // Full { commitment, tier } object\n    const [lastJsonError, setLastJsonError] = useState(''); // Store JSON error details\n\n    // Sync state on load (unchanged)\n    useEffect(() => { /* ... */ }, [strategicContentData]);\n\n    // Mock progress data (unchanged logic, uses context data for titles)\n    const objectives = useMemo(() => (strategicContentData?.okrs || []).map((o, index) => { /* ... same mock progress logic ... */ }), [strategicContentData?.okrs]);\n\n    // Save handler (unchanged logic)\n    const handleSaveReflection = useCallback(async () => { /* ... uses updateStrategicContentData ... */ }, [misalignmentNotes, updateStrategicContentData]); // cite: useAppServices.jsx\n\n    // --- ** FIXED AI Suggestion Handler ** ---\n    const critiqueMisalignment = useCallback(async () => {\n        const notes = misalignmentNotes.trim();\n        if (!notes || notes.length < 20) { alert(\"Please describe the misalignment issue (min 20 chars).\"); return; }\n        if (!hasGeminiKey()) { setSuggestionText(\"AI Suggestion Unavailable: API Key missing.\"); return; }\n\n        setIsSuggesting(true);\n        setSuggestionText('');\n        setSuggestionCommitment(null); // Clear previous suggestion object\n        setLastJsonError(''); // Clear previous error\n        console.log(\"[AlignmentTracker] Requesting AI preventative commitment...\");\n\n        // Define the desired JSON structure\n        const jsonSchema = {\n            type: \"OBJECT\",\n            properties: { commitment: { type: \"STRING\" }, tier: { type: \"STRING\", enum: [\"T1\", \"T2\"] } },\n            required: [\"commitment\", \"tier\"]\n        };\n\n        const systemInstruction = `You are a pragmatic Executive Coach. Analyze the user's misalignment log (low-leverage activity). Generate ONE concise, low-friction, high-impact daily commitment (a 'Rep') to prevent this waste. Focus on T1 (Self) or T2 (Work) skills. Respond ONLY with a JSON object matching the required schema. No conversational text or markdown.`;\n        const userQuery = `Misalignment Log: \"${notes}\"\\n\\nGenerate the JSON output.`;\n\n        try {\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemInstruction }] },\n                // --- Request JSON Output ---\n                generationConfig: { responseMimeType: \"application/json\", responseSchema: jsonSchema },\n                model: 'gemini-1.5-flash', // Use flash for speed\n            };\n\n            const result = await callSecureGeminiAPI(payload); // cite: useAppServices.jsx\n            console.log(\"[AlignmentTracker] AI Response (raw):\", result);\n\n            // Response should already be parsed JSON if API call was successful\n            const parsedJson = result?.candidates?.[0]?.content?.parts?.[0]; // The part itself should be the object\n\n            // --- Validate Parsed JSON ---\n            if (parsedJson && typeof parsedJson === 'object' && parsedJson.commitment && parsedJson.tier) {\n                console.log(\"[AlignmentTracker] AI Suggestion generated:\", parsedJson);\n                setSuggestionText(parsedJson.commitment);\n                setSuggestionCommitment(parsedJson); // Store the full object\n            } else {\n                // Handle cases where response is not valid JSON or misses required fields\n                console.error(\"[AlignmentTracker] Failed to parse valid JSON from AI response:\", parsedJson);\n                throw new Error(`AI response was not the expected JSON object. Received: ${JSON.stringify(parsedJson)}`);\n            }\n\n        } catch (error) {\n            console.error(\"[AlignmentTracker] AI Suggestion Error:\", error);\n            let errorMsg = `AI suggestion failed: ${error.message}.`;\n            setLastJsonError(error.message); // Store error details\n            setSuggestionText(errorMsg); // Show error to user\n            setSuggestionCommitment(null); // Ensure commitment object is null on error\n        } finally {\n            setIsSuggesting(false); // Reset loading state\n        }\n    }, [misalignmentNotes, hasGeminiKey, callSecureGeminiAPI]); // Dependencies\n\n    // Add suggestion to daily practice (unchanged logic)\n    const handleAddSuggestionToScorecard = useCallback(async () => { /* ... uses updateDailyPracticeData ... */ }, [suggestionCommitment, updateDailyPracticeData, navigate]); // cite: useAppServices.jsx\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10\">\n            {/* Header */}\n            <h1 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>Tool: Strategic Alignment Tracker</h1>\n            <p className=\"text-lg text-gray-600 mb-6 max-w-3xl\">Review OKR progress, log misalignments, and get AI suggestions for preventative daily reps.</p>\n            {/* Back Button */}\n            <Button onClick={() => setPlanningView('planning-home')} variant=\"nav-back\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to Strategic Tools\n            </Button>\n\n            {/* Main Content Sections */}\n            <div className=\"space-y-6\">\n                {/* OKR Progress Section */}\n                <h2 className='text-2xl font-extrabold border-b-2 pb-2 mb-4' style={{ color: COLORS.NAVY, borderColor: COLORS.TEAL }}>Quarterly Objective Progress</h2>\n                {objectives.length === 0 && <Card className=\"text-center italic text-gray-500 border-dashed\">No OKRs defined yet. Use the OKR Drafting Tool.</Card>}\n                {objectives.map(obj => (\n                    <Card key={obj.id} title={obj.title} icon={CheckCircle} accent='TEAL' className=\"shadow-md\">\n                        {/* Progress Bar & Status */}\n                        <div className=\"flex items-center justify-between mb-2\">\n                            <p className=\"text-sm font-semibold\">Progress: {Math.round(obj.progress * 100)}%</p>\n                            {/* Status Badge (FIXED) */}\n                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full`}>{obj.status}</span>\n                        </div>\n                        {/* Progress Bar Visual (FIXED) */}\n                        <div className=\"w-full bg-gray-200 rounded-full h-2.5\"> \n                            <div className={`h-2.5 rounded-full`} style={{ width: `${obj.progress * 100}%` }}></div> \n                        </div>\n                        {/* Succession Dependency Note (if applicable) */}\n                        {obj.successionDependency && <div className='mt-3 p-2 rounded text-xs flex items-center bg-gray-100 border border-gray-200'><CornerRightUp className='w-3 h-3 mr-1 text-gray-500'/> Succession Critical: Requires <strong>{obj.successionDependency}</strong> development.</div>}\n                        {/* ... rest of the card ... */}\n                    </Card>\n                ))}\n\n                {/* Misalignment Log Card */}\n                <Card title=\"Vision Alignment Check (Misalignment Log)\" icon={Lightbulb} accent='ORANGE'>\n                    <p className=\"text-gray-700 text-sm mb-3\">Log non-OKR activities draining time this week to identify & eliminate waste.</p>\n                    {/* Notes Input */}\n                    <textarea value={misalignmentNotes} onChange={(e) => setMisalignmentNotes(e.target.value)}\n                        className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#E04E1B] h-20 text-sm\" placeholder=\"e.g., 'Spent 3 hours on ad-hoc reporting not tied to KRs...'\" />\n                    {/* Save Log Button */}\n                    <div className='flex items-center gap-4 mt-4'>\n                        <Button onClick={handleSaveReflection} disabled={isSaving || !misalignmentNotes.trim()} variant=\"secondary\" size=\"md\" className=\"flex-1\">\n                            {isSaving ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Save className='w-5 h-5 mr-2'/>} {isSaving ? 'Saving Log...' : 'Save Misalignment Log'}\n                        </Button>\n                        {isSavedConfirmation && <span className='text-sm font-bold text-green-600 flex items-center'><CheckCircle className='w-4 h-4 mr-1'/> Logged!</span>}\n                    </div>\n                    {/* AI Suggestion Button */}\n                    <Button onClick={critiqueMisalignment} disabled={isSuggesting || !misalignmentNotes.trim() || misalignmentNotes.trim().length < 20 || !hasGeminiKey()} variant=\"outline\" size=\"md\" className=\"w-full mt-4 text-[#002E47] border-[#002E47] hover:bg-[#002E47]/10\">\n                        {isSuggesting ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Cpu className='w-5 h-5 mr-2'/>} {isSuggesting ? 'Generating Commitment...' : 'Get AI Preventative Rep'}\n                    </Button>\n                     {!hasGeminiKey() && <p className=\"text-xs text-red-500 mt-2 text-center\">API Key missing. AI suggestions disabled.</p>}\n                    {/* AI Suggestion Display */}\n                    {suggestionText && (\n                        <div className={`mt-4 p-3 rounded-xl border ${suggestionCommitment ? 'bg-white border-[#47A88D]' : 'bg-red-50 border-red-300'} shadow-md`}>\n                            <p className={`text-xs font-semibold mb-1 flex items-center gap-1 ${suggestionCommitment ? 'text-[#47A88D]' : 'text-red-600'}`}>\n                                {suggestionCommitment ? <Lightbulb className=\"w-4 h-4\"/> : <AlertTriangle className=\"w-4 h-4\"/>}\n                                AI Preventative Rep Suggestion {suggestionCommitment ? `(${suggestionCommitment.tier})` : '(Error)'}:\n                            </p>\n                            <p className={`text-sm ${suggestionCommitment ? 'text-[#002E47] font-medium' : 'text-red-700'}`}>{suggestionText}</p>\n                            {/* Add to Scorecard Button (Conditional) */}\n                            {suggestionCommitment && (\n                                <Button onClick={handleAddSuggestionToScorecard} variant='primary' size=\"sm\" className=\"w-full mt-3\">\n                                    <PlusCircle className='w-4 h-4 mr-1' /> Add to Daily Practice ({suggestionCommitment.tier} Rep)\n                                </Button>\n                            )}\n                            {/* Display JSON error details if present */}\n                            {lastJsonError && !suggestionCommitment && <p className='text-[10px] text-red-500 mt-2'>Error Detail: {lastJsonError}</p>}\n                        </div>\n                    )}\n                </Card>\n            </div>\n        </div>\n    );\n};\n\n\n/* =========================================================\n   MAIN ROUTER: PlanningHubScreen\n========================================================= */\nexport default function PlanningHubScreen() {\n    // --- Consume Services ---\n    const { isLoading: isAppLoading, error: appError, featureFlags, isAdmin } = useAppServices(); // cite: useAppServices.jsx\n\n    // --- Local State ---\n    const [view, setPlanningView] = useState('planning-home'); // Current tool view\n\n    // --- Feature Flag Check (bypass for admins) ---\n    // If the entire Planning Hub is disabled, show a message or return null\n    if (!isAdmin && !featureFlags?.enablePlanningHub) { // cite: useAppServices.jsx\n        return (\n            <div className=\"p-8 text-center text-gray-500\">\n                <Trello className=\"w-12 h-12 mx-auto mb-4 text-gray-400\"/>\n                <h1 className=\"text-2xl font-bold mb-2\">Strategic Content Tools Unavailable</h1>\n                <p>This feature is currently disabled by the administrator.</p>\n            </div>\n        );\n    }\n\n    // --- Loading & Error States ---\n    if (isAppLoading) return <LoadingSpinner message=\"Loading Strategic Content Tools...\" />;\n    if (appError) return <ConfigError message={`Failed to load Planning Hub: ${appError.message}`} />;\n\n\n    // --- View Rendering Logic ---\n    const renderView = () => {\n        const viewProps = { setPlanningView }; // Pass setter to child views\n\n        switch (view) {\n            case 'vision-builder': return <VisionBuilderView {...viewProps} />;\n            case 'okr-drafting': return <OKRDraftingView {...viewProps} />;\n            case 'alignment-tracker': return <AlignmentTrackerView {...viewProps} />;\n            case 'pre-mortem': return <PreMortemView {...viewProps} />;\n            case 'planning-home':\n            default:\n                // --- Refactored Home View ---\n                return (\n                    // Consistent page structure and padding\n                    <div className=\"p-6 md:p-8 lg:p-10\">\n                        {/* Header */}\n                        <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.BLUE+'30'}}> {/* Use BLUE accent */}\n                            <Trello className='w-10 h-10 flex-shrink-0' style={{color: COLORS.BLUE}}/>\n                            <div>\n                                <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Strategic Content Tools</h1>\n                                <p className=\"text-md text-gray-600 mt-1\">(Content Pillar 1)</p>\n                            </div>\n                        </header>\n                        <p className=\"text-lg text-gray-700 mb-10 max-w-3xl\">High-leverage tools for strategic planning, goal setting, and risk mitigation, supported by AI audits.</p>\n\n                        {/* Tool Grid */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                            {/* Vision & Mission */}\n                            <Card title=\"Vision & Mission Builder\" icon={BookOpen} accent='TEAL' onClick={() => setPlanningView('vision-builder')} className=\"cursor-pointer hover:border-teal-400\">\n                                <p className=\"text-gray-700 text-sm mb-4\">Define your 3-5 year strategic North Star. Get AI critique on clarity and alignment.</p>\n                                <div className=\"mt-auto text-[#47A88D] font-semibold flex items-center group\">Launch Tool <span className=\"ml-1 group-hover:translate-x-1 transition-transform\">&rarr;</span></div>\n                            </Card>\n                            {/* OKR Drafting */}\n                            <Card title=\"OKR Drafting & Audit\" icon={Target} accent='NAVY' onClick={() => setPlanningView('okr-drafting')} className=\"cursor-pointer hover:border-navy-400\">\n                                <p className=\"text-gray-700 text-sm mb-4\">Set quarterly Objectives and Key Results. Use the AI Auditor for measurability and impact.</p>\n                                <div className=\"mt-auto text-[#002E47] font-semibold flex items-center group\">Launch Tool <span className=\"ml-1 group-hover:translate-x-1 transition-transform\">&rarr;</span></div>\n                            </Card>\n                            {/* Pre-Mortem */}\n                            <Card title=\"Decision Pre-Mortem Audit\" icon={AlertTriangle} accent='ORANGE' onClick={() => setPlanningView('pre-mortem')} className=\"cursor-pointer hover:border-orange-400\">\n                                <p className=\"text-gray-700 text-sm mb-4\">Identify critical risks *before* decisions. Use the AI Devil's Advocate to find blind spots.</p>\n                                <div className=\"mt-auto text-[#E04E1B] font-semibold flex items-center group\">Launch Auditor <span className=\"ml-1 group-hover:translate-x-1 transition-transform\">&rarr;</span></div>\n                            </Card>\n                            {/* Alignment Tracker */}\n                            <Card title=\"Strategic Alignment Tracker\" icon={Activity} accent='BLUE' onClick={() => setPlanningView('alignment-tracker')} className=\"cursor-pointer hover:border-blue-400\">\n                                <p className=\"text-gray-700 text-sm mb-4\">Review OKR progress, log misalignments, and get AI suggestions for preventative daily reps.</p>\n                                <div className=\"mt-auto text-[#2563EB] font-semibold flex items-center group\">Launch Tracker <span className=\"ml-1 group-hover:translate-x-1 transition-transform\">&rarr;</span></div>\n                            </Card>\n                        </div>\n                    </div>\n                );\n        }\n    };\n\n    // --- Main Render ---\n    return (\n        <div className=\"min-h-screen\" style={{ background: COLORS.BG }}> {/* Consistent BG */}\n            {renderView()}\n        </div>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/QuickStartAccelerator.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":222,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":222,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'featureFlags' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":222,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":222,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/QuickStartAccelerator.jsx (Refactored for Consistency, Context)\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Icons ---\nimport {\n  Zap, ShieldCheck, ArrowLeft, Target, Briefcase, Clock, Users, CornerRightUp, X, Activity, Cpu, Eye,\n  CheckCircle, AlertTriangle, Lightbulb, BookOpen, Loader // Added Loader\n} from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5355', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Matches Dashboard/Dev Plan) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use exact Button definition from Dashboard.jsx ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\nconst Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => { /* ... Re-use exact Card definition from Dashboard.jsx ... */\n    const interactive = !!onClick; const Tag = interactive ? 'button' : 'div'; const accentColor = COLORS[accent] || COLORS.NAVY; const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n    return (\n        <Tag {...(interactive ? { type: 'button' } : {})} role={interactive ? 'button' : undefined} tabIndex={interactive ? 0 : undefined} onKeyDown={handleKeyDown} className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }} onClick={onClick}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div className={Icon || title ? '' : ''}>{children}</div>\n        </Tag>\n    );\n};\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition from DevelopmentPlan.jsx ... */\n    <div className=\"min-h-[200px] flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/* =========================================================\n   UTILITIES (Local or Shared)\n========================================================= */\n// Markdown to HTML converter (Simplified version)\nconst mdToHtml = async (md) => { /* ... Re-use definition from Labs.jsx ... */\n    if (!md) return ''; let html = md;\n    html = html.replace(/^## (.*$)/gim, '<h2 class=\"text-xl font-extrabold text-[#002E47] border-b border-gray-200 pb-2 mb-3 mt-5\">$1</h2>');\n    html = html.replace(/^### (.*$)/gim, '<h3 class=\"text-lg font-bold text-[#47A88D] mt-4 mb-2\">$1</h3>');\n    html = html.replace(/\\*\\*(.*?)\\*\\*/gim, '<strong class=\"font-semibold\">$1</strong>');\n    html = html.replace(/^\\* (.*$)/gim, '<li>$1</li>');\n    html = html.replace(/(<li>.*<\\/li>\\s*)+/g, (match) => `<ul class=\"list-disc list-inside space-y-1 mb-4 pl-4\">${match.trim()}</ul>`);\n    html = html.split('\\n').map(line => { line = line.trim(); if (!line || line.startsWith('<h') || line.startsWith('<ul') || line.startsWith('<li') || line === '</ul>') return line; return `<p class=\"text-sm text-gray-700 mb-2\">${line}</p>`; }).join('');\n    html = html.replace(/<p><\\/p>/g, '');\n    return `<div class=\"prose prose-sm max-w-none\">${html}</div>`;\n};\n\n// --- Mock LIS Critique (Fallback if API fails or key missing) ---\nconst LIS_MOCK_CRITIQUE = `## Leadership Identity Audit Score: 75/100\n\n### Clarity and Specificity\n**Critique:** Your draft uses somewhat passive language (\"tries to do the right thing\"). Aim for measurable actions.\n\n### Action/Behavior Focus\n**Critique:** Focus on *what you do* (\"I lead by...\") rather than just beliefs (\"I believe in...\").\n\n### Aspirational Rigor\n**Critique:** The statement describes competency, not necessarily excellence. Aim higher.\n\n**Refined LIS Example:**\n\"I am a **dedicated anchor** who cultivates execution by maintaining **radical transparency**, and **I grow trust** by actively seeking and acting on constructive criticism.\"`;\n\n\n/* =========================================================\n   LISAuditorView Component (Refactored)\n   - Allows users to draft and get AI critique on their Leadership Identity Statement.\n========================================================= */\nconst LISAuditorView = ({ setQuickStartView }) => {\n    // --- Consume Services ---\n    const { hasGeminiKey, callSecureGeminiAPI, GEMINI_MODEL } = useAppServices(); // cite: useAppServices.jsx\n\n    // --- Local State ---\n    const [lisDraft, setLisDraft] = useState('I am a dedicated leader who always tries to do the right thing for my team and my company. I believe in hard work.'); // Initial example draft\n    const [isGenerating, setIsGenerating] = useState(false); // Loading state for AI critique\n    const [critique, setCritique] = useState(''); // Raw markdown critique from AI\n    const [critiqueHtml, setCritiqueHtml] = useState(''); // Rendered HTML critique\n\n    // --- Effect to convert critique markdown to HTML ---\n    useEffect(() => {\n        if (!critique) { setCritiqueHtml(''); return; }\n        (async () => setCritiqueHtml(await mdToHtml(critique)))();\n    }, [critique]);\n\n    // --- Handler to generate AI critique ---\n    const generateCritique = useCallback(async () => {\n        const draft = lisDraft.trim();\n        if (!draft) { alert(\"Please provide your LIS draft first.\"); return; }\n\n        setIsGenerating(true);\n        setCritique(''); // Clear previous critique\n        setCritiqueHtml('');\n        console.log(\"[LISAuditor] Requesting critique for draft:\", draft);\n\n        // --- Use Mock Critique if API Key is missing ---\n        if (!hasGeminiKey()) {\n             console.warn(\"[LISAuditor] API Key missing. Using mock critique.\");\n             setCritique(LIS_MOCK_CRITIQUE); // Set mock data\n             setIsGenerating(false);\n             return;\n        }\n\n        // --- Prepare AI Prompt ---\n        const systemPrompt = `You are an expert executive coach specializing in Leadership Identity Statements (LIS). Critique the user's LIS draft based on:\n            1.  **Clarity & Specificity**: Is it concise and unambiguous?\n            2.  **Action/Behavior Focus**: Does it define *actions* or just beliefs/traits?\n            3.  **Aspirational Rigor**: Does it set a high, challenging standard?\n            Respond ONLY with structured Markdown:\n            ## Leadership Identity Audit Score: [Score]/100\n            ### Clarity and Specificity \\n **Critique:** [Your analysis]\n            ### Action/Behavior Focus \\n **Critique:** [Your analysis]\n            ### Aspirational Rigor \\n **Critique:** [Your analysis]\n            **Refined LIS Example:** \\n \"[Concise, actionable example based on user's core ideas]\"`;\n        const userQuery = `Critique this LIS draft:\\n\\n\"${draft}\"`;\n\n        try {\n            // --- Call AI API ---\n            const payload = {\n                contents: [{ role: \"user\", parts: [{ text: userQuery }] }],\n                systemInstruction: { parts: [{ text: systemPrompt }] },\n                model: 'gemini-1.5-flash', // Use flash model for faster critique // cite: QuickStartAccelerator.jsx (Original Logic)\n            };\n            const result = await callSecureGeminiAPI(payload); // cite: useAppServices.jsx\n            console.log(\"[LISAuditor] AI Response:\", result);\n            const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;\n\n            // --- Set Result ---\n            setCritique(text || \"Critique generation failed: No response from AI.\");\n\n        } catch (error) {\n            console.error(\"[LISAuditor] AI Critique Error:\", error);\n            setCritique(`## Critique Error\\n\\nFailed to get AI feedback: ${error.message}`);\n        } finally {\n            setIsGenerating(false); // Reset loading state\n        }\n    }, [lisDraft, hasGeminiKey, callSecureGeminiAPI]); // Dependencies\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10 min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.NAVY+'30'}}>\n                <ShieldCheck className='w-10 h-10 flex-shrink-0' style={{color: COLORS.NAVY}}/>\n                <div>\n                    <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>Leadership Identity Statement (LIS) Auditor</h1>\n                    <p className=\"text-md text-gray-600 mt-1\">Refine your core leadership foundation.</p>\n                </div>\n            </header>\n            <p className=\"text-lg text-gray-700 mb-6 max-w-3xl\">Your LIS defines who you are at your best. Use the AI Rep Coach to ensure it's specific, actionable, and aligned.</p>\n\n            {/* Back Button */}\n            <Button onClick={() => setQuickStartView('quick-start-home')} variant=\"nav-back\" className=\"mb-8\">\n                <ArrowLeft className=\"w-5 h-5 mr-2\" /> Back to QuickStart Program\n            </Button>\n\n            {/* Main Content Grid */}\n            <div className='grid grid-cols-1 lg:grid-cols-2 gap-8'>\n                {/* Left Column: LIS Input */}\n                <Card title=\"1. Draft Your Leadership Identity Statement\" icon={ShieldCheck} accent='NAVY'>\n                    <p className=\"text-gray-700 text-sm mb-4\">Define who you are when leading at your best. Focus on actions and values.</p>\n                    {/* LIS Input Textarea */}\n                    <textarea\n                        value={lisDraft}\n                        onChange={(e) => setLisDraft(e.target.value)}\n                        className=\"w-full p-3 mt-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#47A88D] h-32 text-sm\" // Teal focus\n                        placeholder=\"e.g., 'I build high-trust teams by modeling vulnerability and consistently delivering on commitments.'\"\n                        aria-label=\"Leadership Identity Statement Draft\"\n                    />\n                    {/* Audit Button */}\n                    <Button\n                        onClick={generateCritique}\n                        disabled={isGenerating || !lisDraft.trim()}\n                        size=\"md\" className=\"w-full mt-6\"\n                        variant=\"secondary\" // Use Orange button\n                    >\n                        {isGenerating ? <Loader className=\"w-5 h-5 mr-2 animate-spin\"/> : <Cpu className='w-5 h-5 mr-2' />}\n                        {isGenerating ? 'Auditing Identity...' : 'Run LIS Audit with AI Rep Coach'}\n                    </Button>\n                     {!hasGeminiKey() && <p className=\"text-xs text-red-500 mt-2 text-center\">API Key missing. Using mock critique.</p>}\n                </Card>\n\n                {/* Right Column: AI Critique Output */}\n                <div className='lg:sticky lg:top-6'> {/* Make critique sticky */}\n                    {isGenerating ? ( // Show loading spinner within Card\n                        <Card title=\"AI Rep Coach Critique\" icon={Cpu} accent='TEAL'>\n                            <LoadingSpinner message=\"Analyzing your LIS...\" />\n                        </Card>\n                    ) : critiqueHtml ? ( // Show critique if available\n                        <Card title=\"AI Rep Coach Critique\" icon={Cpu} accent='TEAL'>\n                            <div dangerouslySetInnerHTML={{ __html: critiqueHtml }} />\n                        </Card>\n                    ) : ( // Placeholder if no critique yet\n                        <Card title=\"AI Rep Coach Critique\" icon={Cpu} accent='TEAL' className=\"border-dashed border-gray-300 bg-gray-50 text-center\">\n                            <p className=\"text-sm text-gray-500 italic py-8\">Complete Step 1 and click \"Run LIS Audit\" to get feedback here.</p>\n                        </Card>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n/* =========================================================\n   QuickStart Accelerator MAIN ROUTER (Refactored Home View)\n========================================================= */\nconst QuickStartAcceleratorScreen = () => {\n    // --- Consume Services ---\n    const { navigate, featureFlags, isLoading: isAppLoading, error: appError } = useAppServices(); // cite: useAppServices.jsx\n\n    // --- Local State ---\n    const [view, setQuickStartView] = useState('quick-start-home'); // Controls view: 'home' or 'lis-auditor'\n\n    // --- Effect to scroll to top on mount ---\n    useEffect(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, []);\n\n    // --- Core Sessions Data (Could be moved to global metadata: COURSE_LIBRARY?) ---\n    // Using local data as defined in the original file\n    const sessions = useMemo(() => [ // cite: QuickStartAccelerator.jsx (Original Logic)\n        { id: 1, title: 'Delivering Effective Feedback', focus: 'CLEAR Framework & The Magic Ratio (5:1)', keyRationale: 'Feedback is the currency of growth. Master objectivity (SBI) and ensure positive reinforcement outweighs correction to build a high-trust team environment.', preWork: ['Watch Session 1 Prep Video', 'Complete Pre-Session Exercises', 'Complete Workout Prep'] },\n        { id: 2, title: 'Anchoring Feedback with Identity', focus: 'Leadership Identity Statement (LIS) & Anchored Feedback', keyRationale: 'Your LIS is your North Star. Grounding every action and conversation in your core values ensures integrity and makes your leadership predictable and trustworthy.', preWork: ['Watch Session 2 Prep Video', 'Complete Admired Leaders Exercise', 'Draft LIS (Use LIS Auditor Tool!)'] }, // Updated preWork\n        { id: 3, title: 'Coaching One-on-One (1:1)', focus: '1:1 Structure, Direct-Led Agenda, and Coaching for Growth', keyRationale: 'Effective 1:1s are the most high-leverage time you spend. Shift from status updates to future-focused coaching and actively listening to employee challenges.', preWork: ['Sign up for 1:1 with Trainer', 'Review 1:1 Notes & Topics', 'Prepare for Personalized Coaching Session'] },\n        { id: 4, title: 'Building Vulnerability-Based Trust', focus: 'Trust Fundamentals, 1:1 Habit, and Leading with Vulnerability', keyRationale: 'Trust is the foundation for speed and psychological safety. Learn to lead by modeling vulnerability and commitment, creating space for the team to take risks and admit mistakes.', preWork: ['Watch Session 4 Prep Video', 'Complete Pre-Session Exercises', 'Complete Reflections'] },\n    ], []);\n\n    // --- View Rendering Logic ---\n    const renderView = () => {\n        switch(view) {\n            case 'lis-auditor':\n                return <LISAuditorView setQuickStartView={setQuickStartView} />;\n            case 'quick-start-home':\n            default:\n                // --- Refactored Home View ---\n                return (\n                    // Consistent page structure and padding\n                    <div className=\"p-6 md:p-8 lg:p-10\">\n                        {/* Header */}\n                        <header className='flex items-center gap-4 border-b-2 pb-3 mb-8' style={{borderColor: COLORS.ORANGE+'30'}}> {/* Use ORANGE accent */}\n                            <Zap className='w-10 h-10 flex-shrink-0' style={{color: COLORS.ORANGE}}/>\n                            <div>\n                                <h1 className=\"text-3xl md:text-4xl font-extrabold\" style={{ color: COLORS.NAVY }}>QuickStart Program</h1>\n                                <p className=\"text-md text-gray-600 mt-1\">(Core Pillar)</p>\n                            </div>\n                        </header>\n                        <p className=\"text-lg text-gray-700 mb-10 max-w-3xl\">The foundational 4-session accelerator for the LeaderReps methodology. Review sessions, focus areas, and pre-work requirements.</p>\n\n                        {/* Link to LIS Auditor Tool (Highlighted Card) */}\n                        <Card title=\"Tool: Leadership Identity Statement (LIS) Auditor\" icon={ShieldCheck} accent=\"TEAL\" className=\"mb-8 cursor-pointer hover:border-teal-400\" onClick={() => setQuickStartView('lis-auditor')}>\n                            <p className='text-gray-700 text-sm'>Draft and refine your core leadership statement using AI critique. **Crucial pre-work for Session 2.**</p>\n                            <div className=\"mt-4 text-[#47A88D] font-semibold flex items-center group\">\n                                Launch LIS Auditor <span className=\"inline-block transition-transform group-hover:translate-x-1 ml-1\">&rarr;</span>\n                            </div>\n                        </Card>\n\n                        {/* Session Cards */}\n                        <h2 className='text-2xl font-bold mb-4 mt-10 border-b pb-1' style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>Program Sessions</h2>\n                        <div className=\"space-y-6\">\n                            {sessions.map(session => (\n                                // Use standard Card for each session\n                                <Card key={session.id} title={`Session ${session.id}: ${session.title}`} icon={BookOpen} accent=\"NAVY\">\n                                    {/* Why it Matters */}\n                                    <details className=\"mb-4 group\">\n                                        <summary className=\"text-sm font-semibold cursor-pointer list-none flex items-center gap-1\" style={{ color: COLORS.NAVY }}>\n                                            <Lightbulb className=\"w-4 h-4 text-amber-500\"/> Why This Session Matters\n                                            <span className=\"text-xs text-gray-400 group-open:rotate-90 transition-transform\">▶</span>\n                                        </summary>\n                                        <blockquote className=\"mt-2 border-l-4 pl-4 py-1 text-sm italic text-gray-600\" style={{ borderColor: COLORS.TEAL }}>\n                                            {session.keyRationale}\n                                        </blockquote>\n                                    </details>\n\n                                    {/* Grid for Focus & Pre-Work */}\n                                    <div className=\"grid md:grid-cols-2 gap-4 pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                                        {/* Core Focus */}\n                                        <div>\n                                            <h3 className=\"text-md font-semibold mb-2 flex items-center gap-1.5\" style={{ color: COLORS.TEAL }}><Target className='w-4 h-4'/> Core Focus</h3>\n                                            <p className=\"text-gray-700 text-sm\">{session.focus}</p>\n                                        </div>\n                                        {/* Pre-Work */}\n                                        <div>\n                                            <h3 className=\"text-md font-semibold mb-2 flex items-center gap-1.5\" style={{ color: COLORS.ORANGE }}><Clock className='w-4 h-4'/> Pre-Work Checklist</h3>\n                                            <ul className=\"list-disc pl-5 text-gray-700 space-y-1 text-sm\">\n                                                {session.preWork.map((item, index) => (\n                                                    <li key={index}>{item}</li>\n                                                ))}\n                                            </ul>\n                                        </div>\n                                    </div>\n                                </Card>\n                            ))}\n                        </div>\n                    </div>\n                );\n        }\n    };\n\n    // --- Main Render ---\n    // Feature Flag Check (Example)\n    // if (!featureFlags?.enableQuickStart) { // cite: useAppServices.jsx\n    //     return ( /* ... Render disabled message ... */ );\n    // }\n\n    // Loading/Error Checks\n    if (isAppLoading) return <LoadingSpinner message=\"Loading QuickStart Program...\" />;\n    if (appError) return <ConfigError message={`Failed to load QuickStart Program: ${appError.message}`} />;\n\n    return (\n      <div className=\"min-h-screen\" style={{ background: COLORS.BG }}> {/* Consistent BG */}\n        {renderView()}\n      </div>\n    );\n};\n\nexport default QuickStartAcceleratorScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/ReflectionLogScreen.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'appError' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":59,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/ReflectionLogScreen.jsx (NEW FILE)\n\nimport React, { useState, useEffect, useMemo } from 'react';\n// --- Core Services & Context ---\nimport { useAppServices } from '../../services/useAppServices.jsx'; // cite: useAppServices.jsx\n\n// --- Firestore Imports ---\nimport { collection, query, orderBy, getDocs } from 'firebase/firestore'; // cite: DailyPractice.jsx\n\n// --- Icons ---\nimport { Archive, Loader, MessageSquare, ArrowLeft, User } from 'lucide-react';\n\n/* =========================================================\n   PALETTE & UI COMPONENTS (Standardized)\n========================================================= */\n// --- Primary Color Palette ---\nconst COLORS = { NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', PURPLE: '#7C3AED', BG: '#F9FAFB' }; // cite: App.jsx\n\n// --- Standardized UI Components (Assume imported or globally available) ---\n// Using placeholder comments, assuming Button and Card are correctly defined elsewhere or globally\n// const Button = ({...}) => { /* ... Standard Button ... */ };\n// const Card = ({...}) => { /* ... Standard Card ... */ };\n// --- Standardized Button Component (Local Definition for standalone use) ---\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => { /* ... Re-use definition ... */\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; else baseStyle += ' px-6 py-3 text-base'; // Default 'md'\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C312] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n// --- Standardized Card Component (Local Definition for standalone use) ---\nconst Card = ({ children, title, icon: Icon, className = '', accent = 'NAVY' }) => { /* ... Re-use definition ... */\n    const accentColor = COLORS[accent] || COLORS.NAVY;\n    return ( <div className={`relative p-6 rounded-2xl border-2 shadow-xl ${className}`} style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }}> <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} /> {Icon && title && ( <div className=\"flex items-center gap-3 mb-4\"> <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> </div> <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2> </div> )} {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>} <div>{children}</div> </div> );\n};\n// --- Standardized Loading Spinner ---\nconst LoadingSpinner = ({ message = \"Loading...\" }) => ( /* ... Re-use definition ... */\n    <div className=\"min-h-[300px] flex items-center justify-center\" style={{ background: COLORS.BG }}> <div className=\"flex flex-col items-center\"> <Loader className=\"animate-spin h-12 w-12 mb-3\" style={{ color: COLORS.TEAL }} /> <p className=\"font-semibold\" style={{ color: COLORS.NAVY }}>{message}</p> </div> </div>\n);\n\n/* =========================================================\n   ReflectionLogScreen Component\n========================================================= */\n\n/**\n * ReflectionLogScreen Component\n * Displays a chronological list of the user's saved daily reflections.\n * Fetches data from the `daily_practice/{userId}/reflection_history` subcollection.\n */\nconst ReflectionLogScreen = () => {\n    // --- Consume Services ---\n    const {\n        db, userId, // Firestore instance and user ID\n        isLoading: isAppLoading, // Global app loading state\n        error: appError, // Global app error state\n        navigate // Navigation function\n    } = useAppServices(); // cite: useAppServices.jsx\n\n    // --- Local State ---\n    const [reflectionHistory, setReflectionHistory] = useState([]); // Stores fetched reflection entries\n    const [isHistoryLoading, setIsHistoryLoading] = useState(true); // Loading state specific to this screen's fetch\n    const [fetchError, setFetchError] = useState(null); // Error state specific to this screen's fetch\n\n    // --- Effect to Fetch Reflection History ---\n    useEffect(() => {\n        // Only fetch if db and userId are available\n        if (db && userId) {\n            const fetchHistory = async () => {\n                console.log(\"[ReflectionLogScreen] Fetching reflection history...\");\n                setIsHistoryLoading(true); // Start loading\n                setFetchError(null); // Clear previous errors\n                try {\n                    // Define the Firestore query\n                    const historyCollectionRef = collection(db, `daily_practice/${userId}/reflection_history`); // cite: useAppServices.jsx (collection path)\n                    const q = query(historyCollectionRef, orderBy(\"timestamp\", \"desc\")); // Order by timestamp descending // cite: DailyPractice.jsx\n                    const querySnapshot = await getDocs(q); // Execute query\n\n                    // Map Firestore documents to state array\n                    const historyData = querySnapshot.docs.map(doc => ({\n                        id: doc.id,\n                        ...doc.data(),\n                        // Convert Firestore Timestamp to JS Date object if needed, otherwise keep as is for formatting\n                        timestamp: doc.data().timestamp // Keep timestamp object\n                    }));\n\n                    setReflectionHistory(historyData);\n                    console.log(`[ReflectionLogScreen] Fetched ${historyData.length} reflection entries.`);\n                } catch (e) {\n                    console.error(\"[ReflectionLogScreen] Failed to fetch reflection history:\", e);\n                    setFetchError(e.message || 'Failed to load history.'); // Set fetch error state\n                    setReflectionHistory([]); // Clear history on error\n                } finally {\n                    setIsHistoryLoading(false); // Stop loading\n                }\n            };\n            fetchHistory();\n        } else {\n            // Handle case where db or userId is not yet available (should be handled by global loading, but as safety)\n            console.warn(\"[ReflectionLogScreen] DB or UserID not available for fetching history.\");\n            setIsHistoryLoading(false);\n            if (!isAppLoading) { // Only set error if global loading is done\n                 setFetchError(\"Database connection or user information not available.\");\n            }\n        }\n    }, [db, userId, isAppLoading]); // Dependencies: Re-fetch if db or userId changes\n\n    // --- Helper Function for Formatting Date ---\n    const formatDate = (timestamp) => {\n        if (!timestamp) return 'No Date';\n        try {\n            // Check if it's a Firestore Timestamp object\n            if (timestamp.toDate) {\n                return timestamp.toDate().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n            }\n            // Otherwise, assume it might be an ISO string or Date object\n            const date = new Date(timestamp);\n            if (isNaN(date.getTime())) return 'Invalid Date';\n            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n        } catch (e) {\n            console.error(\"Error formatting date:\", timestamp, e);\n            return 'Error Date';\n        }\n    };\n\n    // --- Render Logic ---\n    // Handle global loading state first\n    if (isAppLoading) {\n        return <LoadingSpinner message=\"Initializing...\" />;\n    }\n\n    return (\n        // Consistent page structure and padding\n        <div className=\"p-6 md:p-8 lg:p-10 max-w-4xl mx-auto min-h-screen\" style={{ background: COLORS.BG }}>\n            {/* Header */}\n            <header className=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4 border-b pb-4 mb-6\" style={{ borderColor: COLORS.SUBTLE }}>\n                <h1 className=\"text-3xl md:text-4xl font-extrabold flex items-center gap-3\" style={{ color: COLORS.NAVY }}>\n                    <Archive className=\"w-8 h-8\" style={{ color: COLORS.TEAL }} /> Reflection Log\n                </h1>\n                {/* Back Button */}\n                <Button onClick={() => navigate('dashboard')} variant=\"nav-back\" size=\"sm\"> {/* Use Button */}\n                    <ArrowLeft size={16} className=\"mr-1\" /> Back to The Arena\n                </Button>\n            </header>\n\n            {/* Loading State for History Fetch */}\n            {isHistoryLoading && <LoadingSpinner message=\"Loading reflection history...\" />}\n\n            {/* Error State for History Fetch */}\n            {!isHistoryLoading && fetchError && (\n                <Card accent=\"RED\" className=\"text-center\">\n                    <p className=\"font-semibold text-red-700\">Error Loading History</p>\n                    <p className=\"text-sm text-red-600 mt-1\">{fetchError}</p>\n                </Card>\n            )}\n\n            {/* Empty State */}\n            {!isHistoryLoading && !fetchError && reflectionHistory.length === 0 && (\n                <Card accent=\"TEAL\" className=\"text-center border-dashed\">\n                    <MessageSquare className=\"w-12 h-12 mx-auto mb-4 text-gray-400\"/>\n                    <h2 className=\"text-xl font-semibold mb-2\" style={{ color: COLORS.NAVY }}>No Reflections Yet</h2>\n                    <p className=\"text-gray-600 text-sm\">Your daily reflection entries will appear here once you save them.</p>\n                    <Button onClick={() => navigate('daily-practice')} size=\"sm\" className=\"mt-4\">\n                        Go to Daily Reflection\n                    </Button>\n                </Card>\n            )}\n\n            {/* History List */}\n            {!isHistoryLoading && !fetchError && reflectionHistory.length > 0 && (\n                <div className=\"space-y-4\">\n                    {reflectionHistory.map((entry) => (\n                        // Use Card for each entry for consistent styling\n                        <Card key={entry.id} accent=\"NAVY\" className=\"shadow-md hover:shadow-lg transition-shadow\">\n                            {/* Date Header */}\n                            <p className=\"text-sm font-bold mb-3 border-b pb-2 flex justify-between items-center\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>\n                               <span>{formatDate(entry.timestamp || entry.date)}</span>\n                               {/* Optional: Show short ID */}\n                               {/* <span className=\"text-xs font-normal text-gray-400\">ID: {entry.id.slice(0, 6)}</span> */}\n                            </p>\n                            {/* Reflection Content */}\n                            <div className=\"space-y-2 text-sm text-gray-700\">\n                                {entry.did && <p><strong>Did:</strong> {entry.did}</p>}\n                                {entry.noticed && <p><strong>Noticed:</strong> {entry.noticed}</p>}\n                                {entry.tryDiff && <p><strong>Try:</strong> {entry.tryDiff}</p>}\n                                {entry.identity && (\n                                    <p className=\"italic font-medium text-gray-800 pt-2 border-t border-gray-200 mt-3 flex items-start gap-2\">\n                                        <User size={14} className=\"flex-shrink-0 mt-0.5\" style={{ color: COLORS.TEAL }}/>\n                                        <span>\"I'm the kind of leader who {entry.identity}\"</span>\n                                    </p>\n                                )}\n                                {/* Display simple date if timestamp is missing/invalid */}\n                                {!entry.timestamp && entry.date && <p className=\"text-xs text-gray-400 mt-2\">Logged on: {entry.date}</p>}\n                            </div>\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default ReflectionLogScreen;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/dashboard/DailyTasksCard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onSaveWIN' is defined but never used.","line":143,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":143,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/dashboard/DailyTasksCard.jsx\n// Arena v1.0 Scope: Daily Tasks component to replace Social Pod\nimport React, { useState } from 'react';\nimport { Check, Plus, X, Clock, Calendar } from 'lucide-react';\n\n// LEADERREPS.COM OFFICIAL CORPORATE COLORS - VERIFIED 11/12/25\nconst COLORS = { \n  // === PRIMARY BRAND COLORS (from leaderreps.com) ===\n  NAVY: '#002E47',        // Primary text, headers, navigation\n  ORANGE: '#E04E1B',      // Call-to-action buttons, highlights, alerts  \n  TEAL: '#47A88D',        // Secondary buttons, success states, accents\n  LIGHT_GRAY: '#FCFCFA',  // Page backgrounds, subtle surfaces\n  \n  // === SEMANTIC MAPPINGS (using ONLY corporate colors) ===\n  BLUE: '#002E47',        // Map to NAVY\n  GREEN: '#47A88D',       // Map to TEAL  \n  AMBER: '#E04E1B',       // Map to ORANGE\n  RED: '#E04E1B',         // Map to ORANGE\n  PURPLE: '#47A88D',      // Map to TEAL\n  \n  // === TEXT & BACKGROUNDS (corporate colors only) ===\n  TEXT: '#002E47',        // NAVY for all text\n  MUTED: '#47A88D',       // TEAL for muted text\n  BG: '#FCFCFA',          // LIGHT_GRAY for backgrounds\n  OFF_WHITE: '#FCFCFA',   // Same as BG\n  SUBTLE: '#47A88D'       // TEAL for subtle elements\n};\n\nconst Button = ({ children, onClick, variant = 'primary', size = 'md', className = '', disabled = false }) => {\n  const baseStyles = 'inline-flex items-center justify-center rounded-lg font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';\n  \n  const variants = {\n    primary: `text-white hover:shadow-lg focus:ring-2 focus:ring-teal-500`,\n    secondary: `text-white hover:opacity-90 focus:ring-2 focus:ring-blue-500`,\n    outline: `border-2 text-teal-600 hover:text-white focus:ring-2 focus:ring-teal-500`,\n    ghost: `text-gray-700 hover:bg-gray-100 focus:ring-2 focus:ring-gray-500`,\n    danger: `bg-red-600 text-white hover:opacity-90 focus:ring-2 focus:ring-red-500`\n  };\n  \n  const sizes = {\n    sm: 'px-3 py-1.5 text-sm',\n    md: 'px-4 py-2 text-base',\n    lg: 'px-6 py-3 text-lg'\n  };\n  \n  return (\n    <button\n      onClick={onClick}\n      disabled={disabled}\n      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}\n      style={{\n        background: variant === 'primary' ? `linear-gradient(135deg, ${COLORS.TEAL}, ${COLORS.BLUE})` : \n                   variant === 'outline' ? 'transparent' :\n                   variant === 'secondary' ? COLORS.NAVY :\n                   undefined,\n        borderColor: variant === 'outline' ? COLORS.TEAL : undefined\n      }}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst Card = ({ children, title, accent, className = '' }) => {\n  const accentColors = {\n    TEAL: COLORS.TEAL,\n    NAVY: COLORS.NAVY,\n    ORANGE: COLORS.ORANGE,\n    BLUE: COLORS.BLUE,\n    PURPLE: COLORS.PURPLE\n  };\n  \n  const accentColor = accent ? accentColors[accent] : COLORS.TEAL;\n  \n  return (\n    <div \n      className={`bg-white rounded-xl shadow-sm border-l-4 p-6 ${className}`}\n      style={{ borderLeftColor: accentColor }}\n    >\n      {title && (\n        <h3 className=\"text-xl font-bold mb-4\" style={{ color: COLORS.NAVY }}>\n          {title}\n        </h3>\n      )}\n      {children}\n    </div>\n  );\n};\n\nconst TaskItem = ({ task, onToggle, onRemove, showRemove = true }) => {\n  return (\n    <div className={`flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 ${\n      task.completed \n        ? 'bg-green-50 border-green-200' \n        : 'bg-white border-gray-200 hover:border-gray-300'\n    }`}>\n      <button\n        onClick={() => onToggle(task.id)}\n        className={`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${\n          task.completed\n            ? 'bg-green-500 border-green-500 text-white'\n            : 'border-gray-300 hover:border-teal-400'\n        }`}\n      >\n        {task.completed && <Check className=\"w-3 h-3\" />}\n      </button>\n      \n      <div className=\"flex-1\">\n        <p className={`text-sm ${\n          task.completed \n            ? 'text-green-700 line-through' \n            : 'text-gray-700'\n        }`}>\n          {task.text}\n        </p>\n        {task.isSystem && (\n          <p className=\"text-xs text-gray-500 mt-1\">\n            System Task\n          </p>\n        )}\n      </div>\n      \n      {showRemove && !task.isSystem && (\n        <button\n          onClick={() => onRemove(task.id)}\n          className=\"p-1 text-gray-400 hover:text-red-500 transition-colors\"\n        >\n          <X className=\"w-4 h-4\" />\n        </button>\n      )}\n    </div>\n  );\n};\n\nconst DailyTasksCard = ({ \n  otherTasks = [], \n  morningWIN = '', \n  winCompleted = false,\n  onToggleTask, \n  onRemoveTask, \n  onAddTask,\n  onToggleWIN,\n  onSaveWIN \n}) => {\n  const [newTaskText, setNewTaskText] = useState('');\n  const [showAddTask, setShowAddTask] = useState(false);\n\n  const handleAddTask = () => {\n    if (newTaskText.trim()) {\n      onAddTask(newTaskText.trim());\n      setNewTaskText('');\n      setShowAddTask(false);\n    }\n  };\n\n  const completedTasks = otherTasks.filter(task => task.completed);\n  const pendingTasks = otherTasks.filter(task => !task.completed);\n  const progressPercentage = otherTasks.length > 0 ? (completedTasks.length / otherTasks.length) * 100 : 0;\n\n  return (\n    <Card title=\"📋 Daily Tasks\" accent=\"BLUE\">\n      \n      {/* Progress Overview */}\n      <div className=\"mb-6 p-4 rounded-lg\" style={{ backgroundColor: `${COLORS.BLUE}10` }}>\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm font-semibold\" style={{ color: COLORS.BLUE }}>\n            Daily Progress\n          </span>\n          <span className=\"text-sm font-bold\" style={{ color: COLORS.BLUE }}>\n            {completedTasks.length} of {otherTasks.length} completed\n          </span>\n        </div>\n        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n          <div \n            className=\"h-2 rounded-full transition-all duration-500\"\n            style={{ \n              width: `${progressPercentage}%`,\n              backgroundColor: COLORS.BLUE\n            }}\n          />\n        </div>\n      </div>\n\n      {/* Today's WIN Display */}\n      {morningWIN && (\n        <div className=\"mb-4 p-3 rounded-lg border-2\" style={{ \n          backgroundColor: winCompleted ? `${COLORS.GREEN}10` : `${COLORS.ORANGE}10`,\n          borderColor: winCompleted ? `${COLORS.GREEN}30` : `${COLORS.ORANGE}30`\n        }}>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex-1\">\n              <p className=\"text-xs font-semibold mb-1\" style={{ \n                color: winCompleted ? COLORS.GREEN : COLORS.ORANGE \n              }}>\n                🏆 TODAY'S WIN:\n              </p>\n              <p className=\"text-sm\" style={{ color: COLORS.TEXT }}>\n                {morningWIN}\n              </p>\n            </div>\n            <button\n              onClick={onToggleWIN}\n              className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ml-3 ${\n                winCompleted\n                  ? 'bg-green-500 border-green-500 text-white'\n                  : 'border-orange-400 hover:border-orange-500'\n              }`}\n            >\n              {winCompleted && <Check className=\"w-4 h-4\" />}\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Tasks List */}\n      <div className=\"space-y-3 mb-4\">\n        {/* Pending Tasks First */}\n        {pendingTasks.map(task => (\n          <TaskItem\n            key={task.id}\n            task={task}\n            onToggle={onToggleTask}\n            onRemove={onRemoveTask}\n          />\n        ))}\n        \n        {/* Completed Tasks */}\n        {completedTasks.length > 0 && (\n          <div className=\"pt-3 border-t border-gray-200\">\n            <p className=\"text-xs font-semibold text-gray-500 mb-3 flex items-center gap-2\">\n              <Check className=\"w-4 h-4\" />\n              Completed ({completedTasks.length})\n            </p>\n            {completedTasks.map(task => (\n              <TaskItem\n                key={task.id}\n                task={task}\n                onToggle={onToggleTask}\n                onRemove={onRemoveTask}\n                showRemove={false}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Add New Task */}\n      {showAddTask ? (\n        <div className=\"flex gap-2 mb-4\">\n          <input\n            type=\"text\"\n            value={newTaskText}\n            onChange={(e) => setNewTaskText(e.target.value)}\n            placeholder=\"Add a new task...\"\n            className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm\"\n            onKeyPress={(e) => e.key === 'Enter' && handleAddTask()}\n            autoFocus\n          />\n          <Button\n            onClick={handleAddTask}\n            variant=\"primary\"\n            size=\"sm\"\n            disabled={!newTaskText.trim()}\n          >\n            Add\n          </Button>\n          <Button\n            onClick={() => {\n              setShowAddTask(false);\n              setNewTaskText('');\n            }}\n            variant=\"ghost\"\n            size=\"sm\"\n          >\n            Cancel\n          </Button>\n        </div>\n      ) : (\n        <Button\n          onClick={() => setShowAddTask(true)}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"w-full\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Task\n        </Button>\n      )}\n\n      {/* Empty State */}\n      {otherTasks.length === 0 && !morningWIN && (\n        <div className=\"text-center py-6\">\n          <Clock className=\"w-12 h-12 mx-auto mb-3\" style={{ color: COLORS.MUTED }} />\n          <p className=\"text-sm font-medium mb-1\" style={{ color: COLORS.TEXT }}>\n            No tasks for today\n          </p>\n          <p className=\"text-xs\" style={{ color: COLORS.MUTED }}>\n            Add your first task or set today's WIN to get started\n          </p>\n        </div>\n      )}\n\n    </Card>\n  );\n};\n\nexport default DailyTasksCard;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/dashboard/DashboardComponents.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'serverTimestamp' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":25},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":47,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":47,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'Icon' is defined but never used.","line":1143,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":1143,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/dashboard/DashboardComponents.jsx\n// MODIFIED: 10/30/25 - Final version with UnifiedAnchorEditorModal, \n//                      clickable system tasks, and fixed height for Morning Bookend to prevent layout shift.\n// REMOVED: LeadershipAnchorsCard and related placeholder exports.\n\nimport React, { useState, useEffect } from 'react';\nimport { \n  Target, Clock, User, Save, Loader, CheckCircle, TrendingUp, Star, \n  ChevronDown, ChevronUp, Plus, X, Sunrise, Moon, Flame, Anchor,\n  ToggleLeft, ToggleRight, Zap, AlertTriangle, MessageSquare, Trophy,\n  Send, Users, Activity, Edit3\n} from 'lucide-react';\nimport { serverTimestamp } from 'firebase/firestore';\n\n// --- Helper function to format timestamps ---\nconst formatTimestamp = (timestamp) => {\n  if (!timestamp) return 'Just now';\n  \n  try {\n    // Handle both Date objects and Firestore Timestamps\n    const date = timestamp instanceof Date ? timestamp : timestamp.toDate?.();\n    if (!date) return 'Just now';\n    \n    const now = new Date();\n    const diff = now - date;\n    const seconds = Math.floor(diff / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    \n    if (seconds < 60) return 'Just now';\n    if (minutes < 60) return `${minutes}m ago`;\n    if (hours < 24) return `${hours}h ago`;\n    if (days < 7) return `${days}d ago`;\n    \n    return date.toLocaleDateString();\n  } catch (error) {\n    console.error('Error formatting timestamp:', error);\n    return 'Recently';\n  }\n};\n\n/* =========================================================\n   COLORS & BASE COMPONENTS\n========================================================= */\n// LEADERREPS.COM OFFICIAL CORPORATE COLORS - VERIFIED 11/12/25\nexport const COLORS = { \n  // === PRIMARY BRAND COLORS (from leaderreps.com) ===\n  NAVY: '#002E47',        // Primary text, headers, navigation\n  ORANGE: '#E04E1B',      // Call-to-action buttons, highlights, alerts  \n  TEAL: '#47A88D',        // Secondary buttons, success states, accents\n  LIGHT_GRAY: '#FCFCFA',  // Page backgrounds, subtle surfaces\n  \n  // === SEMANTIC MAPPINGS (using ONLY corporate colors) ===\n  BLUE: '#002E47',        // Map to NAVY (no separate blue in brand)\n  GREEN: '#47A88D',       // Map to TEAL (brand's green is teal)\n  AMBER: '#E04E1B',       // Map to ORANGE (no separate amber in brand)\n  RED: '#E04E1B',         // Map to ORANGE (warnings/errors use orange)\n  PURPLE: '#47A88D',      // Map to TEAL (no purple in brand)\n  \n  // === TEXT & BACKGROUNDS (corporate colors only) ===\n  TEXT: '#002E47',        // NAVY for all text\n  MUTED: '#47A88D',       // TEAL for muted text\n  BG: '#FCFCFA',          // LIGHT_GRAY for backgrounds\n  OFF_WHITE: '#FCFCFA',   // Same as BG\n  SUBTLE: '#47A88D'       // TEAL for subtle elements\n};\n\n// --- Corporate Button Component ---\nexport const Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => {\n  // Base corporate button classes\n  let buttonClass = '';\n  \n  if (variant === 'primary') {\n    buttonClass = 'btn-corporate-primary';\n  } else if (variant === 'secondary') {\n    buttonClass = 'btn-corporate-secondary';\n  } else if (variant === 'outline') {\n    buttonClass = 'btn-corporate-secondary';\n  } else if (variant === 'nav-back') {\n    buttonClass = 'form-corporate';\n  } else if (variant === 'ghost') {\n    buttonClass = 'bg-transparent hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm';\n  } else {\n    buttonClass = 'btn-corporate-primary';\n  }\n\n  // Size adjustments using CSS custom properties\n  let sizeStyle = {};\n  if (size === 'sm') {\n    sizeStyle = { padding: 'var(--spacing-sm) var(--spacing-md)', fontSize: '0.875rem' };\n  } else if (size === 'lg') {\n    sizeStyle = { padding: 'var(--spacing-xl) var(--spacing-2xl)', fontSize: '1.125rem' };\n  }\n\n  // Disabled state\n  const disabledStyle = disabled ? {\n    opacity: 0.5,\n    cursor: 'not-allowed',\n    background: '#E5E7EB',\n    color: '#9CA3AF'\n  } : {};\n\n  return (\n    <button \n      {...rest} \n      onClick={onClick} \n      disabled={disabled} \n      className={`${buttonClass} ${className}`}\n      style={{ ...sizeStyle, ...disabledStyle }}\n    >\n      {children}\n    </button>\n  );\n};\n\n// --- Corporate Card Component ---\nexport const Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n  const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n\n  // Choose corporate card class based on interactivity\n  const cardClass = interactive ? 'card-corporate' : 'card-corporate-elevated';\n\n  return (\n    <Tag\n      {...(interactive ? { type: 'button' } : {})}\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={handleKeyDown}\n      className={`${cardClass} ${className} text-left`}\n      style={{ color: COLORS.NAVY }}\n      onClick={onClick}\n    >\n      {/* Corporate accent bar using CSS custom properties */}\n      {Icon && title && <span style={{ position:'absolute', top:0, left:0, right:0, height:'4px', background: `var(--gradient-primary)` }} />}\n\n      {Icon && title && (\n           <div className=\"flex items-center\" style={{ gap: 'var(--spacing-md)', marginBottom: 'var(--spacing-lg)' }}>\n              <div className=\"flex items-center justify-center flex-shrink-0\" \n                   style={{ \n                     width: '40px', \n                     height: '40px', \n                     borderRadius: 'var(--radius-lg)', \n                     border: `1px solid ${COLORS.SUBTLE}`, \n                     background: COLORS.LIGHT_GRAY \n                   }}>\n                  <Icon className=\"w-5 h-5\" style={{ color: accentColor }} />\n              </div>\n              <h2 className=\"corporate-heading-md\" style={{ color: COLORS.NAVY }}>{title}</h2>\n          </div>\n      )}\n      {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n\n      <div>{children}</div>\n    </Tag>\n  );\n};\n\n/* =========================================================\n   MODE SWITCH COMPONENT (Unchanged)\n========================================================= */\nexport const ModeSwitch = ({ isArenaMode, onToggle, isLoading }) => (\n  <button\n    onClick={onToggle}\n    disabled={isLoading}\n    className=\"flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 border-2\"\n    style={{\n      backgroundColor: isArenaMode ? COLORS.TEAL : COLORS.ORANGE,\n      borderColor: isArenaMode ? COLORS.TEAL : COLORS.ORANGE,\n      color: 'white',\n      opacity: isLoading ? 0.6 : 1\n    }}\n  >\n    {isArenaMode ? <ToggleRight className=\"w-5 h-5\" /> : <ToggleLeft className=\"w-5 h-5\" />}\n    <span className=\"font-semibold text-sm\">{isArenaMode ? 'Arena Mode' : 'Solo Mode'}</span>\n  </button>\n);\n\n/* =========================================================\n   STREAK TRACKER COMPONENT (Unchanged)\n========================================================= */\nexport const StreakTracker = ({ streakCount, streakCoins }) => (\n  <div className=\"flex items-center gap-4 px-4 py-2 rounded-lg border-2\" \n       style={{ borderColor: COLORS.SUBTLE, backgroundColor: COLORS.LIGHT_GRAY }}>\n    <div className=\"flex items-center gap-2\">\n      <Flame className=\"w-5 h-5\" style={{ color: COLORS.ORANGE }} />\n      <span className=\"font-bold text-lg\" style={{ color: COLORS.NAVY }}>{streakCount}</span>\n      <span className=\"text-sm\" style={{ color: COLORS.MUTED }}>Day Streak</span>\n    </div>\n    <div className=\"h-6 w-px\" style={{ backgroundColor: COLORS.SUBTLE }} />\n    <div className=\"flex items-center gap-2\">\n      <span className=\"text-xl\">🪙</span>\n      <span className=\"font-bold text-lg\" style={{ color: COLORS.NAVY }}>{streakCoins}</span>\n      <span className=\"text-sm\" style={{ color: COLORS.MUTED }}>Coins</span>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   TAB BUTTON (for Dynamic Bookend Container) (Unchanged)\n========================================================= */\nexport const TabButton = ({ active, onClick, label, minimized = false }) => (\n  <button\n    type=\"button\"\n    aria-pressed={active}\n    onClick={onClick}\n    className={`flex-1 px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-200 relative ${\n      active ? 'shadow-md' : 'hover:bg-gray-50'\n    }`}\n    style={{\n      backgroundColor: active ? COLORS.TEAL : 'transparent',\n      color: active ? 'white' : COLORS.TEXT,\n      border: active ? 'none' : `2px solid ${COLORS.SUBTLE}`\n    }}\n  >\n    {label}\n    {minimized && !active && (\n      <span \n        className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full\"\n        style={{ backgroundColor: COLORS.ORANGE }}\n        title=\"Incomplete\"\n      />\n    )}\n  </button>\n);\n\n/* =========================================================\n   DYNAMIC BOOKEND CONTAINER (Unchanged)\n========================================================= */\nexport const DynamicBookendContainer = ({ \n  morningProps,\n  eveningProps,\n  dailyPracticeData\n}) => {\n  const [activeTab, setActiveTab] = useState('AM');\n  \n  // Time-based default logic\n  useEffect(() => {\n    const currentHour = new Date().getHours();\n    \n    if (currentHour < 12) {\n      setActiveTab('AM');\n    } else if (currentHour >= 16) {\n      setActiveTab('PM');\n    } else {\n      setActiveTab('PM'); // Default to PM in the afternoon\n    }\n  }, []);\n  \n  // FIX #7: Improved minimization logic for AM bookend\n  const currentHour = new Date().getHours();\n  const shouldMinimizeAM = currentHour >= 12 && \n    !dailyPracticeData?.morningBookend?.completedAt;\n  \n  return (\n    <Card title=\"📋 Daily Bookends\" accent=\"NAVY\">\n      {/* Tab Navigation */}\n      <div className=\"flex gap-2 mb-4\">\n        <TabButton \n          active={activeTab === 'AM'}\n          onClick={() => setActiveTab('AM')}\n          label=\"AM Bookend\"\n          minimized={shouldMinimizeAM}\n        />\n        <TabButton \n          active={activeTab === 'PM'}\n          onClick={() => setActiveTab('PM')}\n          label=\"PM Bookend\"\n        />\n      </div>\n      \n      {/* Conditional Rendering */}\n      {activeTab === 'AM' && <MorningBookend {...morningProps} />}\n      {activeTab === 'PM' && <EveningBookend {...eveningProps} />}\n    </Card>\n  );\n};\n\n/* =========================================================\n   MORNING BOOKEND COMPONENT (WITH LAYOUT FIX)\n========================================================= */\nexport const MorningBookend = ({ \n    dailyWIN, setDailyWIN, otherTasks, onAddTask, onToggleTask, onRemoveTask,\n    showLIS, setShowLIS, identityStatement, onSave, isSaving, \n    onToggleWIN, onSaveWIN,\n    completedAt, winCompleted\n}) => {\n    const [newTaskText, setNewTaskText] = useState('');\n    \n    const handleAddClick = () => {\n        if (newTaskText.trim()) { onAddTask(newTaskText); setNewTaskText(''); }\n    };\n    const handleKeyPress = (e) => { if (e.key === 'Enter') handleAddClick(); };\n    \n    // FIX #7: Improved lock logic\n    const isChecklistMode = !!completedAt;\n    const currentHour = new Date().getHours();\n    const isPastNoon = currentHour >= 12;\n    \n    // Show warning if past noon and not completed\n    const showNoonWarning = isPastNoon && !isChecklistMode && !dailyWIN;\n    \n    // CHECKLIST MODE - After completion\n    if (isChecklistMode) {\n        return (\n            <div className=\"space-y-4\">\n                {/* Header */}\n                <div className=\"flex items-center gap-2 mb-3\">\n                    <Sunrise className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n                    <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                        ✅ Today's Plan\n                    </h3>\n                </div>\n                \n                {/* WIN Display with Checkbox */}\n                <div className=\"p-3 rounded-lg border-2\" \n                     style={{ \n                         backgroundColor: winCompleted ? `${COLORS.GREEN}10` : `${COLORS.TEAL}10`,\n                         borderColor: winCompleted ? COLORS.GREEN : COLORS.TEAL\n                     }}>\n                    <div className=\"flex items-start gap-3\">\n                        <input \n                            type=\"checkbox\"\n                            checked={winCompleted || false}\n                            onChange={onToggleWIN}\n                            className=\"mt-1 w-5 h-5 flex-shrink-0\"\n                            style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <div className=\"flex-1\">\n                            <p className=\"text-xs font-semibold mb-1\" style={{ color: COLORS.MUTED }}>\n                                🏆 TODAY'S WIN:\n                            </p>\n                            <p className={`text-sm font-bold ${winCompleted ? 'line-through opacity-60' : ''}`} \n                               style={{ color: COLORS.NAVY }}>\n                                {dailyWIN || 'No WIN set'}\n                            </p>\n                        </div>\n                    </div>\n                </div>\n                \n                {/* Tasks Display with Checkboxes - MIN-HEIGHT FIX APPLIED */}\n                <div className=\"space-y-2\" style={{ minHeight: '180px' }}> \n                    <p className=\"text-xs font-semibold\" style={{ color: COLORS.MUTED }}>\n                        📋 OTHER TASKS:\n                    </p>\n                    {otherTasks && otherTasks.length > 0 ? (\n                        otherTasks.map((task, idx) => (\n                            <div key={task.id || idx} \n                                 className=\"flex items-center gap-3 p-2 border rounded-lg\"\n                                 style={{ borderColor: task.completed ? COLORS.GREEN : COLORS.SUBTLE }}>\n                                \n                                {/* MODIFIED: Render system tasks as clickable buttons/links */}\n                                {task.isSystem ? (\n                                    <button \n                                        onClick={task.onClick}\n                                        className=\"text-sm flex-1 text-left font-medium hover:text-teal-600 transition-colors\"\n                                        style={{ color: COLORS.NAVY }}\n                                    >\n                                        <span className=\"mr-2 text-red-500\">→</span>\n                                        {task.text}\n                                    </button>\n                                ) : (\n                                  <>\n                                    <input \n                                        type=\"checkbox\"\n                                        checked={task.completed}\n                                        onChange={() => onToggleTask(task.id ?? idx)}\n                                        className=\"w-4 h-4\"\n                                        style={{ accentColor: COLORS.TEAL }}\n                                    />\n                                    <span className={`text-sm flex-1 ${task.completed ? 'line-through opacity-60' : ''}`}\n                                        style={{ color: COLORS.TEXT }}>\n                                        {task.text}\n                                    </span>\n                                  </>\n                                )}\n                                {/* Only show remove button for non-system, non-completed tasks in checklist mode */}\n                                {!task.isSystem && !task.completed && (\n                                    <button \n                                        onClick={() => onRemoveTask(task.id ?? idx)}\n                                        className=\"text-gray-400 hover:text-red-500 transition-colors\"\n                                    >\n                                        <X className=\"w-4 h-4\" />\n                                    </button>\n                                )}\n                            </div>\n                        ))\n                    ) : (\n                        <p className=\"text-sm italic pt-2\" style={{ color: COLORS.MUTED }}>No tasks were set for today.</p>\n                    )}\n                </div>\n                \n                {/* LIS Display (if enabled) */}\n                {showLIS && identityStatement && (\n                    <div className=\"p-3 rounded-lg border\" \n                         style={{ backgroundColor: `${COLORS.TEAL}10`, borderColor: `${COLORS.TEAL}30` }}>\n                        <p className=\"text-xs font-semibold mb-1\" style={{ color: COLORS.TEAL }}>\n                            🎯 IDENTITY ANCHOR:\n                        </p>\n                        <p className=\"text-sm italic\" style={{ color: COLORS.TEXT }}>\n                            {identityStatement}\n                        </p>\n                    </div>\n                )}\n                \n                {/* Completion Status */}\n                <div className=\"pt-3 border-t text-center\" style={{ borderColor: COLORS.SUBTLE }}>\n                    <p className=\"text-xs font-semibold\" style={{ color: COLORS.GREEN }}>\n                        ✓ Morning plan locked in!\n                    </p>\n                </div>\n            </div>\n        );\n    }\n    \n    // INPUT MODE - Before completion\n    return (\n        <div className=\"space-y-4\">\n            {/* Header */}\n            <div className=\"flex items-center gap-2 mb-3\">\n                <Sunrise className=\"w-5 h-5\" style={{ color: COLORS.ORANGE }} />\n                <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                    🌅 Plan Your Day\n                </h3>\n            </div>\n            \n            {/* FIX #7: Warning if past noon */}\n            {showNoonWarning && (\n                <div className=\"p-3 rounded-lg border-l-4\" \n                     style={{ backgroundColor: `${COLORS.AMBER}10`, borderColor: COLORS.AMBER }}>\n                    <div className=\"flex items-start gap-2\">\n                        <AlertTriangle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" style={{ color: COLORS.AMBER }} />\n                        <div>\n                            <p className=\"text-xs font-semibold\" style={{ color: COLORS.AMBER }}>\n                               ⚠️ LATE START ALERT\n                            </p>\n                            <p className=\"text-xs mt-1\" style={{ color: COLORS.TEXT }}>\n                                It's past noon! Set your WIN and lock in your plan to stay on track.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* FIX #7: Why It Matters Section */}\n            <div className=\"p-3 rounded-lg\" style={{ backgroundColor: `${COLORS.BLUE}05`, border: `1px solid ${COLORS.BLUE}20` }}>\n                <p className=\"text-xs font-semibold mb-1\" style={{ color: COLORS.BLUE }}>\n                    💡 WHY IT MATTERS:\n                </p>\n                <p className=\"text-xs\" style={{ color: COLORS.TEXT }}>\n                    Leaders who plan their day intentionally are 3x more likely to achieve their goals. \n                    Your WIN keeps you focused on what truly matters.\n                </p>\n            </div>\n            \n            {/* WIN Input */}\n            <div>\n                <label className=\"text-sm font-semibold mb-2 flex items-center\" style={{ color: COLORS.TEXT }}>\n                    <Target className=\"w-4 h-4 mr-1\" style={{ color: COLORS.ORANGE }} />\n                    Today's WIN (What's Important Now)\n                </label>\n                <textarea \n                    value={dailyWIN} onChange={(e) => setDailyWIN(e.target.value)}\n                    placeholder=\"What is the ONE thing that must get done today?\"\n                    className=\"w-full p-3 border rounded-lg focus:ring-2 transition-all\"\n                    style={{ borderColor: COLORS.SUBTLE }} rows={2}\n                />\n                {/* Separate Save WIN Button (Address user confusion) */}\n                <Button \n                    onClick={onSaveWIN}\n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"w-full mt-2\"\n                >\n                    <Save className=\"w-4 h-4 mr-1\" /> Save Today's WIN\n                </Button>\n            </div>\n\n            {/* Tasks Input - MIN-HEIGHT FIX APPLIED */}\n            <div style={{ minHeight: '180px' }}>\n                <label className=\"text-sm font-semibold mb-2 flex items-center justify-between\" style={{ color: COLORS.TEXT }}>\n                    <span className=\"flex items-center\">\n                        <Clock className=\"w-4 h-4 mr-1\" style={{ color: COLORS.TEAL }} />\n                        Other Important Tasks ({otherTasks?.length || 0}/5)\n                    </span>\n                </label>\n                \n                {/* Existing Tasks */}\n                {otherTasks && otherTasks.length > 0 && (\n                    <div className=\"space-y-2 mb-3\">\n                        {otherTasks.map((task, idx) => (\n                            <div key={task.id || idx} \n                                 className=\"flex items-center gap-2 p-2 border rounded-lg\"\n                                 style={{ borderColor: COLORS.SUBTLE, backgroundColor: COLORS.LIGHT_GRAY }}>\n                                \n                                {/* MODIFIED: Render system tasks as clickable buttons/links */}\n                                {task.isSystem ? (\n                                    <button \n                                        onClick={task.onClick}\n                                        className=\"text-sm flex-1 text-left font-medium hover:text-teal-600 transition-colors\"\n                                        style={{ color: COLORS.NAVY }}\n                                    >\n                                        <span className=\"mr-2 text-red-500\">→</span>\n                                        {task.text}\n                                    </button>\n                                ) : (\n                                    <span className=\"text-sm flex-1\" style={{ color: COLORS.TEXT }}>{task.text}</span>\n                                )}\n\n                                {!task.isSystem && (\n                                    <button \n                                        onClick={() => onRemoveTask(task.id ?? idx)}\n                                        className=\"text-gray-400 hover:text-red-500 transition-colors\"\n                                    >\n                                        <X className=\"w-4 h-4\" />\n                                    </button>\n                                )}\n                            </div>\n                        ))}\n                    </div>\n                )}\n                \n                {/* Add New Task */}\n                {(!otherTasks || otherTasks.length < 5) && (\n                    <div className=\"flex gap-2\">\n                        <input \n                            type=\"text\" value={newTaskText} onChange={(e) => setNewTaskText(e.target.value)}\n                            onKeyPress={handleKeyPress} placeholder=\"Add a task (auto-saves when you click +)...\"\n                            className=\"flex-1 p-2 border rounded-lg text-sm focus:ring-2 transition-all\"\n                            style={{ borderColor: COLORS.SUBTLE }}\n                        />\n                        <button \n                            onClick={handleAddClick}\n                            disabled={!newTaskText.trim() || (otherTasks && otherTasks.length >= 5)}\n                            className=\"px-4 py-2 rounded-lg font-semibold text-white transition-all disabled:opacity-50\"\n                            style={{ backgroundColor: COLORS.TEAL }}\n                        >\n                            <Plus className=\"w-4 h-4\" />\n                        </button>\n                    </div>\n                )}\n            </div>\n\n            {/* LIS Toggle */}\n            <div>\n                <button \n                    onClick={() => setShowLIS(!showLIS)}\n                    className=\"text-sm font-semibold flex items-center gap-2 transition-colors hover:opacity-80\"\n                    style={{ color: COLORS.TEAL }}\n                >\n                    {showLIS ? 'Hide' : 'Show'} Leadership Identity Statement\n                    {showLIS ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                </button>\n                {showLIS && (\n                    <div className=\"mt-3 p-4 rounded-lg border\" \n                         style={{ backgroundColor: `${COLORS.TEAL}10`, borderColor: `${COLORS.TEAL}30` }}>\n                        <p className=\"text-sm italic font-medium\" style={{ color: COLORS.TEXT }}>\n                            \"I am the kind of leader who {identityStatement || '...'}\"\n                        </p>\n                    </div>\n                )}\n            </div>\n\n            {/* FIX #7: Validation - require WIN before completion */}\n            <div className=\"pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                {!dailyWIN && (\n                    <p className=\"text-xs mb-2 text-center\" style={{ color: COLORS.AMBER }}>\n                        ⚠️ Set your WIN before completing the bookend\n                    </p>\n                )}\n                <Button \n                    onClick={onSave} \n                    disabled={isSaving || !dailyWIN} \n                    variant=\"primary\" \n                    size=\"md\" \n                    className=\"w-full\"\n                >\n                    {isSaving ? <><Loader className=\"w-5 h-5 mr-2 animate-spin\" />Saving...</> : \n                               <><CheckCircle className=\"w-5 h-5 mr-2\" />✓ Complete Morning Bookend</>}\n                </Button>\n            </div>\n        </div>\n    );\n};\n\n/* =========================================================\n   EVENING BOOKEND COMPONENT (WITH LAYOUT FIX)\n========================================================= */\nexport const EveningBookend = ({ \n    reflectionGood, setReflectionGood, reflectionBetter, setReflectionBetter,\n    reflectionBest, setReflectionBest, habitsCompleted, onHabitToggle, onSave, isSaving,\n    onNavigate, amWinCompleted, amTasksCompleted\n}) => {\n    // Determine the calculated stable height based on MorningBookend\n    const minHeightStyle = { minHeight: '445px' }; // Height based on a stable MorningBookend height\n    \n    return (\n        <div className=\"space-y-4\" style={minHeightStyle}>\n            {/* Header */}\n            <div className=\"flex items-center gap-2 mb-3\">\n                <Moon className=\"w-5 h-5\" style={{ color: COLORS.NAVY }} />\n                <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                    🌙 Evening Reflection\n                </h3>\n            </div>\n            \n            {/* Good */}\n            <div>\n                <label className=\"text-sm font-semibold mb-2 flex items-center\" style={{ color: COLORS.GREEN }}>\n                    <CheckCircle className=\"w-4 h-4 mr-1\" />\n                    Good - What went well today?\n                </label>\n                <textarea value={reflectionGood} onChange={(e) => setReflectionGood(e.target.value)}\n                    placeholder=\"Celebrate your wins...\" className=\"w-full p-3 border rounded-lg focus:ring-2 transition-all\"\n                    style={{ borderColor: `${COLORS.GREEN}40` }} rows={2}\n                />\n            </div>\n\n            {/* Better */}\n            <div>\n                <label className=\"text-sm font-semibold mb-2 flex items-center\" style={{ color: COLORS.AMBER }}>\n                    <TrendingUp className=\"w-4 h-4 mr-1\" />\n                    Better - What needs improvement?\n                </label>\n                <textarea value={reflectionBetter} onChange={(e) => setReflectionBetter(e.target.value)}\n                    placeholder=\"Areas for growth...\" className=\"w-full p-3 border rounded-lg focus:ring-2 transition-all\"\n                    style={{ borderColor: `${COLORS.AMBER}40` }} rows={2}\n                />\n            </div>\n\n            {/* Best */}\n            <div>\n                <label className=\"text-sm font-semibold mb-2 flex items-center\" style={{ color: COLORS.BLUE }}>\n                    <Star className=\"w-4 h-4 mr-1\" />\n                    Best - What do I need to do to show up as my best tomorrow?\n                </label>\n                <textarea value={reflectionBest} onChange={(e) => setReflectionBest(e.target.value)}\n                    placeholder=\"Tomorrow's commitment...\" className=\"w-full p-3 border rounded-lg focus:ring-2 transition-all\"\n                    style={{ borderColor: `${COLORS.BLUE}40` }} rows={2}\n                />\n            </div>\n\n            {/* Daily Habits Tracker */}\n            <div className=\"pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                <p className=\"text-sm font-semibold mb-3\" style={{ color: COLORS.TEXT }}>Daily Habits Tracker</p>\n                \n                {/* Auto-Tracked Habits (Matches user request) */}\n                <div className=\"space-y-2 mb-3 p-3 rounded-lg\" style={{ backgroundColor: `${COLORS.TEAL}05` }}>\n                    <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.TEAL }}>\n                        🔗 AUTO-TRACKED FROM MORNING:\n                    </p>\n                    \n                    <label className=\"flex items-center gap-2 p-2 rounded opacity-75\">\n                        {/* MODIFIED (10/29/25): Use amWinCompleted prop */}\n                        <input type=\"checkbox\" checked={amWinCompleted || false}\n                            disabled \n                            className=\"w-4 h-4\" style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <span className=\"text-sm\" style={{ color: COLORS.TEXT }}>Completed Morning WIN</span>\n                    </label>\n                    \n                    <label className=\"flex items-center gap-2 p-2 rounded opacity-75\">\n                        {/* MODIFIED (10/29/25): Use amTasksCompleted prop */}\n                        <input type=\"checkbox\" checked={amTasksCompleted || false}\n                            disabled\n                            className=\"w-4 h-4\" style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <span className=\"text-sm\" style={{ color: COLORS.TEXT }}>Completed All Morning Tasks</span>\n                    </label>\n                </div>\n                \n                {/* Manual Tracking */}\n                <div className=\"space-y-2\">\n                    <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n                        ✍️ MANUAL TRACKING:\n                    </p>\n                    \n                    <label className=\"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-colors\">\n                        <input type=\"checkbox\" checked={habitsCompleted.readLIS || false}\n                            onChange={(e) => onHabitToggle('readLIS', e.target.checked)}\n                            className=\"w-4 h-4\" style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <span className=\"text-sm\" style={{ color: COLORS.TEXT }}>Read LIS</span>\n                    </label>\n                    \n                    <label className=\"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-colors\">\n                        <input type=\"checkbox\" checked={habitsCompleted.completedDailyRep || false}\n                            onChange={(e) => onHabitToggle('completedDailyRep', e.target.checked)}\n                            className=\"w-4 h-4\" style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <span className=\"text-sm\" style={{ color: COLORS.TEXT }}>Complete Daily Rep</span>\n                    </label>\n                    \n                    <label className=\"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-colors\">\n                        <input type=\"checkbox\" checked={habitsCompleted.eveningReflection || false}\n                            onChange={(e) => onHabitToggle('eveningReflection', e.target.checked)}\n                            className=\"w-4 h-4\" style={{ accentColor: COLORS.TEAL }}\n                        />\n                        <span className=\"text-sm\" style={{ color: COLORS.TEXT }}>Evening Reflection</span>\n                    </label>\n                </div>\n            </div>\n\n            {/* Save Button */}\n            <div className=\"pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n                <Button onClick={onSave} disabled={isSaving} variant=\"primary\" size=\"md\" className=\"w-full\">\n                    {isSaving ? <><Loader className=\"w-5 h-5 mr-2 animate-spin\" />Saving...</> : \n                               <><Save className=\"w-5 h-5 mr-2\" />Save Reflection</>}\n                </Button>\n            </div>\n            \n            {/* View History Link */}\n            {onNavigate && (\n                <div className=\"pt-3\">\n                    <Button \n                        onClick={() => onNavigate('daily-practice')}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"w-full\"\n                    >\n                        📖 View Full Reflection History\n                    </Button>\n                </div>\n            )}\n        </div>\n    );\n};\n\n/* =========================================================\n   SUGGESTION MODAL (FIX #4, #5)\n========================================================= */\nexport const SuggestionModal = ({ title, prefix, suggestions, onSelect, onClose }) => (\n  <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div className=\"bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n          {title}\n        </h2>\n        <button \n          onClick={onClose}\n          className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n      </div>\n      \n      <div className=\"overflow-y-auto flex-1 space-y-2\">\n        {suggestions.map((suggestion, index) => (\n          <button\n            key={index}\n            onClick={() => onSelect(suggestion.value || suggestion.text || suggestion)}\n            className=\"w-full text-left p-4 rounded-lg border-2 transition-all hover:border-teal-500 hover:bg-teal-50\"\n            style={{ borderColor: COLORS.SUBTLE }}\n          >\n            <p className=\"text-sm font-medium\" style={{ color: COLORS.TEXT }}>\n              {prefix} <strong>{suggestion.value || suggestion.text || suggestion}</strong>\n            </p>\n            {suggestion.description && (\n              <p className=\"text-xs mt-1\" style={{ color: COLORS.MUTED }}>\n                {suggestion.description}\n              </p>\n            )}\n          </button>\n        ))}\n      </div>\n      \n      <div className=\"mt-4 pt-4 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n        <Button onClick={onClose} variant=\"outline\" size=\"sm\" className=\"w-full\">\n          Close\n        </Button>\n      </div>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   FIX #6: SAVE INDICATOR\n========================================================= */\nexport const SaveIndicator = ({ show, message = \"Saved!\" }) => {\n  if (!show) return null;\n  \n  return (\n    <div className=\"fixed bottom-4 right-4 z-50 animate-fade-in-up\">\n      <div className=\"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2\">\n        <CheckCircle className=\"w-5 h-5\" />\n        <span className=\"font-semibold\">{message}</span>\n      </div>\n    </div>\n  );\n};\n\n/* =========================================================\n   FIX #3: BONUS EXERCISE MODAL\n========================================================= */\nexport const BonusExerciseModal = ({ exercise, onComplete, onSkip }) => (\n  <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div className=\"bg-white rounded-2xl p-6 max-w-lg w-full\">\n      <div className=\"text-center mb-4\">\n        <div className=\"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center\"\n             style={{ backgroundColor: `${COLORS.ORANGE}20` }}>\n          <Trophy className=\"w-8 h-8\" style={{ color: COLORS.ORANGE }} />\n        </div>\n        <h2 className=\"text-2xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n          🎉 Bonus Challenge!\n        </h2>\n        <p className=\"text-sm\" style={{ color: COLORS.MUTED }}>\n          Complete this 2-minute exercise to earn +50 coins\n        </p>\n      </div>\n\n      <div className=\"p-4 rounded-lg mb-4\" style={{ backgroundColor: `${COLORS.TEAL}10` }}>\n        <h3 className=\"font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n          {exercise.name || exercise.title}\n        </h3>\n        <p className=\"text-sm mb-3\" style={{ color: COLORS.TEXT }}>\n          {exercise.description}\n        </p>\n        {exercise.instructions && (\n          <div className=\"text-xs\" style={{ color: COLORS.MUTED }}>\n            <strong>How to do it:</strong>\n            <p className=\"mt-1\">{exercise.instructions}</p>\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex gap-3\">\n        <Button onClick={onComplete} variant=\"primary\" size=\"md\" className=\"flex-1\">\n          ✓ I Did It! (+50 🪙)\n        </Button>\n        <Button onClick={onSkip} variant=\"outline\" size=\"md\" className=\"flex-1\">\n          Skip for Now\n        </Button>\n      </div>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   FIX #8: ADDITIONAL REPS CARD (Enhanced)\n========================================================= */\nexport const AdditionalRepsCard = ({ commitments, onToggle, repLibrary }) => {\n  // Lookup full rep details from library\n  const enrichedCommitments = commitments.map(commitment => {\n    if (typeof commitment === 'string') {\n      return { id: commitment, text: commitment, completed: false };\n    }\n    \n    // If we have a repId, lookup details from library\n    if (commitment.repId && repLibrary) {\n      const repDetails = repLibrary.find(rep => rep.id === commitment.repId || rep.repId === commitment.repId);\n      if (repDetails) {\n        return {\n          ...commitment,\n          name: repDetails.name,\n          description: repDetails.description,\n          category: repDetails.category\n        };\n      }\n    }\n    \n    return commitment;\n  });\n\n  return (\n    <Card title=\"⏳ Additional Daily Reps\" accent='TEAL'>\n      <div className=\"space-y-3\">\n        {enrichedCommitments.map((commitment, idx) => (\n          <div key={commitment.id || idx} \n               className=\"p-4 rounded-lg border-2 transition-all\"\n               style={{ \n                 borderColor: commitment.completed ? COLORS.GREEN : COLORS.SUBTLE,\n                 backgroundColor: commitment.completed ? `${COLORS.GREEN}05` : COLORS.LIGHT_GRAY\n               }}>\n            <div className=\"flex items-start gap-3\">\n              <input \n                type=\"checkbox\" \n                checked={commitment.completed || false}\n                onChange={() => onToggle(commitment.id)}\n                className=\"mt-1 w-5 h-5 flex-shrink-0\"\n                style={{ accentColor: COLORS.TEAL }}\n              />\n              <div className=\"flex-1\">\n                <p className={`text-sm font-bold mb-1 ${commitment.completed ? 'line-through opacity-60' : ''}`}\n                   style={{ color: COLORS.NAVY }}>\n                  {commitment.name || commitment.text || commitment.repId}\n                </p>\n                {commitment.description && (\n                  <p className=\"text-xs mb-2\" style={{ color: COLORS.MUTED }}>\n                    {commitment.description}\n                  </p>\n                )}\n                {commitment.category && (\n                  <span className=\"inline-block px-2 py-1 rounded text-xs font-semibold\"\n                        style={{ backgroundColor: `${COLORS.BLUE}20`, color: COLORS.BLUE }}>\n                    {commitment.category}\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </Card>\n  );\n};\n\n/* =========================================================\n   FIX #8 & #9: SOCIAL POD CARD (with working Find Pod button)\n========================================================= */\nexport const SocialPodCard = ({ podMembers, activityFeed, onSendMessage, onFindPod }) => {\n  const [newMessage, setNewMessage] = useState('');\n\n  const handleSend = () => {\n    if (newMessage.trim()) {\n      onSendMessage(newMessage);\n      setNewMessage('');\n    }\n  };\n\n  return (\n    <Card title=\"🤝 Social Pod Feed\" accent='TEAL'>\n      {/* Pod Members Section */}\n      {podMembers && podMembers.length > 0 ? (\n        <>\n          <div className=\"mb-4\">\n            <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n              YOUR POD MEMBERS:\n            </p>\n            <div className=\"flex gap-2 flex-wrap\">\n              {podMembers.map((member, idx) => (\n                <div key={idx} \n                     className=\"flex items-center gap-2 px-3 py-2 rounded-lg border\"\n                     style={{ borderColor: COLORS.SUBTLE, backgroundColor: COLORS.LIGHT_GRAY }}>\n                  <div className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n                       style={{ backgroundColor: COLORS.TEAL, color: 'white' }}>\n                    <User className=\"w-4 h-4\" />\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-semibold\" style={{ color: COLORS.NAVY }}>\n                      {member.name || 'Leader'}\n                    </p>\n                    <p className=\"text-xs\" style={{ color: COLORS.MUTED }}>\n                      {member.streak || 0} day streak\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Activity Feed */}\n          <div className=\"mb-4\">\n            <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n              RECENT ACTIVITY:\n            </p>\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n              {activityFeed && activityFeed.length > 0 ? (\n                activityFeed.map((activity, idx) => (\n                  <div key={idx} \n                       className=\"p-3 rounded-lg border-l-4\"\n                       style={{ \n                         backgroundColor: COLORS.LIGHT_GRAY,\n                         borderColor: COLORS.TEAL\n                       }}>\n                    <div className=\"flex items-start gap-2\">\n                      <Activity className=\"w-4 h-4 mt-0.5 flex-shrink-0\" style={{ color: COLORS.TEAL }} />\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-semibold\" style={{ color: COLORS.NAVY }}>\n                          {activity.userName}\n                        </p>\n                        <p className=\"text-xs\" style={{ color: COLORS.TEXT }}>\n                          {activity.message}\n                        </p>\n                        <p className=\"text-xs mt-1\" style={{ color: COLORS.MUTED }}>\n                          {formatTimestamp(activity.timestamp)}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <p className=\"text-sm text-center py-4\" style={{ color: COLORS.MUTED }}>\n                  No recent activity. Be the first to share!\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Send Message */}\n          <div className=\"pt-3 border-t\" style={{ borderColor: COLORS.SUBTLE }}>\n            <div className=\"flex gap-2\">\n              <input \n                type=\"text\"\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && handleSend()}\n                placeholder=\"Share your progress...\"\n                className=\"flex-1 p-2 border rounded-lg text-sm\"\n                style={{ borderColor: COLORS.SUBTLE }}\n              />\n              <button\n                onClick={handleSend}\n                disabled={!newMessage.trim()}\n                className=\"px-4 py-2 rounded-lg font-semibold text-white transition-all disabled:opacity-50\"\n                style={{ backgroundColor: COLORS.TEAL }}\n              >\n                <Send className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n        </>\n      ) : (\n        /* Empty State */\n        <div className=\"text-center py-8\">\n          <Users className=\"w-12 h-12 mx-auto mb-3\" style={{ color: COLORS.MUTED }} />\n          <p className=\"text-sm font-semibold mb-2\" style={{ color: COLORS.NAVY }}>\n            No Pod Members Yet\n          </p>\n          <p className=\"text-xs mb-4\" style={{ color: COLORS.MUTED }}>\n            Connect with other leaders to build accountability\n          </p>\n          <Button onClick={onFindPod} variant=\"outline\" size=\"sm\">\n            Find a Pod\n          </Button>\n        </div>\n      )}\n    </Card>\n  );\n};\n\n/* =========================================================\n   AI COACH NUDGE\n========================================================= */\nexport const AICoachNudge = ({ onOpenLab, disabled }) => (\n  <Card>\n    <div className=\"flex items-start gap-3\">\n      <div className=\"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0\" \n           style={{ backgroundColor: `${COLORS.TEAL}20`, color: COLORS.TEAL }}>\n        <MessageSquare className=\"w-5 h-5\" />\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold mb-1\" style={{ color: COLORS.NAVY }}>Need coaching support?</h3>\n        <p className=\"text-sm mb-3\" style={{ color: COLORS.TEXT }}>\n          Practice scenarios, get feedback, or work through challenges with your AI coach.\n        </p>\n        <Button onClick={onOpenLab} variant=\"outline\" size=\"sm\" disabled={disabled}>\n          <Zap className=\"w-4 h-4 mr-1\" /> Open Coaching Lab\n        </Button>\n      </div>\n    </div>\n  </Card>\n);\n\n/* =========================================================\n   DEV PLAN PROGRESS LINK (FIX #2)\n========================================================= */\nexport const DevPlanProgressLink = ({ progress, focusArea, onNavigate }) => (\n  <Card>\n    <div className=\"flex items-center justify-between mb-3\">\n      <div className=\"flex-1\">\n        <p className=\"text-xs font-semibold mb-1\" style={{ color: COLORS.MUTED }}>\n          CURRENT DEVELOPMENT FOCUS\n        </p>\n        <p className=\"text-base font-bold\" style={{ color: COLORS.NAVY }}>\n          {focusArea || 'Not Set'}\n        </p>\n      </div>\n      <div className=\"text-right\">\n        <p className=\"text-3xl font-bold\" style={{ color: COLORS.TEAL }}>\n          {progress || 0}%\n        </p>\n        <p className=\"text-xs\" style={{ color: COLORS.MUTED }}>\n          Complete\n        </p>\n      </div>\n    </div>\n    <Button \n      onClick={onNavigate}\n      variant=\"outline\"\n      size=\"sm\"\n      className=\"w-full\"\n    >\n      View Development Plan →\n    </Button>\n  </Card>\n);\n\n/* =========================================================\n   REMINDER BANNER COMPONENTS\n========================================================= */\nexport const ReminderBanner = ({ message, onDismiss, type = 'best' }) => {\n  const bgColor = type === 'best' ? COLORS.TEAL : COLORS.AMBER;\n  const emoji = type ==='best' ? '🌟' : '💡';\n  const label = type === 'best' ? \"YESTERDAY'S COMMITMENT:\" : \"AREA FOR IMPROVEMENT:\";\n  \n  // CRITICAL FIX: Don't render if message is a FieldValue sentinel (has _methodName)\n  // This prevents React Error #31 when deleteField() or other sentinels are passed\n  if (!message || typeof message !== 'string') {\n    return null; // Don't render if message is not a valid string\n  }\n  \n  return (\n    <div \n      className=\"p-4 rounded-lg border-l-4\" \n      style={{ \n        backgroundColor: `${bgColor}10`, \n        borderColor: bgColor \n      }}\n    >\n      <div className=\"flex justify-between items-start gap-3\">\n        <div className=\"flex-1\">\n          <p className=\"text-xs font-semibold mb-1\" style={{ color: bgColor }}>\n            {emoji} {label}\n          </p>\n          <p className=\"text-sm\" style={{ color: COLORS.NAVY }}>\n            {message}\n          </p>\n        </div>\n        <button\n          onClick={onDismiss}\n          className=\"text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0\"\n          aria-label=\"Dismiss reminder\"\n        >\n          <X className=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  );\n};\n\n/* =========================================================\n   NEW: LEADERSHIP ANCHORS CARD (Exported) -- REMOVED\n========================================================= */\n// export const LeadershipAnchorsCard = () => null; // Placeholder removed\n\n/* =========================================================\n   NEW: UNIFIED ANCHOR EDITOR MODAL\n========================================================= */\nconst AnchorInputSection = ({ \n    title, icon: Icon, description, value, setValue, \n    suggestions, onSelectSuggestion, isTextArea = false \n}) => {\n    // Determine the text used for suggestions based on the anchor type\n    const suggestionPrefix = title === '1. Identity Anchor' \n        ? '... ' // for \"...prioritizes team well-being\"\n        : ''; \n        \n    return (\n        <div className=\"p-4 rounded-xl border\" style={{ borderColor: COLORS.SUBTLE }}>\n            <div className=\"flex items-center gap-2 mb-2\">\n                <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n                <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                    {title}\n                </h3>\n            </div>\n            <p className=\"text-xs mb-3\" style={{ color: COLORS.MUTED }}>\n                {description}\n            </p>\n            \n            {isTextArea ? (\n                <textarea \n                    value={value}\n                    onChange={(e) => setValue(e.target.value)}\n                    placeholder=\"Enter your anchor...\"\n                    className=\"w-full p-3 border rounded-lg mb-4\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                    rows={3}\n                />\n            ) : (\n                <input \n                    type=\"text\"\n                    value={value}\n                    onChange={(e) => setValue(e.target.value)}\n                    placeholder=\"Enter your anchor...\"\n                    className=\"w-full p-3 border rounded-lg mb-4\"\n                    style={{ borderColor: COLORS.SUBTLE }}\n                />\n            )}\n            \n            {suggestions && suggestions.length > 0 && (\n                <>\n                    <p className=\"text-xs font-semibold mb-2\" style={{ color: COLORS.MUTED }}>\n                        SUGGESTIONS:\n                    </p>\n                    <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                        {suggestions.slice(0, 3).map((suggestion, index) => (\n                            <button\n                                key={index}\n                                onClick={() => onSelectSuggestion(suggestion.text)}\n                                className=\"w-full text-left p-2 rounded-lg text-sm transition-all bg-gray-50 hover:bg-teal-50\"\n                                style={{ color: COLORS.NAVY }}\n                            >\n                                {suggestionPrefix} {suggestion.text}\n                            </button>\n                        ))}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n\nexport const UnifiedAnchorEditorModal = ({ \n    initialIdentity, initialHabit, initialWhy,\n    identitySuggestions, habitSuggestions, whySuggestions,\n    onSave, onClose\n}) => {\n    const [identity, setIdentity] = useState(initialIdentity);\n    const [habit, setHabit] = useState(initialHabit);\n    const [why, setWhy] = useState(initialWhy);\n\n    const handleSave = () => {\n        onSave({ identity, habit, why });\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n                <div className=\"flex justify-between items-center mb-4 pb-2 border-b\" style={{ borderColor: COLORS.SUBTLE }}>\n                    <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                        <Anchor className=\"w-6 h-6 inline-block mr-2\" style={{ color: COLORS.TEAL }} />\n                        Define Your Leadership Anchors\n                    </h2>\n                    <button onClick={onClose} className=\"p-1 rounded-full hover:bg-gray-100\">\n                        <X className=\"w-5 h-5\" style={{ color: COLORS.MUTED }} />\n                    </button>\n                </div>\n\n                <div className=\"overflow-y-auto flex-1 space-y-4 pr-2\">\n                    <AnchorInputSection\n                        title=\"1. Identity Anchor\"\n                        icon={User}\n                        description='Complete the statement: \"I am the kind of leader who...\"'\n                        value={identity}\n                        setValue={setIdentity}\n                        suggestions={identitySuggestions}\n                        onSelectSuggestion={setIdentity}\n                    />\n\n                    <AnchorInputSection\n                        title=\"2. Habit Anchor (Cue)\"\n                        icon={Clock}\n                        description='Your daily cue: \"When I...\"'\n                        value={habit}\n                        setValue={setHabit}\n                        suggestions={habitSuggestions}\n                        onSelectSuggestion={setHabit}\n                    />\n                    \n                    <AnchorInputSection\n                        title=\"3. Your 'Why It Matters'\"\n                        icon={Zap}\n                        description='Your core purpose: Why does this leadership journey matter to you?'\n                        value={why}\n                        setValue={setWhy}\n                        suggestions={whySuggestions}\n                        onSelectSuggestion={setWhy}\n                        isTextArea={true}\n                    />\n                </div>\n\n                <div className=\"mt-4 pt-4 border-t flex gap-3\" style={{ borderColor: COLORS.SUBTLE }}>\n                    <Button onClick={handleSave} variant=\"primary\" size=\"md\" className=\"flex-1\">\n                        <Save className=\"w-4 h-4 mr-2\" /> Save All Anchors\n                    </Button>\n                    <Button onClick={onClose} variant=\"outline\" size=\"md\" className=\"flex-1\">\n                        Cancel\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n\n/* =========================================================\n   PLACEHOLDER COMPONENTS (Required to fix build errors)\n========================================================= */\n// Exporting placeholder components to prevent errors in Dashboard.jsx when these are not used\nexport const IdentityAnchorCard = () => null;\nexport const HabitAnchorCard = () => null;\nexport const WhyAnchorCard = () => null;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/dashboard/DashboardHooks.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'featureFlags' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":5},{"ruleId":"no-unused-vars","severity":1,"message":"'userEmail' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'sanitizeTimestamps'. Either include it or remove the dependency array.","line":106,"column":6,"nodeType":"ArrayExpression","endLine":106,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [dailyPracticeData.activeCommitments, sanitizeTimestamps]","fix":{"range":[4077,4115],"text":"[dailyPracticeData.activeCommitments, sanitizeTimestamps]"}}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":120,"column":17,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":120,"endColumn":31,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[4546,4565],"text":"Object.prototype.hasOwnProperty.call(obj, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'sanitizeTimestamps'. Either include it or remove the dependency array.","line":136,"column":6,"nodeType":"ArrayExpression","endLine":136,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [dailyPracticeData.morningBookend, sanitizeTimestamps]","fix":{"range":[4955,4990],"text":"[dailyPracticeData.morningBookend, sanitizeTimestamps]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'amCompletedAt' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":446,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":446,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'amWinCompleted' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":447,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":447,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'amTasksCompleted' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":448,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":448,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/dashboard/DashboardHooks.jsx\n// Extracted State & Logic from Dashboard (10/28/25)\n// FINALIZED: Ensures updateDailyPracticeData dependency is used correctly and safely within callbacks.\n// FIXED (10/30/25): Final fix for Issue 5 (Reflections not clearing) by clearing local state explicitly.\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport { serverTimestamp } from 'firebase/firestore';\n\n/* =========================================================\n   MAIN DASHBOARD HOOK\n   Consolidates all state and logic for Dashboard\n========================================================= */\nexport const useDashboard = ({\n  dailyPracticeData,\n  updateDailyPracticeData, // <--- Prop from useAppServices\n  featureFlags,\n  db,\n  userEmail\n}) => {\n  \n  // === ARENA MODE STATE ===\n  const [isArenaMode, setIsArenaMode] = useState(true);\n  const [isTogglingMode, setIsTogglingMode] = useState(false);\n\n  // === TARGET REP STATE ===\n  const [targetRepStatus, setTargetRepStatus] = useState('Pending');\n  const [isSavingRep, setIsSavingRep] = useState(false);\n\n  // === IDENTITY & HABIT STATE ===\n  const [identityStatement, setIdentityStatement] = useState('');\n  const [habitAnchor, setHabitAnchor] = useState('');\n  const [whyStatement, setWhyStatement] = useState('');\n  const [showIdentityEditor, setShowIdentityEditor] = useState(false);\n  const [showHabitEditor, setShowHabitEditor] = useState(false);\n\n  // === BOOKEND STATE (NEW 10/28/25) ===\n  const [morningWIN, setMorningWIN] = useState('');\n  const [otherTasks, setOtherTasks] = useState([]);\n  const [showLIS, setShowLIS] = useState(false);\n  const [reflectionGood, setReflectionGood] = useState('');\n  const [reflectionBetter, setReflectionBetter] = useState('');\n  const [reflectionBest, setReflectionBest] = useState('');\n  const [habitsCompleted, setHabitsCompleted] = useState({\n      readLIS: false,\n      completedDailyRep: false,\n      eveningReflection: false\n  });\n  const [isSavingBookend, setIsSavingBookend] = useState(false);\n  \n  // FIXED 10/29/25: Track when we're intentionally clearing reflections\n  const [shouldSkipReflectionLoad, setShouldSkipReflectionLoad] = useState(false);\n\n  // === STREAK STATE ===\n  const [streakCount, setStreakCount] = useState(0);\n  const [streakCoins, setStreakCoins] = useState(0);\n\n  // === ADDITIONAL REPS STATE ===\n  const [additionalCommitments, setAdditionalCommitments] = useState([]);\n\n  /* =========================================================\n     LOAD DATA FROM FIRESTORE (Dependency on dailyPracticeData)\n  ========================================================= */\n  \n  // Load Arena Mode\n  useEffect(() => {\n    if (dailyPracticeData?.arenaMode !== undefined) {\n      setIsArenaMode(dailyPracticeData.arenaMode);\n    }\n  }, [dailyPracticeData?.arenaMode]);\n\n  // Load Target Rep Status\n  useEffect(() => {\n    if (dailyPracticeData?.dailyTargetRepStatus) {\n      setTargetRepStatus(dailyPracticeData.dailyTargetRepStatus);\n    }\n  }, [dailyPracticeData?.dailyTargetRepStatus]);\n\n  // Load Identity & Habit & Why\n  useEffect(() => {\n    if (dailyPracticeData?.identityAnchor) {\n      setIdentityStatement(dailyPracticeData.identityAnchor);\n    }\n    if (dailyPracticeData?.habitAnchor) {\n      setHabitAnchor(dailyPracticeData.habitAnchor);\n    }\n    if (dailyPracticeData?.whyStatement) {\n      setWhyStatement(dailyPracticeData.whyStatement);\n    }\n  }, [dailyPracticeData?.identityAnchor, dailyPracticeData?.habitAnchor, dailyPracticeData?.whyStatement]);\n\n  // Load Streak Data\n  useEffect(() => {\n    if (dailyPracticeData?.streakCount !== undefined) {\n      setStreakCount(dailyPracticeData.streakCount);\n    }\n    if (dailyPracticeData?.streakCoins !== undefined) {\n      setStreakCoins(dailyPracticeData.streakCoins);\n    }\n  }, [dailyPracticeData?.streakCount, dailyPracticeData?.streakCoins]);\n\n  // Load Additional Commitments\n  useEffect(() => {\n    if (dailyPracticeData?.activeCommitments) {\n      setAdditionalCommitments(sanitizeTimestamps(dailyPracticeData.activeCommitments));\n    }\n  }, [dailyPracticeData?.activeCommitments]);\n\n  // Helper to sanitize Firestore Timestamps\n  const sanitizeTimestamps = (obj) => {\n    if (!obj) return obj;\n    if (Array.isArray(obj)) {\n      return obj.map(item => sanitizeTimestamps(item));\n    }\n    if (obj && typeof obj === 'object' && typeof obj.toDate === 'function') {\n      return obj.toDate();\n    }\n    if (obj && typeof obj === 'object') {\n      const sanitized = {};\n      for (const key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          sanitized[key] = sanitizeTimestamps(obj[key]);\n        }\n      }\n      return sanitized;\n    }\n    return obj;\n  };\n\n  // Load Morning Bookend\n  useEffect(() => {\n    if (dailyPracticeData?.morningBookend) {\n      const mb = dailyPracticeData.morningBookend;\n      setMorningWIN(mb.dailyWIN || '');\n      setOtherTasks(sanitizeTimestamps(mb.otherTasks || []));\n    }\n  }, [dailyPracticeData?.morningBookend]);\n\n  // Load Evening Bookend (Issue 5 Fix)\n  useEffect(() => {\n    // Skip load if we just saved and cleared\n    if (shouldSkipReflectionLoad) {\n      // Clear flag after skipping the load cycle\n      setShouldSkipReflectionLoad(false); \n      return;\n    }\n    \n    if (dailyPracticeData?.eveningBookend) {\n      const eb = dailyPracticeData.eveningBookend;\n      setReflectionGood(eb.good || '');\n      setReflectionBetter(eb.better || '');\n      setReflectionBest(eb.best || '');\n      setHabitsCompleted(eb.habits || {\n        readLIS: false,\n        completedDailyRep: false,\n        eveningReflection: false\n      });\n    }\n  }, [dailyPracticeData?.eveningBookend, shouldSkipReflectionLoad]);\n\n  /* =========================================================\n     MODE TOGGLE HANDLER (Dependency on updateDailyPracticeData)\n  ========================================================= */\n  const handleToggleMode = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData || isTogglingMode) return;\n\n    setIsTogglingMode(true);\n    const newMode = !isArenaMode;\n\n    try {\n      const success = await updateDailyPracticeData({ arenaMode: newMode });\n      if (success) {\n        setIsArenaMode(newMode);\n        console.log(`[Dashboard] Mode toggled to ${newMode ? 'Arena' : 'Solo'}`);\n      }\n    } catch (error) {\n      console.error('[Dashboard] Error toggling mode:', error);\n      alert('Error changing mode. Please try again.');\n    } finally {\n      setIsTogglingMode(false);\n    }\n  }, [isArenaMode, isTogglingMode, updateDailyPracticeData]); // Explicitly include prop\n\n  /* =========================================================\n     TARGET REP HANDLERS (Dependency on updateDailyPracticeData)\n  ========================================================= */\n  const handleCompleteTargetRep = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData || isSavingRep) return;\n\n    setIsSavingRep(true);\n    try {\n      const updates = {\n        dailyTargetRepStatus: 'Committed',\n        dailyTargetRepDate: new Date().toISOString().split('T')[0]\n      };\n\n      const success = await updateDailyPracticeData(updates);\n      if (success) {\n        setTargetRepStatus('Committed');\n        // Update habits\n        setHabitsCompleted(prev => ({ ...prev, completedDailyRep: true }));\n        console.log('[Dashboard] Target rep completed');\n      }\n    } catch (error) {\n      console.error('[Dashboard] Error completing target rep:', error);\n      alert('Error completing rep. Please try again.');\n    } finally {\n      setIsSavingRep(false);\n    }\n  }, [updateDailyPracticeData, isSavingRep]); // Explicitly include prop\n\n  /* =========================================================\n     IDENTITY & HABIT HANDLERS (Dependency on updateDailyPracticeData)\n  ========================================================= */\n  const handleSaveIdentity = useCallback(async (newIdentity) => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) return;\n\n    try {\n      const success = await updateDailyPracticeData({ identityAnchor: newIdentity });\n      if (success) {\n        setIdentityStatement(newIdentity);\n        setShowIdentityEditor(false);\n        console.log('[Dashboard] Identity saved');\n      }\n    } catch (error) {\n      console.error('[Dashboard] Error saving identity:', error);\n      alert('Error saving identity. Please try again.');\n    }\n  }, [updateDailyPracticeData]); // Explicitly include prop\n\n  const handleSaveHabit = useCallback(async (newHabit) => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) return;\n\n    try {\n      const success = await updateDailyPracticeData({ habitAnchor: newHabit });\n      if (success) {\n        setHabitAnchor(newHabit);\n        setShowHabitEditor(false);\n        console.log('[Dashboard] Habit anchor saved');\n      }\n    } catch (error) {\n      console.error('[Dashboard] Error saving habit:', error);\n      alert('Error saving habit. Please try again.');\n    }\n  }, [updateDailyPracticeData]); // Explicitly include prop\n\n  /* =========================================================\n     BOOKEND HANDLERS (Dependency on updateDailyPracticeData)\n  ========================================================= */\n  const handleSaveMorningBookend = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) {\n      console.error('[Dashboard] Cannot save morning bookend');\n      alert('Error: Unable to save. Please try again.');\n      return;\n    }\n\n    setIsSavingBookend(true);\n    try {\n      const updates = {\n        morningBookend: {\n          dailyWIN: morningWIN,\n          otherTasks: otherTasks,\n          readLIS: showLIS,\n          completedAt: serverTimestamp()\n        }\n      };\n\n      const success = await updateDailyPracticeData(updates);\n      if (!success) throw new Error('Update failed');\n      console.log('[Dashboard] Morning bookend saved');\n    } catch (error) {\n      console.error('[Dashboard] Error saving morning bookend:', error);\n      alert('Error saving morning plan. Please try again.');\n    } finally {\n      setIsSavingBookend(false);\n    }\n  }, [morningWIN, otherTasks, showLIS, updateDailyPracticeData]); // Explicitly include prop\n\n  const handleSaveEveningBookend = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) {\n      console.error('[Dashboard] Cannot save evening bookend');\n      alert('Error: Unable to save. Please try again.');\n      return;\n    }\n\n    setIsSavingBookend(true);\n    try {\n      const updates = {\n        eveningBookend: {\n          good: reflectionGood,\n          better: reflectionBetter,\n          best: reflectionBest,\n          habits: habitsCompleted,\n          completedAt: serverTimestamp()\n        },\n        // NEW: Set tomorrow's reminders from today's reflection\n        tomorrowsReminder: reflectionBest,\n        improvementReminder: reflectionBetter\n      };\n\n      const success = await updateDailyPracticeData(updates);\n      if (!success) throw new Error('Update failed');\n\n      // Auto-check evening reflection habit\n      setHabitsCompleted(prev => ({ ...prev, eveningReflection: true }));\n      \n      // FIXED (Issue 5): Clear local state and activate reload guard flag\n      setReflectionGood('');\n      setReflectionBetter('');\n      setReflectionBest('');\n      setShouldSkipReflectionLoad(true); // <-- Set flag to skip next listener update\n      \n      console.log('[Dashboard] Evening bookend saved with next-day reminders');\n    } catch (error) {\n      console.error('[Dashboard] Error saving evening bookend:', error);\n      alert('Error saving reflection. Please try again.');\n    } finally {\n      setIsSavingBookend(false);\n    }\n  }, [reflectionGood, reflectionBetter, reflectionBest, habitsCompleted, updateDailyPracticeData]); // Explicitly include prop\n\n  const handleAddTask = useCallback((taskText) => {\n    if (!taskText.trim()) return;\n    if (otherTasks.length >= 5) {\n      alert('Maximum 5 tasks allowed');\n      return;\n    }\n    \n    const newTask = {\n      id: `task-${Date.now()}`,\n      text: taskText,\n      completed: false\n    };\n    \n    const updatedTasks = [...otherTasks, newTask];\n    setOtherTasks(updatedTasks);\n    \n    // NEW: Auto-save to Firestore immediately\n    // Use the destructured prop directly\n    if (updateDailyPracticeData) {\n      updateDailyPracticeData({\n        'morningBookend.otherTasks': updatedTasks\n      }).catch(error => {\n        console.error('[Dashboard] Error auto-saving task:', error);\n      });\n    }\n  }, [otherTasks, updateDailyPracticeData]); // Explicitly include prop\n\n  const handleToggleTask = useCallback(async (taskId) => {\n    const updatedTasks = otherTasks.map(task =>\n      task.id === taskId ? { ...task, completed: !task.completed } : task\n    );\n    setOtherTasks(updatedTasks);\n    \n    // Auto-save to Firestore immediately\n    // Use the destructured prop directly\n    if (updateDailyPracticeData) {\n      try {\n        await updateDailyPracticeData({\n          'morningBookend.otherTasks': updatedTasks\n        });\n        console.log('[Dashboard] Task toggled and saved');\n      } catch (error) {\n        console.error('[Dashboard] Error auto-saving task toggle:', error);\n      }\n    }\n  }, [otherTasks, updateDailyPracticeData]); // Explicitly include prop\n\n  const handleRemoveTask = useCallback(async (taskKey) => {\n    let updatedTasks;\n    if (typeof taskKey === 'number') {\n      updatedTasks = otherTasks.filter((_, idx) => idx !== taskKey);\n    } else {\n      updatedTasks = otherTasks.filter(task => task.id !== taskKey);\n      // If not found and taskKey looks like an index string, try parseInt\n      if (updatedTasks.length === otherTasks.length && typeof taskKey === 'string' && taskKey.match(/^\\d+$/)) {\n        const idx = parseInt(taskKey, 10);\n        updatedTasks = otherTasks.filter((_, i) => i !== idx);\n      }\n    }\n    // If still same length, nothing to remove\n    if (updatedTasks.length === otherTasks.length) return;\n    setOtherTasks(updatedTasks);\n    \n    // Auto-save to Firestore immediately\n    // Use the destructured prop directly\n    if (updateDailyPracticeData) {\n      try {\n        await updateDailyPracticeData({\n          'morningBookend.otherTasks': updatedTasks\n        });\n        console.log('[Dashboard] Task removed and saved');\n      } catch (error) {\n        console.error('[Dashboard] Error auto-saving task removal:', error);\n      }\n    }\n  }, [otherTasks, updateDailyPracticeData]); // Explicitly include prop\n\n  // NEW: Handle WIN checkbox toggle\n  const handleToggleWIN = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) return;\n    \n    const currentStatus = dailyPracticeData?.morningBookend?.winCompleted || false;\n    const newStatus = !currentStatus;\n    \n    try {\n      await updateDailyPracticeData({\n        'morningBookend.winCompleted': newStatus\n      });\n      console.log('[Dashboard] WIN toggled:', newStatus);\n    } catch (error) {\n      console.error('[Dashboard] Error toggling WIN:', error);\n    }\n  }, [dailyPracticeData, updateDailyPracticeData]); // Explicitly include prop\n\n  const handleHabitToggle = useCallback((habitKey, checked) => {\n    setHabitsCompleted(prev => ({ ...prev, [habitKey]: checked }));\n  }, []);\n\n  // NEW: Handle saving WIN separately\n  const handleSaveWIN = useCallback(async () => {\n    // Use the destructured prop directly\n    if (!updateDailyPracticeData) return;\n    \n    try {\n      await updateDailyPracticeData({\n        'morningBookend.dailyWIN': morningWIN\n      });\n      console.log('[Dashboard] WIN saved');\n    } catch (error) {\n      console.error('[Dashboard] Error saving WIN:', error);\n      alert('Error saving WIN. Please try again.');\n    }\n  }, [morningWIN, updateDailyPracticeData]); // Explicitly include prop\n\n  /* =========================================================\n     COMPUTED VALUES\n  ========================================================= */\n  // Derived AM flags for UI auto-tracking\n  const amCompletedAt = dailyPracticeData?.morningBookend?.completedAt || null;\n  const amWinCompleted = !!(dailyPracticeData?.morningBookend?.winCompleted);\n  const amTasksCompleted = Array.isArray(otherTasks) && otherTasks.length > 0 && otherTasks.every(t => !!t.completed);\n\n  const targetRep = useMemo(() => {\n    return dailyPracticeData?.dailyTargetRepId || null;\n  }, [dailyPracticeData?.dailyTargetRepId]);\n\n  const canCompleteTargetRep = useMemo(() => {\n    return targetRepStatus === 'Pending' && !isSavingRep;\n  }, [targetRepStatus, isSavingRep]);\n\n  /* =========================================================\n     RETURN ALL STATE & HANDLERS\n  ========================================================= */\n  return {\n    // Arena Mode\n    isArenaMode,\n    isTogglingMode,\n    handleToggleMode,\n\n    // Target Rep\n    targetRep,\n    targetRepStatus,\n    canCompleteTargetRep,\n    isSavingRep,\n    handleCompleteTargetRep,\n\n    // Identity & Habit & Why\n    identityStatement,\n    setIdentityStatement,\n    habitAnchor,\n    setHabitAnchor,\n    whyStatement,\n    setWhyStatement,\n    showIdentityEditor,\n    setShowIdentityEditor,\n    showHabitEditor,\n    setShowHabitEditor,\n    handleSaveIdentity,\n    handleSaveHabit,\n\n    // Bookends\n    morningWIN,\n    setMorningWIN,\n    otherTasks,\n    showLIS,\n    setShowLIS,\n    reflectionGood,\n    setReflectionGood,\n    reflectionBetter,\n    setReflectionBetter,\n    reflectionBest,\n    setReflectionBest,\n    habitsCompleted,\n    isSavingBookend,\n    handleSaveMorningBookend,\n    handleSaveEveningBookend,\n    handleAddTask,\n    handleToggleTask,\n    handleRemoveTask,\n    handleToggleWIN, // NEW\n    handleSaveWIN, // NEW\n    handleHabitToggle,\n    setShouldSkipReflectionLoad, // FIXED 10/29/25: Export flag setter\n\n    // Streak\n    streakCount,\n    streakCoins,\n\n    // Additional Reps\n    additionalCommitments,\n  };\n};","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/dashboard/EveningBookend.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/dashboard/MorningBookend.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/BaselineAssessment.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/DetailedPlanView.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'globalMetadata' is defined but never used.","line":76,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'onUpdatePlan' is defined but never used.","line":79,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/developmentplan/DetailedPlanView.jsx\n// FIX #4: RESTORED DETAILED 18-MONTH PLAN VIEW WITH GRAPHICS\n// This was in the OLD Development Plan and user wants it back\n\nimport React, { useMemo } from 'react';\nimport { \n  Target, Calendar, BarChart3, Zap, CheckCircle, Lightbulb, ArrowLeft \n} from 'lucide-react';\nimport { \n  RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, \n  ResponsiveContainer \n} from 'recharts';\n\n/* =========================================================\n   COLORS & COMPONENTS (Match Dashboard)\n========================================================= */\nconst COLORS = { \n  NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', \n  GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', \n  OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', \n  PURPLE: '#7C3AED', BG: '#F9FAFB' \n};\n\nconst Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => {\n    let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n    if (size === 'sm') baseStyle += ' px-4 py-2 text-sm'; \n    else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg'; \n    else baseStyle += ' px-6 py-3 text-base';\n    if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n    else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n    else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n    else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n    if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n    return (<button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>);\n};\n\nconst Card = ({ children, title, icon: Icon, className = '', accent = 'NAVY' }) => {\n    const accentColor = COLORS[accent] || COLORS.NAVY;\n    return (\n        <div className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-lg transition-all duration-300 text-left ${className}`} \n             style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: COLORS.SUBTLE, color: COLORS.NAVY }}>\n            <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n            {Icon && title && (\n                <div className=\"flex items-center gap-3 mb-4\">\n                    <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" \n                         style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}> \n                        <Icon className=\"w-5 h-5\" style={{ color: accentColor }} /> \n                    </div>\n                    <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2>\n                </div>\n            )}\n            {!Icon && title && <h2 className=\"text-xl font-extrabold mb-4 border-b pb-2\" style={{ color: COLORS.NAVY, borderColor: COLORS.SUBTLE }}>{title}</h2>}\n            <div>{children}</div>\n        </div>\n    );\n};\n\n/* =========================================================\n   18-MONTH JOURNEY MAP (from OLD Development Plan)\n========================================================= */\nconst JOURNEY_MAP = [\n  { cycle: 1, q: 'Q1 (0-3 mo)', phase: 'Foundation', performance: 'Feedback', people: 'Vulnerability-Based Trust', mindset: 'Player→Coach' },\n  { cycle: 2, q: 'Q2 (3-6 mo)', phase: 'Foundation', performance: 'Goals & Expectations', people: '1:1s', mindset: 'Ownership & Accountability' },\n  { cycle: 3, q: 'Q3 (6-9 mo)', phase: 'Performance', performance: 'Delegation', people: 'Coaching', mindset: 'Player→Coach (Deeper)' },\n  { cycle: 4, q: 'Q4 (9-12 mo)', phase: 'Performance', performance: 'Decision-Making / Meetings', people: 'Recognition & Motivation', mindset: 'Leadership Motive' },\n  { cycle: 5, q: 'Q5 (12-15 mo)', phase: 'Impact', performance: 'Accountability Systems', people: 'Team Health: Conflict & Commitment', mindset: 'Ownership (Revisited)' },\n  { cycle: 6, q: 'Q6 (15-18 mo)', phase: 'Impact', performance: 'Coaching Mastery', people: 'Recognition & Vulnerability Integration', mindset: 'Leadership Identity (Capstone)' },\n];\n\n/* =========================================================\n   DETAILED PLAN VIEW COMPONENT\n========================================================= */\nconst DetailedPlanView = ({ \n  developmentPlanData, \n  globalMetadata,\n  onNavigateToTracker,\n  onStartProgressScan,\n  onUpdatePlan \n}) => {\n  \n  const currentPlan = developmentPlanData?.currentPlan;\n  const currentCycle = developmentPlanData?.currentCycle || 1;\n  const latestAssessment = developmentPlanData?.assessmentHistory?.[developmentPlanData.assessmentHistory.length - 1];\n  \n  const journeyPhase = useMemo(() => \n    JOURNEY_MAP.find(j => j.cycle === currentCycle)?.phase || 'Foundation', \n    [currentCycle]\n  );\n\n  // Prepare data for Radar Chart\n  const radarData = useMemo(() => {\n    // FIXED: Use scores from assessmentHistory's latest item\n    const scores = latestAssessment?.assessmentScores || latestAssessment?.answers;\n\n    if (!scores) return [];\n    \n    return Object.entries(scores).map(([dimension, score]) => {\n        // Find the full category name from devPlanUtils.js context (Q_TO_CATEGORY or SKILL_CATEGORIES)\n        // Since we don't have devPlanUtils, we'll use simple mapping for display\n        const subjectMap = {\n            'STRATEGIC': 'Strategy',\n            'PEOPLE': 'People',\n            'EXECUTION': 'Execution',\n            'INFLUENCE': 'Influence',\n            'SELF': 'Self-Mgt',\n            // Fallback for Q IDs\n            'q1': 'Prio.', 'q2': 'Fdbk', 'q3': 'Dev.', 'q4': 'Comm.', 'q5': 'Time',\n            'q6': 'Rels.', 'q7': 'Decs.', 'q8': 'Trust', 'q9': 'Cnflict', 'q10': 'Recog.',\n        };\n        \n        const fullSubject = subjectMap[dimension] || dimension.split(' ').slice(0, 2).join(' ');\n        \n        // Ensure score is a number between 1 and 5\n        const numericScore = typeof score === 'string' ? parseInt(score, 10) : Number(score);\n\n        return {\n          subject: fullSubject,\n          score: isNaN(numericScore) ? 3 : Math.min(5, Math.max(1, numericScore)), // Clamp between 1-5\n          fullMark: 5\n        };\n    }).filter(d => d.subject.length > 0);\n  }, [latestAssessment]);\n\n\n  if (!currentPlan) {\n    return (\n      <div className=\"p-8 text-center\">\n        <p className=\"text-lg text-gray-600\">No development plan found.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen\" style={{ background: COLORS.BG }}>\n      <div className=\"container mx-auto px-4 py-6 max-w-7xl\">\n        \n        {/* Header Area */}\n        <div className=\"flex flex-col md:flex-row justify-between items-start gap-4 mb-6\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-3 mb-2\">\n              <Button onClick={onNavigateToTracker} variant=\"nav-back\" size=\"sm\">\n                <ArrowLeft className=\"w-4 h-4\" /> Back to Tracker\n              </Button>\n            </div>\n            <h1 className=\"text-3xl md:text-4xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>\n              Your Arena Development Plan\n            </h1>\n            <p className=\"text-lg text-gray-600\">\n              18-month leadership journey | Current: <strong>Cycle {currentCycle} ({journeyPhase} Phase)</strong>\n            </p>\n          </div>\n          \n          {/* Progress Scan Button */}\n          <Button onClick={onStartProgressScan} variant=\"secondary\" size=\"md\">\n            <Target className=\"w-5 h-5\" /> Start Next 90-Day Scan\n          </Button>\n        </div>\n\n        {/* FIX #4: 18-Month Journey Map Card (RESTORED from OLD version) */}\n        <Card title=\"Your 18-Month Leadership Journey\" icon={Calendar} accent=\"NAVY\">\n          <p className=\"text-sm text-gray-600 mb-4\">\n            Your complete development path across 6 quarters. Each cycle builds on the previous.\n          </p>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3\">\n            {JOURNEY_MAP.map(item => (\n              <div \n                key={item.cycle}\n                className={`p-3 rounded-lg border-2 transition-all duration-300 ${\n                  item.cycle === currentCycle \n                    ? 'bg-[#47A88D]/10 border-[#47A88D] shadow-lg scale-105' \n                    : 'bg-gray-50 border-gray-200'\n                } ${item.cycle < currentCycle ? 'opacity-60' : ''}`}\n              >\n                {/* Phase Badge */}\n                <span \n                  className={`text-[10px] font-bold px-2 py-0.5 rounded`}\n                  style={{\n                    backgroundColor: item.phase === 'Foundation' ? `${COLORS.BLUE}20` : \n                                    item.phase === 'Performance' ? `${COLORS.TEAL}20` : `${COLORS.ORANGE}20`,\n                    color: item.phase === 'Foundation' ? COLORS.BLUE : \n                          item.phase === 'Performance' ? COLORS.TEAL : COLORS.ORANGE\n                  }}\n                >\n                  {item.phase}\n                </span>\n                \n                {/* Cycle Title */}\n                <h4 className=\"font-bold text-xs mt-2 mb-1\" style={{ color: COLORS.NAVY }}>\n                  {item.q}\n                </h4>\n                \n                {/* Focus Areas */}\n                <ul className=\"text-[10px] text-gray-600 space-y-0.5\">\n                  <li><strong>Perf:</strong> {item.performance}</li>\n                  <li><strong>People:</strong> {item.people}</li>\n                  <li><strong>Mindset:</strong> {item.mindset}</li>\n                </ul>\n                \n                {/* Current Cycle Indicator */}\n                {item.cycle === currentCycle && (\n                  <span className=\"block text-center text-[10px] font-bold mt-1\" \n                        style={{ color: COLORS.TEAL }}>\n                    ← YOU ARE HERE\n                  </span>\n                )}\n                \n                {/* Completed Indicator */}\n                {item.cycle < currentCycle && (\n                  <div className=\"flex justify-center mt-1\">\n                    <CheckCircle className=\"w-3 h-3\" style={{ color: COLORS.GREEN }} />\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </Card>\n\n        {/* Assessment Snapshot & Focus Plan Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6\">\n          \n          {/* Left Column: Radar Chart (RESTORED from OLD version) */}\n          <div className=\"lg:col-span-1\">\n            <Card title=\"Leadership Profile Snapshot\" icon={BarChart3} accent=\"TEAL\">\n              <p className=\"text-sm text-gray-600 mb-4\">\n                {latestAssessment \n                  ? `Latest assessment scores (as of ${new Date(latestAssessment.date).toLocaleDateString()})`\n                  : 'Complete an assessment to see your profile'\n                }\n              </p>\n              \n              {radarData.length > 0 ? (\n                <div style={{ width: '100%', height: 300 }}>\n                  <ResponsiveContainer>\n                    <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"80%\" data={radarData}>\n                      <PolarGrid stroke={COLORS.SUBTLE} />\n                      <PolarAngleAxis \n                        dataKey=\"subject\" \n                        tick={{ fontSize: 9, fill: COLORS.MUTED }} \n                      />\n                      <PolarRadiusAxis \n                        angle={30} \n                        domain={[0, 5]} \n                        tick={{ fontSize: 10, fill: COLORS.MUTED }} \n                      />\n                      <Radar \n                        name=\"Your Scores\" \n                        dataKey=\"score\" \n                        stroke={COLORS.TEAL} \n                        fill={COLORS.TEAL} \n                        fillOpacity={0.6} \n                      />\n                    </RadarChart>\n                  </ResponsiveContainer>\n                </div>\n              ) : (\n                <div className=\"text-center py-12 text-gray-500\">\n                  <BarChart3 className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                  <p className=\"text-sm\">Complete assessment to view profile</p>\n                </div>\n              )}\n            </Card>\n          </div>\n\n          {/* Right Column: 90-Day Focus Plan (RESTORED from OLD version) */}\n          <div className=\"lg:col-span-2\">\n            <Card title=\"Your Current 90-Day Focus Plan\" icon={Target} accent=\"ORANGE\">\n              <p className=\"text-sm text-gray-600 mb-6\">\n                Based on your {currentPlan.type === 'Standard Foundation' ? 'standard foundation' : 'latest assessment'}, \n                focus on these <strong>Top {currentPlan.focusAreas?.length || 0} Growth Areas</strong> for this cycle.\n              </p>\n              \n              {/* Focus Areas List */}\n              <div className=\"space-y-6\">\n                {currentPlan.focusAreas?.map((area, index) => (\n                  <div key={index} \n                       className=\"flex flex-col sm:flex-row gap-4 border-b pb-6 last:border-b-0\" \n                       style={{ borderColor: COLORS.SUBTLE }}>\n                    \n                    {/* Number Badge */}\n                    <div className={`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center text-white text-xl font-bold mb-2 sm:mb-0`} \n                         style={{ background: COLORS.ORANGE }}>\n                      {index + 1}\n                    </div>\n                    \n                    {/* Area Details */}\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                        {area.name}\n                        {area.score !== 'N/A' && (\n                          <span className=\"text-sm font-normal text-gray-500\"> (Score: {area.score})</span>\n                        )}\n                      </h3>\n                      \n                      {/* FIX #3: WHY it Matters & What Good Looks Like */}\n                      <div className=\"mt-2 space-y-2\">\n                        <div className=\"p-2 rounded\" style={{ backgroundColor: `${COLORS.BLUE}05` }}>\n                          <p className=\"text-xs font-semibold\" style={{ color: COLORS.BLUE }}>\n                            💡 WHY IT MATTERS:\n                          </p>\n                          <p className=\"text-sm italic text-gray-600 mt-1\">{area.why}</p>\n                        </div>\n                        \n                        <div className=\"p-2 rounded\" style={{ backgroundColor: `${COLORS.TEAL}05` }}>\n                          <p className=\"text-xs font-semibold\" style={{ color: COLORS.TEAL }}>\n                            🎯 WHAT GREAT LOOKS LIKE:\n                          </p>\n                          <p className=\"text-sm text-gray-600 mt-1\">{area.whatGoodLooksLike}</p>\n                        </div>\n                      </div>\n                      \n                      {/* Training Plan / Courses */}\n                      <h5 className=\"text-sm font-bold mt-3 mb-2\" style={{ color: COLORS.NAVY }}>\n                        Related Training:\n                      </h5>\n                      <ul className=\"list-disc list-inside text-sm text-gray-700 space-y-1\">\n                        {area.courses?.map((course, idx) => (\n                          <li key={idx}>Arena Course: <strong>{course}</strong></li>\n                        ))}\n                        <li className=\"font-semibold\" style={{ color: COLORS.TEAL }}>\n                          <CheckCircle className=\"w-4 h-4 inline-block mr-1\" />\n                          Core reps added to Daily Practice\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* 80/20 Model Note (if applicable) */}\n                {currentPlan.type === 'Personalized' && (\n                  <p className=\"text-xs text-gray-500 mt-4 bg-gray-100 p-3 rounded-lg border flex items-start gap-2\">\n                    <Lightbulb className=\"w-4 h-4 inline-block mr-1 text-blue-500 flex-shrink-0 mt-0.5\" />\n                    <span>\n                      <strong>80/20 Plan:</strong> Includes standard areas for Cycle {currentCycle} from \n                      the 18-month map, plus one personalized area based on your lowest score.\n                    </span>\n                  </p>\n                )}\n              </div>\n              \n              {/* Button to Daily Practice */}\n              <Button \n                onClick={() => window.location.href = '#'} \n                variant=\"primary\" \n                size=\"md\" \n                className=\"mt-6 w-full\"\n              >\n                <Zap className=\"w-5 h-5\" /> Go to Daily Practice\n              </Button>\n            </Card>\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex gap-4 mt-6\">\n          <Button \n            onClick={onNavigateToTracker} \n            variant=\"outline\" \n            size=\"md\"\n            className=\"flex-1\"\n          >\n            View Rep Tracker\n          </Button>\n          <Button \n            onClick={onStartProgressScan} \n            variant=\"primary\" \n            size=\"md\"\n            className=\"flex-1\"\n          >\n            <Target className=\"w-5 h-5\" /> Start 90-Day Progress Scan\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DetailedPlanView;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/DevPlanComponents.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":16,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":16,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'Icon' is defined but never used.","line":160,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":160,"endColumn":52},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'steps.length'. Either include it or remove the dependency array.","line":242,"column":6,"nodeType":"ArrayExpression","endLine":242,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [steps.length]","fix":{"range":[9812,9814],"text":"[steps.length]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Icon' is defined but never used.","line":355,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":355,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'Icon' is defined but never used.","line":377,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":377,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/developmentplan/DevPlanComponents.jsx\n// Reconstructed component library for the Development Plan screen.\n// ADDED: LikertScaleInput component for the new single-page assessment.\n\nimport React from 'react';\nimport { \n  CheckCircle, ArrowRight, Loader, \n  TrendingUp, Target, Award, Clock, BarChart3, \n  Edit, RefreshCw, Calendar, Save, X, Plus, Trash2 \n} from 'lucide-react';\n\n/* =========================================================\n   COLORS\n   (Shared with DashboardComponents)\n========================================================= */\nexport const COLORS = { \n  NAVY: '#002E47', TEAL: '#47A88D', BLUE: '#2563EB', ORANGE: '#E04E1B', \n  GREEN: '#10B981', AMBER: '#F5A800', RED: '#E04E1B', LIGHT_GRAY: '#FCFCFA', \n  OFF_WHITE: '#FFFFFF', SUBTLE: '#E5E7EB', TEXT: '#374151', MUTED: '#4B5563', \n  PURPLE: '#7C3AED', BG: '#F9FAFB' \n};\n\n/* =========================================================\n   Standardized Button Component\n   (Shared with DashboardComponents)\n========================================================= */\nexport const Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', size = 'md', ...rest }) => {\n  let baseStyle = `inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 disabled:opacity-50 disabled:cursor-not-allowed`;\n\n  if (size === 'sm') baseStyle += ' px-4 py-2 text-sm';\n  else if (size === 'lg') baseStyle += ' px-8 py-4 text-lg';\n  else baseStyle += ' px-6 py-3 text-base';\n\n  if (variant === 'primary') baseStyle += ` bg-[${COLORS.TEAL}] text-white shadow-lg hover:bg-[#349881] focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'secondary') baseStyle += ` bg-[${COLORS.ORANGE}] text-white shadow-lg hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50`;\n  else if (variant === 'outline') baseStyle += ` bg-[${COLORS.OFF_WHITE}] text-[${COLORS.TEAL}] border-2 border-[${COLORS.TEAL}] shadow-md hover:bg-[${COLORS.TEAL}]/10 focus:ring-[${COLORS.TEAL}]/50`;\n  else if (variant === 'nav-back') baseStyle += ` bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-100 focus:ring-gray-300/50 px-4 py-2 text-sm`;\n  else if (variant === 'ghost') baseStyle += ` bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-gray-300/50 px-3 py-1.5 text-sm`;\n\n  if (disabled) baseStyle += ' bg-gray-300 text-gray-500 shadow-inner border-transparent hover:bg-gray-300';\n\n  return <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>{children}</button>;\n};\n\n/* =========================================================\n   Standardized Card Component\n   (Shared with DashboardComponents)\n========================================================= */\nexport const Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'NAVY', actions }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n  const handleKeyDown = (e) => { if (interactive && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); onClick?.(); } };\n\n  return (\n    <Tag\n      {...(interactive ? { type: 'button' } : {})}\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={handleKeyDown}\n      className={`relative rounded-2xl border-2 shadow-xl transition-all duration-300 text-left ${className}`}\n      style={{\n          background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)',\n          borderColor: COLORS.SUBTLE,\n          color: COLORS.NAVY\n      }}\n      onClick={onClick}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n      \n      {(title || actions) && (\n        <div className=\"flex items-center justify-between p-6 pb-4\">\n          <div className=\"flex items-center gap-3\">\n            {Icon && (\n              <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border flex-shrink-0\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n                  <Icon className=\"w-5 h-5\" style={{ color: accentColor }} />\n              </div>\n            )}\n            {title && (\n              <h2 className=\"text-xl font-extrabold\" style={{ color: COLORS.NAVY }}>{title}</h2>\n            )}\n          </div>\n          {actions && (\n            <div className=\"flex-shrink-0\">{actions}</div>\n          )}\n        </div>\n      )}\n      \n      <div className={title || actions ? \"p-6 pt-0\" : \"p-6\"}>\n        {children}\n      </div>\n    </Tag>\n  );\n};\n\n/* =========================================================\n   ProgressBar Component\n   (Used in BaselineAssessment, ProgressScan, QuickPlanEditor)\n========================================================= */\nexport const ProgressBar = ({ progress = 0, color, height = 8, showLabel = false }) => {\n  const progressPercent = Math.max(0, Math.min(100, progress));\n  const barColor = color || COLORS.TEAL;\n  \n  return (\n    <div className=\"relative w-full\" style={{ height: `${height}px` }}>\n      <div \n        className=\"w-full h-full rounded-full\"\n        style={{ backgroundColor: COLORS.SUBTLE }}\n      >\n        <div \n          className=\"h-full rounded-full transition-all duration-500\"\n          style={{ \n            width: `${progressPercent}%`, \n            backgroundColor: barColor \n          }}\n        />\n      </div>\n      {showLabel && (\n        <span \n          className=\"absolute right-0 -top-5 text-xs font-semibold\"\n          style={{ color: barColor }}\n        >\n          {Math.round(progressPercent)}%\n        </span>\n      )}\n    </div>\n  );\n};\n\n/* =========================================================\n   Badge Component\n   (Used in ProgressBreakdown, ProgressScan, QuickPlanEditor)\n========================================================= */\nexport const Badge = ({ children, variant = 'default', size = 'md' }) => {\n  let baseStyle = 'font-semibold rounded-full inline-block';\n\n  // Size\n  if (size === 'sm') baseStyle += ' px-2.5 py-0.5 text-xs';\n  else if (size == 'lg') baseStyle += ' px-3.5 py-1.5 text-sm';\n  else baseStyle += ' px-3 py-1 text-sm';\n  \n  // Variant\n  if (variant === 'primary') baseStyle += ` bg-[${COLORS.BLUE}20] text-[${COLORS.BLUE}]`;\n  else if (variant === 'success') baseStyle += ` bg-[${COLORS.GREEN}20] text-[${COLORS.GREEN}]`;\n  else if (variant === 'warning') baseStyle += ` bg-[${COLORS.AMBER}20] text-[${COLORS.AMBER}]`;\n  else if (variant === 'purple') baseStyle += ` bg-[${COLORS.PURPLE}20] text-[${COLORS.PURPLE}]`;\n  else baseStyle += ` bg-[${COLORS.SUBTLE}] text-[${COLORS.MUTED}]`;\n  \n  return (\n    <span className={baseStyle}>\n      {children}\n    </span>\n  );\n};\n\n/* =========================================================\n   StatCard Component\n   (Used in ProgressBreakdown, PlanTracker)\n========================================================= */\nexport const StatCard = ({ label, value, icon: Icon, color, trend }) => {\n  const accentColor = color || COLORS.TEAL;\n\n  return (\n    <div \n      className=\"p-4 rounded-xl border-2\"\n      style={{ borderColor: COLORS.SUBTLE, background: 'white' }}\n    >\n      <div className=\"flex items-center gap-3 mb-3\">\n        <div \n          className=\"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0\"\n          style={{ backgroundColor: `${accentColor}20` }}\n        >\n          <Icon className=\"w-5 h-5\" style={{ color: accentColor }} />\n        </div>\n        <div>\n          <p className=\"text-xs font-semibold\" style={{ color: COLORS.MUTED }}>\n            {label}\n          </p>\n        </div>\n      </div>\n      <p className=\"text-3xl font-extrabold\" style={{ color: COLORS.NAVY }}>\n        {value}\n      </p>\n      {trend && (\n        <p className=\"text-xs mt-1\" style={{ color: COLORS.MUTED }}>\n          {trend}\n        </p>\n      )}\n    </div>\n  );\n};\n\n/* =========================================================\n   LoadingSpinner Component\n   (Used in DevelopmentPlan)\n========================================================= */\nexport const LoadingSpinner = ({ message }) => (\n  <div className=\"flex items-center justify-center min-h-[50vh]\">\n    <div className=\"text-center\">\n      <div \n        className=\"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4\" \n        style={{ borderColor: COLORS.TEAL }} \n      />\n      <p style={{ color: COLORS.TEXT }}>\n        {message || 'Loading...'}\n      </p>\n    </div>\n  </div>\n);\n\n/* =========================================================\n   PlanGenerationLoader Component - COOL ANIMATION!\n   (Used in BaselineAssessment and ProgressScan during plan generation)\n========================================================= */\nexport const PlanGenerationLoader = ({ message = 'Crafting Your Development Plan' }) => {\n  const [dots, setDots] = React.useState('');\n  const [currentStep, setCurrentStep] = React.useState(0);\n  \n  const steps = [\n    { icon: '🎯', text: 'Analyzing your assessment', color: COLORS.TEAL },\n    { icon: '🧠', text: 'Identifying growth areas', color: COLORS.BLUE },\n    { icon: '💡', text: 'Mapping practice reps', color: COLORS.ORANGE },\n    { icon: '📅', text: 'Structuring your 90-day plan', color: COLORS.GREEN },\n    { icon: '✨', text: 'Finalizing recommendations', color: COLORS.PURPLE }\n  ];\n  \n  React.useEffect(() => {\n    // Animate dots\n    const dotsInterval = setInterval(() => {\n      setDots(prev => prev.length >= 3 ? '' : prev + '.');\n    }, 500);\n    \n    // Cycle through steps\n    const stepInterval = setInterval(() => {\n      setCurrentStep(prev => (prev + 1) % steps.length);\n    }, 1600);\n    \n    return () => {\n      clearInterval(dotsInterval);\n      clearInterval(stepInterval);\n    };\n  }, []);\n  \n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\" \n         style={{ background: 'rgba(0, 0, 0, 0.75)' }}>\n      <div className=\"relative\">\n        {/* Animated Background Circles */}\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div \n            className=\"absolute w-64 h-64 rounded-full animate-pulse\"\n            style={{ \n              background: `radial-gradient(circle, ${COLORS.TEAL}20 0%, transparent 70%)`,\n              animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'\n            }}\n          />\n          <div \n            className=\"absolute w-48 h-48 rounded-full animate-ping\"\n            style={{ \n              background: `radial-gradient(circle, ${COLORS.ORANGE}15 0%, transparent 70%)`,\n              animation: 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite'\n            }}\n          />\n        </div>\n        \n        {/* Main Content Card */}\n        <div \n          className=\"relative bg-white rounded-3xl shadow-2xl p-12 max-w-md mx-4\"\n          style={{ \n            border: `3px solid ${COLORS.TEAL}40`,\n            animation: 'fadeIn 0.3s ease-out'\n          }}\n        >\n          {/* Spinning Icon */}\n          <div className=\"flex justify-center mb-6\">\n            <div \n              className=\"w-20 h-20 rounded-full flex items-center justify-center text-4xl\"\n              style={{ \n                background: `linear-gradient(135deg, ${COLORS.TEAL}20, ${COLORS.BLUE}20)`,\n                animation: 'spin 3s linear infinite'\n              }}\n            >\n              {steps[currentStep].icon}\n            </div>\n          </div>\n          \n          {/* Main Message */}\n          <h3 \n            className=\"text-2xl font-extrabold text-center mb-2\"\n            style={{ color: COLORS.NAVY }}\n          >\n            {message}{dots}\n          </h3>\n          \n          {/* Current Step */}\n          <div className=\"mt-6 p-4 rounded-xl transition-all duration-500\"\n               style={{ \n                 background: `${steps[currentStep].color}10`,\n                 border: `2px solid ${steps[currentStep].color}30`\n               }}>\n            <div className=\"flex items-center gap-3\">\n              <div \n                className=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-lg\"\n                style={{ background: `${steps[currentStep].color}20` }}\n              >\n                {steps[currentStep].icon}\n              </div>\n              <p className=\"text-sm font-semibold\" style={{ color: steps[currentStep].color }}>\n                {steps[currentStep].text}\n              </p>\n            </div>\n          </div>\n          \n          {/* Progress Indicators */}\n          <div className=\"flex justify-center gap-2 mt-6\">\n            {steps.map((_, index) => (\n              <div\n                key={index}\n                className=\"transition-all duration-300\"\n                style={{\n                  width: index === currentStep ? '32px' : '8px',\n                  height: '8px',\n                  borderRadius: '4px',\n                  background: index === currentStep ? COLORS.TEAL : `${COLORS.SUBTLE}`\n                }}\n              />\n            ))}\n          </div>\n          \n          {/* Encouraging Message */}\n          <p className=\"text-center text-xs mt-6\" style={{ color: COLORS.MUTED }}>\n            This usually takes 5-8 seconds...\n          </p>\n        </div>\n      </div>\n      \n      <style>{`\n        @keyframes fadeIn {\n          from { opacity: 0; transform: scale(0.95); }\n          to { opacity: 1; transform: scale(1); }\n        }\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n/* =========================================================\n   EmptyState Component\n   (Used in PlanTracker)\n========================================================= */\nexport const EmptyState = ({ icon: Icon, title, description, action }) => (\n  <div className=\"text-center p-12 my-12 border-2 border-dashed rounded-2xl\" style={{ borderColor: COLORS.SUBTLE, backgroundColor: COLORS.LIGHT_GRAY }}>\n    <Icon \n      className=\"w-12 h-12 mx-auto mb-4\" \n      style={{ color: COLORS.MUTED }} \n    />\n    <h3 className=\"text-xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n      {title}\n    </h3>\n    <p className=\"text-sm mb-6 max-w-sm mx-auto\" style={{ color: COLORS.TEXT }}>\n      {description}\n    </p>\n    {action && (\n      <div>{action}</div>\n    )}\n  </div>\n);\n\n/* =========================================================\n   SectionHeader Component\n   (Used in PlanTracker)\n========================================================= */\nexport const SectionHeader = ({ title, icon: Icon, accent = 'NAVY' }) => {\n  const accentColor = COLORS[accent] || COLORS.NAVY;\n  \n  return (\n    <div className=\"flex items-center gap-3 mb-4 pb-3 border-b-2\" style={{ borderColor: COLORS.SUBTLE }}>\n      <Icon className=\"w-6 h-6\" style={{ color: accentColor }} />\n      <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n        {title}\n      </h2>\n    </div>\n  );\n};\n\n/* =========================================================\n   LikertScaleInput Component (NEW)\n   (Replaces the old full-width button layout in assessments)\n========================================================= */\nexport const LikertScaleInput = ({ question, options, value, onChange }) => {\n  return (\n    <div \n      className=\"p-6 rounded-2xl border-2\" \n      style={{ \n        borderColor: value ? COLORS.TEAL : COLORS.SUBTLE, \n        backgroundColor: value ? `${COLORS.TEAL}05` : COLORS.OFF_WHITE,\n        transition: 'border-color 0.3s'\n      }}\n    >\n      <p className=\"text-base font-semibold mb-4\" style={{ color: COLORS.NAVY }}>\n        {question.text}\n      </p>\n      <div \n        className=\"flex flex-col sm:flex-row rounded-lg overflow-hidden border\" \n        style={{ borderColor: COLORS.SUBTLE }}\n      >\n        {options.map((option, index) => (\n          <button\n            key={option.value}\n            onClick={() => onChange(question.id, option.value)}\n            className={`flex-1 p-3 text-center text-sm font-medium transition-all ${\n              value === option.value\n                ? '' // Active state is handled by style\n                : 'hover:bg-gray-100'\n            }`}\n            style={{ \n              backgroundColor: value === option.value ? COLORS.TEAL : COLORS.OFF_WHITE,\n              color: value === option.value ? 'white' : COLORS.TEXT,\n              borderRight: index < options.length - 1 ? `1px solid ${COLORS.SUBTLE}` : 'none',\n              borderBottom: `1px solid ${COLORS.SUBTLE}`,\n            }}\n          >\n            {option.label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/MilestoneTimeline.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isFuture' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":73,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/developmentplan/MilestoneTimeline.jsx\n// Visual timeline showing progress through the 12-week development cycle\n\nimport React from 'react';\n// REQ #5: Import Button and ArrowLeft\nimport { CheckCircle, Circle, Flag, Calendar, ArrowLeft } from 'lucide-react';\nimport { Card, Badge, Button } from './DevPlanComponents';\nimport { MILESTONE_CONFIG, getCurrentWeek, getCurrentPhase, COLORS } from './devPlanUtils';\n\nconst MilestoneTimeline = ({ plan, onBack }) => {\n  const currentWeek = getCurrentWeek(plan);\n  const currentPhase = getCurrentPhase(currentWeek);\n  \n  return (\n    // REQ #5: Improved wrapper div for better layout - FULL WIDTH\n    <div className=\"w-full mx-auto p-4 sm:p-6 space-y-6\" style={{ maxWidth: '1400px' }}>\n      \n      {/* REQ #5: Added Back Button */}\n      <div className=\"mb-0\">\n        <Button onClick={onBack} variant=\"nav-back\" size=\"sm\">\n          <ArrowLeft className=\"w-4 h-4\" /> Back to Tracker\n        </Button>\n      </div>\n\n      <Card title=\"12-Week Journey\" icon={Calendar} accent=\"PURPLE\">\n        {/* Phase Overview */}\n        <div className=\"mb-8 p-6 rounded-xl\" style={{ background: `${currentPhase.color}10` }}>\n          <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-2\">\n            <div>\n              <Badge variant=\"purple\" size=\"lg\">Week {currentWeek} of 12</Badge>\n              <h4 className=\"text-2xl font-bold mt-3\" style={{ color: COLORS.NAVY }}>\n                {currentPhase.name} Phase\n              </h4>\n              <p className=\"text-base text-gray-600 mt-1\">{currentPhase.description}</p>\n            </div>\n            <div className=\"text-center md:text-right\">\n              <p className=\"text-5xl font-bold\" style={{ color: currentPhase.color }}>\n                {Math.round((currentWeek / 12) * 100)}%\n              </p>\n              <p className=\"text-sm text-gray-600 mt-1\">Complete</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Timeline - IMPROVED LAYOUT */}\n        <div className=\"space-y-8\">\n          {MILESTONE_CONFIG.phases.map((phase, phaseIdx) => (\n            <div key={phase.name} className=\"relative\">\n              {/* Phase Header - IMPROVED */}\n              <div className=\"flex items-center gap-4 mb-4\">\n                <div \n                  className=\"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg\"\n                  style={{ background: phase.color }}\n                >\n                  {phaseIdx + 1}\n                </div>\n                <div>\n                  <h5 className=\"font-bold text-lg\" style={{ color: COLORS.NAVY }}>\n                    {phase.name}\n                  </h5>\n                  <p className=\"text-sm text-gray-600\">\n                    Weeks {phase.weeks[0]}-{phase.weeks[phase.weeks.length - 1]}\n                  </p>\n                </div>\n              </div>\n\n              {/* Week Markers - IMPROVED GRID */}\n              <div className=\"ml-6 pl-6 border-l-2\" style={{ borderColor: COLORS.SUBTLE }}>\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n                  {phase.weeks.map(weekNum => {\n                    const isPast = weekNum < currentWeek;\n                    const isCurrent = weekNum === currentWeek;\n                    const isFuture = weekNum > currentWeek;\n                    \n                    return (\n                      <div \n                        key={weekNum}\n                        className={`p-3 rounded-xl border-2 transition-all ${\n                          isCurrent ? 'ring-2 shadow-lg' : 'shadow-sm'\n                        }`}\n                        style={{\n                          borderColor: isPast || isCurrent ? phase.color : COLORS.SUBTLE,\n                          background: isPast ? `${phase.color}10` : isCurrent ? `${phase.color}20` : 'white',\n                          ringColor: isCurrent ? phase.color : 'transparent',\n                        }}\n                      >\n                        <div className=\"flex items-center justify-center gap-2\">\n                          {isPast ? (\n                            <CheckCircle className=\"w-5 h-5\" style={{ color: phase.color }} />\n                          ) : isCurrent ? (\n                            <Flag className=\"w-5 h-5\" style={{ color: phase.color }} />\n                          ) : (\n                            <Circle className=\"w-5 h-5 text-gray-400\" />\n                          )}\n                          <span \n                            className={`text-sm font-bold ${\n                              isPast || isCurrent ? '' : 'text-gray-400'\n                            }`}\n                            style={{ color: isPast || isCurrent ? phase.color : undefined }}\n                          >\n                            Week {weekNum}\n                          </span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Key Milestones - IMPROVED LAYOUT */}\n        <div className=\"mt-8 p-6 rounded-xl border-2 shadow-sm\" style={{ borderColor: COLORS.SUBTLE, background: COLORS.LIGHT_GRAY }}>\n          <h5 className=\"font-bold text-lg mb-4\" style={{ color: COLORS.NAVY }}>\n            🎯 Key Milestones\n          </h5>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <MilestoneItem \n              week={2}\n              label=\"Foundation Set\"\n              completed={currentWeek >= 2}\n              description=\"Initial habits established\"\n            />\n            <MilestoneItem \n              week={6}\n              label=\"Practice Groove\"\n              completed={currentWeek >= 6}\n              description=\"Consistent daily application\"\n            />\n            <MilestoneItem \n              week={8}\n              label=\"Integration Point\"\n              completed={currentWeek >= 8}\n              description=\"Skills becoming natural\"\n            />\n            <MilestoneItem \n              week={11}\n              label=\"Mastery Level\"\n              completed={currentWeek >= 11}\n              description=\"Unconscious competence achieved\"\n            />\n            <MilestoneItem \n              week={12}\n              label=\"Progress Scan\"\n              completed={currentWeek >= 12}\n              description=\"Reassess and plan next cycle\"\n            />\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\n// Helper component for milestone items - IMPROVED\nconst MilestoneItem = ({ week, label, completed, description }) => {\n  return (\n    <div className=\"flex items-start gap-3 p-3 rounded-lg bg-white shadow-sm\">\n      <div \n        className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${\n          completed ? 'bg-green-100' : 'bg-gray-100'\n        }`}\n      >\n        {completed ? (\n          <CheckCircle className=\"w-5 h-5 text-green-600\" />\n        ) : (\n          <Circle className=\"w-5 h-5 text-gray-400\" />\n        )}\n      </div>\n      <div className=\"flex-1\">\n        <div className=\"flex items-center gap-2 mb-1\">\n          <span className=\"text-sm font-bold\" style={{ color: COLORS.NAVY }}>\n            Week {week}:\n          </span>\n          <span className={`text-sm font-bold ${completed ? 'text-green-600' : 'text-gray-500'}`}>\n            {label}\n          </span>\n        </div>\n        <p className=\"text-xs text-gray-600\">{description}</p>\n      </div>\n    </div>\n  );\n};\n\nexport default MilestoneTimeline;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/PlanTracker.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'skillCatalog' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/developmentplan/PlanTracker.jsx  \n// Main view of current development plan with action buttons\n// FIXED: Added logging, works with adapted plan structure\n\nimport React, { useState } from 'react';\nimport { Target, TrendingUp, Calendar, Edit, ArrowLeft } from 'lucide-react'; // REQ #4: Added ArrowLeft\nimport { Button, Card, ProgressBar } from './DevPlanComponents';\nimport { COLORS, generatePlanSummary } from './devPlanUtils';\nimport ProgressBreakdown from './ProgressBreakdown';\nimport QuickPlanEditor from './QuickPlanEditor';\n\nconst PlanTracker = ({ \n  plan, \n  cycle = 1, \n  globalMetadata, \n  skillCatalog = [],\n  onEditPlan,\n  onScan,\n  onDetail,\n  onTimeline \n}) => {\n  const [showBreakdown, setShowBreakdown] = useState(false);\n  const [showEditor, setShowEditor] = useState(false);\n\n  if (!plan) {\n    return (\n      <div className=\"max-w-3xl mx-auto p-6\">\n        <Card accent=\"TEAL\">\n          <p className=\"text-gray-600\">No plan available. Complete your baseline assessment to get started.</p>\n        </Card>\n      </div>\n    );\n  }\n\n  // Generate summary with logging\n  const summary = generatePlanSummary(plan);\n  console.log('[PlanTracker] Plan summary:', {\n    hasCoreReps: !!plan?.coreReps,\n    coreRepsCount: plan?.coreReps?.length,\n    progress: summary.progress,\n    cycle\n  });\n\n  const handleSaveEdit = async (updatedPlan) => {\n    if (onEditPlan) {\n      const success = await onEditPlan(updatedPlan);\n      if (success) {\n        setShowEditor(false);\n      }\n    }\n  };\n\n  if (showEditor) {\n    return (\n      <QuickPlanEditor\n        plan={plan}\n        onSave={handleSaveEdit}\n        onCancel={() => setShowEditor(false)}\n      />\n    );\n  }\n\n  if (showBreakdown) {\n    return (\n      <div>\n        <div className=\"max-w-4xl mx-auto p-6 mb-0\">\n          {/* REQ #4: Changed button text from \"Back to Overview\" to \"Back to Tracker\" */}\n          <Button onClick={() => setShowBreakdown(false)} variant=\"nav-back\" size=\"sm\">\n            <ArrowLeft className=\"w-4 h-4\" />\n            Back to Tracker\n          </Button>\n        </div>\n        <ProgressBreakdown plan={plan} globalMetadata={globalMetadata} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <Card accent=\"TEAL\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n              Development Plan\n            </h1>\n            <p className=\"text-gray-600\">\n              Cycle {cycle} • {summary.totalSkills} skills • {summary.progress}% complete\n            </p>\n          </div>\n          <Button\n            onClick={() => setShowEditor(true)}\n            variant=\"secondary\"\n            className=\"flex items-center gap-2\"\n          >\n            <Edit size={16} />\n            Quick Edit\n          </Button>\n        </div>\n\n        <ProgressBar progress={summary.progress} color={COLORS.TEAL} />\n      </Card>\n\n      {/* Quick Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card accent=\"BLUE\">\n          <div className=\"flex items-center gap-3\">\n            <Target size={32} style={{ color: COLORS.BLUE }} />\n            <div>\n              <div className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                {summary.totalSkills}\n              </div>\n              <div className=\"text-sm text-gray-600\">Total Skills</div>\n            </div>\n          </div>\n        </Card>\n\n        <Card accent=\"GREEN\">\n          <div className=\"flex items-center gap-3\">\n            <TrendingUp size={32} style={{ color: COLORS.GREEN }} />\n            <div>\n              <div className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                {summary.completedSkills}\n              </div>\n              <div className=\"text-sm text-gray-600\">Completed</div>\n            </div>\n          </div>\n        </Card>\n\n        <Card accent=\"ORANGE\">\n          <div className=\"flex items-center gap-3\">\n            <Calendar size={32} style={{ color: COLORS.ORANGE }} />\n            <div>\n              <div className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n                {summary.currentWeek || 0}\n              </div>\n              <div className=\"text-sm text-gray-600\">Current Week</div>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Actions */}\n      <Card accent=\"TEAL\">\n        <h2 className=\"font-bold mb-4\" style={{ color: COLORS.NAVY }}>\n          Actions\n        </h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n          <Button\n            onClick={() => setShowBreakdown(true)}\n            variant=\"primary\"\n            className=\"flex items-center justify-center gap-2\"\n          >\n            <Target size={16} />\n            View Progress Breakdown\n          </Button>\n          \n          {onScan && (\n            <Button\n              onClick={onScan}\n              variant=\"primary\"\n              className=\"flex items-center justify-center gap-2\"\n            >\n              <TrendingUp size={16} />\n              Start Progress Scan\n            </Button>\n          )}\n          \n          {onTimeline && (\n            <Button\n              onClick={onTimeline}\n              variant=\"secondary\"\n              className=\"flex items-center justify-center gap-2\"\n            >\n              <Calendar size={16} />\n              View Timeline\n            </Button>\n          )}\n          \n          {onDetail && (\n            <Button\n              onClick={onDetail}\n              variant=\"secondary\"\n              className=\"flex items-center justify-center gap-2\"\n            >\n              View Detailed Plan\n            </Button>\n          )}\n        </div>\n      </Card>\n\n      {/* Focus Areas Summary */}\n      {plan.focusAreas && (\n        <Card accent=\"PURPLE\">\n          <h2 className=\"font-bold mb-4\" style={{ color: COLORS.NAVY }}>\n            Focus Areas\n          </h2>\n          <div className=\"space-y-3\">\n            {plan.focusAreas.map((area, index) => (\n              <div key={index} className=\"p-4 bg-gray-50 rounded-lg\">\n                <h3 className=\"font-semibold mb-2\" style={{ color: COLORS.NAVY }}>\n                  {area.name}\n                </h3>\n                <p className=\"text-sm text-gray-600 mb-2\">\n                  {area.why}\n                </p>\n                <div className=\"text-xs text-gray-500\">\n                  {area.reps?.length || 0} practice reps • {area.courses?.length || 0} courses\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Open-Ended Goal */}\n      {plan.openEndedAnswer && (\n        <Card accent=\"GOLD\">\n          <h3 className=\"font-bold mb-2\" style={{ color: COLORS.NAVY }}>\n            Your Goal\n          </h3>\n          <p className=\"text-gray-700\">{plan.openEndedAnswer}</p>\n        </Card>\n      )}\n    </div>\n  );\n};\n\nexport default PlanTracker;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/ProgressBreakdown.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'skillCatalog' logical expression could make the dependencies of useMemo Hook (at line 37) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'skillCatalog' in its own useMemo() Hook.","line":12,"column":9,"nodeType":"VariableDeclarator","endLine":12,"endColumn":99}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/developmentplan/ProgressBreakdown.jsx\n// Visual breakdown of skill progress across development plan\n// FIXED: Updated to work with adapted plan structure (coreReps), group by focus area\n\nimport React, { useMemo } from 'react';\nimport { TrendingUp, Target, Award } from 'lucide-react';\nimport { Card, ProgressBar, Badge } from './DevPlanComponents';\nimport { COLORS, calculateSkillProgress } from './devPlanUtils';\n\nconst ProgressBreakdown = ({ plan, globalMetadata }) => {\n  // FIXED: Simplified skill catalog access\n  const skillCatalog = globalMetadata?.SKILL_CATALOG?.items || globalMetadata?.SKILL_CATALOG || [];\n\n  const skillProgress = useMemo(() => {\n    if (!plan || !plan.coreReps) return [];\n    \n    console.log('[ProgressBreakdown] Processing adapted plan:', {\n      hasCoreReps: !!plan.coreReps,\n      coreRepsCount: plan.coreReps?.length,\n      catalogSize: skillCatalog.length\n    });\n    \n    return plan.coreReps.map(rep => {\n      // Use skillName from adapted rep (already has the name!)\n      const skillName = rep.skillName || rep.skillId;\n      \n      // Calculate progress from weeksCompleted\n      const progress = calculateSkillProgress(rep.weeksCompleted || 0);\n      \n      return {\n        ...rep,\n        skillName,\n        progress,\n        focusArea: rep.focusArea || rep.dimension || 'General'\n      };\n    });\n  }, [plan, skillCatalog]);\n\n  // FIXED: Group by focus area instead of tier\n  const skillsByFocusArea = useMemo(() => {\n    const grouped = {};\n    skillProgress.forEach(skill => {\n      const area = skill.focusArea || 'General';\n      if (!grouped[area]) {\n        grouped[area] = [];\n      }\n      grouped[area].push(skill);\n    });\n    \n    console.log('[ProgressBreakdown] Grouped by focus area:', Object.keys(grouped));\n    return grouped;\n  }, [skillProgress]);\n\n  const overallProgress = useMemo(() => {\n    if (skillProgress.length === 0) return 0;\n    const total = skillProgress.reduce((sum, skill) => sum + skill.progress, 0);\n    return Math.round(total / skillProgress.length);\n  }, [skillProgress]);\n\n  if (!plan || skillProgress.length === 0) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card accent=\"BLUE\">\n          <p className=\"text-gray-600\">No skills to display. Complete your baseline assessment to get started.</p>\n        </Card>\n      </div>\n    );\n  }\n\n  // Focus area colors\n  const areaColors = {\n    'Clarity & Communication': COLORS.BLUE,\n    'Trust & Relationships': COLORS.TEAL,\n    'Delegation & Empowerment': COLORS.PURPLE,\n    'Execution & Results': COLORS.ORANGE,\n    'Leadership Mindset & Identity': COLORS.NAVY,\n    'Ownership & Accountability': COLORS.GREEN,\n    'Recognition & Motivation': COLORS.PINK,\n    'Team Health & Culture': COLORS.GOLD\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n      {/* Overall Progress */}\n      <Card accent=\"BLUE\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold\" style={{ color: COLORS.NAVY }}>\n              Overall Progress\n            </h2>\n            <p className=\"text-gray-600\">\n              {skillProgress.length} skills across {Object.keys(skillsByFocusArea).length} focus areas\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-3xl font-bold\" style={{ color: COLORS.BLUE }}>\n              {overallProgress}%\n            </div>\n            <p className=\"text-sm text-gray-600\">complete</p>\n          </div>\n        </div>\n        <ProgressBar progress={overallProgress} color={COLORS.BLUE} />\n      </Card>\n\n      {/* Skills by Focus Area */}\n      {Object.entries(skillsByFocusArea).map(([area, skills]) => {\n        if (skills.length === 0) return null;\n        \n        const areaColor = areaColors[area] || COLORS.ORANGE;\n        const areaProgress = Math.round(\n          skills.reduce((sum, s) => sum + s.progress, 0) / skills.length\n        );\n\n        return (\n          <Card key={area} accent=\"BLUE\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center gap-3\">\n                <Badge variant=\"primary\" style={{ backgroundColor: areaColor }}>\n                  {area}\n                </Badge>\n                <span className=\"text-sm text-gray-600\">\n                  {skills.length} {skills.length === 1 ? 'skill' : 'skills'}\n                </span>\n              </div>\n              <div className=\"text-right\">\n                <span className=\"text-xl font-bold\" style={{ color: areaColor }}>\n                  {areaProgress}%\n                </span>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              {skills.map((skill, idx) => {\n                const isComplete = skill.progress >= 100;\n                const isMastered = skill.weeksCompleted >= 12;\n\n                return (\n                  <div\n                    key={skill.skillId || idx}\n                    className=\"p-4 rounded-lg border-2\"\n                    style={{\n                      borderColor: isComplete ? areaColor : COLORS.SUBTLE,\n                      background: isComplete ? `${areaColor}08` : 'white'\n                    }}\n                  >\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold mb-1\" style={{ color: COLORS.NAVY }}>\n                          {skill.skillName}\n                        </h3>\n                        {skill.phase && (\n                          <p className=\"text-sm text-gray-600\">\n                            Current phase: {skill.phase}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {isMastered && (\n                          <Award size={20} style={{ color: COLORS.GOLD }} />\n                        )}\n                        <span className=\"text-sm font-medium\" style={{ color: areaColor }}>\n                          {skill.weeksCompleted || 0} weeks\n                        </span>\n                      </div>\n                    </div>\n                    <ProgressBar progress={skill.progress} color={areaColor} height=\"h-2\" />\n                  </div>\n                );\n              })}\n            </div>\n          </Card>\n        );\n      })}\n\n      {/* Insights */}\n      <Card accent=\"TEAL\">\n        <div className=\"flex items-center gap-3 mb-3\">\n          <TrendingUp size={24} style={{ color: COLORS.TEAL }} />\n          <h3 className=\"font-bold\" style={{ color: COLORS.NAVY }}>\n            Key Insights\n          </h3>\n        </div>\n        <ul className=\"space-y-2 text-sm text-gray-600\">\n          <li>• You have {skillProgress.filter(s => s.progress >= 100).length} skills at or above 100% completion</li>\n          <li>• {skillProgress.filter(s => s.weeksCompleted >= 12).length} skills have reached mastery (12+ weeks)</li>\n          <li>• Focus area with most progress: {\n            Object.entries(skillsByFocusArea)\n              .map(([area, skills]) => ({\n                area,\n                progress: skills.reduce((sum, s) => sum + s.progress, 0) / skills.length\n              }))\n              .sort((a, b) => b.progress - a.progress)[0]?.area || 'None'\n          }</li>\n        </ul>\n      </Card>\n    </div>\n  );\n};\n\nexport default ProgressBreakdown;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/ProgressScan.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'globalMetadata' is defined but never used.","line":81,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/developmentplan/ProgressScan.jsx\n// REFACTORED: Converted to a single-page form (Screen 1).\n// Kept the \"Comparison\" screen (Screen 2) as a good UX step.\n// UPDATED (10/30/25): Added simulated 8s loading state for generation.\n// UPDATED (10/30/25): Replaced LikertScaleInput with RadioButtonInput for consistency.\n\nimport React, { useState, useMemo } from 'react';\n// REQ #3: Added ArrowLeft\nimport { TrendingUp, ArrowRight, CheckCircle, Loader, ArrowLeft } from 'lucide-react';\nimport { \n  Button, \n  Card, \n  ProgressBar, \n  Badge,\n  PlanGenerationLoader // NEW: Import the cool loader\n  // LikertScaleInput REMOVED\n} from './DevPlanComponents';\nimport { \n  ASSESSMENT_QUESTIONS, \n  OPEN_ENDED_QUESTION, \n  LIKERT_SCALE, \n  COLORS, \n  generatePlanFromAssessment \n} from './devPlanUtils';\nimport { adaptFirebaseAssessmentToComponents } from '../../../utils/devPlanAdapter';\n\n// REQ: New Radio Button Input Component (Copied from BaselineAssessment for visual consistency)\nconst RadioButtonInput = ({ question, options, value, onChange }) => {\n  const [isFocused, setIsFocused] = useState(false);\n  \n  return (\n    <div \n      className=\"p-6 rounded-lg transition-all\"\n      style={{ \n        background: isFocused ? 'white' : COLORS.BG,\n        border: `2px solid ${isFocused ? COLORS.TEAL : 'transparent'}`\n      }}\n      onFocus={() => setIsFocused(true)}\n      onBlur={() => setIsFocused(false)}\n    >\n      <label className=\"block text-base font-semibold mb-1\" style={{ color: COLORS.NAVY }}>\n        {question.text}\n      </label>\n      <p className=\"text-sm mb-4\" style={{ color: COLORS.MUTED }}>\n        {question.description}\n      </p>\n      \n      <fieldset className=\"mt-4\">\n        <legend className=\"sr-only\">Choose an option for {question.text}</legend>\n        <div className=\"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-x-6 gap-y-3\">\n          {options.map((option) => (\n            <div key={option.value} className=\"flex items-center\">\n              <input\n                id={`${question.id}-${option.value}`}\n                name={question.id}\n                type=\"radio\"\n                value={option.value}\n                checked={value === option.value}\n                onChange={() => onChange(question.id, option.value)}\n                className=\"h-5 w-5 border-gray-300\"\n                style={{ color: COLORS.TEAL, accentColor: COLORS.TEAL }}\n              />\n              <label \n                htmlFor={`${question.id}-${option.value}`} \n                className=\"ml-2 block text-sm font-medium\"\n                style={{ color: COLORS.TEXT }}\n              >\n                {option.label}\n              </label>\n            </div>\n          ))}\n        </div>\n      </fieldset>\n    </div>\n  );\n};\n\n\nconst ProgressScan = ({ \n  developmentPlanData, \n  globalMetadata, \n  skillCatalog = [],\n  onCompleteScan, \n  onBack,\n  isLoading = false \n}) => {\n  // We now have two main \"views\" in this component\n  // 1. 'assessment': The new single-page form\n  // 2. 'comparison': The old \"showComparison\" screen\n  const [view, setView] = useState('assessment');\n  \n  // State for the assessment form\n  const [responses, setResponses] = useState({});\n  const [openEndedResponse, setOpenEndedResponse] = useState('');\n  \n  // NEW: State for simulated loading delay\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  // Adapt previous assessment to get correct field names\n  const previousAssessment = useMemo(() => {\n    const lastAssessment = developmentPlanData?.assessmentHistory?.[developmentPlanData.assessmentHistory.length - 1];\n    if (!lastAssessment) return null;\n    \n    console.log('[ProgressScan] Adapting previous assessment');\n    // Ensure the answers keys are correctly mapped\n    return adaptFirebaseAssessmentToComponents(lastAssessment);\n  }, [developmentPlanData?.assessmentHistory]);\n\n  const completedQuestions = Object.keys(responses).length;\n  const totalQuestions = ASSESSMENT_QUESTIONS.length;\n  const progress = (completedQuestions / totalQuestions) * 100;\n  const isComplete = completedQuestions === totalQuestions;\n\n  // Handler for the new component\n  const handleResponse = (questionId, value) => {\n    setResponses(prev => ({ ...prev, [questionId]: value }));\n  };\n\n  // This just moves from the form to the comparison view\n  const handleReviewProgress = () => {\n    if (!isComplete) {\n      alert(\"Please answer all assessment questions.\");\n      return;\n    }\n    setView('comparison');\n  };\n\n  // This is the final \"submit\" from the comparison screen\n  const handleComplete = () => {\n    // START SIMULATED GENERATION\n    setIsGenerating(true);\n    \n    // Simulate 8-second generation time (UX requirement)\n    setTimeout(() => {\n        const newAssessment = {\n            date: new Date().toISOString(),\n            answers: responses,\n            openEnded: [openEndedResponse.trim()].filter(g => g), // Wrap in array to match Baseline format\n            cycle: (developmentPlanData?.currentCycle || 0) + 1, // Cycle starts at 1, so if currentCycle is 0 (initial state), new is 1. If current is 1, new is 2.\n        };\n\n        console.log('[ProgressScan] Generating plan with skill catalog size:', skillCatalog.length);\n        const newPlan = generatePlanFromAssessment(newAssessment, skillCatalog);\n        \n        onCompleteScan(newPlan, newAssessment);\n        setIsGenerating(false);\n    }, 8000); // 8-second delay\n  };\n\n  // --- RENDER ---\n\n  // SCREEN 2: COMPARISON VIEW\n  if (view === 'comparison' && previousAssessment) {\n    // Use combined loading state\n    const isTotalLoading = isLoading || isGenerating;\n    \n    return (\n      <>\n        {/* Show cool loading overlay when generating */}\n        {isGenerating && <PlanGenerationLoader message=\"Generating Your Next Plan\" />}\n        \n        <div className=\"max-w-4xl mx-auto p-4 sm:p-6\">\n        <Card accent=\"GREEN\">\n          <div className=\"mb-6\">\n            <h2 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>\n              Your Progress\n            </h2>\n            <p className=\"text-lg\" style={{ color: COLORS.MUTED }}>\n              Compare your current assessment with your previous baseline.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 mb-6\">\n            {ASSESSMENT_QUESTIONS.map(question => {\n              // We need to use .answers for previous assessment if it was a Baseline, or .responses if it was a Progress Scan.\n              const prevScore = previousAssessment.responses?.[question.id] || previousAssessment.answers?.[question.id] || 0;\n              const newScore = responses[question.id] || 0;\n              const improvement = newScore - prevScore;\n\n              return (\n                <div\n                  key={question.id}\n                  className=\"p-4 rounded-xl border-2\"\n                  style={{ borderColor: COLORS.SUBTLE, background: 'white' }}\n                >\n                  <p className=\"text-base font-semibold mb-3\" style={{ color: COLORS.NAVY }}>\n                    {question.text}\n                  </p>\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <span className=\"text-xs font-semibold\" style={{ color: COLORS.MUTED }}>Previous: {prevScore}/5</span>\n                        <span className=\"text-xs font-semibold\" style={{ color: COLORS.TEAL }}>Current: {newScore}/5</span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n                        <div \n                          className=\"bg-teal-500 h-2.5 rounded-full\" \n                          style={{ width: `${(newScore / 5) * 100}%` }}\n                        ></div>\n                      </div>\n                    </div>\n                    {improvement !== 0 && (\n                      <Badge variant={improvement > 0 ? 'success' : 'warning'}>\n                        {improvement > 0 ? `+${improvement}` : improvement}\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <Button\n              onClick={() => setView('assessment')}\n              variant=\"outline\"\n              size=\"lg\"\n              disabled={isTotalLoading}\n            >\n              Back to Edit\n            </Button>\n            <Button\n              onClick={handleComplete}\n              variant=\"primary\"\n              size=\"lg\"\n              className=\"flex-1\"\n              disabled={isTotalLoading}\n            >\n              {isTotalLoading ? <Loader className=\"animate-spin\" /> : <ArrowRight className=\"w-5 h-5\" />}\n              {isTotalLoading ? 'Generating Plan...' : 'Generate New Plan'}\n            </Button>\n          </div>\n        </Card>\n      </div>\n      </>\n    );\n  }\n\n  // SCREEN 1: ASSESSMENT FORM (Default View)\n  // Use combined loading state\n  const isTotalLoading = isLoading || isGenerating;\n  \n  return (\n    <div className=\"max-w-4xl mx-auto p-4 sm:p-6\" style={{ background: COLORS.BG }}>\n      \n      {/* REQ #3: Added Back Button */}\n      <div className=\"mb-4\">\n        <Button onClick={onBack} variant=\"nav-back\" size=\"sm\">\n          <ArrowLeft className=\"w-4 h-4\" />\n          Back to Tracker\n        </Button>\n      </div>\n\n      {/* Header Card */}\n      <Card accent=\"GREEN\">\n        <h1 className=\"text-3xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>\n          Progress Scan\n        </h1>\n        <p className=\"text-lg\" style={{ color: COLORS.MUTED }}>\n          Let's reassess your leadership effectiveness to see how you've grown.\n        </p>\n      </Card>\n\n      {/* Sticky Progress Bar */}\n      <div className=\"sticky top-0 z-10 py-4\" style={{ background: `${COLORS.BG}F0` }}>\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"flex justify-between text-sm mb-2 px-1\">\n            <span className=\"font-semibold\" style={{ color: COLORS.GREEN }}>\n              {completedQuestions} of {totalQuestions} Questions Answered\n            </span>\n            <span className=\"font-semibold\" style={{ color: COLORS.GREEN }}>\n              {Math.round(progress)}%\n            </span>\n          </div>\n          <ProgressBar progress={progress} color={COLORS.GREEN} height={12} />\n        </div>\n      </div>\n\n      {/* Form Container */}\n      <div className=\"space-y-4 mt-4\">\n        \n        {/* Render all Likert questions - NOW USING RADIO BUTTON INPUT */}\n        {ASSESSMENT_QUESTIONS.map((question) => {\n          const prevScore = previousAssessment?.responses?.[question.id] || previousAssessment?.answers?.[question.id];\n          \n          return (\n            <div key={question.id}>\n              <RadioButtonInput // Changed from LikertScaleInput\n                question={question}\n                options={LIKERT_SCALE}\n                value={responses[question.id]}\n                onChange={handleResponse}\n              />\n              {prevScore && (\n                <div className=\"px-6 py-2 rounded-b-xl\" style={{ backgroundColor: `${COLORS.TEAL}10` }}>\n                  <p className=\"text-xs font-medium\" style={{ color: COLORS.TEAL }}>\n                    Your previous score was: **{prevScore}/5**\n                  </p>\n                </div>\n              )}\n            </div>\n          );\n        })}\n\n        {/* Open-ended question */}\n        <Card accent=\"ORANGE\">\n          <label className=\"block text-lg font-semibold mb-3\" style={{ color: COLORS.NAVY }}>\n            {OPEN_ENDED_QUESTION.text}\n          </label>\n           <p className=\"text-sm mb-3\" style={{ color: COLORS.MUTED }}>\n            {OPEN_ENDED_QUESTION.placeholder}\n          </p>\n          <textarea\n            className=\"w-full p-4 border rounded-lg focus:ring-2 transition-all\"\n            style={{ borderColor: COLORS.SUBTLE, ringColor: COLORS.ORANGE }}\n            rows={4}\n            value={openEndedResponse}\n            onChange={(e) => setOpenEndedResponse(e.target.value)}\n            placeholder=\"Share your focus for the next 90 days...\"\n            disabled={isTotalLoading}\n          />\n        </Card>\n\n        {/* The \"One Banana\" - Complete Button */}\n        <div className=\"pt-6 pb-12\">\n          <Button\n            onClick={handleReviewProgress}\n            variant=\"primary\"\n            size=\"lg\"\n            className=\"w-full\"\n            disabled={isTotalLoading || !isComplete}\n          >\n            {isTotalLoading ? (\n              <Loader className=\"animate-spin\" />\n            ) : (\n              <TrendingUp className=\"w-5 h-5\" />\n            )}\n            {isTotalLoading ? 'Generating Plan...' : 'Review My Progress'}\n          </Button>\n          {!isComplete && (\n            <p className=\"text-center text-sm mt-3\" style={{ color: COLORS.MUTED }}>\n              Please answer all {totalQuestions} questions to continue.\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProgressScan;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/QuickPlanEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/developmentplan/devPlanUtils.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/labs/ScenarioLibraryView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/screens/labs/shared/LabComponents.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":10,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":10,"endColumn":20},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/screens/labs/shared/LabComponents.jsx\n// REFACTORED: Shared UI components for Labs\n\nimport React, { useState } from 'react';\nimport { CheckCircle, AlertTriangle, Target } from 'lucide-react';\n\n/* =========================================================\n   SHARED CONSTANTS & THEME\n========================================================= */\nexport const COLORS = {\n  BG: '#FCFCFA',             // Corporate light gray\n  SURFACE: '#FCFCFA',        // Corporate light gray\n  BORDER: '#47A88D',         // Corporate teal\n  SUBTLE: '#349881',         // Corporate subtle teal\n  TEXT: '#002E47',           // Corporate navy\n  MUTED: '#349881',          // Corporate subtle teal\n  NAVY: '#002E47',           // Corporate navy\n  TEAL: '#47A88D',           // Corporate teal\n  BLUE: '#002E47',           // NO BLUE! Use corporate navy\n  ORANGE: '#E04E1B',         // Corporate orange\n  GREEN: '#47A88D',          // NO GREEN! Use corporate teal\n  AMBER: '#E04E1B',          // NO AMBER! Use corporate orange\n  RED: '#E04E1B',            // NO RED! Use corporate orange\n  LIGHT_GRAY: '#FCFCFA'      // Corporate light gray\n};\n\nexport const COMPLEXITY_MAP = {\n  Low:    { label: 'Novice',       hex: COLORS.GREEN, icon: CheckCircle },\n  Medium: { label: 'Intermediate', hex: COLORS.AMBER, icon: AlertTriangle },\n  High:   { label: 'Expert',       hex: COLORS.RED,   icon: Target },\n};\n\n/* =========================================================\n   SHARED UI COMPONENTS\n========================================================= */\nexport const Button = ({ children, onClick, disabled = false, variant = 'primary', className = '', ...rest }) => {\n    let baseStyle = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-xl focus:outline-none focus:ring-4 text-white flex items-center justify-center\";\n\n    if (variant === 'primary') { baseStyle += ` bg-[${COLORS.TEAL}] hover:bg-[#349881] focus:ring-[#47A88D]/50`; } \n    else if (variant === 'secondary') { baseStyle += ` bg-[${COLORS.ORANGE}] hover:bg-[${COLORS.SUBTLE}] focus:ring-[#E04E1B]/50`; } \n    else if (variant === 'outline') { baseStyle = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[#47A88D]/10 focus:ring-4 focus:ring-[#47A88D]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-center`; }\n\n    if (disabled) { baseStyle = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\"; }\n\n    return (\n        <button {...rest} onClick={onClick} disabled={disabled} className={`${baseStyle} ${className}`}>\n            {children}\n        </button>\n    );\n};\n\nexport const Card = ({ children, title, icon: Icon, className = '', onClick, accent = 'ORANGE' }) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.ORANGE;\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      className={`relative p-6 rounded-2xl border-2 shadow-xl hover:shadow-2xl transition-all duration-300 text-left ${className}`}\n      style={{\n        background: 'linear-gradient(180deg,#FCFCFA,#FCFCFA)',\n        borderColor: COLORS.SUBTLE,\n        color: COLORS.TEXT\n      }}\n      onClick={onClick}\n    >\n      <span style={{\n        position:'absolute', top:0, left:0, right:0, height:6,\n        background: accentColor,\n        borderTopLeftRadius:14, borderTopRightRadius:14\n      }} />\n\n      {Icon && (\n        <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\"\n             style={{ borderColor: COLORS.SUBTLE, background: '#F3F4F6' }}>\n          <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n        </div>\n      )}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\n\nexport const Tooltip = ({ content, children }) => {\n    const [isVisible, setIsVisible] = useState(false);\n    \n    return (\n        <div className=\"relative inline-block\" onMouseEnter={() => setIsVisible(true)} onMouseLeave={() => setIsVisible(false)}>\n            {children}\n            {isVisible && content && (\n                <div className=\"absolute z-10 w-64 p-3 -mt-2 -ml-32 text-xs text-white bg-[#002E47] rounded-lg shadow-lg bottom-full left-1/2 transform translate-x-1/2\">\n                    {content}\n                    <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-[#002E47]\"></div>\n                </div>\n            )}\n        </div>\n    );\n};","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/services/firebaseClient.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/AccessibleComponents.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/Button.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/Card.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/LoadingStates.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Icon' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":67,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/shared/LoadingStates.jsx\n// REFACTOR: Centralized loading and empty states\n\nimport React from 'react';\nimport { Loader, AlertCircle, FileX, Wifi, WifiOff } from 'lucide-react';\nimport { COLORS } from '../../utils/constants.js';\n\nexport const LoadingSpinner = ({ \n  message = \"Loading...\", \n  size = \"md\",\n  color = COLORS.TEAL,\n  className = \"\" \n}) => {\n  const sizeClasses = {\n    sm: \"h-4 w-4\",\n    md: \"h-8 w-8\", \n    lg: \"h-12 w-12\",\n    xl: \"h-16 w-16\"\n  };\n\n  return (\n    <div className={`flex flex-col items-center justify-center p-8 ${className}`}>\n      <Loader \n        className={`animate-spin ${sizeClasses[size]} mb-3`} \n        style={{ color }} \n      />\n      {message && (\n        <p className=\"text-sm font-medium\" style={{ color: COLORS.TEXT }}>\n          {message}\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport const ErrorState = ({ \n  title = \"Something went wrong\",\n  message = \"An unexpected error occurred. Please try again.\",\n  onRetry,\n  className = \"\"\n}) => (\n  <div className={`flex flex-col items-center justify-center p-8 text-center ${className}`}>\n    <AlertCircle className=\"h-12 w-12 mb-4\" style={{ color: COLORS.ERROR }} />\n    <h3 className=\"text-lg font-semibold mb-2\" style={{ color: COLORS.TEXT }}>\n      {title}\n    </h3>\n    <p className=\"text-sm text-gray-600 mb-6 max-w-md\">\n      {message}\n    </p>\n    {onRetry && (\n      <button\n        onClick={onRetry}\n        className=\"px-4 py-2 rounded-lg font-medium text-white transition-colors\"\n        style={{ backgroundColor: COLORS.TEAL }}\n      >\n        Try Again\n      </button>\n    )}\n  </div>\n);\n\nexport const EmptyState = ({ \n  title = \"No data found\",\n  message = \"There's nothing here yet.\",\n  actionLabel,\n  onAction,\n  icon: Icon = FileX,\n  className = \"\"\n}) => (\n  <div className={`flex flex-col items-center justify-center p-8 text-center ${className}`}>\n    <Icon className=\"h-12 w-12 mb-4\" style={{ color: COLORS.SUBTLE }} />\n    <h3 className=\"text-lg font-semibold mb-2\" style={{ color: COLORS.TEXT }}>\n      {title}\n    </h3>\n    <p className=\"text-sm text-gray-600 mb-6 max-w-md\">\n      {message}\n    </p>\n    {actionLabel && onAction && (\n      <button\n        onClick={onAction}\n        className=\"px-4 py-2 rounded-lg font-medium text-white transition-colors\"\n        style={{ backgroundColor: COLORS.TEAL }}\n      >\n        {actionLabel}\n      </button>\n    )}\n  </div>\n);\n\nexport const NetworkStatus = ({ isOnline = true }) => (\n  <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium ${\n    isOnline ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n  }`}>\n    {isOnline ? (\n      <Wifi className=\"h-3 w-3\" />\n    ) : (\n      <WifiOff className=\"h-3 w-3\" />\n    )}\n    {isOnline ? 'Online' : 'Offline'}\n  </div>\n);","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/MembershipGate.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/StyledButton.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/shared/UI.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/system/ConfigError.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/system/ErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/ui/MembershipGate.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'membershipData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":157,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":157,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/ui/MembershipGate.jsx\nimport React from 'react';\nimport { useAppServices } from '../../services/useAppServices.jsx';\nimport { membershipService, MEMBERSHIP_TIERS } from '../../services/membershipService.js';\nimport { Crown, ArrowRight, Zap } from 'lucide-react';\n\nconst COLORS = { \n  NAVY: '#002E47', \n  TEAL: '#47A88D', \n  ORANGE: '#E04E1B', \n  GREEN: '#10B981', \n  BLUE: '#2563EB', \n  AMBER: '#F5A800',\n  RED: '#E04E1B', \n  LIGHT_GRAY: '#FCFCFA', \n  OFF_WHITE: '#FFFFFF', \n  SUBTLE: '#E5E7EB', \n  TEXT: '#374151', \n  MUTED: '#4B5563', \n  PURPLE: '#7C3AED', \n  BG: '#F9FAFB' \n};\n\n/**\n * MembershipGate Component\n * \n * Controls access to premium features based on user's membership tier.\n * Shows upgrade prompts when user doesn't have sufficient access.\n * \n * @param {string} requiredTier - The minimum tier required ('basic', 'professional', 'elite')\n * @param {string} featureName - Display name of the feature being gated\n * @param {React.ReactNode} children - The component/content to gate\n * @param {function} navigate - Optional navigation function for upgrade flow\n */\nexport const MembershipGate = ({ requiredTier, featureName, children, navigate }) => {\n  const { membershipData, isAdmin } = useAppServices();\n  \n  // Admins bypass all restrictions\n  if (isAdmin) {\n    return children;\n  }\n  \n  const currentTier = membershipData?.currentTier || 'basic';\n  const hasAccess = membershipService.hasAccess(currentTier, requiredTier);\n  \n  // If user has access, render the children\n  if (hasAccess) {\n    return children;\n  }\n  \n  // Get tier information for upgrade prompt\n  const requiredTierInfo = MEMBERSHIP_TIERS[requiredTier];\n  const currentTierInfo = MEMBERSHIP_TIERS[currentTier];\n  \n  // Show upgrade prompt\n  return (\n    <div className=\"relative\">\n      {/* Blurred/disabled content */}\n      <div className=\"opacity-30 pointer-events-none select-none\">\n        {children}\n      </div>\n      \n      {/* Upgrade overlay */}\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        <div \n          className=\"bg-white rounded-lg shadow-lg border-2 p-6 max-w-md mx-4\"\n          style={{ \n            borderColor: requiredTierInfo.color,\n            background: `linear-gradient(135deg, ${COLORS.OFF_WHITE} 0%, ${requiredTierInfo.color}10 100%)`\n          }}\n        >\n          <div className=\"text-center\">\n            {/* Icon */}\n            <div \n              className=\"w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4\"\n              style={{ backgroundColor: `${requiredTierInfo.color}20` }}\n            >\n              <Crown \n                className=\"w-6 h-6\" \n                style={{ color: requiredTierInfo.color }} \n              />\n            </div>\n            \n            {/* Title */}\n            <h3 \n              className=\"text-lg font-bold mb-2\"\n              style={{ color: COLORS.TEXT }}\n            >\n              {requiredTierInfo.name} Feature\n            </h3>\n            \n            {/* Description */}\n            <p className=\"text-sm text-gray-600 mb-4\">\n              <span className=\"font-semibold\">{featureName}</span> is available with{' '}\n              <span \n                className=\"font-bold\"\n                style={{ color: requiredTierInfo.color }}\n              >\n                {requiredTierInfo.name}\n              </span>{' '}\n              membership and above.\n            </p>\n            \n            {/* Current vs Required */}\n            <div className=\"bg-white rounded-lg p-3 mb-4 border border-gray-200\">\n              <div className=\"flex justify-between items-center text-sm\">\n                <div>\n                  <div className=\"text-gray-500\">Current:</div>\n                  <div \n                    className=\"font-semibold\"\n                    style={{ color: currentTierInfo.color }}\n                  >\n                    {currentTierInfo.name}\n                  </div>\n                </div>\n                <ArrowRight className=\"w-4 h-4 text-gray-400\" />\n                <div>\n                  <div className=\"text-gray-500\">Upgrade to:</div>\n                  <div \n                    className=\"font-semibold\"\n                    style={{ color: requiredTierInfo.color }}\n                  >\n                    {requiredTierInfo.name}\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            {/* Upgrade button */}\n            <button\n              onClick={() => navigate && navigate('membership-module')}\n              className=\"w-full px-4 py-2 rounded-lg font-semibold text-white flex items-center justify-center gap-2 transition-all duration-200 hover:shadow-lg\"\n              style={{ \n                backgroundColor: requiredTierInfo.color,\n                boxShadow: `0 4px 12px ${requiredTierInfo.color}30`\n              }}\n            >\n              <Zap className=\"w-4 h-4\" />\n              Upgrade to {requiredTierInfo.name}\n            </button>\n            \n            {/* Pricing hint */}\n            <div className=\"text-xs text-gray-500 mt-2\">\n              Starting at ${requiredTierInfo.price}/month\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Inline upgrade prompt for smaller spaces\n */\nexport const MembershipPrompt = ({ requiredTier, featureName, navigate, className = \"\" }) => {\n  const { membershipData } = useAppServices();\n  const requiredTierInfo = MEMBERSHIP_TIERS[requiredTier];\n  \n  return (\n    <div \n      className={`p-4 rounded-lg border-2 border-dashed text-center ${className}`}\n      style={{ \n        borderColor: `${requiredTierInfo.color}40`,\n        backgroundColor: `${requiredTierInfo.color}05`\n      }}\n    >\n      <Crown \n        className=\"w-8 h-8 mx-auto mb-2\" \n        style={{ color: requiredTierInfo.color }} \n      />\n      <h4 \n        className=\"font-semibold mb-1\"\n        style={{ color: COLORS.TEXT }}\n      >\n        {featureName}\n      </h4>\n      <p className=\"text-sm text-gray-600 mb-3\">\n        Available with {requiredTierInfo.name} membership\n      </p>\n      <button\n        onClick={() => navigate && navigate('membership-module')}\n        className=\"px-4 py-2 rounded-lg text-white font-medium text-sm hover:shadow-lg transition-all duration-200\"\n        style={{ backgroundColor: requiredTierInfo.color }}\n      >\n        Upgrade to {requiredTierInfo.name}\n      </button>\n    </div>\n  );\n};\n\nexport default MembershipGate;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/components/ui/PWAInstall.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isInstallable' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":18,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/ui/PWAInstall.jsx\n// PWA Install Button Component with error handling\nimport React, { useState, useEffect } from 'react';\nimport { Download, X, Info, Smartphone, Monitor, ExternalLink } from 'lucide-react';\n\nconst COLORS = {\n  NAVY: '#002E47',\n  ORANGE: '#E04E1B',\n  TEAL: '#47A88D',\n  LIGHT_GRAY: '#FCFCFA',\n  TEXT: '#002E47',\n  MUTED: '#47A88D',\n  BG: '#FCFCFA'\n};\n\nconst PWAInstall = () => {\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\n  const [isInstallable, setIsInstallable] = useState(false);\n  const [showInstructions, setShowInstructions] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  useEffect(() => {\n    // Check if already installed\n    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || \n                         window.navigator.standalone === true;\n    setIsInstalled(isStandalone);\n\n    // Listen for beforeinstallprompt event\n    const handleBeforeInstallPrompt = (e) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      setIsInstallable(true);\n    };\n\n    // Listen for successful install\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setIsInstallable(false);\n      setDeferredPrompt(null);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) {\n      setShowInstructions(true);\n      return;\n    }\n\n    try {\n      // Show the install prompt\n      deferredPrompt.prompt();\n      \n      // Wait for the user's response\n      const { outcome } = await deferredPrompt.userChoice;\n      \n      if (outcome === 'accepted') {\n        console.log('User accepted the install prompt');\n      } else {\n        console.log('User dismissed the install prompt');\n        setShowInstructions(true);\n      }\n      \n      // Clear the deferredPrompt\n      setDeferredPrompt(null);\n      setIsInstallable(false);\n    } catch (error) {\n      console.error('Install failed:', error);\n      setShowInstructions(true);\n    }\n  };\n\n  const getDeviceInstructions = () => {\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\n    const isChrome = /Chrome/.test(navigator.userAgent);\n    const isSafari = /Safari/.test(navigator.userAgent) && !isChrome;\n    \n    if (isIOS && isSafari) {\n      return {\n        icon: <Smartphone className=\"w-5 h-5\" />,\n        title: \"Install on iOS\",\n        steps: [\n          \"Tap the Share button at the bottom\",\n          \"Scroll down and tap 'Add to Home Screen'\",\n          \"Tap 'Add' to install the app\"\n        ]\n      };\n    }\n    \n    if (isChrome) {\n      return {\n        icon: <Monitor className=\"w-5 h-5\" />,\n        title: \"Install on Chrome\",\n        steps: [\n          \"Click the menu (⋮) in the top right\",\n          \"Select 'Apps' → 'Install LeaderReps'\",\n          \"Or look for the install icon in the address bar\"\n        ]\n      };\n    }\n    \n    return {\n      icon: <ExternalLink className=\"w-5 h-5\" />,\n      title: \"Install Instructions\",\n      steps: [\n        \"Use Chrome or Safari for best experience\",\n        \"Look for 'Install App' or 'Add to Home Screen'\",\n        \"The app will work offline once installed\"\n      ]\n    };\n  };\n\n  if (isInstalled) {\n    return null; // Don't show install button if already installed\n  }\n\n  return (\n    <>\n      {/* Install Button */}\n      <button\n        onClick={handleInstallClick}\n        className=\"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-1\"\n        style={{\n          backgroundColor: COLORS.TEAL,\n          color: 'white',\n          border: 'none'\n        }}\n        title=\"Install LeaderReps App\"\n      >\n        <Download className=\"w-4 h-4\" />\n        <span className=\"hidden sm:inline\">Install App</span>\n      </button>\n\n      {/* Instructions Modal */}\n      {showInstructions && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div\n            className=\"bg-white rounded-lg shadow-2xl max-w-md w-full p-6\"\n            style={{ backgroundColor: COLORS.BG }}\n          >\n            <div className=\"flex items-start justify-between mb-4\">\n              <div className=\"flex items-center gap-3\">\n                {getDeviceInstructions().icon}\n                <h3 className=\"text-lg font-bold\" style={{ color: COLORS.NAVY }}>\n                  {getDeviceInstructions().title}\n                </h3>\n              </div>\n              <button\n                onClick={() => setShowInstructions(false)}\n                className=\"p-1 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <X className=\"w-5 h-5\" style={{ color: COLORS.MUTED }} />\n              </button>\n            </div>\n\n            <div className=\"space-y-3 mb-6\">\n              {getDeviceInstructions().steps.map((step, index) => (\n                <div key={index} className=\"flex gap-3\">\n                  <div\n                    className=\"flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white\"\n                    style={{ backgroundColor: COLORS.ORANGE }}\n                  >\n                    {index + 1}\n                  </div>\n                  <p className=\"text-sm\" style={{ color: COLORS.TEXT }}>\n                    {step}\n                  </p>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"bg-blue-50 p-3 rounded-lg mb-4\">\n              <div className=\"flex gap-2\">\n                <Info className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"text-sm font-medium text-blue-800\">\n                    Why install the app?\n                  </p>\n                  <p className=\"text-xs text-blue-600 mt-1\">\n                    • Works offline • Faster loading • Desktop/home screen access • Better performance\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <button\n              onClick={() => setShowInstructions(false)}\n              className=\"w-full py-2 px-4 rounded-lg font-medium transition-colors\"\n              style={{\n                backgroundColor: COLORS.NAVY,\n                color: 'white'\n              }}\n            >\n              Got it!\n            </button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default PWAInstall;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/config/firebaseConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/data/Constants.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'initialTierIndex' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":247,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":247,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// --- ICON IMPORTS FOR ICON MAP ---\nimport { Zap, HeartPulse, Users, Mic, Briefcase, Target, CheckCircle, TrendingUp, ShieldCheck, BarChart3, AlertTriangle, Clock as ClockIcon, Lightbulb, CornerRightUp, Eye, BookOpen, Home, ArrowLeft, PlusCircle, X, MessageSquare, Info } from 'lucide-react';\n\n// --- APPLICATION CONSTANTS ---\nexport const GEMINI_MODEL = \"gemini-2.5-flash-preview-09-2025\";\nexport const API_KEY = (typeof window !== \"undefined\" && (window.__GEMINI_API_KEY || window.GEMINI_API_KEY)) || \"\";\nexport const SECRET_SIGNUP_CODE = \"LeaderReps2024!\"; \n\n// --- ICON MAPPING ---\nexport const IconMap = {\n  Zap,\n  HeartPulse,\n  Users,\n  Mic,\n  Briefcase,\n  Target,\n  CheckCircle,\n  TrendingUp,\n  ShieldCheck,\n  BarChart3,\n  AlertTriangle,\n  Clock: ClockIcon,\n  Lightbulb,\n  CornerRightUp,\n  Eye,\n  BookOpen,\n  Home,\n  ArrowLeft,\n  PlusCircle,\n  X,\n  MessageSquare,\n  Info,\n};\n\n// --- PDP TIER METADATA ---\nexport const LEADERSHIP_TIERS = {\n    T1: { id: 'T1', name: 'Self-Awareness & Trust', icon: 'HeartPulse', color: 'indigo-500' },\n    T2: { id: 'T2', name: 'Communication & Feedback', icon: 'Mic', color: 'cyan-600' },\n    T3: { id: 'T3', name: 'Execution & Delegation', icon: 'Briefcase', color: 'green-600' },\n    T4: { id: 'T4', name: 'Talent & People Development', icon: 'Users', color: 'yellow-600' },\n    T5: { id: 'T5', name: 'Vision & Strategic Clarity', icon: 'TrendingUp', color: 'red-600' },\n};\n\n// --- DAILY PRACTICE COMMITMENT BANK (Required for DailyPractice.jsx) ---\nexport const leadershipCommitmentBank = {\n    'Focus & Productivity': [\n        { id: 1, text: 'Identify and block out 90 minutes for \"Deep Work\" on a high-leverage task.', isCustom: false },\n        { id: 2, text: 'Close email/chat apps entirely for the first two hours of the workday.', isCustom: false },\n        { id: 3, text: 'Review and confirm alignment with my top 3 OKRs before starting my day.', isCustom: false },\n        { id: 4, text: 'Decline one non-essential meeting to protect focused work time.', isCustom: false },\n        { id: 5, text: 'Process emails only during two dedicated 30-minute windows.', isCustom: false },\n        { id: 6, text: 'List the one non-negotiable win for tomorrow before leaving the office.', isCustom: false },\n        { id: 7, text: 'Do not check external news or social media before 10 AM.', isCustom: false },\n        { id: 8, text: 'Time-box all low-leverage administrative tasks to 60 minutes max.', isCustom: false },\n        { id: 9, text: 'Finish the day with a 15-minute desk clean and digital file purge.', isCustom: false },\n        { id: 10, text: 'Write a concise end-of-day summary for my team/manager (optional).', isCustom: false },\n    ],\n    'Feedback & Coaching': [\n        { id: 11, text: 'Deliver one piece of specific, objective (SBI) constructive feedback.', isCustom: false },\n        { id: 12, text: 'Deliver one piece of specific, genuine positive reinforcement (5:1 Ratio).', isCustom: false },\n        { id: 13, text: 'Conduct one scheduled 1:1 session with a direct report, focusing on their agenda.', isCustom: false },\n        { id: 14, text: 'Use a powerful, open-ended question (e.g., \"What is the biggest roadblock?\") in a team meeting.', isCustom: false },\n        { id: 15, text: 'Paraphrase and validate a colleague’s emotion during a difficult discussion.', isCustom: false },\n        { id: 16, text: 'Actively listen for 5 minutes without interrupting anyone.', isCustom: false },\n        { id: 17, text: 'Ask \"How can I support you?\" instead of \"Why did this happen?\" during a performance conversation.', isCustom: false },\n        { id: 18, text: 'Mentor one junior colleague for 15 minutes on a specific skill.', isCustom: false },\n        { id: 19, text: 'Document one specific coaching action for each direct report.', isCustom: false },\n        { id: 20, text: 'Provide feedback to my own manager.', isCustom: false },\n    ],\n    'Trust & Identity': [\n        { id: 21, text: 'Log one instance where I consciously acted in alignment with my Leadership Identity Statement (LIS).', isCustom: false },\n        { id: 22, text: 'Lead by modeling vulnerability: admit one specific error or uncertainty to the team.', isCustom: false },\n        { id: 23, text: 'Hold myself and one direct report accountable for a clear, measurable commitment.', isCustom: false },\n        { id: 24, text: 'Say \"no\" to a request that conflicts with my top strategic priority.', isCustom: false },\n        { id: 25, text: 'Practice silence during a debate to allow psychological safety for others.', isCustom: false },\n        { id: 26, text: 'Express gratitude publicly to a team member for courage or effort, not just results.', isCustom: false },\n        { id: 27, text: 'Engage in a difficult conversation I have been avoiding (Crucial Conversation).', isCustom: false },\n        { id: 28, text: 'Write down one core leadership value and define a concrete behavior that supports it.', isCustom: false },\n        { id: 29, text: 'Apologize sincerely and specifically for a mistake I made.', isCustom: false },\n        { id: 30, text: 'Ensure my body language and tone match my message (congruence).', isCustom: false },\n    ],\n    'Process & Delegation': [\n        { id: 31, text: 'Delegate a task that I believe I could do better/faster, but that the other person needs for development.', isCustom: false },\n        { id: 32, text: 'Update a project risk log with two new potential failure points.', isCustom: false },\n        { id: 33, text: 'Conduct a quick RACI review for a pending cross-functional decision.', isCustom: false },\n        { id: 34, text: 'Document one team process that currently relies too heavily on me.', isCustom: false },\n        { id: 35, text: 'Provide specific, forward-looking context when assigning a task (The \"Why\").', isCustom: false },\n        { id: 36, text: 'Avoid \"reverse delegation\" by allowing a team member to solve their own problem (5-minute rule).', isCustom: false },\n        { id: 37, text: 'Set clear criteria for a successful outcome before initiating any new project phase.', isCustom: false },\n        { id: 38, text: 'Review a project retrospective to identify one process improvement for the next sprint.', isCustom: false },\n    ],\n    'Strategy & Planning': [\n        { id: 41, text: 'Review the organizational Vision/Mission statement and relate it to my team’s QTR goals.', isCustom: false },\n        { id: 42, text: 'Refine one Key Result in the Planning Hub to be more clearly \"from X to Y\".', isCustom: false },\n        { id: 43, text: 'Conduct a mini \"Pre-Mortem\" audit on a minor decision I am making.', isCustom: false },\n        { id: 44, text: 'Review my weekly calendar: is 80% of my time spent on tasks that drive the top 20% of results?', isCustom: false },\n        { id: 45, text: 'Proactively seek external data/competitive intelligence for future planning.', isCustom: false },\n        { id: 46, text: 'Update a project risk log with two new potential failure points.', isCustom: false },\n        { id: 47, text: 'Set clear \"stop\" criteria for a failing project or experiment.', isCustom: false },\n        { id: 48, text: 'Write a short one-page summary of a new business book or article.', isCustom: false },\n        { id: 49, text: 'Check if any daily commitments are misaligned with strategic objectives.', isCustom: false },\n    ],\n    'Personal Development': [\n        { id: 51, text: 'Dedicate 15 minutes to journaling about a recent failure without self-judgment.', isCustom: false },\n        { id: 52, text: 'Practice 5 minutes of focused breathing or meditation before a high-stakes meeting.', isCustom: false },\n        { id: 53, text: 'Block off time to read a chapter from a business book (linked in Business Readings).', isCustom: false },\n        { id: 54, text: 'Schedule a 30-minute learning session on a skill I am weak in.', isCustom: false },\n        { id: 55, text: 'Reach out to a peer mentor for advice on a current leadership challenge.', isCustom: false },\n        { id: 56, text: 'End the workday by listing three things I am genuinely grateful for.', isCustom: false },\n        { id: 57, text: 'Identify and label the dominant emotion I feel during a difficult interaction.', isCustom: false },\n        { id: 58, text: 'Take a 10-minute walk outside to clear my mind during a stressful period.', isCustom: false },\n        { id: 59, text: 'Write down one actionable step toward closing a skill gap identified in my PDP.', isCustom: false },\n    ],\n};\n\n// --- CONTENT LIBRARY ---\nexport const CONTENT_LIBRARY = [\n    // T1: Self-Awareness & Trust (Items kept here for generatePlanData consistency)\n    { id: 101, tier: 'T1', skill: 'Trust', type: 'Reading', title: 'Article: Vulnerability-Based Trust', duration: 30, difficulty: 'Intro' },\n    { id: 102, tier: 'T1', skill: 'Identity', type: 'Exercise', title: 'Drafting Your LIS', duration: 45, difficulty: 'Core' },\n    { id: 103, tier: 'T1', skill: 'Reflection', type: 'Journal', title: 'Daily Check: Acted in Integrity?', duration: 15, difficulty: 'Intro' },\n    { id: 104, tier: 'T1', skill: 'Awareness', type: 'Quiz', title: 'Self-Assessment: Blind Spots', duration: 20, difficulty: 'Intro' },\n    { id: 105, tier: 'T1', skill: 'Reflection', type: 'Reading', title: 'Book Summary: The Power of Habit', duration: 25, difficulty: 'Core' },\n    { id: 106, tier: 'T1', skill: 'Trust', type: 'Case Study', title: 'Trust Collapse Scenario Analysis', duration: 60, difficulty: 'Mastery' },\n    { id: 107, tier: 'T1', skill: 'Identity', type: 'Reading', title: 'Article: The LIS Anchor Point', duration: 20, difficulty: 'Intro' },\n    { id: 108, tier: 'T1', skill: 'Awareness', type: 'Exercise', title: 'Values Conflict Role-Play Prep', duration: 30, difficulty: 'Core' },\n    // T2: Communication & Feedback\n    { id: 201, tier: 'T2', skill: 'Feedback', type: 'Exercise', title: 'SBI Feedback Practice (Lab)', duration: 30, difficulty: 'Core' },\n    { id: 202, tier: 'T2', skill: 'Listening', type: 'Reading', title: 'Article: Paraphrasing for Empathy', duration: 15, difficulty: 'Intro' },\n    { id: 203, tier: 'T2', skill: 'Crucial', type: 'Role-Play', title: 'Practice: Deflecting the Blame-Shifter', duration: 40, difficulty: 'Core' },\n    { id: 204, tier: 'T2', skill: 'Crucial', type: 'Reading', title: 'Book Summary: Crucial Conversations', duration: 25, difficulty: 'Intro' },\n    { id: 205, tier: 'T2', skill: 'Feedback', type: 'Exercise', title: 'Mastering the 5:1 Magic Ratio', duration: 35, difficulty: 'Mastery' },\n    { id: 206, tier: 'T2', skill: 'Listening', type: 'Quiz', title: 'Listening Blocks Assessment', duration: 15, difficulty: 'Intro' },\n    { id: 207, tier: 'T2', skill: 'Crucial', type: 'Case Study', title: 'Firing for Cultural Fit Scenario', duration: 60, difficulty: 'Mastery' },\n    { id: 208, tier: 'T2', skill: 'Feedback', type: 'Reading', title: 'Article: The CLEAR Model', duration: 20, difficulty: 'Core' },\n    // T3: Execution & Delegation\n    { id: 301, tier: 'T3', skill: 'Execution', type: 'Reading', title: 'Book Summary: Deep Work', duration: 25, difficulty: 'Intro' },\n    { id: 302, tier: 'T3', skill: 'Execution', type: 'Exercise', title: 'Time Blocking for High Leverage', duration: 30, difficulty: 'Core' },\n    { id: 303, tier: 'T3', skill: 'Delegation', type: 'Exercise', title: 'RACI Matrix Practice', duration: 45, difficulty: 'Core' },\n    { id: 304, tier: 'T3', skill: 'Delegation', type: 'Reading', title: 'Article: Delegation Levels', duration: 15, difficulty: 'Intro' },\n    { id: 305, tier: 'T3', skill: 'Process', type: 'Case Study', title: 'Process Bottleneck Audit', duration: 50, difficulty: 'Mastery' },\n    { id: 306, tier: 'T3', skill: 'Execution', type: 'Quiz', title: 'Distraction Hotspots Assessment', duration: 15, difficulty: 'Intro' },\n    { id: 307, tier: 'T3', skill: 'Delegation', type: 'Exercise', title: 'Delegation Risk Assessment', duration: 30, difficulty: 'Core' },\n    { id: 308, tier: 'T3', skill: 'Process', type: 'Reading', title: 'Article: PDCA Cycles', duration: 20, difficulty: 'Mastery' },\n    // T4: Talent & People Development\n    { id: 401, tier: 'T4', skill: 'Coaching', type: 'Exercise', title: 'Grow Model Practice', duration: 35, difficulty: 'Core' },\n    { id: 402, tier: 'T4', skill: 'Development', type: 'Reading', title: 'Book Summary: Dare to Lead', duration: 25, difficulty: 'Intro' },\n    { id: 403, tier: 'T4', skill: 'Talent', type: 'Exercise', title: 'Succession Planning Draft', duration: 60, difficulty: 'Mastery' },\n    { id: 404, tier: 'T4', skill: 'Coaching', type: 'Role-Play', title: 'Practice: Coaching a High Performer', duration: 40, difficulty: 'Core' },\n    { id: 405, tier: 'T4', skill: 'Development', type: 'Reading', title: 'Article: Career Laddering', duration: 20, difficulty: 'Intro' },\n    { id: 406, tier: 'T4', skill: 'Talent', type: 'Quiz', title: 'Hiring Bias Assessment', duration: 15, difficulty: 'Intro' },\n    { id: 407, tier: 'T4', skill: 'Coaching', type: 'Case Study', title: 'High Turnover Intervention', duration: 50, difficulty: 'Mastery' },\n    { id: 408, tier: 'T4', skill: 'Development', type: 'Exercise', title: 'Motivational Driver Mapping', duration: 30, difficulty: 'Core' },\n    // T5: Vision & Strategic Clarity\n    { id: 501, tier: 'T5', skill: 'Vision', type: 'Exercise', title: 'Vision Statement Workshop', duration: 45, difficulty: 'Core' },\n    { id: 502, tier: 'T5', skill: 'OKR', type: 'Reading', title: 'Book Summary: Measure What Matters', duration: 25, difficulty: 'Intro' },\n    { id: 503, tier: 'T5', skill: 'Strategic', type: 'Tool', title: 'Pre-Mortem Risk Audit', duration: 30, difficulty: 'Mastery' },\n    { id: 504, tier: 'T5', skill: 'OKR', type: 'Exercise', title: 'OKR Refinement (AI Critique)', duration: 40, difficulty: 'Core' },\n    { id: 505, tier: 'T5', skill: 'Strategic', type: 'Reading', title: 'Article: Competitive Moats', duration: 20, difficulty: 'Intro' },\n    { id: 506, tier: 'T5', skill: 'Vision', type: 'Quiz', title: 'Vision Alignment Check', duration: 15, difficulty: 'Intro' },\n    { id: 507, tier: 'T5', skill: 'Strategic', type: 'Case Study', title: 'Market Disruption Response Plan', duration: 60, difficulty: 'Mastery' },\n    { id: 508, tier: 'T5', skill: 'OKR', type: 'Exercise', title: 'KR \"From X to Y\" Practice', duration: 30, difficulty: 'Core' },\n];\n\n// --- BOOK DATA ---\nexport const allBooks = {\n    Strategy: [\n        { id: 1, title: 'Measure What Matters', author: 'John Doerr' },\n        { id: 7, title: 'Good to Great', author: 'Jim Collins' },\n        { id: 8, title: 'Playing to Win', author: 'A.G. Lafley & Roger L. Martin' },\n        { id: 9, title: 'Blue Ocean Strategy', author: 'W. Chan Kim & Renée Mauborgne' },\n        { id: 10, title: 'The Innovator\\'s Dilemma', author: 'Clayton M. Christensen' },\n    ],\n    Culture: [\n        { id: 2, title: 'Dare to Lead', author: 'Brené Brown' },\n        { id: 11, title: 'The Culture Code', author: 'Daniel Coyle' },\n        { id: 12, title: 'Radical Candor', author: 'Kim Scott' },\n        { id: 13, title: 'Turn the Ship Around!', author: 'L. David Marquet' },\n        { id: 14, title: 'Legacy', author: 'James Kerr' },\n    ],\n    Productivity: [\n        { id: 3, title: 'Deep Work', author: 'Cal Newport' },\n        { id: 15, title: 'Getting Things Done (GTD)', author: 'David Allen' },\n        { id: 16, title: 'The 7 Habits of Highly Effective People', author: 'Stephen Covey' },\n        { id: 17, title: 'Eat That Frog!', author: 'Brian Tracy' },\n        { id: 18, title: 'The One Thing', author: 'Gary Keller & Jay Papasan' },\n    ],\n    Innovation: [\n        { id: 4, title: 'The Lean Startup', author: 'Eric Ries' },\n        { id: 19, title: 'Creativity, Inc.', author: 'Ed Catmull' },\n        { id: 20, title: 'Rework', author: 'Jason Fried & D.H. Hansson' },\n        { id: 21, title: 'Zero to One', author: 'Peter Thiel' },\n        { id: 22, title: 'Loonshots', author: 'Safi Bahcall' },\n    ],\n    'Personal Willpower': [\n        { id: 5, title: 'Atomic Habits', author: 'James Clear' },\n        { id: 23, title: 'Grit', author: 'Angela Duckworth' },\n        { id: 24, title: 'The Power of Habit', author: 'Charles Duhigg' },\n        { id: 25, title: 'Flow', author: 'Mihaly Csikszentmihalyi' },\n        { id: 26, title: 'Start With Why', author: 'Simon Sinek' },\n    ],\n    'Mental Fitness & Resilience': [\n        { id: 6, title: 'Mindset', author: 'Carol Dweck' },\n        { id: 27, title: 'Meditations', author: 'Marcus Aurelius' },\n        { id: 28, title: 'The Subtle Art of Not Giving a F*ck', author: 'Mark Manson' },\n        { id: 29, title: 'Option B', author: 'Sheryl Sandberg & Adam Grant' },\n        { id: 30, title: 'Daring Greatly', author: 'Brené Brown' },\n    ],\n};\n\n// --- MOCK CONTENT DETAILS (For Modals) ---\nexport const MOCK_CONTENT_DETAILS = {\n    'Reading': (title, skill) => `### Core Concepts of ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nThis article highlights the importance of asynchronous communication, creating clear documentation, and setting \"done\" criteria upfront to reduce execution drag. Your primary takeaway should be the principle: **Clear is Kind, Vague is Cruel.**\\n\\n* **Action Item:** Schedule 30 minutes for process mapping.\\n* **Key Term:** Psychological Safety.`,\n    'Exercise': (title, skill) => `### Guided Practice: ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nThis exercise requires you to journal or draft statements based on a self-reflective prompt. Use the questions below as a starting point. Your goal is to identify a core belief and define a corresponding measurable behavior.\\n\\n* **Prompt 1:** When was the last time you felt truly in integrity with your stated values?\\n* **Prompt 2:** What is the most difficult piece of feedback you have successfully processed and implemented?`,\n    'Journal': (title, skill) => `### Journal Prompt: ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nDedicate 15 minutes to freewriting based on this reflection prompt. Do not edit or self-censor. Just write.\\n\\n* **Reflection Focus:** Describe a recent decision where the easiest path conflicted with the most ethical or strategically correct path. What was the impact on your long-term credibility?`,\n    'Quiz': (title, skill) => `### Self-Assessment: ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nThis is a quick self-score. Rate yourself 1-5 (1=Never, 5=Always) on the following statements.\\n\\n* I actively ask for negative feedback from my team.\\n* I publicly own mistakes before assigning blame.`,\n    'Case Study': (title, skill) => `### Case Study Setup: ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nReview the following scenario description and prepare a 5-step action plan before running the simulation or discussing with your coach. The scenario involves a failure to delegate a crucial task to a capable subordinate, leading to team burnout and missed deadlines.`,\n    'Tool': (title, skill) => `### Tool Overview: ${title}\\n\\n**Focus Skill:** ${skill}\\n\\nThis module guides you through a new framework. The current focus is risk identification and mitigation planning. The objective of this tool is to formalize risk assessment across your strategic goals.`,\n};\n\n// --- FIRESTORE COLLECTION PATHS ---\nexport const PDP_COLLECTION = 'leadership_plan'; \nexport const PDP_DOCUMENT = 'roadmap';\nexport const COMMITMENT_COLLECTION = 'daily_practice';\nexport const COMMITMENT_DOCUMENT = 'scorecard_data';\nexport const PLANNING_COLLECTION = 'planning_hub';\nexport const PLANNING_DOCUMENT = 'planning_data';\nexport const COACHING_COLLECTION = 'coaching_sessions';\n\n// --- PLAN GENERATION UTILITIES ---\nexport const getTargetDifficulty = (rating) => {\n    if (rating <= 4) return 'Intro';\n    if (rating <= 7) return 'Core';\n    return 'Mastery';\n};\n\nexport const adjustDuration = (rating, baseDuration) => {\n    if (rating >= 8) return Math.max(15, Math.round(baseDuration * 0.7)); // 30% quicker\n    if (rating <= 3) return Math.min(90, Math.round(baseDuration * 1.3)); // 30% slower\n    return baseDuration;\n};\n\nexport const generatePlanData = (assessment, ownerUid) => {\n    const { managerStatus, goalPriorities, selfRatings } = assessment;\n    const allTiers = Object.keys(LEADERSHIP_TIERS);\n\n    const initialTierIndex = managerStatus === 'New' ? 0 : managerStatus === 'Mid-Level' ? 2 : 4;\n\n    const plan = [];\n    const usedContentIds = new Set();\n\n    const targetTiers = []; \n    if (managerStatus === 'New') targetTiers.push('T1', 'T2');\n    else if (managerStatus === 'Mid-Level') targetTiers.push('T2', 'T3', 'T4');\n    else targetTiers.push('T4', 'T5');\n    goalPriorities.forEach(tier => targetTiers.push(tier));\n\n    let tierRotationQueue = targetTiers.filter((v, i, a) => a.indexOf(v) === i); \n\n    allTiers.forEach(tier => {\n        if (!tierRotationQueue.includes(tier)) {\n            tierRotationQueue.push(tier);\n        }\n    });\n\n    for (let month = 1; month <= 24; month++) {\n        let currentTier = tierRotationQueue[(Math.floor((month - 1) / 4)) % tierRotationQueue.length];\n\n        if (month > 1 && goalPriorities.length > 0) {\n            const lowRatingGoal = goalPriorities.find(g => selfRatings[g] <= 3);\n            if (lowRatingGoal && month % 6 === 0) {\n                currentTier = lowRatingGoal;\n            }\n        }\n\n        const tierMeta = LEADERSHIP_TIERS[currentTier];\n        const theme = `Focus on ${tierMeta.name}`;\n        \n        const rating = selfRatings[currentTier];\n        const targetDifficulty = getTargetDifficulty(rating);\n\n        const requiredContent = [];\n        const contentPool = CONTENT_LIBRARY.filter(item => \n            item.tier === currentTier && item.difficulty === targetDifficulty && !usedContentIds.has(item.id)\n        );\n        \n        let count = 0;\n        for (const item of contentPool) {\n            if (count < 4) {\n                requiredContent.push({\n                    ...item,\n                    duration: adjustDuration(rating, item.duration),\n                    status: 'Pending',\n                });\n                usedContentIds.add(item.id);\n                count++;\n            }\n        }\n        \n        if (requiredContent.length < 4) {\n            const fallbackPool = CONTENT_LIBRARY.filter(item => \n                item.tier === currentTier && !usedContentIds.has(item.id)\n            );\n            for (const item of fallbackPool) {\n                 if (count < 4) {\n                    requiredContent.push({\n                        ...item,\n                        duration: adjustDuration(rating, item.duration),\n                        status: 'Pending',\n                    });\n                    usedContentIds.add(item.id);\n                    count++;\n                }\n            }\n        }\n        \n        plan.push({\n            month,\n            tier: currentTier,\n            theme,\n            requiredContent,\n            status: 'Pending',\n            reflectionText: '',\n            monthCompletedDate: null,\n            totalDuration: requiredContent.reduce((sum, item) => sum + item.duration, 0),\n        });\n    }\n\n    return {\n        ownerUid,\n        assessment,\n        plan,\n        currentMonth: 1,\n        latestScenario: null,\n        lastUpdate: new Date().toISOString(),\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/data/LeadershipTiers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/firebase/Hooks.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getFirestore' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'addDoc' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":80,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":86},{"ruleId":"no-unused-vars","severity":1,"message":"'collection' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":88,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":98},{"ruleId":"no-unused-vars","severity":1,"message":"'getCollectionPath' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":17,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, signOut } from 'firebase/auth';\nimport { getFirestore, doc, onSnapshot, setDoc, updateDoc, writeBatch, getDoc, addDoc, collection } from 'firebase/firestore'; \n\nimport { \n    useAppServices \n} from '../App'; // Assuming App context export is available via relative path or provided globally\n\nimport {\n    PDP_COLLECTION, PDP_DOCUMENT, COMMITMENT_COLLECTION, COMMITMENT_DOCUMENT, PLANNING_COLLECTION, \n    PLANNING_DOCUMENT, LEADERSHIP_TIERS, CONTENT_LIBRARY, COACHING_COLLECTION\n} from '../data/Constants'; \n\n// --- FIRESTORE PATHING UTILITY ---\nconst getPath = (collection, document, userId, appId) => \n    userId ? `/artifacts/${appId}/users/${userId}/${collection}/${document}` : null;\nconst getCollectionPath = (collection, userId, appId) => \n    userId ? `/artifacts/${appId}/users/${userId}/${collection}` : null;\n\n\n// --- COMMITMENT DEFAULTS (Moved from App.jsx) ---\nconst DEFAULT_COMMITMENT_DATA = {\n    lastCommitmentDate: new Date().toISOString().split('T')[0], \n    history: [\n        { date: '2025-10-10', score: '3/3' },\n        { date: '2025-10-16', score: '3/3' },\n    ],\n    active_commitments: [\n        { id: 102, text: 'Identify and block out 90 minutes for \"Deep Work\" on a high-leverage task.', status: 'Committed', linkedGoal: 'Improve Team Execution Quality', linkedTier: 'T3', targetColleague: null },\n    ],\n    reflection_journal: '',\n};\n\n// --- PLANNING DEFAULTS (Moved from App.jsx) ---\nconst DEFAULT_PLANNING_DATA = {\n    vision: 'To lead a team recognized globally for its innovative speed and psychological safety by 2028.',\n    mission: 'To empower every team member to take calculated risks and own the outcomes, driving a culture of continuous learning and customer-centric excellence.',\n    okrs: [\n        { id: 1, objective: 'Dramatically improve team execution quality and velocity', keyResults: [\n            { id: 101, kr: 'Reduce customer-reported bugs from 45 to 15 per quarter.' },\n            { id: 102, kr: 'Increase team code coverage on critical features from 70% to 95%.' }\n        ]},\n    ],\n    last_premortem_decision: 'N/A',\n};\n\n\n/**\n * Hook for PDP Data (Read/Write Roadmap)\n */\nexport const usePDPData = (db, userId, isAuthReady) => {\n    const { appId } = useAppServices();\n    const [pdpData, setPdpData] = useState(undefined); \n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    const pdpPath = getPath(PDP_COLLECTION, PDP_DOCUMENT, userId, appId);\n\n    useEffect(() => {\n        if (!db || !isAuthReady || !userId || !pdpPath) {\n             if(isAuthReady) setIsLoading(false);\n             return;\n        }\n\n        setError(null);\n        const docRef = doc(db, pdpPath);\n\n        const unsubscribe = onSnapshot(docRef, (docSnap) => {\n            if (docSnap.exists()) {\n                setPdpData(docSnap.data());\n            } else {\n                setPdpData(null);\n            }\n            setIsLoading(false);\n        }, (e) => {\n            console.error(\"Error subscribing to PDP data:\", e);\n            setError(\"Real-time data synchronization failed. Check network or security rules.\");\n            setIsLoading(false);\n            setPdpData(null); \n        });\n\n        return () => unsubscribe();\n    }, [db, userId, isAuthReady, pdpPath, appId]);\n\n    const updatePdpData = useCallback(async (dataToUpdate) => {\n        if (!db || !userId || !pdpPath) return false;\n        \n        try {\n            const docRef = doc(db, pdpPath);\n            await updateDoc(docRef, { ...dataToUpdate, lastUpdate: new Date().toISOString() });\n            return true;\n        } catch (e) {\n            console.error(\"Error updating PDP data:\", e);\n            return false;\n        }\n    }, [pdpPath, db, userId]);\n\n    const saveNewPlan = useCallback(async (newPlanData) => {\n        if (!db || !userId || !pdpPath) return false;\n        \n        try {\n            const docRef = doc(db, pdpPath);\n            await setDoc(docRef, { \n                ...newPlanData, \n                ownerUid: userId,\n                lastUpdate: new Date().toISOString(),\n                currentMonth: 1,\n            });\n            return true;\n        } catch (e) {\n            console.error(\"Error saving new PDP document:\", e);\n            return false;\n        }\n    }, [pdpPath, db, userId]);\n\n    return { pdpData, isLoading, error, updatePdpData, saveNewPlan };\n};\n\n\n/**\n * Hook for Commitment Data (Read/Write Daily Scorecard)\n */\nexport const useCommitmentData = (db, userId, isAuthReady) => {\n    const { appId } = useAppServices();\n    const [commitmentData, setCommitmentData] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    const commitmentPath = getPath(COMMITMENT_COLLECTION, COMMITMENT_DOCUMENT, userId, appId);\n\n    const needsReset = (data) => {\n        if (!data) return false;\n        const today = new Date().toISOString().split('T')[0];\n        return data.lastCommitmentDate !== today;\n    };\n\n    useEffect(() => {\n        if (!db || !isAuthReady || !userId || !commitmentPath) {\n             if(isAuthReady) setIsLoading(false);\n             return;\n        }\n\n        setError(null);\n        const docRef = doc(db, commitmentPath);\n\n        const unsubscribe = onSnapshot(docRef, async (docSnap) => {\n            let currentData;\n            if (docSnap.exists()) {\n                currentData = docSnap.data();\n            } else {\n                try {\n                    await setDoc(docRef, DEFAULT_COMMITMENT_DATA);\n                    currentData = DEFAULT_COMMITMENT_DATA;\n                } catch (e) {\n                    console.error(\"Error creating default Commitment document:\", e);\n                    setError(\"Could not initialize Commitment data.\");\n                    setIsLoading(false);\n                    return;\n                }\n            }\n\n            if (needsReset(currentData)) {\n                // --- DAILY RESET LOGIC ---\n                const today = new Date().toISOString().split('T')[0];\n                \n                const yesterdayScore = currentData.active_commitments.length > 0\n                    ? `${currentData.active_commitments.filter(c => c.status === 'Committed').length}/${currentData.active_commitments.length}`\n                    : '0/0';\n\n                const newHistory = [...currentData.history];\n                const lastDate = currentData.lastCommitmentDate;\n                \n                if (newHistory.length === 0 || newHistory[newHistory.length - 1].date !== lastDate) {\n                     newHistory.push({ date: lastDate, score: yesterdayScore });\n                }\n\n                if (newHistory.length > 7) {\n                    newHistory.splice(0, newHistory.length - 7);\n                }\n\n                const resetCommitments = currentData.active_commitments.map(c => ({\n                    ...c,\n                    status: 'Pending',\n                }));\n\n                const batch = writeBatch(db);\n                batch.update(docRef, {\n                    lastCommitmentDate: today,\n                    history: newHistory,\n                    active_commitments: resetCommitments,\n                    reflection_journal: '', \n                });\n\n                try {\n                    await batch.commit();\n                } catch (e) {\n                    console.error(\"Error resetting daily commitments via batch:\", e);\n                    setError(\"Failed to reset daily scorecard.\");\n                }\n            } else {\n                setCommitmentData(currentData);\n            }\n            setIsLoading(false);\n        }, (e) => {\n            console.error(\"Error subscribing to Commitment data:\", e);\n            setError(\"Commitment data synchronization failed.\");\n            setIsLoading(false);\n        });\n\n        return () => unsubscribe();\n    }, [db, userId, isAuthReady, commitmentPath, appId]);\n\n\n    const updateCommitmentData = useCallback(async (dataToUpdateOrFunction) => {\n        if (!db || !userId || !commitmentPath) return false;\n\n        try {\n            const docRef = doc(db, commitmentPath);\n            let dataToUpdate = dataToUpdateOrFunction;\n            \n            if (typeof dataToUpdateOrFunction === 'function') {\n                const docSnap = await getDoc(docRef);\n                const currentData = docSnap.exists() ? docSnap.data() : null;\n                if (!currentData) throw new Error(\"Commitment data not found for functional update.\");\n                \n                dataToUpdate = dataToUpdateOrFunction(currentData);\n            }\n\n            await updateDoc(docRef, dataToUpdate);\n            return true;\n        } catch (e) {\n            console.error(\"Error updating Commitment data:\", e);\n            return false;\n        }\n    }, [commitmentPath, db, userId]);\n\n    return { commitmentData, isLoading, error, updateCommitmentData };\n};\n\n\n/**\n * Hook for Planning Data (Read/Write Vision/OKRs/Pre-Mortem)\n */\nexport const usePlanningData = (db, userId, isAuthReady) => {\n    const { appId } = useAppServices();\n    const [planningData, setPlanningData] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    const planningPath = getPath(PLANNING_COLLECTION, PLANNING_DOCUMENT, userId, appId);\n\n    useEffect(() => {\n        if (!db || !isAuthReady || !userId || !planningPath) {\n            if(isAuthReady) setIsLoading(false);\n            return;\n        }\n\n        setError(null);\n        const docRef = doc(db, planningPath);\n\n        const unsubscribe = onSnapshot(docRef, async (docSnap) => {\n            if (docSnap.exists()) {\n                setPlanningData(docSnap.data());\n                setIsLoading(false);\n            } else {\n                try {\n                    await setDoc(docRef, DEFAULT_PLANNING_DATA);\n                    setPlanningData(DEFAULT_PLANNING_DATA);\n                    setIsLoading(false);\n                } catch (e) {\n                    console.error(\"Error creating default Planning document:\", e);\n                    setError(\"Could not initialize Planning data.\");\n                    setIsLoading(false);\n                }\n            }\n        }, (e) => {\n            console.error(\"Error subscribing to Planning data:\", e);\n            setError(\"Planning data synchronization failed.\");\n            setIsLoading(false);\n        });\n\n        return () => unsubscribe();\n    }, [db, userId, isAuthReady, planningPath, appId]);\n\n    const updatePlanningData = useCallback(async (dataToUpdate) => {\n        if (!db || !userId || !planningPath) return false;\n\n        try {\n            const docRef = doc(db, planningPath);\n            await updateDoc(docRef, dataToUpdate);\n            return true;\n        } catch (e) {\n            console.error(\"Error updating Planning data:\", e);\n            return false;\n        }\n    }, [planningPath, db, userId]);\n\n    return { planningData, isLoading, error, updatePlanningData };\n};\n\n// --- AUTH UTILITIES (Simplified, relying on Firebase SDK) ---\nexport const authService = {\n    async signIn(email, password) {\n        const auth = getAuth();\n        return signInWithEmailAndPassword(auth, email, password);\n    },\n    async signUp(email, password) {\n        const auth = getAuth();\n        return createUserWithEmailAndPassword(auth, email, password);\n    },\n    async resetPassword(email) {\n        const auth = getAuth();\n        return sendPasswordResetEmail(auth, email);\n    },\n    async signOut() {\n        const auth = getAuth();\n        return signOut(auth);\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/globals/notepad.js","messages":[{"ruleId":"no-inner-declarations","severity":2,"message":"Move function declaration to function body root.","line":14,"column":5,"nodeType":"FunctionDeclaration","messageId":"moveDeclToRoot","endLine":16,"endColumn":6},{"ruleId":"no-inner-declarations","severity":2,"message":"Move function declaration to function body root.","line":17,"column":5,"nodeType":"FunctionDeclaration","messageId":"moveDeclToRoot","endLine":21,"endColumn":6},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":19,"column":43,"nodeType":"BlockStatement","messageId":"unexpected","endLine":19,"endColumn":45,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[673,673],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":48,"column":88,"nodeType":"BlockStatement","messageId":"unexpected","endLine":48,"endColumn":90,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1505,1505],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n/* Global Notepad (safe side-effect module)\n   - Creates window.notepad/globalThis.notepad if absent\n   - No exports; pure side-effect for early import in main.jsx\n*/\n(function initNotepadGlobal(){\n  try {\n    var root = (typeof window !== 'undefined') ? window : (typeof globalThis !== 'undefined' ? globalThis : this);\n    if (root.notepad && typeof root.notepad.addContent === 'function') return;\n\n    var subs = new Set();\n    var state = { title: 'Notepad', lines: [] };\n\n    function snapshot(){\n      return { title: state.title, lines: state.lines.slice() };\n    }\n    function notify(){\n      subs.forEach(function(fn){\n        try { fn(snapshot()); } catch (e) {}\n      });\n    }\n\n    var api = {\n      setTitle: function(t){\n        state.title = String(t == null ? '' : t);\n        notify();\n        return state.title;\n      },\n      addContent: function(line){\n        state.lines.push({ ts: Date.now(), text: String(line == null ? '' : line) });\n        notify();\n        return state.lines.length;\n      },\n      get: function(){ return snapshot(); },\n      clear: function(){\n        state.lines.length = 0;\n        notify();\n      },\n      subscribe: function(fn){\n        if (typeof fn !== 'function') return function(){};\n        subs.add(fn);\n        return function(){ subs.delete(fn); };\n      }\n    };\n\n    root.notepad = api;\n    // mirror to globalThis as well (in case window is shadowed)\n    try { if (typeof globalThis !== 'undefined') globalThis.notepad = api; } catch (e) {}\n  } catch (e) {\n    // If anything unexpected happens, do not block app boot\n    console.error('Notepad global failed to initialize:', e);\n  }\n})();\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/lib/firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/main.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file has exports. Move your component(s) to a separate file.","line":45,"column":10,"nodeType":"Identifier","messageId":"noExport","endLine":45,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Suspense, lazy } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport './styles/global.css';\n\n// FIX: Removed the unnecessary import of AppServicesProvider since DataProvider is used in App.jsx.\n// import { AppServicesProvider } from './services/useAppServices.jsx'; \n\n// === PWA SERVICE WORKER REGISTRATION ===\nconst registerServiceWorker = () => {\n  // Check if Service Workers are supported by the browser\n  if ('serviceWorker' in navigator) {\n    // Vite PWA plugin generates the worker as /sw.js in production build\n    navigator.serviceWorker.register('/sw.js', { scope: '/' })\n      .then((registration) => {\n        console.log('SW registered successfully:', registration);\n      })\n      .catch((error) => {\n        console.error('SW registration failed:', error);\n      });\n  }\n};\n// === END PWA SERVICE WORKER REGISTRATION ===\n\n/** Error boundary so crashes don’t white-screen */\nclass ErrorBoundary extends React.Component {\n  constructor(p) { super(p); this.state = { hasError: false, error: null }; }\n  static getDerivedStateFromError(error) { return { hasError: true, error }; }\n  componentDidCatch(err, info) { console.error('App crash:', err, info); }\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div style={{ padding: 24, maxWidth: 720, margin: '48px auto', lineHeight: 1.5 }}>\n          <h2>Something went wrong</h2>\n          <pre style={{ whiteSpace: 'pre-wrap', background: '#f6f8fa', padding: 12, borderRadius: 8 }}>\n            {String(this.state.error)}\n          </pre>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\n/** Parse Firebase config from Vite env (one-line JSON). Show a friendly screen if missing. */\nfunction ConfigGate({ children }) {\n  // NOTE: This config reading logic relies on Vite's import.meta.env, \n  // which works even when hosted on GitHub Pages after a Vite build.\n  const raw = import.meta.env.VITE_FIREBASE_CONFIG;\n  let cfg = null, err = null;\n  \n  if (!raw) {\n    // Since we are moving from Netlify to a GitHub Pages/Vite pipeline, the VITE_FIREBASE_CONFIG \n    // must be injected either via a CI tool (like GitHub Actions) or a manual placeholder.\n    // However, for Vite build to complete successfully, the placeholder must often resolve.\n    // We will leave this warning for debugging the build environment variables.\n    err = 'VITE_FIREBASE_CONFIG is missing. Set it in your CI/Build environment variables.';\n  } else {\n    try {\n      cfg = typeof raw === 'string' ? JSON.parse(raw) : raw;\n    } catch (e1) {\n      try {\n        const cleaned = String(raw).trim().replace(/(\\r\\n|\\n|\\r)/g, '').replace(/'/g, '\"');\n        cfg = JSON.parse(cleaned);\n        console.warn('VITE_FIREBASE_CONFIG required sanitizing; parsed successfully.');\n      } catch (e2) {\n        err = 'VITE_FIREBASE_CONFIG is not valid JSON.';\n      }\n    }\n  }\n\n  const required = ['apiKey', 'authDomain', 'projectId', 'appId'];\n  const missing = cfg ? required.filter(k => !cfg[k]) : required;\n\n  if (err || missing.length) {\n    return (\n      <div style={{ padding: 24, maxWidth: 720, margin: '48px auto', lineHeight: 1.6 }}>\n        <h2>App not configured</h2>\n        <p>The site is missing required Firebase configuration, so the app can’t start. Add this one-line JSON:</p>\n        <pre style={{ whiteSpace: 'pre-wrap', background: '#f6f8fa', padding: 12, borderRadius: 8 }}>\n{`VITE_FIREBASE_CONFIG={\"apiKey\":\"…\",\"authDomain\":\"…\",\"projectId\":\"…\",\"appId\":\"…\",\"storageBucket\":\"…\",\"messagingSenderId\":\"…\"}\n`}\n        </pre>\n        {err && <p style={{ color: '#b00020' }}><strong>Error:</strong> {err}</p>}\n        {missing && missing.length > 0 && <p><strong>Missing keys:</strong> {missing.join(', ')}</p>}\n      </div>\n    );\n  }\n\n  // Expose for clients that read from window (optional)\n  if (typeof window !== 'undefined') window.__firebase_config = cfg;\n\n  return children;\n}\n\nconst App = lazy(() => import('./App.jsx')); // default export assumed\n\nconst container = document.getElementById('root');\nif (!container) {\n  throw new Error('Root element with id=\"root\" not found. Ensure <div id=\"root\"></div> exists in index.html.');\n}\n\n// 1. Register the Service Worker right away\nregisterServiceWorker(); \n\ncreateRoot(container).render(\n  <React.StrictMode>\n    <ErrorBoundary>\n      <ConfigGate>\n        {/* FIX: Removed the superfluous AppServicesProvider wrapper around the App component */}\n        <Suspense fallback={<div className=\"p-8 text-center\">Loading…</div>}>\n          <App />\n        </Suspense>\n      </ConfigGate>\n    </ErrorBoundary>\n  </React.StrictMode>\n);","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/providers/DataProvider.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'services'. Either include it or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [userId, db, isAuthReady, services]","fix":{"range":[1973,1998],"text":"[userId, db, isAuthReady, services]"}}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":236,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":236,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7118,7118],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'apiKey'. Either exclude it or remove the dependency array.","line":258,"column":5,"nodeType":"ArrayExpression","endLine":258,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [hasGeminiKey]","fix":{"range":[7740,7762],"text":"[hasGeminiKey]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/providers/DataProvider.jsx\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { AppServiceContext, createAppServices } from '../services/useAppServices.jsx';\n\nconst resolveGlobalMetadata = (meta) => {\n  return meta && typeof meta === 'object' ? meta : {};\n};\n\nconst DataProvider = ({\n  children,\n  firebaseServices,\n  userId,\n  isAuthReady,\n  navigate,\n  user,\n}) => {\n  const { db, auth } = firebaseServices;\n  const [services, setServices] = useState(null);\n  const [isLoadingServices, setIsLoadingServices] = useState(true);\n  const [serviceData, setServiceData] = useState({\n    developmentPlanData: null,\n    dailyPracticeData: null,\n    strategicContentData: null,\n    membershipData: null,\n    globalMetadata: null,\n  });\n\n  useEffect(() => {\n    if (!userId || !db || !isAuthReady) {\n      setServices(null);\n      setIsLoadingServices(false);\n      return;\n    }\n\n    setIsLoadingServices(true);\n    try {\n      const createdServices = createAppServices(db, userId);\n      createdServices.setOnChange((data) => {\n        setServiceData(data);\n        if (\n          data.globalMetadata !== null ||\n          data.dailyPracticeData !== null ||\n          data.developmentPlanData !== null ||\n          data.membershipData !== null\n        ) {\n          setIsLoadingServices(false);\n        }\n      });\n      setServices(createdServices);\n      setServiceData({\n        developmentPlanData: createdServices.developmentPlanData,\n        dailyPracticeData: createdServices.dailyPracticeData,\n        strategicContentData: createdServices.strategicContentData,\n        membershipData: createdServices.membershipData,\n        globalMetadata: createdServices.globalMetadata,\n      });\n    } catch (error) {\n      console.error('[DataProvider] Error creating services:', error);\n      setServices(null);\n      setIsLoadingServices(false);\n    }\n\n    return () => {\n      if (services) {\n        services.cleanup();\n      }\n    };\n  }, [userId, db, isAuthReady]);\n\n  const devPlanHook = useMemo(\n    () =>\n      services\n        ? {\n            developmentPlanData: serviceData.developmentPlanData,\n            updateDevelopmentPlanData: services.updateDevelopmentPlanData,\n            isLoading: false,\n            error: null,\n          }\n        : {\n            developmentPlanData: null,\n            updateDevelopmentPlanData: null,\n            isLoading: isLoadingServices,\n            error: null,\n          },\n    [services, serviceData.developmentPlanData, isLoadingServices]\n  );\n\n  const dailyPracticeHook = useMemo(\n    () =>\n      services\n        ? {\n            dailyPracticeData: serviceData.dailyPracticeData,\n            updateDailyPracticeData: services.updateDailyPracticeData,\n            isLoading: false,\n            error: null,\n          }\n        : {\n            dailyPracticeData: null,\n            updateDailyPracticeData: null,\n            isLoading: isLoadingServices,\n            error: null,\n          },\n    [services, serviceData.dailyPracticeData, isLoadingServices]\n  );\n\n  const strategicContentHook = useMemo(\n    () =>\n      services\n        ? {\n            strategicContentData: serviceData.strategicContentData,\n            updateStrategicContentData: services.updateStrategicContentData,\n            isLoading: false,\n            error: null,\n          }\n        : {\n            strategicContentData: null,\n            updateStrategicContentData: null,\n            isLoading: isLoadingServices,\n            error: null,\n          },\n    [services, serviceData.strategicContentData, isLoadingServices]\n  );\n\n  const membershipHook = useMemo(\n    () =>\n      services\n        ? {\n            membershipData: serviceData.membershipData,\n            updateMembershipData: services.updateMembershipData,\n            isLoading: false,\n            error: null,\n          }\n        : {\n            membershipData: null,\n            updateMembershipData: null,\n            isLoading: isLoadingServices,\n            error: null,\n          },\n    [services, serviceData.membershipData, isLoadingServices]\n  );\n\n  const globalHook = useMemo(\n    () =>\n      services\n        ? {\n            metadata: serviceData.globalMetadata,\n            isLoading: false,\n            error: null,\n          }\n        : { metadata: null, isLoading: isLoadingServices, error: null },\n    [services, serviceData.globalMetadata, isLoadingServices]\n  );\n\n  const resolvedMetadata = useMemo(\n    () => resolveGlobalMetadata(globalHook.metadata),\n    [globalHook.metadata]\n  );\n\n  const isAdmin = useMemo(() => {\n    const PRIMARY_ADMIN_EMAILS = ['rob@sagecg.com', 'admin@leaderreps.com'];\n    const adminEmails = resolvedMetadata.adminemails || [];\n    const userEmail = user?.email?.toLowerCase();\n    const isPrimaryAdmin = !!userEmail && PRIMARY_ADMIN_EMAILS.includes(userEmail);\n    return (\n      isPrimaryAdmin ||\n      (!!userEmail && Array.isArray(adminEmails) && adminEmails.includes(userEmail))\n    );\n  }, [user, resolvedMetadata]);\n\n  const hasPendingDailyPractice = useMemo(() => {\n    const dailyData = dailyPracticeHook.dailyPracticeData;\n    const todayStr = new Date().toISOString().split('T')[0];\n    const hasPendingTargetRep =\n      dailyData?.dailyTargetRepStatus === 'Pending' &&\n      dailyData?.dailyTargetRepDate === todayStr &&\n      !!dailyData?.dailyTargetRepId;\n    const hasPendingAdditionalReps = (dailyData?.activeCommitments || []).some(\n      (c) => c.status === 'Pending'\n    );\n    return hasPendingTargetRep || hasPendingAdditionalReps;\n  }, [dailyPracticeHook.dailyPracticeData]);\n\n  const apiKey = useMemo(() => {\n    return (\n      resolvedMetadata.API_KEY ||\n      (typeof window.__GEMINI_API_KEY !== 'undefined'\n        ? window.__GEMINI_API_KEY\n        : '')\n    );\n  }, [resolvedMetadata.API_KEY]);\n\n  const hasGeminiKey = useCallback(() => !!apiKey, [apiKey]);\n\n  const callSecureGeminiAPI = useCallback(\n    async (payload) => {\n      if (!hasGeminiKey()) {\n        console.error(\n          \"Gemini API Key check failed in callSecureGeminiAPI. Ensure it's loaded correctly.\"\n        );\n        throw new Error('Gemini API Key is missing or not configured.');\n      }\n\n      const YOUR_BACKEND_ENDPOINT_URL =\n        'YOUR_SECURE_CLOUD_FUNCTION_URL_HERE';\n\n      if (\n        YOUR_BACKEND_ENDPOINT_URL === 'YOUR_SECURE_CLOUD_FUNCTION_URL_HERE'\n      ) {\n        console.error(\n          'CRITICAL SETUP ERROR: The backend endpoint URL for callSecureGeminiAPI has not been set in App.jsx.'\n        );\n        throw new Error(\n          'AI Rep Coach backend is not configured. Please contact the administrator.'\n        );\n      }\n\n      try {\n        const requestOptions = {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n        };\n\n        const response = await fetch(\n          YOUR_BACKEND_ENDPOINT_URL,\n          requestOptions\n        );\n\n        if (!response.ok) {\n          let errorBody = 'Could not retrieve error details.';\n          try {\n            errorBody = await response.text();\n          } catch (_) {}\n          console.error(\n            `[callSecureGeminiAPI] Backend call failed with status ${response.status}:`,\n            errorBody\n          );\n          throw new Error(\n            `The AI Rep Coach backend returned an error (Status ${response.status}).`\n          );\n        }\n\n        const data = await response.json();\n        return data;\n      } catch (error) {\n        console.error(\n          '[callSecureGeminiAPI] Error during fetch to backend:',\n          error\n        );\n        throw new Error(\n          `Failed to communicate with the AI Rep Coach: ${error.message}`\n        );\n      }\n    },\n    [hasGeminiKey, apiKey]\n  );\n\n  const appServicesValue = useMemo(() => {\n    const geminiModel = resolvedMetadata.GEMINI_MODEL || 'gemini-1.5-flash';\n    const convertedFeatureFlags = Object.fromEntries(\n      Object.entries(resolvedMetadata.featureFlags || {}).map(\n        ([key, value]) => [\n          key,\n          value === true || value === 'true' || value === 1,\n        ]\n      )\n    );\n\n    return {\n      // Core Services\n      db,\n      auth,\n      navigate,\n      user,\n      userId,\n      isAdmin,\n      hasPendingDailyPractice,\n\n      // Feature Flags\n      featureFlags: convertedFeatureFlags,\n\n      // Data Hooks\n      ...devPlanHook,\n      ...dailyPracticeHook,\n      ...strategicContentHook,\n      ...membershipHook,\n      ...globalHook,\n\n      // Gemini API\n      apiKey,\n      geminiModel,\n      hasGeminiKey,\n      callSecureGeminiAPI,\n    };\n  }, [\n    db,\n    auth,\n    navigate,\n    user,\n    userId,\n    isAdmin,\n    hasPendingDailyPractice,\n    resolvedMetadata,\n    devPlanHook,\n    dailyPracticeHook,\n    strategicContentHook,\n    membershipHook,\n    globalHook,\n    apiKey,\n    hasGeminiKey,\n    callSecureGeminiAPI,\n  ]);\n\n  return (\n    <AppServiceContext.Provider value={appServicesValue}>\n      {children}\n    </AppServiceContext.Provider>\n  );\n};\n\nexport default DataProvider;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/routing/ScreenRouter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/services/membershipService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/services/useAppServices.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'deleteField' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":14},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":61,"column":15,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":61,"endColumn":29,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[2160,2179],"text":"Object.prototype.hasOwnProperty.call(obj, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":144,"column":15,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":144,"endColumn":29,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[4888,4907],"text":"Object.prototype.hasOwnProperty.call(val, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updateDocEx' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":366,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":366,"endColumn":18},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":415,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":415,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":526,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":526,"endColumn":40},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":533,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":533,"endColumn":38},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":547,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":547,"endColumn":41},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":555,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":555,"endColumn":34},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":659,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":659,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":668,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":668,"endColumn":34},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":774,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":774,"endColumn":31},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":907,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":907,"endColumn":34},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":929,"column":59,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":929,"endColumn":73,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[34361,34381],"text":"Object.prototype.hasOwnProperty.call(data, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'useCatalogDoc' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":933,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":933,"endColumn":20},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":979,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":979,"endColumn":30},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":991,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":991,"endColumn":31}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/services/useAppServices.jsx (FINAL CORRECTED VERSION)\n// Custom for rob@sagecg.com - Scales to 10,000+ users\n// \n// CRITICAL FIX (10/30/25): Comprehensive Firebase sentinel stripping\n// - Enhanced stripSentinels() to catch ALL sentinel types (FieldValue, ServerTimestampTransform, etc.)\n// - Applied to ALL Firestore listeners (devPlan, dailyPractice, strategic, membership, metadata, catalogs)\n// - Prevents React Error #31 from sentinel objects in state\n// - Fixes development plan generation bug where data disappeared after save\n\nimport React, {\n  useMemo,\n  useCallback,\n  useContext,\n  createContext,\n  useState,\n  useEffect,\n} from 'react';\n\nimport {\n  doc as fsDoc,\n  setDoc as fsSetDoc,\n  onSnapshot as fsOnSnapshot,\n  getDoc as fsGetDoc,\n  updateDoc as fsUpdateDoc, \n  serverTimestamp, \n  deleteField \n} from 'firebase/firestore';\n\n// Import specific icons used within this service\nimport { HeartPulse, Briefcase, Users, AlertTriangle, TrendingUp, Zap, ShieldCheck, Target, BarChart3, BookOpen, Film, Trello, Mic, Clock, Cpu, User as UserIcon, DollarSign } from 'lucide-react'; \n\nconsole.log('🔥🔥🔥 useAppServices.jsx LOADED - CLEAN STRUCTURE VERSION (Option B) 🔥🔥🔥');\n\n/* =========================================================\n   HELPER FUNCTION: Sanitize Firestore Timestamps\n========================================================= */\n// Recursively converts all Firestore Timestamp objects to JavaScript Date objects\n// This prevents React Error #31 when trying to render timestamp objects\nconst sanitizeTimestamps = (obj) => {\n  if (!obj) return obj;\n  \n  // Handle arrays\n  if (Array.isArray(obj)) {\n    return obj.map(item => sanitizeTimestamps(item));\n  }\n  \n  // Handle Firestore Timestamp objects (have toDate method)\n  if (obj && typeof obj === 'object' && typeof obj.toDate === 'function') {\n    try {\n      return obj.toDate();\n    } catch (error) {\n      console.warn('[sanitizeTimestamps] Error converting timestamp:', error);\n      return null;\n    }\n  }\n  \n  // Handle plain objects\n  if (obj && typeof obj === 'object' && obj.constructor === Object) {\n    const sanitized = {};\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        sanitized[key] = sanitizeTimestamps(obj[key]);\n      }\n    }\n    return sanitized;\n  }\n  \n  return obj;\n};\n\n/* =========================================================\n   HELPER FUNCTION: Strip FieldValue Sentinels (COMPREHENSIVE)\n========================================================= */\n// Removes ALL types of FieldValue sentinels (deleteField, serverTimestamp, increment, etc.)\n// This prevents React Error #31 when optimistic updates include sentinels\n// CRITICAL: Must catch ALL sentinel variations to prevent state corruption\nconst stripSentinels = (val) => {\n  // Handle null, undefined, and primitives\n  if (!val || typeof val !== 'object') {\n    return val;\n  }\n  \n  // COMPREHENSIVE SENTINEL DETECTION\n  // Check multiple ways sentinels can manifest:\n  const isSentinel = (\n    // Method 1: Check constructor name (most reliable)\n    val.constructor?.name === 'FieldValue' ||\n    val.constructor?.name === 'ServerTimestampTransform' ||\n    val.constructor?.name === 'DeleteFieldValueImpl' ||\n    val.constructor?.name === 'NumericIncrementFieldValueImpl' ||\n    val.constructor?.name === 'ArrayUnionFieldValueImpl' ||\n    val.constructor?.name === 'ArrayRemoveFieldValueImpl' ||\n    \n    // Method 2: Check for _methodName property (legacy)\n    (val._methodName && typeof val._methodName === 'string') ||\n    \n    // Method 3: Check for sentinel methods\n    val._methodName === 'serverTimestamp' ||\n    val._methodName === 'delete' ||\n    val._methodName === 'increment' ||\n    val._methodName === 'arrayUnion' ||\n    val._methodName === 'arrayRemove' ||\n    \n    // Method 4: Has toJSON but is NOT a Date or Timestamp\n    (val.toJSON && \n     typeof val.toJSON === 'function' && \n     !val.toISOString && // Not a Date\n     !val.toDate) // Not a Firestore Timestamp\n  );\n  \n  if (isSentinel) {\n    console.warn('[stripSentinels] 🛑 Removing Firebase sentinel:', {\n      constructor: val.constructor?.name,\n      methodName: val._methodName,\n      type: typeof val\n    });\n    return null; // Return null instead of undefined for clearer filtering\n  }\n  \n  // Preserve Date objects\n  if (val instanceof Date) {\n    return val;\n  }\n  \n  // Preserve Firestore Timestamps (they have toDate method)\n  if (val.toDate && typeof val.toDate === 'function') {\n    return val;\n  }\n  \n  // Handle arrays\n  if (Array.isArray(val)) {\n    const cleaned = val\n      .map(item => stripSentinels(item))\n      .filter(item => item !== null && item !== undefined);\n    return cleaned;\n  }\n  \n  // Handle objects - recursively strip sentinels from all properties\n  if (val && typeof val === 'object') {\n    const cleaned = {};\n    let sentinelCount = 0;\n    \n    for (const key in val) {\n      if (val.hasOwnProperty(key)) {\n        const cleanedValue = stripSentinels(val[key]);\n        \n        // Only add non-null, non-undefined values\n        if (cleanedValue !== null && cleanedValue !== undefined) {\n          cleaned[key] = cleanedValue;\n        } else if (cleanedValue === null) {\n          // Sentinel was removed\n          sentinelCount++;\n        }\n      }\n    }\n    \n    if (sentinelCount > 0) {\n      console.log(`[stripSentinels] ✅ Stripped ${sentinelCount} sentinel(s) from object`);\n    }\n    \n    return cleaned;\n  }\n  \n  return val;\n};\n\n\n/* =========================================================\n   HELPER FUNCTION: Detect Firestore FieldValue Sentinels\n   and Delete-Aware UI Merge (prevents React error #31)\n========================================================= */\nconst isFirestoreSentinel = (v) =>\n  v && typeof v === 'object' && typeof v._methodName === 'string';\n\n/**\n * Deep, delete-aware merge for optimistic UI updates.\n * - If patch value is a Firestore sentinel => delete that key locally.\n * - If object => recurse\n * - If array => replace (arrays are not merged)\n * - Never returns sentinel objects (so it's safe for React state).\n */\nfunction applyPatchDeleteAware(prev, patch) {\n  // Pass through primitives/null\n  if (patch === null || typeof patch !== 'object') return patch;\n\n  // Arrays: replace whole branch after removing sentinels\n  if (Array.isArray(patch)) {\n    return stripSentinels(patch);\n  }\n\n  // Objects\n  const base =\n    prev && typeof prev === 'object' && !Array.isArray(prev) ? { ...prev } : {};\n\n  for (const [k, v] of Object.entries(patch)) {\n    if (isFirestoreSentinel(v)) {\n      // deleteField() => remove locally for optimistic UI\n      delete base[k];\n      continue;\n    }\n    if (v && typeof v === 'object' && !Array.isArray(v)) {\n      base[k] = applyPatchDeleteAware(base[k], v);\n    } else {\n      base[k] = v;\n    }\n  }\n  return base;\n}\n\n\n/* =========================================================\n   Mock fallback (keeps the app usable without Firestore)\n========================================================= */\nconst __firestore_mock_store =\n  typeof window !== 'undefined'\n    ? window.__firestore_mock_store || (window.__firestore_mock_store = {})\n    : {};\n\nconst createMockSnapshot = (docPath, data, exists = true) => ({\n  exists: () => exists,\n  data: () => data,\n  docRef: docPath, \n  _md: { fromCache: false, pendingWrites: false },\n});\n\nconst mockSetDoc = async (docRefPath, data) => {\n  __firestore_mock_store[docRefPath] = data;\n  console.log(`[MOCK SET] Path: ${docRefPath}`, data); \n  return true;\n};\n\nconst mockGetDoc = async (docPath) => {\n  const d = __firestore_mock_store[docPath];\n  console.log(`[MOCK GET] Path: ${docPath}`, d ? '(Found)' : '(Not Found)'); \n  return createMockSnapshot(docPath, d || {}, !!d);\n};\n\nconst mockDoc = (db, ...pathSegments) => pathSegments.join('/');\n\nconst mockUpdateDoc = async (docRefPath, data) => {\n    const existingData = __firestore_mock_store[docRefPath] || {};\n    __firestore_mock_store[docRefPath] = { ...existingData, ...data };\n    console.log(`[MOCK UPDATE] Path: ${docRefPath}`, data); \n    return true;\n};\n\n/* =========================================================\n   Real Firestore wrappers \n========================================================= */\n\n// REQ #5 (BUG FIX): Helper function to remove 'undefined' values before saving to Firestore\nconst cleanUndefinedValues = (obj) => {\n  if (typeof obj !== 'object' || obj === null) return obj;\n  if (Array.isArray(obj)) return obj.map(cleanUndefinedValues);\n  \n  const newObj = {};\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      const value = obj[key];\n      if (value !== undefined) {\n        newObj[key] = cleanUndefinedValues(value); // Recurse\n      } else {\n        console.warn(`[cleanUndefinedValues] Removed 'undefined' from key: ${key}`);\n      }\n    }\n  }\n  return newObj;\n};\n\n\nconst toDocRef = (db, path) => fsDoc(db, ...path.split('/'));\n\nconst onSnapshotEx = (db, path, cb) => {\n  if (!db) {\n      console.warn(`[onSnapshotEx] No Firestore DB instance provided for path: ${path}. Using mock (no-op).`);\n      return () => {}; \n  }\n  try {\n      return fsOnSnapshot(\n          toDocRef(db, path),\n          { includeMetadataChanges: true },\n          (snap) =>\n          cb({\n              exists: () => snap.exists(),\n              data: () => snap.data(),\n              docRef: path,\n              _md: {\n                  fromCache: snap.metadata.fromCache,\n                  pendingWrites: snap.metadata.hasPendingWrites,\n              },\n          }),\n          (error) => { \n              console.error(`[onSnapshotEx ERROR] Path: ${path}`, error);\n          }\n      );\n  } catch (error) {\n      console.error(`[onSnapshotEx SETUP FAILED] Path: ${path}`, error);\n      return () => {}; \n  }\n};\n\nconst getDocEx = async (db, path) => {\n  if (!db) {\n      console.warn(`[getDocEx] No Firestore DB instance provided for path: ${path}. Using mock.`);\n      return mockGetDoc(path);\n  }\n  try {\n      const snap = await fsGetDoc(toDocRef(db, path));\n      return {\n          exists: () => snap.exists(),\n          data: () => snap.data(),\n          docRef: path,\n      };\n  } catch (error) {\n      console.error(`[getDocEx FAILED] Path: ${path}`, error);\n      return createMockSnapshot(path, {}, false);\n  }\n};\n\nconst setDocEx = async (db, path, data, merge = false) => {\n  console.log(`[setDocEx] ===== START =====`);\n  console.log(`[setDocEx] Path: ${path}`);\n  // console.log(`[setDocEx] Data (Raw):`, data); // Too noisy\n  console.log(`[setDocEx] Merge: ${merge}`);\n  console.log(`[setDocEx] DB exists: ${!!db}`);\n  \n  if (!db) {\n      console.warn(`[setDocEx] No Firestore DB instance provided for path: ${path}. Using mock.`);\n      return mockSetDoc(path, data);\n  }\n  \n  try {\n      // REQ #5 (BUG FIX): Clean data of undefined values\n      console.log(`[setDocEx] Cleaning data for Firestore...`);\n      const cleanedData = cleanUndefinedValues(data);\n      \n      console.log(`[setDocEx] Creating dataWithTimestamp...`);\n      const dataWithTimestamp = { ...cleanedData, _updatedAt: serverTimestamp() };\n      \n      console.log(`[setDocEx] Creating document reference for path: ${path}`);\n      const docRef = toDocRef(db, path);\n      console.log(`[setDocEx] Document reference created:`, docRef);\n      \n      console.log(`[setDocEx] Calling fsSetDoc...`);\n      await fsSetDoc(docRef, dataWithTimestamp, merge ? { merge: true } : undefined);\n      console.log(`[setDocEx SUCCESS] ===== Path: ${path}, Merge: ${merge} =====`);\n      return true; \n  } catch (error) {\n      console.error(`[setDocEx FAILED] ===== CRITICAL ERROR =====`);\n      console.error(`[setDocEx FAILED] Path: ${path}`);\n      console.error(`[setDocEx FAILED] Error object:`, error);\n      console.error(`[setDocEx FAILED] Error code:`, error?.code);\n      console.error(`[setDocEx FAILED] Error message:`, error?.message);\n      console.error(`[setDocEx FAILED] Error name:`, error?.name);\n      console.error(`[setDocEx FAILED] Full error details:`, { \n        code: error?.code, \n        message: error?.message,\n        name: error?.name,\n        stack: error?.stack,\n        toString: error?.toString()\n      });\n      return false; \n  }\n};\n\nconst updateDocEx = async (db, path, data) => {\n    if (!db) {\n        console.warn(`[updateDocEx] No Firestore DB instance provided for path: ${path}. Using mock.`);\n        return mockUpdateDoc(path, data);\n    }\n    if (!data || typeof data !== 'object' || Object.keys(data).length === 0) {\n        console.warn(`[updateDocEx] Attempted to update with empty data object for path: ${path}. Skipping.`);\n        return true; \n    }\n    try {\n        // REQ #5 (BUG FIX): Clean data of undefined values\n        const cleanedData = cleanUndefinedValues(data);\n\n        const dataWithTimestamp = { ...cleanedData, _updatedAt: serverTimestamp() };\n        console.log(`[updateDocEx] Attempting update to path: ${path}`, { data: dataWithTimestamp });\n        await fsUpdateDoc(toDocRef(db, path), dataWithTimestamp);\n        console.log(`[updateDocEx SUCCESS] Path: ${path}`, data); \n        return true;\n    } catch (error) {\n        console.error(`[updateDocEx FAILED] Path: ${path}`, error);\n        console.error(`[updateDocEx FAILED] Error details:`, { \n          code: error.code, \n          message: error.message,\n          name: error.name \n        });\n        return false;\n    }\n};\n\n// ==================== NEW CLEAN PATH STRUCTURE ====================\n// ALL USER DATA NOW LIVES IN: modules/{userId}/{moduleName}/{docName}\n// This scales perfectly for 10,000+ users\n// =================================================================\n\n/**\n * Build path for user modules (NEW CLEAN STRUCTURE)\n */\nconst buildModulePath = (uid, moduleName, docName) => {\n  return `modules/${uid}/${moduleName}/${docName}`;\n};\n\n/**\n * Build path for user profile (FIXED: 2 segments for document)\n */\nconst buildUserProfilePath = (uid) => {\n  return `users/${uid}`;\n};\n\n// --- ensureUserDocs: Create required per-user docs if missing (CLEAN STRUCTURE) ---\nexport const ensureUserDocs = async (db, uid) => {\n  console.log(`[ensureUserDocs] Running for UID: ${uid} (CLEAN STRUCTURE)`); \n  try {\n    if (!db || !uid) {\n        console.warn('[ensureUserDocs] DB or UID missing, skipping.');\n        return;\n    }\n\n    const todayStr = new Date().toISOString().split('T')[0]; \n\n    // ==================== USER PROFILE ====================\n    const userProfilePath = buildUserProfilePath(uid);\n    const userProfileSnap = await getDocEx(db, userProfilePath);\n    \n    if (!userProfileSnap.exists()) {\n        console.log(`[ensureUserDocs] Creating user profile at: ${userProfilePath}`);\n        await setDocEx(db, userProfilePath, {\n            userId: uid,\n            createdAt: new Date().toISOString(),\n            _createdAt: serverTimestamp()\n        });\n    }\n\n    // ==================== DEVELOPMENT PLAN MODULE ====================\n    const devPlanPath = buildModulePath(uid, 'development_plan', 'current');\n    const devPlanSnap = await getDocEx(db, devPlanPath);\n    \n    if (!devPlanSnap.exists()) {\n        console.log(`[ensureUserDocs] Creating development plan at: ${devPlanPath}`);\n        const defaultPlan = {\n            currentCycle: 1,\n            createdAt: serverTimestamp(),\n            lastAssessmentDate: null,\n            assessmentHistory: [], \n            planHistory: [],\n            // NOTE: 'currentPlan' is the container, which is what the component checks for.\n            currentPlan: null, \n        };\n        await setDocEx(db, devPlanPath, defaultPlan);\n    }\n\n    // ==================== DAILY PRACTICE MODULE ====================\n    const dailyPracticePath = buildModulePath(uid, 'daily_practice', 'current');\n    const dailyPracticeSnap = await getDocEx(db, dailyPracticePath);\n    \n    if (!dailyPracticeSnap.exists()) {\n        console.log(`[ensureUserDocs] Creating daily practice at: ${dailyPracticePath}`);\n        const defaultDailyPractice = {\n            activeCommitments: [], \n            identityAnchor: '', \n            habitAnchor: '', \n            // Add the new whyStatement\n            whyStatement: '',\n            dailyTargetRepId: null, \n            dailyTargetRepDate: null, \n            dailyTargetRepStatus: 'Pending', \n            streakCount: 0,\n            streakCoins: 0,\n            lastUpdated: todayStr,\n            completedRepsToday: [],\n            _createdAt: serverTimestamp()\n        };\n        await setDocEx(db, dailyPracticePath, defaultDailyPractice);\n    }\n\n    // ==================== STRATEGIC CONTENT MODULE ====================\n    const strategicPath = buildModulePath(uid, 'strategic_content', 'vision_mission');\n    const strategicSnap = await getDocEx(db, strategicPath);\n    \n    if (!strategicSnap.exists()) {\n        console.log(`[ensureUserDocs] Creating strategic content at: ${strategicPath}`);\n        const defaultStrategic = {\n            vision: '',\n            mission: '',\n            values: [],\n            goals: [],\n            purpose: '',\n            _createdAt: serverTimestamp()\n        };\n        await setDocEx(db, strategicPath, defaultStrategic);\n    }\n    \n    // ==================== MEMBERSHIP MODULE (NEW) ====================\n    const membershipPath = buildModulePath(uid, 'membership', 'current');\n    const membershipSnap = await getDocEx(db, membershipPath);\n\n    if (!membershipSnap.exists()) {\n        console.log(`[ensureUserDocs] Creating membership data at: ${membershipPath}`);\n        const defaultMembership = {\n            status: 'Trial', // Default to Trial or Free\n            currentPlanId: 'trial',\n            nextBillingDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 7 days trial\n            paymentHistory: [],\n            notifications: [\n                { id: 'welcome', message: 'Welcome to your 7-day free trial! Upgrade now to maintain access.', type: 'warning', isRead: false }\n            ],\n            _createdAt: serverTimestamp()\n        };\n        await setDocEx(db, membershipPath, defaultMembership);\n    }\n\n\n    console.log('[ensureUserDocs] All required documents verified/created (CLEAN STRUCTURE)');\n  } catch (e) {\n    console.error('[ensureUserDocs] Error:', e);\n  }\n};\n\n/* =========================================================\n   Mock Data (fallback for when Firestore isn't available)\n========================================================= */\nexport const MOCK_DEVELOPMENT_PLAN_DATA = {\n  currentPlan: null, // Ensure mock reflects reality\n  assessmentHistory: [],\n  planHistory: [],\n  currentCycle: 1,\n};\n\nexport const MOCK_DAILY_PRACTICE_DATA = {\n  lastUpdated: new Date().toISOString().split('T')[0],\n  dailyTargetRepId: null,\n  dailyTargetRepStatus: 'Pending',\n  dailyTargetRepDate: null,\n  activeCommitments: [],\n  completedRepsToday: [],\n  identityAnchor: '',\n  habitAnchor: '',\n  whyStatement: '', // Add mock field\n  streakCount: 0,\n  streakCoins: 0,\n};\n\nexport const MOCK_STRATEGIC_CONTENT_DATA = {\n  vision: '',\n  mission: '',\n  values: [],\n  goals: [],\n  purpose: '',\n};\n\nexport const MOCK_MEMBERSHIP_DATA = {\n    status: 'Trial',\n    currentPlanId: 'trial',\n    nextBillingDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n    paymentHistory: [],\n    notifications: [\n        { id: 'welcome', message: 'Welcome to your 7-day free trial! Upgrade now to maintain access.', type: 'warning', isRead: false }\n    ],\n};\n\nconst MOCK_MEMBERSHIP_PLANS = {\n    items: [\n        { \n            id: 'basic', \n            name: 'Base', \n            price: 29, \n            recurrence: 'Monthly', \n            features: [\n                'Dashboard & Daily Practice', \n                'Basic Rep Library', \n                'Weekly Development Plan', \n                'Limited AI Coaching (5/month)'\n            ]\n        },\n        { \n            id: 'professional', \n            name: 'Pro', \n            price: 79, \n            recurrence: 'Monthly', \n            features: [\n                'Full Rep & Content Library', \n                'Unlimited Daily Practice', \n                'Complete Development Plans', \n                'Full AI Coaching Lab Access',\n                'Community Participation'\n            ]\n        },\n        { \n            id: 'elite', \n            name: 'Premium', \n            price: 199, \n            recurrence: 'Monthly', \n            features: [\n                'All Pro Features', \n                'Executive ROI Reports', \n                'Priority Support', \n                '1-on-1 Coaching Sessions',\n                'Early Access to New Content'\n            ]\n        }\n    ]\n};\n\n// Global metadata mocks - BOSS V1 SCOPE: Future features disabled by default\nconst MOCK_FEATURE_FLAGS = { \n  // V1 CORE FEATURES (ENABLED) - Arena v1.0 Approved Only\n  enableDevPlan: true,\n  enableDailyPractice: true,\n  enableMembershipModule: true,\n  \n  // FUTURE SCOPE FEATURES (DISABLED per Arena v1.0 scope)\n  enableReadings: false,       // Professional Reading Hub - FUTURE SCOPE\n  enableCourses: false,        // Course Library - FUTURE SCOPE\n  \n  // FUTURE SCOPE FEATURES (DISABLED per boss requirements)\n  enableLabs: false,           // AI Coaching Lab - FUTURE SCOPE\n  enableLabsAdvanced: false,   // Advanced Lab features - FUTURE SCOPE\n  enablePlanningHub: false,    // Strategic Tools - FUTURE SCOPE\n  enableVideos: false,         // Leadership Videos - FUTURE SCOPE\n  enableCommunity: false,      // Community features - FUTURE SCOPE\n  enableRoiReport: false,      // Executive ROI Report - FUTURE SCOPE\n  enableQuickStart: true,      // Keep QuickStart for onboarding\n  \n  // LEGACY/OTHER\n  enableNewFeature: false \n};\nconst MOCK_REP_LIBRARY = [];\nconst MOCK_EXERCISE_LIBRARY = [];\nconst MOCK_WORKOUT_LIBRARY = [];\nconst MOCK_COURSE_LIBRARY = [];\nconst MOCK_SKILL_CATALOG = [];\nconst MOCK_IDENTITY_ANCHOR_CATALOG = [];\nconst MOCK_HABIT_ANCHOR_CATALOG = [];\nconst MOCK_WHY_CATALOG = [];\nconst MOCK_READING_CATALOG = [];\nconst MOCK_VIDEO_CATALOG = [];\nconst MOCK_SCENARIO_CATALOG = [];\n\nconst LEADERSHIP_TIERS_FALLBACK = [\n  { tier: 1, name: \"Tier 1\", description: \"Foundation\" },\n  { tier: 2, name: \"Tier 2\", description: \"Intermediate\" },\n  { tier: 3, name: \"Tier 3\", description: \"Advanced\" },\n  { tier: 4, name: \"Tier 4\", description: \"Expert\" },\n];\n\nconst GEMINI_MODEL = 'gemini-pro';\n// SECURITY FIX: Remove hardcoded credentials - use environment variables\nconst ADMIN_EMAILS = process.env.VITE_ADMIN_EMAILS ? process.env.VITE_ADMIN_EMAILS.split(',') : ['rob@sagecg.com'];\nconst ADMIN_PASSWORD = process.env.VITE_ADMIN_PASSWORD || 'temp-admin-pwd-change-me';\n\n// Create and export the context\nconst AppServiceContext = createContext(null);\nexport { AppServiceContext }; // Named export for App.jsx\n\nexport const useAppServices = () => {\n  const ctx = useContext(AppServiceContext);\n  if (!ctx) throw new Error('useAppServices must be used within AppServiceProvider');\n  return ctx;\n};\n\n/* =========================================================\n   User Data Hook (UPDATED FOR CLEAN STRUCTURE)\n========================================================= */\nexport const useFirestoreUserData = (db, uid, isAuthReady, moduleName, docName, mockFallback = {}) => {\n  const [data, setData] = useState(mockFallback);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Build path using new structure: modules/{uid}/{moduleName}/{docName}\n  const path = useMemo(() => {\n    if (!uid) return null;\n    return buildModulePath(uid, moduleName, docName);\n  }, [uid, moduleName, docName]);\n\n  console.log(`[useFirestoreUserData] Initialized for path: ${path}`);\n\n  // Real-time listener\n  useEffect(() => {\n    console.log(`[useFirestoreUserData] Effect triggered for path: ${path}`);\n    console.log(`[useFirestoreUserData] - DB: ${!!db}, UID: ${uid}, AuthReady: ${isAuthReady}, Path: ${path}`);\n\n    if (!db || !uid || !isAuthReady || !path) {\n      console.warn(`[useFirestoreUserData] Prerequisites not met. DB: ${!!db}, UID: ${uid}, AuthReady: ${isAuthReady}, Path: ${path}`);\n      setIsLoading(false);\n      return;\n    }\n\n    console.log(`[useFirestoreUserData] ✅ Setting up listener for: ${path}`);\n    setIsLoading(true);\n    setError(null);\n\n    let didSetInitial = false;\n\n    const unsubscribe = onSnapshotEx(db, path, (snap) => {\n      console.log(`[useFirestoreUserData SNAPSHOT] Path: ${path}, Exists: ${snap.exists()}, FromCache: ${snap._md?.fromCache}`);\n\n      if (snap.exists()) {\n        const docData = snap.data();\n        console.log(`[useFirestoreUserData] ✅ Data received for ${path}:`, Object.keys(docData));\n        setData(docData);\n        didSetInitial = true;\n      } else {\n        console.warn(`[useFirestoreUserData] ⚠️ Document does not exist at ${path}. Using mock fallback.`);\n        setData(mockFallback);\n      }\n\n      if (!didSetInitial || !snap._md?.fromCache) {\n        setIsLoading(false);\n      }\n    });\n\n    return () => {\n      console.log(`[useFirestoreUserData] 🔌 Unsubscribing from: ${path}`);\n      unsubscribe();\n    };\n  }, [db, uid, isAuthReady, path, mockFallback]);\n\n  // Update function\n  const updateData = useCallback(\n    async (updates) => {\n      console.log(`[useFirestoreUserData.updateData] Called for path: ${path}`, updates);\n      \n      if (!path || !db) {\n        console.warn(`[useFirestoreUserData.updateData] Cannot update - missing path or db. Path: ${path}, DB: ${!!db}`);\n        return false;\n      }\n\n      try {\n        console.log(`[useFirestoreUserData.updateData] Attempting to update ${path}...`);\n        // We use setDocEx with merge:true for all user module updates\n        const success = await setDocEx(db, path, updates, true);\n        \n        if (success) {\n          console.log(`[useFirestoreUserData.updateData] ✅ Successfully updated ${path}`);\n          // Optimistically update local state\n          setData(prev => applyPatchDeleteAware(prev, updates));\n          return true;\n        } else {\n          console.error(`[useFirestoreUserData.updateData] ❌ setDocEx returned false for ${path}`);\n          return false;\n        }\n      } catch (err) {\n        console.error(`[useFirestoreUserData.updateData] ❌ Error updating ${path}:`, err);\n        setError(err);\n        return false;\n      }\n    },\n    [db, path]\n  );\n\n  return { data, isLoading, error, updateData };\n};\n\n/* =========================================================\n   Global Metadata Hook (unchanged - already clean)\n========================================================= */\n\n\n// --- Begin compatibility helpers for lower-case config keys ---\n// Prefer lower_case config fields with graceful fallback to legacy UPPER_CASE\nconst cfg = (obj, keys, fallback) => {\n  const list = Array.isArray(keys) ? keys : [keys];\n  for (const k of list) {\n    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null) return obj[k];\n  }\n  return fallback;\n};\n// --- End compatibility helpers ---\n\nexport const useGlobalMetadata = (db, isAuthReady) => {\n  const [metadata, setMetadata] = useState({\n    featureFlags: MOCK_FEATURE_FLAGS,\n    LEADERSHIP_TIERS: LEADERSHIP_TIERS_FALLBACK,\n    REP_LIBRARY: MOCK_REP_LIBRARY,\n    EXERCISE_LIBRARY: MOCK_EXERCISE_LIBRARY,\n    WORKOUT_LIBRARY: MOCK_WORKOUT_LIBRARY,\n    COURSE_LIBRARY: MOCK_COURSE_LIBRARY,\n    SKILL_CATALOG: MOCK_SKILL_CATALOG,\n    IDENTITY_ANCHOR_CATALOG: MOCK_IDENTITY_ANCHOR_CATALOG,\n    HABIT_ANCHOR_CATALOG: MOCK_HABIT_ANCHOR_CATALOG,\n    WHY_CATALOG: MOCK_WHY_CATALOG,\n    READING_CATALOG: MOCK_READING_CATALOG,\n    VIDEO_CATALOG: MOCK_VIDEO_CATALOG,\n    SCENARIO_CATALOG: MOCK_SCENARIO_CATALOG,\n    MEMBERSHIP_PLANS: MOCK_MEMBERSHIP_PLANS, // ADDED: Membership plans mock\n    RESOURCE_LIBRARY: {},\n    IconMap: {},\n    APP_ID: 'default-app-id',\n    GEMINI_MODEL: GEMINI_MODEL,\n    // 💡 FIX: Add mock/fallback for admin emails here\n    adminemails: ADMIN_EMAILS,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    if (!db || !isAuthReady) {\n      setLoading(false);\n      return;\n    }\n\n    const fetchMetadata = async () => {\n      try {\n          console.log(\"[GLOBAL METADATA] Fetching from metadata/config\");\n          const configSnap = await getDocEx(db, 'metadata/config');\n          const configData = configSnap.exists() ? configSnap.data() : {};\n          \n          console.log(\"[GLOBAL METADATA] Config keys found:\", Object.keys(configData));\n\n          // Build icon map\n          const iconComponents = {\n            HeartPulse, Briefcase, Users, AlertTriangle, TrendingUp, Zap,\n            ShieldCheck, Target, BarChart3, BookOpen, Film, Trello, Mic, Clock, Cpu, UserIcon, DollarSign\n          };\n          const iconMap = {};\n          Object.keys(iconComponents).forEach(name => {\n              iconMap[name] = iconComponents[name];\n          });\n\n          setMetadata(prev => ({ // Merge with previous state to keep defaults/mocks until catalogs load\n              ...prev,\n              // flags (support feature_flags and featureFlags)\n              featureFlags: cfg(configData, ['feature_flags', 'featureFlags'], MOCK_FEATURE_FLAGS),\n\n              // 💡 FIX: Read the adminemails field (supports 'adminemails' and legacy 'ADMIN_EMAILS')\n              adminemails:              cfg(configData, ['adminemails', 'ADMIN_EMAILS'], ADMIN_EMAILS), // <-- ADDED THIS LINE\n\n              // catalogs/libraries — prefer lower_case, fallback to legacy UPPER_CASE, then mock\n              LEADERSHIP_TIERS:       cfg(configData, ['leadership_tiers', 'LEADERSHIP_TIERS'], LEADERSHIP_TIERS_FALLBACK),\n              REP_LIBRARY:            cfg(configData, ['rep_library', 'REP_LIBRARY'], MOCK_REP_LIBRARY),\n              EXERCISE_LIBRARY:       cfg(configData, ['exercise_library', 'EXERCISE_LIBRARY'], MOCK_EXERCISE_LIBRARY),\n              WORKOUT_LIBRARY:        cfg(configData, ['workout_library', 'WORKOUT_LIBRARY'], MOCK_WORKOUT_LIBRARY),\n              COURSE_LIBRARY:         cfg(configData, ['course_library', 'COURSE_LIBRARY'], MOCK_COURSE_LIBRARY),\n              SKILL_CATALOG:          cfg(configData, ['skill_catalog', 'SKILL_CATALOG'], MOCK_SKILL_CATALOG),\n              IDENTITY_ANCHOR_CATALOG:cfg(configData, ['identity_anchor_catalog', 'IDENTITY_ANCHOR_CATALOG'], MOCK_IDENTITY_ANCHOR_CATALOG),\n              HABIT_ANCHOR_CATALOG:   cfg(configData, ['habit_anchor_catalog', 'HABIT_ANCHOR_CATALOG'], MOCK_HABIT_ANCHOR_CATALOG),\n              WHY_CATALOG:            cfg(configData, ['why_catalog', 'WHY_CATALOG'], MOCK_WHY_CATALOG),\n              READING_CATALOG:        cfg(configData, ['reading_catalog', 'READING_CATALOG'], MOCK_READING_CATALOG),\n              VIDEO_CATALOG:          cfg(configData, ['video_catalog', 'VIDEO_CATALOG'], MOCK_VIDEO_CATALOG),\n              SCENARIO_CATALOG:       cfg(configData, ['scenario_catalog', 'SCENARIO_CATALOG'], MOCK_SCENARIO_CATALOG),\n              MEMBERSHIP_PLANS:       cfg(configData, ['membership_plans', 'MEMBERSHIP_PLANS'], MOCK_MEMBERSHIP_PLANS), // ADDED: Membership plans\n\n              RESOURCE_LIBRARY:       cfg(configData, ['resource_library', 'RESOURCE_LIBRARY'], {}),\n\n              // app/system config — prefer lower_case\n              APP_ID:                 cfg(configData, ['app_id', 'APP_ID'], 'default-app-id'),\n              GEMINI_MODEL:           cfg(configData, ['gemini_model', 'GEMINI_MODEL'], GEMINI_MODEL),\n\n              // built-in icon map\n              IconMap: iconMap,\n          }));\n\n      } catch (e) {\n          console.error(\"[CRITICAL GLOBAL READ FAIL] Metadata fetch failed.\", e);\n          setError(e);\n          setMetadata({\n              featureFlags: MOCK_FEATURE_FLAGS,\n              LEADERSHIP_TIERS: LEADERSHIP_TIERS_FALLBACK,\n              IconMap: {},\n              GEMINI_MODEL: GEMINI_MODEL,\n              APP_ID: 'error-app-id',\n              adminemails: ADMIN_EMAILS, // Ensure fallback is set on error\n          });\n      } finally {\n          setLoading(false);\n      }\n    };\n\n    fetchMetadata();\n\n  }, [db, isAuthReady]);\n\n  return { metadata, isLoading: loading, error };\n};\n\nconst resolveGlobalMetadata = (meta) => {\n  return {\n    featureFlags: meta?.featureFlags || MOCK_FEATURE_FLAGS,\n    adminemails: meta?.adminemails || ADMIN_EMAILS, // 💡 FIX: Include adminemails in resolved metadata\n    LEADERSHIP_TIERS: meta?.LEADERSHIP_TIERS || LEADERSHIP_TIERS_FALLBACK,\n    REP_LIBRARY: meta?.REP_LIBRARY || MOCK_REP_LIBRARY,\n    EXERCISE_LIBRARY: meta?.EXERCISE_LIBRARY || MOCK_EXERCISE_LIBRARY,\n    WORKOUT_LIBRARY: meta?.WORKOUT_LIBRARY || MOCK_WORKOUT_LIBRARY,\n    COURSE_LIBRARY: meta?.COURSE_LIBRARY || MOCK_COURSE_LIBRARY,\n    SKILL_CATALOG: meta?.SKILL_CATALOG || MOCK_SKILL_CATALOG,\n    IDENTITY_ANCHOR_CATALOG: meta?.IDENTITY_ANCHOR_CATALOG || MOCK_IDENTITY_ANCHOR_CATALOG,\n    HABIT_ANCHOR_CATALOG: meta?.HABIT_ANCHOR_CATALOG || MOCK_HABIT_ANCHOR_CATALOG,\n    WHY_CATALOG: meta?.WHY_CATALOG || MOCK_WHY_CATALOG,\n    READING_CATALOG: meta?.READING_CATALOG || MOCK_READING_CATALOG,\n    VIDEO_CATALOG: meta?.VIDEO_CATALOG || MOCK_VIDEO_CATALOG,\n    SCENARIO_CATALOG: meta?.SCENARIO_CATALOG || MOCK_SCENARIO_CATALOG,\n    MEMBERSHIP_PLANS: meta?.MEMBERSHIP_PLANS || MOCK_MEMBERSHIP_PLANS, // ADDED: Membership plans\n    RESOURCE_LIBRARY: meta?.RESOURCE_LIBRARY || {},\n    IconMap: meta?.IconMap || {},\n    GEMINI_MODEL: meta?.GEMINI_MODEL || GEMINI_MODEL,\n    APP_ID: meta?.APP_ID || 'default-app-id',\n  };\n};\n\n/* =========================================================\n   Global writer (unchanged - already clean)\n========================================================= */\nexport const updateGlobalMetadata = async (\n  db,\n  data,\n  { merge = true, source = 'Unknown', userId = 'N/A', forceDocument = 'config' } \n) => {\n  if (!db) {\n    console.warn(`[GLOBAL WRITE MOCK] Skipping write (source: ${source})`);\n    return data; \n  }\n\n  let path;\n  let payload = { ...data }; \n  let useCatalogDoc = false;\n\n  const catalogKeys = [\n    'REP_LIBRARY', 'EXERCISE_LIBRARY', 'WORKOUT_LIBRARY', 'COURSE_LIBRARY', \n    'SKILL_CATALOG', 'IDENTITY_ANCHOR_CATALOG', 'HABIT_ANCHOR_CATALOG', \n    'WHY_CATALOG', 'READING_CATALOG', 'VIDEO_CATALOG', 'SCENARIO_CATALOG',\n    'MEMBERSHIP_PLANS' // Check for membership plans too\n  ];\n  \n  // Check if we are trying to update a catalog\n  const catalogKeyToUpdate = catalogKeys.find(key => data.hasOwnProperty(key));\n\n  if (catalogKeyToUpdate === 'MEMBERSHIP_PLANS' && forceDocument === 'config') {\n      // Use the dedicated catalog writer for membership plans to place it correctly\n      useCatalogDoc = true;\n      path = 'metadata/config/catalog/membership_plans'; // The correct location\n      const body = Array.isArray(payload.MEMBERSHIP_PLANS) ? { items: payload.MEMBERSHIP_PLANS } : payload.MEMBERSHIP_PLANS;\n      payload = body;\n  } else if (forceDocument === 'reading_catalog') {\n      path = mockDoc(db, 'metadata', 'reading_catalog');\n      if (!payload || !payload.items || !Array.isArray(payload.items)) {\n           const potentialArray = Object.values(payload).find(Array.isArray);\n           payload = { items: potentialArray || (Array.isArray(payload) ? payload : []) };\n           console.warn(`[GLOBAL WRITE] Auto-wrapping payload for reading_catalog into { items: [...] }`);\n      }\n  } else {\n      path = mockDoc(db, 'metadata', 'config');\n      // Clean out catalog keys from the main config doc to prevent write errors\n      catalogKeys.forEach(key => delete payload[key]); \n      delete payload.RESOURCE_LIBRARY; delete payload.RESOURCE_LIBRARY_ITEMS; delete payload.catalog; \n  }\n\n   if (!payload || typeof payload !== 'object' || Object.keys(payload).length === 0) {\n       console.warn(`[GLOBAL WRITE SKIPPED] Payload for ${path} became empty after cleaning. Source: ${source}`);\n       return {}; \n   }\n\n  try {\n    const finalPayload = {\n        ...payload,\n        _updatedAt: serverTimestamp(), \n        _updatedBy: userId,\n        _source: source\n    };\n\n    const success = await setDocEx(db, path, finalPayload, merge);\n\n    if (success) {\n        console.log(`[GLOBAL WRITE SUCCESS] Document: ${path}. Merge: ${merge}. Keys Updated: ${Object.keys(payload).join(', ')}. Source: ${source}`);\n        return { ...payload, _updatedBy: userId, _source: source };\n    } else {\n        throw new Error(`setDocEx failed for path ${path}`);\n    }\n\n  } catch (e) {\n    console.error(`[GLOBAL WRITE FAILED] Document: ${path}`, e);\n    throw new Error(`Failed to update global metadata for ${path}: ${e.message}`);\n  }\n};\n\nexport const updateCatalogDoc = async (db, docName, payload, { merge = true, userId = 'N/A' } = {}) => {\n  const path = `metadata/config/catalog/${docName}`;\n  const body = Array.isArray(payload) ? { items: payload } : payload;\n  const finalPayload = { ...body, _updatedAt: serverTimestamp(), _updatedBy: userId, _source: 'updateCatalogDoc' };\n  return setDocEx(db, path, finalPayload, merge);\n};\n\n/* =========================================================\n   Provider factory (REWRITTEN FOR DIRECT FIRESTORE ACCESS)\n   This function sets up Firestore listeners and returns data/update functions\n   Can be called from useEffect without issues\n========================================================= */\nexport const createAppServices = (db, userId) => {\n  console.log('[createAppServices] Creating services for userId:', userId);\n  \n  // Create reactive data stores using a simple observable pattern\n  const stores = {\n    developmentPlanData: null,\n    dailyPracticeData: null,\n    strategicContentData: null,\n    membershipData: null, // ADDED: Membership data store\n    globalMetadata: null,\n    listeners: [], // Store unsubscribe functions\n    onChange: null // Callback for when data changes\n  };\n\n  // Helper to notify about data changes\n  const notifyChange = () => {\n    if (stores.onChange) {\n      stores.onChange({\n        developmentPlanData: stores.developmentPlanData,\n        dailyPracticeData: stores.dailyPracticeData,\n        strategicContentData: stores.strategicContentData,\n        membershipData: stores.membershipData, // ADDED: Notify membership data\n        globalMetadata: stores.globalMetadata\n      });\n    }\n  };\n\n  // Set up Firestore listeners for real-time updates\n  if (db && userId) {\n    // Development Plan listener\n    const devPlanPath = buildModulePath(userId, 'development_plan', 'current');\n    const unsubDev = onSnapshotEx(db, devPlanPath, (snap) => {\n      const rawData = snap.exists() ? snap.data() : MOCK_DEVELOPMENT_PLAN_DATA;\n      // FIX APPLIED HERE: Apply BOTH sanitizers: remove timestamps AND sentinels\n      stores.developmentPlanData = stripSentinels(sanitizeTimestamps(rawData));\n      console.log('[createAppServices] 📋 Dev Plan updated (sentinels stripped)');\n      notifyChange();\n    });\n    stores.listeners.push(unsubDev);\n\n    // Daily Practice listener\n    const dailyPath = buildModulePath(userId, 'daily_practice', 'current');\n    const unsubDaily = onSnapshotEx(db, dailyPath, (snap) => {\n      const rawData = snap.exists() ? snap.data() : MOCK_DAILY_PRACTICE_DATA;\n      // Apply BOTH sanitizers: remove timestamps AND sentinels\n      stores.dailyPracticeData = stripSentinels(sanitizeTimestamps(rawData));\n      console.log('[createAppServices] 💪 Daily Practice updated (sentinels stripped)');\n      notifyChange();\n    });\n    stores.listeners.push(unsubDaily);\n\n    // Strategic Content listener\n    const strategicPath = buildModulePath(userId, 'strategic_content', 'vision_mission');\n    const unsubStrategic = onSnapshotEx(db, strategicPath, (snap) => {\n      const rawData = snap.exists() ? snap.data() : MOCK_STRATEGIC_CONTENT_DATA;\n      // CRITICAL: Apply BOTH sanitizers: remove timestamps AND sentinels\n      stores.strategicContentData = stripSentinels(sanitizeTimestamps(rawData));\n      console.log('[createAppServices] Strategic Content updated');\n      notifyChange();\n    });\n    stores.listeners.push(unsubStrategic);\n    \n    // Membership Listener (NEW)\n    const membershipPath = buildModulePath(userId, 'membership', 'current');\n    const unsubMembership = onSnapshotEx(db, membershipPath, (snap) => {\n      const rawData = snap.exists() ? snap.data() : MOCK_MEMBERSHIP_DATA;\n      // CRITICAL: Apply BOTH sanitizers: remove timestamps AND sentinels\n      stores.membershipData = stripSentinels(sanitizeTimestamps(rawData));\n      console.log('[createAppServices] Membership Data updated');\n      notifyChange();\n    });\n    stores.listeners.push(unsubMembership);\n\n    // Global Metadata - Main Config listener\n    const metadataPath = 'metadata/config';\n    const unsubMeta = onSnapshotEx(db, metadataPath, (snap) => {\n      // Start with base config data\n      if (!stores.globalMetadata) {\n        stores.globalMetadata = {};\n      }\n      \n      // Merge in the main config fields (featureFlags, LEADERSHIP_TIERS, etc.)\n      if (snap.exists()) {\n        // CRITICAL: Apply BOTH sanitizers: remove timestamps AND sentinels\n        const cleanData = stripSentinels(sanitizeTimestamps(snap.data()));\n        Object.assign(stores.globalMetadata, cleanData);\n      }\n      \n      console.log('[createAppServices] Global Metadata (config) updated');\n      notifyChange();\n    });\n    stores.listeners.push(unsubMeta);\n    \n    // Catalog listeners - these are in the catalog subcollection\n    const catalogNames = [\n      'rep_library',\n      'exercise_library', \n      'workout_library',\n      'course_library',\n      'skill_catalog',\n      'identity_anchor_catalog',\n      'habit_anchor_catalog',\n      'why_catalog',\n      'reading_catalog',\n      'video_catalog',\n      'scenario_catalog',\n      'membership_plans' // ADDED: Membership plans catalog\n    ];\n    \n    catalogNames.forEach(catalogName => {\n      const catalogPath = `metadata/config/catalog/${catalogName}`;\n      const unsubCatalog = onSnapshotEx(db, catalogPath, (snap) => {\n        if (!stores.globalMetadata) {\n          stores.globalMetadata = {};\n        }\n        \n        if (snap.exists()) {\n          // Convert snake_case to UPPER_CASE for the key name\n          const keyName = catalogName.toUpperCase();\n          // CRITICAL: Apply BOTH sanitizers: remove timestamps AND sentinels\n          stores.globalMetadata[keyName] = stripSentinels(sanitizeTimestamps(snap.data()));\n          console.log(`[createAppServices] Catalog ${catalogName} loaded:`, snap.data().items?.length || 0, 'items');\n        }\n        \n        notifyChange();\n      });\n      stores.listeners.push(unsubCatalog);\n    });\n  } else {\n    // No db or userId - use mock data\n    console.warn('[createAppServices] No db or userId provided, using mock data');\n    stores.developmentPlanData = MOCK_DEVELOPMENT_PLAN_DATA;\n    stores.dailyPracticeData = MOCK_DAILY_PRACTICE_DATA;\n    stores.strategicContentData = MOCK_STRATEGIC_CONTENT_DATA;\n    stores.membershipData = MOCK_MEMBERSHIP_DATA; // ADDED: Mock Membership Data\n    stores.globalMetadata = {\n      featureFlags: MOCK_FEATURE_FLAGS,\n      LEADERSHIP_TIERS: LEADERSHIP_TIERS_FALLBACK,\n      REP_LIBRARY: MOCK_REP_LIBRARY,\n      EXERCISE_LIBRARY: MOCK_EXERCISE_LIBRARY,\n      WORKOUT_LIBRARY: MOCK_WORKOUT_LIBRARY,\n      COURSE_LIBRARY: MOCK_COURSE_LIBRARY,\n      SKILL_CATALOG: MOCK_SKILL_CATALOG,\n      IDENTITY_ANCHOR_CATALOG: MOCK_IDENTITY_ANCHOR_CATALOG,\n      HABIT_ANCHOR_CATALOG: MOCK_HABIT_ANCHOR_CATALOG,\n      WHY_CATALOG: MOCK_WHY_CATALOG,\n      READING_CATALOG: MOCK_READING_CATALOG,\n      VIDEO_CATALOG: MOCK_VIDEO_CATALOG,\n      SCENARIO_CATALOG: MOCK_SCENARIO_CATALOG,\n      MEMBERSHIP_PLANS: MOCK_MEMBERSHIP_PLANS, // ADDED: Mock Membership Plans\n      RESOURCE_LIBRARY: {},\n      IconMap: {},\n      GEMINI_MODEL: GEMINI_MODEL,\n      APP_ID: 'mock-app-id'\n    };\n  }\n\n  // Create update functions\n  const updateDevelopmentPlanData = async (updates, { merge = true } = {}) => {\n    if (!db || !userId) return false;\n    const path = buildModulePath(userId, 'development_plan', 'current');\n    console.log(`[updateDevelopmentPlanData] Executing with setDocEx (merge=${merge})`);\n    const ok = await setDocEx(db, path, updates, merge);\n    // Removed optimistic update - listener will fire with clean data\n    return ok;\n  };\n\n  const updateDailyPracticeData = async (updates) => {\n    if (!db || !userId) return false;\n    const path = buildModulePath(userId, 'daily_practice', 'current');\n    \n    const ok = await setDocEx(db, path, updates, true);\n    if (ok) {\n      // Optimistic UI: apply delete-aware merge locally & notify\n      stores.dailyPracticeData = applyPatchDeleteAware(stores.dailyPracticeData || {}, updates);\n      notifyChange();\n    }\n    return ok;\n  };\n\n  const updateStrategicContentData = async (updates) => {\n    if (!db || !userId) return false;\n    const path = buildModulePath(userId, 'strategic_content', 'vision_mission');\n    \n    const ok = await setDocEx(db, path, updates, true);\n    if (ok) {\n      // Optimistic UI: apply delete-aware merge locally & notify\n      stores.strategicContentData = applyPatchDeleteAware(stores.strategicContentData || {}, updates);\n      notifyChange();\n    }\n    return ok;\n  };\n  \n  // Update Membership Data (NEW)\n  const updateMembershipData = async (updates) => {\n    if (!db || !userId) return false;\n    const path = buildModulePath(userId, 'membership', 'current');\n    const ok = await setDocEx(db, path, updates, true);\n    if (ok) {\n      stores.membershipData = applyPatchDeleteAware(stores.membershipData || {}, updates);\n      notifyChange();\n    }\n    return ok;\n  };\n  \n  // =========================================================\n  // 🛑 NEW: FULL PLAN AND ANCHOR CLEAR FUNCTION (CRITICAL FIX)\n  // =========================================================\n  const clearUserPlanAndAnchors = async () => {\n      if (!db || !userId) {\n          console.warn('[clearUserPlanAndAnchors] DB or UserID missing, skipping clear.');\n          return false;\n      }\n      \n      const devPlanPath = buildModulePath(userId, 'development_plan', 'current');\n      const dailyPath = buildModulePath(userId, 'daily_practice', 'current');\n      const todayStr = new Date().toISOString().split('T')[0];\n      \n      console.log('[clearUserPlanAndAnchors] Initiating full plan and daily practice clear.');\n      \n      // 1. CLEAR DEVELOPMENT PLAN to its default state\n      const defaultPlanPayload = {\n          currentPlan: null, // CRITICAL: Set to null to trigger Baseline view\n          currentCycle: 1,\n          lastAssessmentDate: null,\n          assessmentHistory: [], \n          planHistory: [],\n      };\n      // 🛑 CRITICAL FIX: Use merge: false (or omit it) to force an OVERWRITE.\n      // This wipes out all old residual fields like 'coreReps', 'skills', etc.\n      const ok1 = await setDocEx(db, devPlanPath, defaultPlanPayload, false); \n\n      // 2. CLEAR DAILY PRACTICE to its default state (removes all anchors/targets)\n      const defaultDailyPracticePayload = {\n          activeCommitments: [], \n          identityAnchor: '', \n          habitAnchor: '', \n          whyStatement: '',\n          dailyTargetRepId: null, \n          dailyTargetRepDate: null, \n          dailyTargetRepStatus: 'Pending', \n          streakCount: 0,\n          streakCoins: 0,\n          lastUpdated: todayStr,\n          completedRepsToday: [],\n      };\n      // 🛑 CRITICAL FIX: Use merge: false (or omit it) to force an OVERWRITE.\n      const ok2 = await setDocEx(db, dailyPath, defaultDailyPracticePayload, false);\n      \n      const result = ok1 && ok2;\n      console.log(`[clearUserPlanAndAnchors] Plan Clear Status: ${result ? 'SUCCESS' : 'FAILED'} (Forced Overwrite)`);\n      return result;\n  };\n\n  // Return the service object with getter functions and a way to set onChange callback\n  return {\n    // Data getters that access the current state\n    get developmentPlanData() { return stores.developmentPlanData; },\n    get dailyPracticeData() { return stores.dailyPracticeData; },\n    get strategicContentData() { return stores.strategicContentData; },\n    get membershipData() { return stores.membershipData; }, // ADDED: Getter for membership data\n    get globalMetadata() { \n      // Always resolve metadata with fallbacks\n      return resolveGlobalMetadata(stores.globalMetadata);\n    },\n    \n    // Update functions\n    updateDevelopmentPlanData,\n    updateDailyPracticeData,\n    updateStrategicContentData,\n    updateMembershipData, // ADDED: Update membership data function\n    \n    // Utility functions\n    clearUserPlanAndAnchors, // 🛑 NEW EXPORTED FUNCTION\n    \n    // Method to set onChange callback\n    setOnChange: (callback) => {\n      stores.onChange = callback;\n    },\n    \n    // Cleanup function to unsubscribe from listeners\n    cleanup: () => {\n      console.log('[createAppServices] Cleaning up listeners');\n      stores.listeners.forEach(unsub => unsub && unsub());\n    }\n  };\n};\n\n// Default export is the context itself\nexport default AppServiceContext;","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/styles/corporate-colors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/test/color-compliance-simple.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/test/components/LeadershipVideos.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/test/corporate-colors.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'mockUser' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":15,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'mockMembershipData' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":16,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/test/corporate-colors.test.jsx\n// Corporate Color Compliance Test Suite\n// Ensures only approved colors (#002E47, #E04E1B, #FCFCFA, #47A88D, #349881) are used\n\nimport React from 'react'\nimport { describe, it, expect, beforeEach } from 'vitest'\nimport { render, screen, fireEvent } from '@testing-library/react'\nimport { CORPORATE_COLORS, APPROVED_COLORS, isApprovedColor, extractColorsFromElement } from './setup.js'\n\n// Import components to test\nimport { Button, Card } from '../components/screens/dashboard/DashboardComponents.jsx'\nimport { MembershipGate } from '../components/ui/MembershipGate.jsx'\n\n// Mock Firebase and services\nconst mockUser = { name: 'Test User', uid: 'test-123' }\nconst mockMembershipData = { currentTier: 'basic' }\n\n// Mock required context providers\nconst MockProviders = ({ children }) => {\n  return (\n    <div data-testid=\"mock-provider\">\n      {children}\n    </div>\n  )\n}\n\ndescribe('Corporate Color Compliance', () => {\n  \n  describe('Color Constants Validation', () => {\n    it('should only contain approved corporate colors', () => {\n      const expectedColors = [\n        '#002E47', // Navy\n        '#E04E1B', // Orange\n        '#FCFCFA', // Light Gray\n        '#47A88D', // Teal\n        '#349881', // Subtle Teal\n        '#FFFFFF'  // White (allowed for surfaces)\n      ]\n      \n      expect(APPROVED_COLORS).toEqual(expect.arrayContaining(expectedColors))\n      expect(APPROVED_COLORS.length).toBeLessThanOrEqual(6) // Only approved colors\n    })\n\n    it('should correctly identify approved colors', () => {\n      // Test approved colors\n      expect(isApprovedColor('#002E47')).toBe(true) // Navy\n      expect(isApprovedColor('#E04E1B')).toBe(true) // Orange\n      expect(isApprovedColor('#FCFCFA')).toBe(true) // Light Gray\n      expect(isApprovedColor('#47A88D')).toBe(true) // Teal\n      expect(isApprovedColor('#349881')).toBe(true) // Subtle Teal\n      expect(isApprovedColor('#FFFFFF')).toBe(true) // White\n      \n      // Test forbidden colors\n      expect(isApprovedColor('#7C3AED')).toBe(false) // Purple\n      expect(isApprovedColor('#F59E0B')).toBe(false) // Amber\n      expect(isApprovedColor('#DC2626')).toBe(false) // Red\n      expect(isApprovedColor('#10B981')).toBe(false) // Green\n      expect(isApprovedColor('#2563EB')).toBe(false) // Blue\n    })\n\n    it('should correctly identify approved rgba colors', () => {\n      // Test approved rgba colors (corporate colors with opacity)\n      expect(isApprovedColor('rgba(0, 46, 71, 0.5)')).toBe(true)   // Navy with opacity\n      expect(isApprovedColor('rgba(224, 78, 27, 0.8)')).toBe(true) // Orange with opacity\n      expect(isApprovedColor('rgba(71, 168, 141, 0.2)')).toBe(true) // Teal with opacity\n      \n      // Test non-corporate rgba colors\n      expect(isApprovedColor('rgba(124, 58, 237, 0.5)')).toBe(false) // Purple with opacity\n      expect(isApprovedColor('rgba(245, 158, 11, 0.8)')).toBe(false) // Amber with opacity\n    })\n  })\n\n  describe('Button Component Compliance', () => {\n    it('should only use corporate colors for primary buttons', () => {\n      render(\n        <MockProviders>\n          <Button variant=\"primary\" data-testid=\"primary-button\">\n            Primary Button\n          </Button>\n        </MockProviders>\n      )\n      \n      const button = screen.getByTestId('primary-button')\n      const colors = extractColorsFromElement(button)\n      \n      colors.forEach(({ property, value }) => {\n        expect(isApprovedColor(value), \n          `Button property '${property}' uses non-corporate color: ${value}`\n        ).toBe(true)\n      })\n    })\n\n    it('should only use corporate colors for secondary buttons', () => {\n      render(\n        <MockProviders>\n          <Button variant=\"secondary\" data-testid=\"secondary-button\">\n            Secondary Button\n          </Button>\n        </MockProviders>\n      )\n      \n      const button = screen.getByTestId('secondary-button')\n      const colors = extractColorsFromElement(button)\n      \n      colors.forEach(({ property, value }) => {\n        expect(isApprovedColor(value),\n          `Button property '${property}' uses non-corporate color: ${value}`\n        ).toBe(true)\n      })\n    })\n\n    it('should use correct corporate colors for button variants', () => {\n      const { rerender } = render(\n        <MockProviders>\n          <Button variant=\"primary\" data-testid=\"test-button\">Test</Button>\n        </MockProviders>\n      )\n      \n      // Test primary button uses teal\n      let button = screen.getByTestId('test-button')\n      let style = window.getComputedStyle(button)\n      \n      // Should use corporate teal or navy\n      expect([CORPORATE_COLORS.TEAL, CORPORATE_COLORS.NAVY]).toContain(\n        style.backgroundColor || style.color\n      )\n      \n      // Test secondary button uses orange\n      rerender(\n        <MockProviders>\n          <Button variant=\"secondary\" data-testid=\"test-button\">Test</Button>\n        </MockProviders>\n      )\n      \n      button = screen.getByTestId('test-button')\n      style = window.getComputedStyle(button)\n      \n      // Should use corporate orange\n      expect([CORPORATE_COLORS.ORANGE, CORPORATE_COLORS.TEAL]).toContain(\n        style.backgroundColor || style.color\n      )\n    })\n  })\n\n  describe('Card Component Compliance', () => {\n    it('should only use corporate colors', () => {\n      render(\n        <MockProviders>\n          <Card title=\"Test Card\" data-testid=\"test-card\">\n            <div>Card content</div>\n          </Card>\n        </MockProviders>\n      )\n      \n      const card = screen.getByTestId('test-card')\n      const colors = extractColorsFromElement(card)\n      \n      colors.forEach(({ property, value }) => {\n        expect(isApprovedColor(value),\n          `Card property '${property}' uses non-corporate color: ${value}`\n        ).toBe(true)\n      })\n    })\n\n    it('should use corporate accent colors correctly', () => {\n      const { rerender } = render(\n        <MockProviders>\n          <Card title=\"Navy Card\" accent=\"NAVY\" data-testid=\"test-card\">\n            Content\n          </Card>\n        </MockProviders>\n      )\n      \n      let card = screen.getByTestId('test-card')\n      let colors = extractColorsFromElement(card)\n      \n      // Should contain navy accent\n      const hasNavy = colors.some(({ value }) => \n        value.includes('002E47') || value.includes('0, 46, 71')\n      )\n      expect(hasNavy, 'Navy accent card should contain navy color').toBe(true)\n      \n      // Test teal accent\n      rerender(\n        <MockProviders>\n          <Card title=\"Teal Card\" accent=\"TEAL\" data-testid=\"test-card\">\n            Content\n          </Card>\n        </MockProviders>\n      )\n      \n      card = screen.getByTestId('test-card')\n      colors = extractColorsFromElement(card)\n      \n      const hasTeal = colors.some(({ value }) => \n        value.includes('47A88D') || value.includes('71, 168, 141')\n      )\n      expect(hasTeal, 'Teal accent card should contain teal color').toBe(true)\n    })\n  })\n\n  describe('Membership Gate Component Compliance', () => {\n    it('should only use corporate colors for tier badges', () => {\n      render(\n        <MockProviders>\n          <MembershipGate \n            requiredTier=\"professional\"\n            currentTier=\"basic\"\n            data-testid=\"membership-gate\"\n          >\n            <div>Protected content</div>\n          </MembershipGate>\n        </MockProviders>\n      )\n      \n      const gate = screen.getByTestId('membership-gate')\n      const colors = extractColorsFromElement(gate)\n      \n      colors.forEach(({ property, value }) => {\n        expect(isApprovedColor(value),\n          `MembershipGate property '${property}' uses non-corporate color: ${value}`\n        ).toBe(true)\n      })\n    })\n  })\n\n  describe('Forbidden Colors Detection', () => {\n    it('should detect and fail on purple usage', () => {\n      const testElement = document.createElement('div')\n      testElement.style.backgroundColor = '#7C3AED' // Purple\n      document.body.appendChild(testElement)\n      \n      const colors = extractColorsFromElement(testElement)\n      const hasForbiddenColor = colors.some(({ value }) => !isApprovedColor(value))\n      \n      expect(hasForbiddenColor, 'Purple should be detected as forbidden color').toBe(true)\n      \n      document.body.removeChild(testElement)\n    })\n\n    it('should detect and fail on amber usage', () => {\n      const testElement = document.createElement('div')\n      testElement.style.color = '#F59E0B' // Amber\n      document.body.appendChild(testElement)\n      \n      const colors = extractColorsFromElement(testElement)\n      const hasForbiddenColor = colors.some(({ value }) => !isApprovedColor(value))\n      \n      expect(hasForbiddenColor, 'Amber should be detected as forbidden color').toBe(true)\n      \n      document.body.removeChild(testElement)\n    })\n\n    it('should detect and fail on red usage', () => {\n      const testElement = document.createElement('div')\n      testElement.style.borderColor = '#DC2626' // Red\n      document.body.appendChild(testElement)\n      \n      const colors = extractColorsFromElement(testElement)\n      const hasForbiddenColor = colors.some(({ value }) => !isApprovedColor(value))\n      \n      expect(hasForbiddenColor, 'Red should be detected as forbidden color').toBe(true)\n      \n      document.body.removeChild(testElement)\n    })\n  })\n\n  describe('CSS Custom Properties Compliance', () => {\n    it('should only define corporate colors in CSS variables', () => {\n      const rootStyles = getComputedStyle(document.documentElement)\n      \n      // Test that corporate color variables exist\n      expect(rootStyles.getPropertyValue('--corporate-navy')).toBe('#002E47')\n      expect(rootStyles.getPropertyValue('--corporate-orange')).toBe('#E04E1B')\n      expect(rootStyles.getPropertyValue('--corporate-teal')).toBe('#47A88D')\n      expect(rootStyles.getPropertyValue('--corporate-subtle-teal')).toBe('#349881')\n      expect(rootStyles.getPropertyValue('--corporate-light-gray')).toBe('#FCFCFA')\n    })\n  })\n})\n\ndescribe('Color Usage Integration Tests', () => {\n  it('should maintain corporate colors during component state changes', () => {\n    const TestComponent = () => {\n      const [active, setActive] = React.useState(false)\n      return (\n        <Button \n          variant={active ? 'primary' : 'secondary'}\n          onClick={() => setActive(!active)}\n          data-testid=\"stateful-button\"\n        >\n          {active ? 'Active' : 'Inactive'}\n        </Button>\n      )\n    }\n    \n    render(\n      <MockProviders>\n        <TestComponent />\n      </MockProviders>\n    )\n    \n    const button = screen.getByTestId('stateful-button')\n    \n    // Test initial state\n    let colors = extractColorsFromElement(button)\n    colors.forEach(({ property, value }) => {\n      expect(isApprovedColor(value),\n        `Stateful button property '${property}' uses non-corporate color: ${value}`\n      ).toBe(true)\n    })\n    \n    // Test after state change\n    fireEvent.click(button)\n    colors = extractColorsFromElement(button)\n    colors.forEach(({ property, value }) => {\n      expect(isApprovedColor(value),\n        `Stateful button (after click) property '${property}' uses non-corporate color: ${value}`\n      ).toBe(true)\n    })\n  })\n})","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/test/setup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/ui/uiKit.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/ui/uiKit.jsx\n/* Small, dependency-free UI kit for consistent look and feel */\nimport React from 'react';\nimport { BookOpen } from 'lucide-react'; // Placeholder for Icon use\n\nexport const COLORS = {\n  // FINAL CONSOLIDATED PALETTE\n  NAVY: '#002E47',      // Dark Text / Primary Background\n  TEAL: '#47A88D',      // Primary Button / Success / Accent\n  SUBTLE_TEAL: '#349881', // Secondary Button / Teal Hover\n  ORANGE: '#E04E1B',    // Action / Alert / Highlight\n  LIGHT_GRAY: '#FCFCFA', // Page Background\n  OFF_WHITE: '#FFFFFF', // Card Background\n  \n  // Mapped existing color names to the new palette\n  BG: '#FCFCFA',\n  SURFACE: '#FFFFFF',\n  TEXT: '#002E47',\n  RED: '#E04E1B',\n};\n\nexport const Button = ({\n  children, onClick, disabled = false, variant = 'primary', className = '', ...rest\n}) => {\n  // Updated base style for softer shadow and consistent font\n  let base = \"px-6 py-3 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-4 flex items-center justify-center\";\n  \n  if (variant === 'primary') base += ` bg-[${COLORS.TEAL}] hover:bg-[${COLORS.SUBTLE_TEAL}] focus:ring-[${COLORS.TEAL}]/50 text-white`;\n  else if (variant === 'secondary') base += ` bg-[${COLORS.ORANGE}] hover:bg-[#C33E12] focus:ring-[${COLORS.ORANGE}]/50 text-white`;\n  else if (variant === 'outline') base = `px-6 py-3 rounded-xl font-semibold transition-all shadow-md border-2 border-[${COLORS.TEAL}] text-[${COLORS.TEAL}] hover:bg-[${COLORS.TEAL}]/10 focus:ring-4 focus:ring-[${COLORS.TEAL}]/50 bg-[${COLORS.LIGHT_GRAY}] flex items-center justify-center`;\n  else if (variant === 'nav-back') base = `px-4 py-2 rounded-lg font-medium transition-all shadow-sm border-2 border-gray-300 text-gray-700 hover:bg-gray-100 flex items-center justify-center`;\n  \n  if (disabled) base = \"px-6 py-3 rounded-xl font-semibold bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner transition-none flex items-center justify-center\";\n\n  return (\n    <button {...rest} onClick={onClick} disabled={disabled} className={`${base} ${className}`}>\n      {children}\n    </button>\n  );\n};\n\nexport const Card = ({\n  children, title, icon: Icon, className = '', onClick, accent = 'TEAL'\n}) => {\n  const interactive = !!onClick;\n  const Tag = interactive ? 'button' : 'div';\n  const accentColor = COLORS[accent] || COLORS.TEAL;\n\n  const handleKeyDown = (e) => {\n    if (!interactive) return;\n    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onClick?.(); }\n  };\n\n  return (\n    <Tag\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={handleKeyDown}\n      className={`relative p-6 rounded-2xl border-2 shadow-2xl hover:shadow-xl transition-all duration-300 text-left ${className}`}\n      style={{ background: 'linear-gradient(180deg,#FFFFFF, #FCFCFA)', borderColor: '#E5E7EB', color: COLORS.TEXT }}\n      onClick={onClick}\n    >\n      <span style={{ position:'absolute', top:0, left:0, right:0, height:6, background: accentColor, borderTopLeftRadius:14, borderTopRightRadius:14 }} />\n      \n      {Icon && (\n        <div className=\"w-10 h-10 rounded-lg flex items-center justify-center border mb-3\" style={{ borderColor: '#E5E7EB', background: COLORS.LIGHT_GRAY }}>\n          <Icon className=\"w-5 h-5\" style={{ color: COLORS.TEAL }} />\n        </div>\n      )}\n      {title && <h2 className=\"text-xl font-extrabold mb-2\" style={{ color: COLORS.NAVY }}>{title}</h2>}\n      {children}\n    </Tag>\n  );\n};\n\nexport const ExecSwitch = ({ checked, onChange, label = 'Executive Brief' }) => {\n  const toggle = () => onChange(!checked);\n  const onKey = (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); } };\n  return (\n    <div className=\"flex items-center gap-2\">\n      <button type=\"button\" role=\"switch\" aria-checked={checked} onClick={toggle} onKeyDown={onKey} className=\"relative inline-flex items-center\" style={{ width: 46, height: 26 }}>\n        <span style={{ position:'absolute', inset:0, background: checked ? COLORS.ORANGE : '#9CA3AF', borderRadius: 9999, transition: 'background .15s ease' }} />\n        <span style={{ position:'relative', left: checked ? 22 : 2, width:22, height:22, background:'#FFFFFF', borderRadius:'9999px', boxShadow:'0 1px 2px rgba(0,0,0,.2)', transition:'left .15s ease' }} />\n      </button>\n      <span style={{ color: COLORS.NAVY, fontWeight: 600 }}>{label}</span>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/ApiHelpers.js","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":195,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":195,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5461,5461],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":200,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":200,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5553,5553],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/utils/ApiHelpers.js\n// Utilities for API access + Gemini (Vite/ESM + Netlify-friendly)\n\n// ---------------- Env helpers ----------------\nexport function getEnv(key, fallback = '') {\n  try {\n    const v = import.meta?.env?.[key];\n    return v === undefined || v === null || v === '' ? fallback : v;\n  } catch {\n    return fallback;\n  }\n}\n\n// Prefer using a server-side proxy (e.g., Netlify function) for Gemini calls.\n// Leave empty by default; set VITE_GEMINI_PROXY_URL to use your function.\nexport const PROXY_URL    = getEnv('VITE_GEMINI_PROXY_URL', '');\nexport const GEMINI_MODEL = getEnv('VITE_GEMINI_MODEL', 'gemini-1.5-pro');\n// Only for direct client calls in dev. Prefer PROXY_URL in production.\nexport const API_KEY      = getEnv('VITE_GEMINI_API_KEY', '');\n\nexport function hasGeminiKey() {\n  return Boolean(PROXY_URL) || Boolean(API_KEY);\n}\n\n// ---------------- Generic fetch helpers ----------------\nexport async function fetchJSON(input, init = {}) {\n  const url = typeof input === 'string' ? input : String(input);\n  const res = await fetch(url, {\n    credentials: 'include',\n    headers: { ...(init.headers || {}) },\n    ...init,\n  });\n\n  const text = await res.text();\n  let data;\n  try { data = text ? JSON.parse(text) : null; } catch { data = text; }\n\n  if (!res.ok) {\n    const err = new Error(`HTTP ${res.status} ${res.statusText}`);\n    err.status = res.status;\n    err.statusText = res.statusText;\n    err.body = data;\n    throw err;\n  }\n  return data;\n}\n\nexport function getJSON(url, init = {}) {\n  return fetchJSON(url, { method: 'GET', ...init });\n}\n\nexport function postJSON(url, body, init = {}) {\n  return fetchJSON(url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json', ...(init.headers || {}) },\n    body: JSON.stringify(body ?? {}),\n    ...init,\n  });\n}\n\n// ---------------- Gemini helper ----------------\n// callSecureGeminiAPI({ prompt?, messages?, systemInstruction?, model?, stream? })\nexport async function callSecureGeminiAPI(opts = {}) {\n  const {\n    prompt,\n    messages,\n    systemInstruction,\n    model = GEMINI_MODEL,\n    stream = false,\n    ...extra\n  } = opts || {};\n\n  // Prefer proxy (keeps your API key server-side)\n  if (PROXY_URL) {\n    return postJSON(PROXY_URL, {\n      model,\n      prompt,\n      messages,\n      systemInstruction,\n      stream,\n      ...extra,\n    });\n  }\n\n  // Fallback: direct call to Google API (dev-only)\n  if (!API_KEY) {\n    throw new Error('No PROXY_URL or API_KEY configured for Gemini calls.');\n  }\n\n  const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(\n    model\n  )}:generateContent?key=${encodeURIComponent(API_KEY)}`;\n\n  const contents =\n    Array.isArray(messages) && messages.length\n      ? normalizeToGeminiContents(messages)\n      : [{ role: 'user', parts: [{ text: String(prompt ?? '') }] }];\n\n  const body = {\n    contents,\n    ...(systemInstruction\n      ? { system_instruction: { parts: [{ text: String(systemInstruction) }] } }\n      : {}),\n  };\n\n  return postJSON(endpoint, body);\n}\n\nfunction normalizeToGeminiContents(msgs) {\n  return msgs.map((m) => {\n    if (m?.parts) return m;\n    // allow { role, text }\n    return { role: m.role || 'user', parts: [{ text: String(m.text ?? '') }] };\n  });\n}\n\n// ---------------- Markdown helper ----------------\nexport function mdToHtml(md = '') {\n  if (typeof md !== 'string') return '';\n\n  const escapeHtml = (s) =>\n    String(s)\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n\n  let out = md.replace(/\\r\\n?/g, '\\n');\n\n  // Code blocks ```...```\n  out = out.replace(/```([\\s\\S]*?)```/g, (_, code) => {\n    return `<pre><code>${escapeHtml(code)}</code></pre>`;\n  });\n\n  // Headings\n  out = out\n    .replace(/^###\\s+(.+)$/gm, '<h3>$1</h3>')\n    .replace(/^##\\s+(.+)$/gm, '<h2>$1</h2>')\n    .replace(/^#\\s+(.+)$/gm, '<h1>$1</h1>');\n\n  // Links [text](url)\n  out = out.replace(\n    /\\[([^\\]]+)]\\((https?:\\/\\/[^\\s)]+)\\)/g,\n    '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>'\n  );\n\n  // Inline code `code`\n  out = out.replace(/`([^`]+)`/g, (_, code) => `<code>${escapeHtml(code)}</code>`);\n\n  // Bold then italic\n  out = out.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\n  out = out.replace(/(^|[^*])\\*([^*\\n]+)\\*(?!\\*)/g, '$1<em>$2</em>');\n\n  // Unordered lists\n  out = out.replace(\n    /(?:^|\\n)(- .*(?:\\n- .*)*)(?:\\n|$)/g,\n    (block) => {\n      const items = block\n        .trim()\n        .split('\\n')\n        .filter((l) => l.trim().startsWith('- '))\n        .map((l) => l.replace(/^- /, '').trim());\n      if (!items.length) return block;\n      return `\\n<ul>${items.map((i) => `<li>${i}</li>`).join('')}</ul>\\n`;\n    }\n  );\n\n  // Paragraphs\n  const parts = out.split(/\\n{2,}/).map((chunk) => chunk.trim());\n  out = parts\n    .map((chunk) => {\n      if (!chunk) return '';\n      if (/^<(h\\d|ul|pre|blockquote|table|p|img|hr|code)/i.test(chunk)) return chunk;\n      return `<p>${chunk}</p>`;\n    })\n    .join('\\n');\n\n  return out;\n}\n\n// ---------------- Tiny local storage utils ----------------\nexport function sleep(ms) {\n  return new Promise((r) => setTimeout(r, Number(ms) || 0));\n}\nexport function readLocal(key, fallback = null) {\n  try {\n    const v = localStorage.getItem(key);\n    return v === null ? fallback : JSON.parse(v);\n  } catch {\n    return fallback;\n  }\n}\nexport function writeLocal(key, value) {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch {}\n}\nexport function removeLocal(key) {\n  try {\n    localStorage.removeItem(key);\n  } catch {}\n}\n\n// Optional default export for namespace import\nconst ApiHelpers = {\n  PROXY_URL,\n  GEMINI_MODEL,\n  API_KEY,\n  hasGeminiKey,\n  fetchJSON,\n  getJSON,\n  postJSON,\n  callSecureGeminiAPI,\n  mdToHtml,\n  sleep,\n  readLocal,\n  writeLocal,\n  removeLocal,\n};\n\nexport default ApiHelpers;\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/constants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/devPlanAdapter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/errorHandler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/firebaseUtils.js","messages":[{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":75,"column":13,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":75,"endColumn":27,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[2454,2473],"text":"Object.prototype.hasOwnProperty.call(obj, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":190,"column":15,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":190,"endColumn":29,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[5444,5463],"text":"Object.prototype.hasOwnProperty.call(obj, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/utils/firebaseUtils.js\n// Utility functions for Firebase integration\n// CRITICAL: Strips Firebase FieldValue sentinels that cause React Error #31\n\n/**\n * Recursively strips Firebase FieldValue sentinels from data\n * \n * Firebase sentinels like serverTimestamp() are special objects that:\n * - Get converted to timestamps on the server\n * - Return as sentinel objects in client callbacks\n * - Cannot be rendered by React (causes Error #31)\n * - Must be stripped before entering React state\n * \n * @param {any} obj - Data that may contain sentinels\n * @returns {any} - Clean data with sentinels removed\n */\nexport const stripFirebaseSentinels = (obj) => {\n  // Handle null, undefined, primitives\n  if (!obj || typeof obj !== 'object') {\n    return obj;\n  }\n  \n  // Check if this is a Firebase sentinel\n  // Sentinels have specific constructor names or method signatures\n  const isSentinel = (\n    obj.constructor?.name === 'FieldValue' ||\n    obj.constructor?.name === 'ServerTimestampTransform' ||\n    obj.constructor?.name === 'DeleteFieldValueImpl' ||\n    obj.constructor?.name === 'NumericIncrementFieldValueImpl' ||\n    obj.constructor?.name === 'ArrayUnionFieldValueImpl' ||\n    obj.constructor?.name === 'ArrayRemoveFieldValueImpl' ||\n    obj._methodName === 'serverTimestamp' ||\n    obj._methodName === 'delete' ||\n    obj._methodName === 'increment' ||\n    obj._methodName === 'arrayUnion' ||\n    obj._methodName === 'arrayRemove' ||\n    // Additional check: has toJSON but not a Date\n    (obj.toJSON && typeof obj.toJSON === 'function' && !obj.toISOString)\n  );\n  \n  if (isSentinel) {\n    console.warn('[stripSentinels] Removing Firebase sentinel:', {\n      constructor: obj.constructor?.name,\n      method: obj._methodName,\n      type: typeof obj\n    });\n    return null; // Remove the sentinel entirely\n  }\n  \n  // Handle Date objects (preserve them)\n  if (obj instanceof Date) {\n    return obj;\n  }\n  \n  // Handle Firestore Timestamp objects (convert to Date)\n  if (obj.toDate && typeof obj.toDate === 'function') {\n    try {\n      return obj.toDate();\n    } catch (e) {\n      console.warn('[stripSentinels] Failed to convert Timestamp:', e);\n      return null;\n    }\n  }\n  \n  // Handle arrays\n  if (Array.isArray(obj)) {\n    return obj\n      .map(item => stripFirebaseSentinels(item))\n      .filter(item => item !== null && item !== undefined);\n  }\n  \n  // Handle plain objects\n  const cleaned = {};\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      const value = stripFirebaseSentinels(obj[key]);\n      // Only add non-null values\n      if (value !== null && value !== undefined) {\n        cleaned[key] = value;\n      }\n    }\n  }\n  \n  return cleaned;\n};\n\n/**\n * Creates a Firestore converter that automatically strips sentinels\n * Use with: doc(db, path).withConverter(createCleanConverter())\n */\nexport const createCleanConverter = () => ({\n  toFirestore: (data) => data,\n  fromFirestore: (snapshot, options) => {\n    const data = snapshot.data(options);\n    return stripFirebaseSentinels(data);\n  }\n});\n\n/**\n * Wraps a Firestore onSnapshot callback to auto-strip sentinels\n * \n * @param {Function} callback - Your snapshot handler\n * @returns {Function} - Wrapped callback that strips sentinels\n * \n * Usage:\n * onSnapshot(docRef, withSentinelStripping((snap) => {\n *   if (snap.exists()) {\n *     const data = snap.data(); // Already cleaned!\n *     setState(data);\n *   }\n * }))\n */\nexport const withSentinelStripping = (callback) => {\n  return (snapshot) => {\n    if (snapshot.exists && snapshot.exists()) {\n      // Get raw data\n      const rawData = snapshot.data();\n      \n      // Strip sentinels\n      const cleanData = stripFirebaseSentinels(rawData);\n      \n      // Create a proxy snapshot with clean data\n      const cleanSnapshot = {\n        ...snapshot,\n        data: () => cleanData,\n        _originalData: rawData\n      };\n      \n      return callback(cleanSnapshot);\n    }\n    \n    return callback(snapshot);\n  };\n};\n\n/**\n * Validates that data is clean (no sentinels)\n * Useful for debugging\n * \n * @param {any} data - Data to validate\n * @param {string} context - Description for logging\n * @returns {boolean} - True if clean, false if sentinels found\n */\nexport const validateNoSentinels = (data, context = 'unknown') => {\n  const sentinels = findSentinels(data);\n  \n  if (sentinels.length > 0) {\n    console.error(`[validateNoSentinels] Found ${sentinels.length} sentinel(s) in ${context}:`, sentinels);\n    return false;\n  }\n  \n  console.log(`[validateNoSentinels] ✓ ${context} is clean`);\n  return true;\n};\n\n/**\n * Internal: Recursively finds all sentinels in data\n * Used by validateNoSentinels\n */\nconst findSentinels = (obj, path = 'root') => {\n  if (!obj || typeof obj !== 'object') {\n    return [];\n  }\n  \n  const sentinels = [];\n  \n  // Check if current object is a sentinel\n  const isSentinel = (\n    obj.constructor?.name === 'FieldValue' ||\n    obj.constructor?.name?.includes('Transform') ||\n    obj._methodName ||\n    (obj.toJSON && typeof obj.toJSON === 'function' && !obj.toISOString && !obj.toDate)\n  );\n  \n  if (isSentinel) {\n    sentinels.push({\n      path,\n      constructor: obj.constructor?.name,\n      method: obj._methodName\n    });\n  }\n  \n  // Recursively check children\n  if (Array.isArray(obj)) {\n    obj.forEach((item, index) => {\n      sentinels.push(...findSentinels(item, `${path}[${index}]`));\n    });\n  } else {\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        sentinels.push(...findSentinels(obj[key], `${path}.${key}`));\n      }\n    }\n  }\n  \n  return sentinels;\n};\n\n/**\n * Safely converts Firestore Timestamp to ISO string\n * Handles both Firestore Timestamps and Date objects\n */\nexport const toISOString = (timestamp) => {\n  if (!timestamp) return null;\n  \n  // Already a string\n  if (typeof timestamp === 'string') {\n    return timestamp;\n  }\n  \n  // Firestore Timestamp\n  if (timestamp.toDate && typeof timestamp.toDate === 'function') {\n    try {\n      return timestamp.toDate().toISOString();\n    } catch (e) {\n      console.warn('[toISOString] Failed to convert Timestamp:', e);\n      return null;\n    }\n  }\n  \n  // Date object\n  if (timestamp instanceof Date) {\n    return timestamp.toISOString();\n  }\n  \n  console.warn('[toISOString] Unknown timestamp format:', timestamp);\n  return null;\n};\n\nexport default {\n  stripFirebaseSentinels,\n  createCleanConverter,\n  withSentinelStripping,\n  validateNoSentinels,\n  toISOString\n};\n","usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/src/utils/logger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/tailwind.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/test-issues.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/test-navigation-modes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/vite.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/workspaces/leaderreps-PDPlatformDev/vite.config.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]